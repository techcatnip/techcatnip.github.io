<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>kubectl备忘录</title>
      <link href="/posts/dfa35092.html"/>
      <url>/posts/dfa35092.html</url>
      
        <content type="html"><![CDATA[<h1 id="kubectl备忘录"><a href="#kubectl备忘录" class="headerlink" title="kubectl备忘录"></a>kubectl备忘录</h1><p><strong>说明:</strong></p><p>这些指令适用于 Kubernetes v1.27。要检查版本，请使用 <code>kubectl version</code> 命令。</p><p>本页列举了常用的 <code>kubectl</code> 命令和标志。Kubectl 自动补全</p><p><a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/cheatsheet/">kubectl 备忘单 | Kubernetes</a></p><p><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#-strong-getting-started-strong-">Kubectl 命令参考文档</a></p><h2 id="Kubectl-自动补全"><a href="#Kubectl-自动补全" class="headerlink" title="Kubectl 自动补全"></a>Kubectl 自动补全</h2><p>BASH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bash-completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)  <span class="comment"># 在 bash 中设置当前 shell 的自动补全，要先安装 bash-completion 包。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc <span class="comment"># 在你的 bash shell 中永久地添加自动补全</span></span><br></pre></td></tr></table></figure><h3 id="关于-all-namespaces-的一点说明"><a href="#关于-all-namespaces-的一点说明" class="headerlink" title="关于 --all-namespaces 的一点说明"></a>关于 <code>--all-namespaces</code> 的一点说明</h3><p>我们经常用到<code>--all-namespaces</code> 参数，应该要知道它的简写：</p><p><code>kubectl -A</code></p><h2 id="Kubectl-上下文和配置"><a href="#Kubectl-上下文和配置" class="headerlink" title="Kubectl 上下文和配置"></a>Kubectl 上下文和配置</h2><p>设置<code>kubectl</code> 与哪个 Kubernetes 集群进行通信并修改配置信息。 查看使用 kubeconfig 跨集群授权访问 文档获取配置文件详细信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">kubectl config view <span class="comment"># 显示合并的 kubeconfig 配置。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时使用多个 kubeconfig 文件并查看合并的配置</span></span><br><span class="line">KUBECONFIG=~/.kube/config:~/.kube/kubconfig2</span><br><span class="line">kubectl config view</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 e2e 用户的密码</span></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[?(@.name == &quot;e2e&quot;)].user.password&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[].name&#125;&#x27;</span>    <span class="comment"># 显示第一个用户</span></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[*].name&#125;&#x27;</span>   <span class="comment"># 获取用户列表</span></span><br><span class="line">kubectl config get-contexts                          <span class="comment"># 显示上下文列表</span></span><br><span class="line">kubectl config current-context                       <span class="comment"># 展示当前所处的上下文</span></span><br><span class="line">kubectl config use-context my-cluster-name           <span class="comment"># 设置默认的上下文为 my-cluster-name</span></span><br><span class="line"></span><br><span class="line">kubectl config set-cluster my-cluster-name           <span class="comment"># 在 kubeconfig 中设置集群条目</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 kubeconfig 中配置代理服务器的 URL，以用于该客户端的请求</span></span><br><span class="line">kubectl config set-cluster my-cluster-name --proxy-url=my-proxy-url</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加新的用户配置到 kubeconf 中，使用 basic auth 进行身份认证</span></span><br><span class="line">kubectl config set-credentials kubeuser/foo.kubernetes.com --username=kubeuser --password=kubepassword</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定上下文中持久性地保存名字空间，供所有后续 kubectl 命令使用</span></span><br><span class="line">kubectl config set-context --current --namespace=ggckad-s2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用特定的用户名和名字空间设置上下文</span></span><br><span class="line">kubectl config set-context gce --user=cluster-admin --namespace=foo \</span><br><span class="line">  &amp;&amp; kubectl config use-context gce</span><br><span class="line"></span><br><span class="line">kubectl config <span class="built_in">unset</span> users.foo                       <span class="comment"># 删除用户 foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置或显示 context / namespace 的短别名</span></span><br><span class="line"><span class="comment"># （仅适用于 bash 和 bash 兼容的 shell，在使用 kn 设置命名空间之前要先设置 current-context）</span></span><br><span class="line"><span class="built_in">alias</span> kx=<span class="string">&#x27;f() &#123; [ &quot;$1&quot; ] &amp;&amp; kubectl config use-context $1 || kubectl config current-context ; &#125; ; f&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> kn=<span class="string">&#x27;f() &#123; [ &quot;$1&quot; ] &amp;&amp; kubectl config set-context --current --namespace $1 || kubectl config view --minify | grep namespace | cut -d&quot; &quot; -f6 ; &#125; ; f&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./my-manifest.yaml           <span class="comment"># 创建资源</span></span><br><span class="line">kubectl apply -f ./my1.yaml -f ./my2.yaml     <span class="comment"># 使用多个文件创建</span></span><br><span class="line">kubectl apply -f ./dir                        <span class="comment"># 基于目录下的所有清单文件创建资源</span></span><br><span class="line">kubectl apply -f https://git.io/vPieo         <span class="comment"># 从 URL 中创建资源</span></span><br><span class="line">kubectl create deployment nginx --image=nginx <span class="comment"># 启动单实例 nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个打印 “Hello World” 的 Job</span></span><br><span class="line">kubectl create job hello --image=busybox:1.28 -- <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个打印 “Hello World” 间隔1分钟的 CronJob</span></span><br><span class="line">kubectl create cronjob hello --image=busybox:1.28   --schedule=<span class="string">&quot;*/1 * * * *&quot;</span> -- <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span>  </span><br><span class="line"></span><br><span class="line">kubectl explain pods                          <span class="comment"># 获取 pod 清单的文档说明</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从标准输入创建多个 YAML 对象</span></span><br><span class="line">kubectl apply -f - &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: busybox-sleep</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: busybox</span></span><br><span class="line"><span class="string">    image: busybox:1.28</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">    - sleep</span></span><br><span class="line"><span class="string">    - &quot;1000000&quot;</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: busybox-sleep-less</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: busybox</span></span><br><span class="line"><span class="string">    image: busybox:1.28</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">    - sleep</span></span><br><span class="line"><span class="string">    - &quot;1000&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建有多个 key 的 Secret</span></span><br><span class="line">kubectl apply -f - &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Secret</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: mysecret</span></span><br><span class="line"><span class="string">type: Opaque</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">  password: $(echo -n &quot;s33msi4&quot; | base64 -w0)</span></span><br><span class="line"><span class="string">  username: $(echo -n &quot;jane&quot; | base64 -w0)</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="查看和查找资源"><a href="#查看和查找资源" class="headerlink" title="查看和查找资源"></a>查看和查找资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get 命令的基本输出</span></span><br><span class="line">kubectl get services                          <span class="comment"># 列出当前命名空间下的所有 services</span></span><br><span class="line">kubectl get pods --all-namespaces             <span class="comment"># 列出所有命名空间下的全部的 Pods</span></span><br><span class="line">kubectl get pods -o wide                      <span class="comment"># 列出当前命名空间下的全部 Pods，并显示更详细的信息</span></span><br><span class="line">kubectl get deployment my-dep                 <span class="comment"># 列出某个特定的 Deployment</span></span><br><span class="line">kubectl get pods                              <span class="comment"># 列出当前命名空间下的全部 Pods</span></span><br><span class="line">kubectl get pod my-pod -o yaml                <span class="comment"># 获取一个 pod 的 YAML</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># describe 命令的详细输出</span></span><br><span class="line">kubectl describe nodes my-node</span><br><span class="line">kubectl describe pods my-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前名字空间下所有 Services，按名称排序</span></span><br><span class="line">kubectl get services --sort-by=.metadata.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出 Pods，按重启次数排序</span></span><br><span class="line">kubectl get pods --sort-by=<span class="string">&#x27;.status.containerStatuses[0].restartCount&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列举所有 PV 持久卷，按容量排序</span></span><br><span class="line">kubectl get pv --sort-by=.spec.capacity.storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取包含 app=cassandra 标签的所有 Pods 的 version 标签</span></span><br><span class="line">kubectl get pods --selector=app=cassandra -o \</span><br><span class="line">  jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.labels.version&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索带有 “.” 键值，例： &#x27;ca.crt&#x27;</span></span><br><span class="line">kubectl get configmap myconfig \</span><br><span class="line">  -o jsonpath=<span class="string">&#x27;&#123;.data.ca\.crt&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索一个 base64 编码的值，其中的键名应该包含减号而不是下划线。</span></span><br><span class="line">kubectl get secret my-secret --template=<span class="string">&#x27;&#123;&#123;index .data &quot;key-name-with-dashes&quot;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有工作节点（使用选择器以排除标签名称为 &#x27;node-role.kubernetes.io/control-plane&#x27; 的结果）</span></span><br><span class="line">kubectl get node --selector=<span class="string">&#x27;!node-role.kubernetes.io/control-plane&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前命名空间中正在运行的 Pods</span></span><br><span class="line">kubectl get pods --field-selector=status.phase=Running</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取全部节点的 ExternalIP 地址</span></span><br><span class="line">kubectl get nodes -o jsonpath=<span class="string">&#x27;&#123;.items[*].status.addresses[?(@.type==&quot;ExternalIP&quot;)].address&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出属于某个特定 RC 的 Pods 的名称</span></span><br><span class="line"><span class="comment"># 在转换对于 jsonpath 过于复杂的场合，&quot;jq&quot; 命令很有用；可以在 https://stedolan.github.io/jq/ 找到它。</span></span><br><span class="line">sel=<span class="variable">$&#123;$(kubectl get rc my-rc --output=json | jq -j &#x27;.spec.selector | to_entries | .[] | &quot;\(.key)=\(.value),&quot;&#x27;)%?&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $(kubectl get pods --selector=<span class="variable">$sel</span> --output=jsonpath=&#123;.items..metadata.name&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有 Pods 的标签（或任何其他支持标签的 Kubernetes 对象）</span></span><br><span class="line">kubectl get pods --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查哪些节点处于就绪状态</span></span><br><span class="line">JSONPATH=<span class="string">&#x27;&#123;range .items[*]&#125;&#123;@.metadata.name&#125;:&#123;range @.status.conditions[*]&#125;&#123;@.type&#125;=&#123;@.status&#125;;&#123;end&#125;&#123;end&#125;&#x27;</span> \</span><br><span class="line"> &amp;&amp; kubectl get nodes -o jsonpath=<span class="string">&quot;<span class="variable">$JSONPATH</span>&quot;</span> | grep <span class="string">&quot;Ready=True&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用外部工具来输出解码后的 Secret</span></span><br><span class="line">kubectl get secret my-secret -o go-template=<span class="string">&#x27;&#123;&#123;range $k,$v := .data&#125;&#125;&#123;&#123;&quot;### &quot;&#125;&#125;&#123;&#123;$k&#125;&#125;&#123;&#123;&quot;\n&quot;&#125;&#125;&#123;&#123;$v|base64decode&#125;&#125;&#123;&#123;&quot;\n\n&quot;&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出被一个 Pod 使用的全部 Secret</span></span><br><span class="line">kubectl get pods -o json | jq <span class="string">&#x27;.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name&#x27;</span> | grep -v null | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列举所有 Pods 中初始化容器的容器 ID（containerID）</span></span><br><span class="line"><span class="comment"># 可用于在清理已停止的容器时避免删除初始化容器</span></span><br><span class="line">kubectl get pods --all-namespaces -o jsonpath=<span class="string">&#x27;&#123;range .items[*].status.initContainerStatuses[*]&#125;&#123;.containerID&#125;&#123;&quot;\n&quot;&#125;&#123;end&#125;&#x27;</span> | <span class="built_in">cut</span> -d/ -f3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出事件（Events），按时间戳排序</span></span><br><span class="line">kubectl get events --sort-by=.metadata.creationTimestamp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有警告事件</span></span><br><span class="line">kubectl events --types=Warning</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较当前的集群状态和假定某清单被应用之后的集群状态</span></span><br><span class="line">kubectl diff -f ./my-manifest.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个句点分隔的树，其中包含为节点返回的所有键</span></span><br><span class="line"><span class="comment"># 在复杂的嵌套JSON结构中定位键时非常有用</span></span><br><span class="line">kubectl get nodes -o json | jq -c <span class="string">&#x27;paths|join(&quot;.&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个句点分隔的树，其中包含为pod等返回的所有键</span></span><br><span class="line">kubectl get pods -o json | jq -c <span class="string">&#x27;paths|join(&quot;.&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设你的 Pods 有默认的容器和默认的名字空间，并且支持 &#x27;env&#x27; 命令，可以使用以下脚本为所有 Pods 生成 ENV 变量。</span></span><br><span class="line"><span class="comment"># 该脚本也可用于在所有的 Pods 里运行任何受支持的命令，而不仅仅是 &#x27;env&#x27;。 </span></span><br><span class="line"><span class="keyword">for</span> pod <span class="keyword">in</span> $(kubectl get po --output=jsonpath=&#123;.items..metadata.name&#125;); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$pod</span> &amp;&amp; kubectl <span class="built_in">exec</span> -it <span class="variable">$pod</span> -- <span class="built_in">env</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个 Deployment 的 status 子资源</span></span><br><span class="line">kubectl get deployment nginx-deployment --subresource=status</span><br></pre></td></tr></table></figure><h2 id="更新资源"><a href="#更新资源" class="headerlink" title="更新资源"></a>更新资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/frontend www=image:v2               <span class="comment"># 滚动更新 &quot;frontend&quot; Deployment 的 &quot;www&quot; 容器镜像</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/frontend                      <span class="comment"># 检查 Deployment 的历史记录，包括版本</span></span><br><span class="line">kubectl rollout undo deployment/frontend                         <span class="comment"># 回滚到上次部署版本</span></span><br><span class="line">kubectl rollout undo deployment/frontend --to-revision=2         <span class="comment"># 回滚到特定部署版本</span></span><br><span class="line">kubectl rollout status -w deployment/frontend                    <span class="comment"># 监视 &quot;frontend&quot; Deployment 的滚动升级状态直到完成</span></span><br><span class="line">kubectl rollout restart deployment/frontend                      <span class="comment"># 轮替重启 &quot;frontend&quot; Deployment</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> pod.json | kubectl replace -f -                              <span class="comment"># 通过传入到标准输入的 JSON 来替换 Pod</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制替换，删除后重建资源。会导致服务不可用。</span></span><br><span class="line">kubectl replace --force -f ./pod.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为多副本的 nginx 创建服务，使用 80 端口提供服务，连接到容器的 8000 端口。</span></span><br><span class="line">kubectl expose rc nginx --port=80 --target-port=8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某单容器 Pod 的镜像版本（标签）更新到 v4</span></span><br><span class="line">kubectl get pod mypod -o yaml | sed <span class="string">&#x27;s/\(image: myimage\):.*$/\1:v4/&#x27;</span> | kubectl replace -f -</span><br><span class="line"></span><br><span class="line">kubectl label pods my-pod new-label=awesome                      <span class="comment"># 添加标签</span></span><br><span class="line">kubectl label pods my-pod new-label-                             <span class="comment"># 移除标签</span></span><br><span class="line">kubectl annotate pods my-pod icon-url=http://goo.gl/XXBTWq       <span class="comment"># 添加注解</span></span><br><span class="line">kubectl autoscale deployment foo --min=2 --max=10                <span class="comment"># 对 &quot;foo&quot; Deployment 自动伸缩容</span></span><br></pre></td></tr></table></figure><h2 id="部分更新资源"><a href="#部分更新资源" class="headerlink" title="部分更新资源"></a>部分更新资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部分更新某节点</span></span><br><span class="line">kubectl patch node k8s-node-1 -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;unschedulable&quot;:true&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新容器的镜像；spec.containers[*].name 是必须的。因为它是一个合并性质的主键。</span></span><br><span class="line">kubectl patch pod valid-pod -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;name&quot;:&quot;kubernetes-serve-hostname&quot;,&quot;image&quot;:&quot;new image&quot;&#125;]&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用带位置数组的 JSON patch 更新容器的镜像</span></span><br><span class="line">kubectl patch pod valid-pod --<span class="built_in">type</span>=<span class="string">&#x27;json&#x27;</span> -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/containers/0/image&quot;, &quot;value&quot;:&quot;new image&quot;&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用带位置数组的 JSON patch 禁用某 Deployment 的 livenessProbe</span></span><br><span class="line">kubectl patch deployment valid-deployment  --<span class="built_in">type</span> json   -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/livenessProbe&quot;&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在带位置数组中添加元素</span></span><br><span class="line">kubectl patch sa default --<span class="built_in">type</span>=<span class="string">&#x27;json&#x27;</span> -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/secrets/1&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;whatever&quot; &#125; &#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过修正 scale 子资源来更新 Deployment 的副本数</span></span><br><span class="line">kubectl patch deployment nginx-deployment --subresource=<span class="string">&#x27;scale&#x27;</span> --<span class="built_in">type</span>=<span class="string">&#x27;merge&#x27;</span> -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;replicas&quot;:2&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="对资源进行伸缩"><a href="#对资源进行伸缩" class="headerlink" title="对资源进行伸缩"></a>对资源进行伸缩</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=3 rs/foo                                 <span class="comment"># 将名为 &#x27;foo&#x27; 的副本集伸缩到 3 副本</span></span><br><span class="line">kubectl scale --replicas=3 -f foo.yaml                            <span class="comment"># 将在 &quot;foo.yaml&quot; 中的特定资源伸缩到 3 个副本</span></span><br><span class="line">kubectl scale --current-replicas=2 --replicas=3 deployment/mysql  <span class="comment"># 如果名为 mysql 的 Deployment 的副本当前是 2，那么将它伸缩到 3</span></span><br><span class="line">kubectl scale --replicas=5 rc/foo rc/bar rc/baz                   <span class="comment"># 伸缩多个副本控制器</span></span><br></pre></td></tr></table></figure><h2 id="删除资源"><a href="#删除资源" class="headerlink" title="删除资源"></a>删除资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f ./pod.json                                              <span class="comment"># 删除在 pod.json 中指定的类型和名称的 Pod</span></span><br><span class="line">kubectl delete pod unwanted --now                                         <span class="comment"># 删除 Pod 且无宽限期限（无优雅时段）</span></span><br><span class="line">kubectl delete pod,service baz foo                                        <span class="comment"># 删除名称为 &quot;baz&quot; 和 &quot;foo&quot; 的 Pod 和服务</span></span><br><span class="line">kubectl delete pods,services -l name=myLabel                              <span class="comment"># 删除包含 name=myLabel 标签的 pods 和服务</span></span><br><span class="line">kubectl -n my-ns delete pod,svc --all                                     <span class="comment"># 删除在 my-ns 名字空间中全部的 Pods 和服务</span></span><br><span class="line"><span class="comment"># 删除所有与 pattern1 或 pattern2 awk 模式匹配的 Pods</span></span><br><span class="line">kubectl get pods  -n mynamespace --no-headers=<span class="literal">true</span> | awk <span class="string">&#x27;/pattern1|pattern2/&#123;print $1&#125;&#x27;</span> | xargs  kubectl delete -n mynamespace pod</span><br></pre></td></tr></table></figure><h2 id="与运行中的-Pod-进行交互"><a href="#与运行中的-Pod-进行交互" class="headerlink" title="与运行中的 Pod 进行交互"></a>与运行中的 Pod 进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs my-pod                                 <span class="comment"># 获取 pod 日志（标准输出）</span></span><br><span class="line">kubectl logs -l name=myLabel                        <span class="comment"># 获取含 name=myLabel 标签的 Pods 的日志（标准输出）</span></span><br><span class="line">kubectl logs my-pod --previous                      <span class="comment"># 获取上个容器实例的 pod 日志（标准输出）</span></span><br><span class="line">kubectl logs my-pod -c my-container                 <span class="comment"># 获取 Pod 容器的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -l name=myLabel -c my-container        <span class="comment"># 获取含 name=myLabel 标签的 Pod 容器日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs my-pod -c my-container --previous      <span class="comment"># 获取 Pod 中某容器的上个实例的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -f my-pod                              <span class="comment"># 流式输出 Pod 的日志（标准输出）</span></span><br><span class="line">kubectl logs -f my-pod -c my-container              <span class="comment"># 流式输出 Pod 容器的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -f -l name=myLabel --all-containers    <span class="comment"># 流式输出含 name=myLabel 标签的 Pod 的所有日志（标准输出）</span></span><br><span class="line">kubectl run -i --<span class="built_in">tty</span> busybox --image=busybox:1.28 -- sh  <span class="comment"># 以交互式 Shell 运行 Pod</span></span><br><span class="line">kubectl run nginx --image=nginx -n mynamespace      <span class="comment"># 在 “mynamespace” 命名空间中运行单个 nginx Pod</span></span><br><span class="line">kubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml</span><br><span class="line">                                                    <span class="comment"># 为运行 nginx Pod 生成规约并将其写入到名为 pod.yaml 的文件</span></span><br><span class="line"></span><br><span class="line">kubectl attach my-pod -i                            <span class="comment"># 挂接到一个运行的容器中</span></span><br><span class="line">kubectl port-forward my-pod 5000:6000               <span class="comment"># 在本地计算机上侦听端口 5000 并转发到 my-pod 上的端口 6000</span></span><br><span class="line">kubectl <span class="built_in">exec</span> my-pod -- <span class="built_in">ls</span> /                         <span class="comment"># 在已有的 Pod 中运行命令（单容器场景）</span></span><br><span class="line">kubectl <span class="built_in">exec</span> --stdin --<span class="built_in">tty</span> my-pod -- /bin/sh        <span class="comment"># 使用交互 shell 访问正在运行的 Pod (一个容器场景)</span></span><br><span class="line">kubectl <span class="built_in">exec</span> my-pod -c my-container -- <span class="built_in">ls</span> /         <span class="comment"># 在已有的 Pod 中运行命令（多容器场景）</span></span><br><span class="line">kubectl top pod POD_NAME --containers               <span class="comment"># 显示给定 Pod 和其中容器的监控数据</span></span><br><span class="line">kubectl top pod POD_NAME --sort-by=cpu              <span class="comment"># 显示给定 Pod 的指标并且按照 &#x27;cpu&#x27; 或者 &#x27;memory&#x27; 排序</span></span><br></pre></td></tr></table></figure><h2 id="从容器中复制文件和目录"><a href="#从容器中复制文件和目录" class="headerlink" title="从容器中复制文件和目录"></a>从容器中复制文件和目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo_dir my-pod:/tmp/bar_dir            <span class="comment"># 将 /tmp/foo_dir 本地目录复制到远程当前命名空间中 Pod 中的 /tmp/bar_dir</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo my-pod:/tmp/bar -c my-container    <span class="comment"># 将 /tmp/foo 本地文件复制到远程 Pod 中特定容器的 /tmp/bar 下</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo my-namespace/my-pod:/tmp/bar       <span class="comment"># 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间内指定 Pod 中的 /tmp/bar</span></span><br><span class="line">kubectl <span class="built_in">cp</span> my-namespace/my-pod:/tmp/foo /tmp/bar       <span class="comment"># 将 /tmp/foo 从远程 Pod 复制到本地 /tmp/bar</span></span><br></pre></td></tr></table></figure><h2 id="与-Deployments-和-Services-进行交互"><a href="#与-Deployments-和-Services-进行交互" class="headerlink" title="与 Deployments 和 Services 进行交互"></a>与 Deployments 和 Services 进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs deploy/my-deployment                         <span class="comment"># 获取一个 Deployment 的 Pod 的日志（单容器例子）</span></span><br><span class="line">kubectl logs deploy/my-deployment -c my-container         <span class="comment"># 获取一个 Deployment 的 Pod 的日志（多容器例子）</span></span><br><span class="line"></span><br><span class="line">kubectl port-forward svc/my-service 5000                  <span class="comment"># 侦听本地端口 5000 并转发到 Service 后端端口 5000</span></span><br><span class="line">kubectl port-forward svc/my-service 5000:my-service-port  <span class="comment"># 侦听本地端口 5000 并转发到名字为 &lt;my-service-port&gt; 的 Service 目标端口</span></span><br><span class="line"></span><br><span class="line">kubectl port-forward deploy/my-deployment 5000:6000       <span class="comment"># 侦听本地端口 5000 并转发到 &lt;my-deployment&gt; 创建的 Pod 里的端口 6000</span></span><br><span class="line">kubectl <span class="built_in">exec</span> deploy/my-deployment -- <span class="built_in">ls</span>                   <span class="comment"># 在 Deployment 里的第一个 Pod 的第一个容器里运行命令（单容器和多容器例子）</span></span><br></pre></td></tr></table></figure><h2 id="与节点和集群进行交互"><a href="#与节点和集群进行交互" class="headerlink" title="与节点和集群进行交互"></a>与节点和集群进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl cordon my-node                                                <span class="comment"># 标记 my-node 节点为不可调度</span></span><br><span class="line">kubectl drain my-node                                                 <span class="comment"># 对 my-node 节点进行清空操作，为节点维护做准备</span></span><br><span class="line">kubectl uncordon my-node                                              <span class="comment"># 标记 my-node 节点为可以调度</span></span><br><span class="line">kubectl top node my-node                                              <span class="comment"># 显示给定节点的度量值</span></span><br><span class="line">kubectl cluster-info                                                  <span class="comment"># 显示主控节点和服务的地址</span></span><br><span class="line">kubectl cluster-info dump                                             <span class="comment"># 将当前集群状态转储到标准输出</span></span><br><span class="line">kubectl cluster-info dump --output-directory=/path/to/cluster-state   <span class="comment"># 将当前集群状态输出到 /path/to/cluster-state</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前节点上存在的现有污点。</span></span><br><span class="line">kubectl get nodes -o=<span class="string">&#x27;custom-columns=NodeName:.metadata.name,TaintKey:.spec.taints[*].key,TaintValue:.spec.taints[*].value,TaintEffect:.spec.taints[*].effect&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果已存在具有指定键和效果的污点，则替换其值为指定值。</span></span><br><span class="line">kubectl taint nodes foo dedicated=special-user:NoSchedule</span><br></pre></td></tr></table></figure><h2 id="资源类型"><a href="#资源类型" class="headerlink" title="资源类型"></a>资源类型</h2><p>列出所支持的全部资源类型和它们的简称、<a href="https://kubernetes.io/zh-cn/docs/concepts/overview/kubernetes-api/#api-groups-and-versioning">API 组</a>, <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces">名字空间作用域</a> 和 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects">Kind</a>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources</span><br></pre></td></tr></table></figure><p>用于探索 API 资源的其他操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources --namespaced=<span class="literal">true</span>      <span class="comment"># 所有命名空间作用域的资源</span></span><br><span class="line">kubectl api-resources --namespaced=<span class="literal">false</span>     <span class="comment"># 所有非命名空间作用域的资源</span></span><br><span class="line">kubectl api-resources -o name                <span class="comment"># 用简单格式列举所有资源（仅显示资源名称）</span></span><br><span class="line">kubectl api-resources -o wide                <span class="comment"># 用扩展格式列举所有资源（又称 &quot;wide&quot; 格式）</span></span><br><span class="line">kubectl api-resources --verbs=list,get       <span class="comment"># 支持 &quot;list&quot; 和 &quot;get&quot; 请求动词的所有资源</span></span><br><span class="line">kubectl api-resources --api-group=extensions <span class="comment"># &quot;extensions&quot; API 组中的所有资源</span></span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> kubectl </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu</title>
      <link href="/posts/7c4b9639.html"/>
      <url>/posts/7c4b9639.html</url>
      
        <content type="html"><![CDATA[<h1 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h1><h2 id="Ubuntu镜像下载"><a href="#Ubuntu镜像下载" class="headerlink" title="Ubuntu镜像下载"></a>Ubuntu镜像下载</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://cdimage.ubuntu.com/releases/ #ubuntu server(服务器版)</span><br><span class="line">http://releases.ubuntu.com/ #ubuntu desktop(桌⾯版)</span><br></pre></td></tr></table></figure><h2 id="Ubuntu-Server系统基础配置"><a href="#Ubuntu-Server系统基础配置" class="headerlink" title="Ubuntu Server系统基础配置"></a>Ubuntu Server系统基础配置</h2><p> 更改主机名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/hostname</span></span><br><span class="line">ubuntu-node.example.com</span><br></pre></td></tr></table></figure><h3 id="更改网卡名称为eth0"><a href="#更改网卡名称为eth0" class="headerlink" title="更改网卡名称为eth0"></a>更改网卡名称为eth0</h3><p> 如果没有在安装系统之前传递内核参数将⽹卡名称更改为eth*，则可以在 安装系统之后使⽤以下⽅式修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;net.ifnames=0 biosdevname=0&quot;</span>   <span class="comment">#修改此行添加net.ifnames=0 biosdevname=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新生成grub配置,并重启</span></span><br><span class="line">update-grub   </span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="配置root远程登录"><a href="#配置root远程登录" class="headerlink" title="配置root远程登录"></a>配置root远程登录</h3><p> 默认情况下，ubuntu不允许root⽤⼾远程ssh，如果有实际场景需要允许 root⽤⼾远程ssh，则需要设置root密码，并且编辑 <code>/etc/ssh/sshd_config</code> ⽂件修改如下 :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">32 <span class="comment">#PermitRootLogin prohibit-password  #默认为禁⽌登录</span></span><br><span class="line">33 PermitRootLogin <span class="built_in">yes</span>   <span class="comment">#改为允许登录</span></span><br><span class="line">57 <span class="comment">#PasswordAuthentication yes</span></span><br><span class="line">58 PasswordAuthentication <span class="built_in">yes</span> <span class="comment">#打开密码认证，其实默认就是允许通过密码认证登录</span></span><br><span class="line"></span><br><span class="line">su - root <span class="comment">#切换到root⽤户环境</span></span><br><span class="line">passwd <span class="comment">#设置密码</span></span><br><span class="line">systemctl restart sshd <span class="comment">#重启ssh服务并测试root⽤户远程ssh连接</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Ubuntu-18-04网络配置"><a href="#Ubuntu-18-04网络配置" class="headerlink" title="Ubuntu 18.04网络配置"></a>Ubuntu 18.04网络配置</h2><h3 id="单网卡静态IP地址"><a href="#单网卡静态IP地址" class="headerlink" title="单网卡静态IP地址"></a>单网卡静态IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.0.0.121/24]</span><br><span class="line">      gateway4: 10.0.0.2</span><br><span class="line">      nameservers:</span><br><span class="line">        search: [neteagles.cn， neteagles.com]</span><br><span class="line">        addresses: [223.5.5.5, 223.6.6.6]</span><br><span class="line"><span class="comment">#重启网络生效</span></span><br><span class="line">netplan apply</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果复制粘贴格式错位,可以取消vim⾃动缩进功能</span></span><br><span class="line">vim ~/.vimrc </span><br><span class="line"><span class="built_in">set</span> <span class="built_in">paste</span>  <span class="comment">#添加</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置多网卡静态IP"><a href="#配置多网卡静态IP" class="headerlink" title="配置多网卡静态IP"></a>配置多网卡静态IP</h3><p> ubuntu 18.04配置多⽹卡静态IP以及静态路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.0.0.121/24]</span><br><span class="line">      gateway4: 10.0.0.2</span><br><span class="line">      nameservers:</span><br><span class="line">        search: [neteagles.cn， neteagles.com]</span><br><span class="line">        addresses: [223.5.5.5, 223.6.6.6]</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [192.168.10.100/24]</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">netplan apply</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="单网卡桥接"><a href="#单网卡桥接" class="headerlink" title="单网卡桥接"></a>单网卡桥接</h3><p> ubuntu 18.04的单⽹卡桥接配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6]</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">      </span><br><span class="line"><span class="comment">#netplan apply</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="多⽹卡桥接"><a href="#多⽹卡桥接" class="headerlink" title="多⽹卡桥接"></a>多⽹卡桥接</h3><p> ubuntu 18.04多⽹卡的桥接配置，将br0和br1分别桥接到eth0和eth1。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  </span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6]</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">    br1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.20.3.18/16]</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        interfaces:</span><br><span class="line">          - eth1</span><br></pre></td></tr></table></figure><h3 id="双⽹卡绑定"><a href="#双⽹卡绑定" class="headerlink" title="双⽹卡绑定"></a>双⽹卡绑定</h3><p> 七种bond模式说明</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第⼀种模式：mod=0，即：(balance-rr) Round-robin policy（平衡抡循环策略）</span></span><br><span class="line">特点：传输数据包顺序是依次传输（即：第1个包⾛eth0，下⼀个包就⾛eth1….⼀直循环下去，直到最后⼀个传输完毕），此模式提供负载平衡和容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第⼆种模式：mod=1，即： (active-backup) Active-backup policy（主-备份策略）</span></span><br><span class="line">特点：只有⼀个设备处于活动状态，当⼀个宕掉另⼀个⻢上由备份转换为主设备。mac地址是外部可⻅得，从外⾯看来，bond的MAC地址是唯⼀的，以避免switch(交换机)发⽣混乱。此模式只提供了容错能⼒；由此可⻅此算法的优点是可以提供⾼⽹络连接的可⽤性，但是它的资源利⽤率较低，只有⼀个接⼝处于⼯作状态，在有 N 个⽹络接⼝的情况下，资源利⽤率为1/N。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第三种模式：mod=2，即：(balance-xor) XOR policy（平衡策略）</span></span><br><span class="line">特点：基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR⽬标MAC地址) % slave数量。其他的传输策略可以通过xmit_hash_policy选项指定，此模式提供负载平衡和容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第四种模式：mod=3，即：broadcast（⼴播策略）</span></span><br><span class="line">特点：在每个slave接⼝上传输每个数据包，此模式提供了容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第五种模式：mod=4，即：(802.3ad) IEEE 802.3adDynamic link aggregation（IEEE 802.3ad 动态链接聚合）</span></span><br><span class="line">特点：创建⼀个聚合组，它们共享同样的速率和双⼯设定。根据802.3ad规范将多个slave⼯作在同⼀个激活的聚合下。</span><br><span class="line">必要条件：</span><br><span class="line">条件1：ethtool⽀持获取每个slave的速率和双⼯设定。</span><br><span class="line">条件2：switch(交换机)⽀持IEEE 802.3ad Dynamic <span class="built_in">link</span> aggregation。</span><br><span class="line">条件3：⼤多数switch(交换机)需要经过特定配置才能⽀持802.3ad模式。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第六种模式：mod=5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）</span></span><br><span class="line">特点：不需要任何特别的switch(交换机)⽀持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另⼀个slave接管失败的slave的MAC地址。该模式的必要条件：ethtool⽀持获取每个slave的速率</span><br><span class="line"></span><br><span class="line"><span class="comment">#第七种模式：mod=6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡）</span></span><br><span class="line">特点：该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，⽽且不需要任何switch(交换机)的⽀持。</span><br></pre></td></tr></table></figure><p> ubuntu 18.04的双⽹卡绑定配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">需要提前安装好bridge命令</span><br><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line"></span><br><span class="line"><span class="comment">#netplan apply</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="双⽹卡绑定-桥接"><a href="#双⽹卡绑定-桥接" class="headerlink" title="双⽹卡绑定+桥接"></a>双⽹卡绑定+桥接</h3><p> ⽹卡绑定⽤于提供⽹卡接⼝冗余以及⾼可⽤和端⼝聚合功能，桥接⽹卡再 给需要桥接设备的服务使⽤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      <span class="comment">#addresses: [172.18.3.18/16]</span></span><br><span class="line">      <span class="comment">#gateway4: 172.18.0.1</span></span><br><span class="line">      <span class="comment">#nameservers:</span></span><br><span class="line">        <span class="comment">#addresses: [223.6.6.6,223.5.5.5]</span></span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      interfaces:</span><br><span class="line">        - bond0</span><br><span class="line"><span class="comment">#reboot</span></span><br></pre></td></tr></table></figure><h3 id="内外多⽹卡绑定"><a href="#内外多⽹卡绑定" class="headerlink" title="内外多⽹卡绑定"></a>内外多⽹卡绑定</h3><p> 多⽹络情况下实现⽹卡绑定</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth2:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth3:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">    bond1:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth2</span><br><span class="line">        - eth3</span><br><span class="line">      addresses: [10.20.3.18/16]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br></pre></td></tr></table></figure><h3 id="内⽹多⽹卡绑定-桥接"><a href="#内⽹多⽹卡绑定-桥接" class="headerlink" title="内⽹多⽹卡绑定+桥接"></a>内⽹多⽹卡绑定+桥接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth2:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth3:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">    bond1:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth2</span><br><span class="line">        - eth3</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      interfaces:</span><br><span class="line">        - bond0</span><br><span class="line">      br1:</span><br><span class="line">        dhcp4: no</span><br><span class="line">        dhcp6: no</span><br><span class="line">        interfaces:</span><br><span class="line">          - bond1</span><br><span class="line">        addresses: [10.20.3.18/16]</span><br><span class="line">        routes:</span><br><span class="line">          - to: 172.20.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.20.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.2.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.8.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br></pre></td></tr></table></figure><h2 id="Ubuntu软件包管理"><a href="#Ubuntu软件包管理" class="headerlink" title="Ubuntu软件包管理"></a>Ubuntu软件包管理</h2><h3 id="修改软件仓库"><a href="#修改软件仓库" class="headerlink" title="修改软件仓库"></a>修改软件仓库</h3><p> 阿⾥云仓库地址：<a href="https://opsx.alibaba.com/mirror">https://opsx.alibaba.com/mirror</a></p><p>中科⼤：<a href="http://mirrors.ustc.edu.cn/help/ubuntu.html">http://mirrors.ustc.edu.cn/help/ubuntu.html</a></p><p>清华⼤学：<a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/">https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/</a></p><p>华为：<a href="https://mirrors.huaweicloud.com/">https://mirrors.huaweicloud.com/</a></p><p>设置为清华源:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">18.04LTS:</span><br><span class="line">Ubuntu 的软件源配置文件是 /etc/apt/sources.list。将系统自带的该文件做个备份，将该文件替换为下面内容:</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">20.04LTS:</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件源:</span></span><br><span class="line">apt update</span><br></pre></td></tr></table></figure><h3 id="apt-apt-get"><a href="#apt-apt-get" class="headerlink" title="apt&#x2F;apt-get"></a>apt&#x2F;apt-get</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apt list     <span class="comment">#apt列出仓库软件包，等于yum list</span></span><br><span class="line">apt search NAME    <span class="comment">#搜索安装包</span></span><br><span class="line">apt show apache2   <span class="comment">#查看某个安装包的详细信息</span></span><br><span class="line">apt install apache2   <span class="comment">#在线安装软件包</span></span><br><span class="line">apt remove apache2    <span class="comment">#卸载单个软件包但是保留配置⽂件</span></span><br><span class="line">apt autoremove apache2   <span class="comment">#删除安装包并解决依赖关系</span></span><br><span class="line">apt update   <span class="comment">#更新本地软件包列表索引，修改了apt仓库后必须执⾏</span></span><br><span class="line">apt purge apache2   <span class="comment">#卸载单个软件包删除配置⽂件</span></span><br><span class="line">apt upgrade   <span class="comment">#升级所有已安装且可升级到新版本的软件包</span></span><br><span class="line">apt full-upgrade    <span class="comment">#升级整个系统，必要时可以移除旧软件包。</span></span><br><span class="line">apt edit-sources    <span class="comment">#编辑source源⽂件</span></span><br><span class="line">apt-cache madison nginx    <span class="comment">#查看仓库中软件包有哪些版本可以安装</span></span><br><span class="line">apt install nginx=1.14.0-0ubuntu1.6    <span class="comment">#安装软件包的时候指定安装具体的版本,配合apt-cache madison使用</span></span><br></pre></td></tr></table></figure><h3 id="dpkg安装包管理"><a href="#dpkg安装包管理" class="headerlink" title="dpkg安装包管理"></a>dpkg安装包管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i gitlab-ce_11.9.8-ce.0_amd64.deb   <span class="comment">#安装某个软件包</span></span><br><span class="line">dpkg -r gitlab-ce     <span class="comment">#删除某个软件包保留配置⽂件</span></span><br><span class="line">dpkg -r -P gitlab-ce  <span class="comment">#删除某个软件包不保留配置⽂件</span></span><br><span class="line">dpkg -I gitlab-ce_11.9.8-ce.0_amd64.deb  <span class="comment">#查看软件包信息</span></span><br><span class="line">dpkg -c gitlab-ce_11.9.8-ce.0_amd64.deb  <span class="comment">#查看软件包内的⽂件及⽬录内容</span></span><br><span class="line">dpkg -l  <span class="comment">#列出本机已经安装的所有软件</span></span><br><span class="line">dpkg -L tree <span class="comment">#列出已安装软件包的⽂件</span></span><br></pre></td></tr></table></figure><h3 id="设置oracle-JDK环境"><a href="#设置oracle-JDK环境" class="headerlink" title="设置oracle JDK环境"></a>设置oracle JDK环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入目录中,解压⼆进制⽂件并设置软连接：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br><span class="line">tar xf jdk-8u212-linux-x64.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -sv /usr/local/src/jdk1.8.0_212 /usr/local/jdk</span><br><span class="line"><span class="comment">#配置环境变量： </span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span> </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="comment">#重新导⼊环境变量并验证：</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><h3 id="安装OpenJDK："><a href="#安装OpenJDK：" class="headerlink" title="安装OpenJDK："></a>安装OpenJDK：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h3 id="安装常用系统命令："><a href="#安装常用系统命令：" class="headerlink" title="安装常用系统命令："></a>安装常用系统命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt install purge ufw lxd lxd-client lxcfs lxc-common</span><br><span class="line">apt install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute gcc openssh-server lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip libevent-dev</span><br><span class="line"></span><br><span class="line">apt install procps (top 命令)</span><br><span class="line">apt install iputils-ping (ping 命令)</span><br><span class="line">apt install net-tools (网络工具)</span><br></pre></td></tr></table></figure><h3 id="系统资源限制优化"><a href="#系统资源限制优化" class="headerlink" title="系统资源限制优化"></a>系统资源限制优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ubuntu需要root和普通用户都要设置,centos只要设置星号的就行</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"><span class="comment">#root账⼾的资源软限制和硬限制</span></span><br><span class="line">root   soft   core      unlimited</span><br><span class="line">root   hard   core      unlimited</span><br><span class="line">root   soft   <span class="built_in">nproc</span>     1000000</span><br><span class="line">root   hard   <span class="built_in">nproc</span>     1000000</span><br><span class="line">root   soft   nofile    1000000</span><br><span class="line">root   hard   nofile    1000000</span><br><span class="line">root   soft   memlock   32000</span><br><span class="line">root   hard   memlock   32000</span><br><span class="line">root   soft   msgqueue  8192000</span><br><span class="line">root   hard   msgqueue  8192000</span><br><span class="line"></span><br><span class="line"><span class="comment">#其他账⼾的资源软限制和硬限制</span></span><br><span class="line">*      soft   core      unlimited</span><br><span class="line">*      hard   core      unlimited</span><br><span class="line">*      soft   <span class="built_in">nproc</span>     1000000</span><br><span class="line">*      hard   <span class="built_in">nproc</span>     1000000</span><br><span class="line">*      soft   nofile    1000000</span><br><span class="line">*      hard   nofile    1000000</span><br><span class="line">*      soft   memlock   32000</span><br><span class="line">*      hard   memlock   32000</span><br><span class="line">*      soft   msgqueue  8192000</span><br><span class="line">*      hard   msgqueue  8192000</span><br></pre></td></tr></table></figure><h3 id="内核参数优化"><a href="#内核参数优化" class="headerlink" title="内核参数优化"></a>内核参数优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line">net.ipv4.ip_nonlocal_bind = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not accept source routing</span></span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the System Request debugging functionality of the kernel</span></span><br><span class="line">kernel.sysrq = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls whether core dumps will append the PID to the core filename.</span></span><br><span class="line"><span class="comment"># Useful for debugging multi-threaded applications.</span></span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the use of TCP syncookies</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable netfilter on bridges.</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the default maxmimum size of a mesage queue</span></span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># # Controls the maximum size of a message, in bytes</span></span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum shared segment size, in bytes</span></span><br><span class="line">kernel.shmmax = 68719476736</span><br><span class="line"></span><br><span class="line"><span class="comment"># # Controls the maximum number of shared memory segments,in pages</span></span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP kernel paramater</span></span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 4194304</span><br><span class="line">net.ipv4.tcp_wmem = 4096 16384 4194304</span><br><span class="line">net.ipv4.tcp_window_scaling = 1</span><br><span class="line">net.ipv4.tcp_sack = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># socket buffer</span></span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line">net.core.somaxconn = 20480</span><br><span class="line">net.core.optmem_max = 81920</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP conn</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 262144</span><br><span class="line">net.ipv4.tcp_syn_retries = 3</span><br><span class="line">net.ipv4.tcp_retries1 = 3</span><br><span class="line">net.ipv4.tcp_retries2 = 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># tcp conn reuse</span></span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_tw_reuse = 0</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line">net.ipv4.tcp_fin_timeout = 1</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 20000</span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># keepalive conn</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 300</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.ip_local_port_range = 10001 65000</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">vm.overcommit_memory = 0</span><br><span class="line">vm.swappiness = 10</span><br><span class="line"></span><br><span class="line"><span class="comment">#net.ipv4.conf.eth1.rp_filter = 0</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.lo.arp_ignore = 1</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.lo.arp_announce = 2</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.all.arp_announce = 2</span></span><br></pre></td></tr></table></figure><h2 id="Ubuntu-Desktop版本使用"><a href="#Ubuntu-Desktop版本使用" class="headerlink" title="Ubuntu Desktop版本使用"></a>Ubuntu Desktop版本使用</h2><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">1、设置软件源及安装常⽤命令：</span><br><span class="line">https://opsx.alibaba.com/mirror</span><br><span class="line"></span><br><span class="line">sudo apt install build-essential cmake pkg-config qt4-qmake libqt4-dev desktop-file-utils \</span><br><span class="line">libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libasound2-dev libpulse-dev libjack-jackd2-dev \</span><br><span class="line">libgl1-mesa-dev libglu1-mesa-dev libx11-dev libxfixes-dev libxext-dev libxi-dev libxinerama-dev</span><br><span class="line"></span><br><span class="line">2、系统更新及配置中⽂语⾔环境：</span><br><span class="line"></span><br><span class="line">3、安装搜狗拼⾳输⼊法</span><br><span class="line">https://pinyin.sogou.com/linux/?r=pinyin</span><br><span class="line"></span><br><span class="line">4、安装转码器ffmpeg：</span><br><span class="line">多媒体视频处理⼯具FFmpeg有⾮常强⼤的功能包括视频采集功能、视频格式转</span><br><span class="line">换、视频抓图、给视频加⽔印等。</span><br><span class="line">sudo apt-get install ffmpeg</span><br><span class="line"></span><br><span class="line">5、安装视频播放器： smplayer</span><br><span class="line">https://www.jianshu.com/p/f24252c632d0</span><br><span class="line">sudo apt-get install smplayer</span><br><span class="line"></span><br><span class="line">6、办公软件WPS：</span><br><span class="line">https://www.wps.cn/product/wpslinux</span><br><span class="line"></span><br><span class="line">7、单机VNC⼯具:</span><br><span class="line">x11vnc server</span><br><span class="line"></span><br><span class="line">8、RealVNC v6.6：</span><br><span class="line">⽀持多个⽤⼾同时连接</span><br><span class="line">https://www.realvnc.com/en/connect/download/vnc/linux/</span><br><span class="line"></span><br><span class="line">9、⽂本编辑器：</span><br><span class="line">visual studio code</span><br><span class="line"></span><br><span class="line">10、markdown⼯具：</span><br><span class="line">https://www.typora.io/<span class="comment">#linux</span></span><br><span class="line">sudo apt-get install typora=0.9.60-1</span><br><span class="line"></span><br><span class="line">11、Ubuntu 桌⾯3D特效：</span><br><span class="line">sudo apt-get install compiz-plugins compizconfig-settings-manager</span><br><span class="line"></span><br><span class="line">12、左侧菜单在底栏显⽰：</span><br><span class="line">~$ gsettings <span class="built_in">set</span> com.canonical.Unity.Launcher launcher-position Bottom</span><br><span class="line"></span><br><span class="line">13、VMware workstion桥接⽹卡设置</span><br><span class="line">https://kb.vmware.com/s/article/287?lang=zh_CN</span><br><span class="line"><span class="built_in">chmod</span> a+rw /dev/vmnet0   <span class="comment">#解决⽹卡桥接不通问题</span></span><br><span class="line"></span><br><span class="line">14、远程⼯具:</span><br><span class="line">SecureCRT</span><br><span class="line"></span><br><span class="line">15、python开发：</span><br><span class="line">pycharm</span><br><span class="line"></span><br><span class="line">16、java开发：</span><br><span class="line">Eclipse</span><br><span class="line">Intellij IDEA</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 示例 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 示例 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>相册</title>
      <link href="/album/index.html"/>
      <url>/album/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>关于本人</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>日常生活</title>
      <link href="/dailyPhoto/index.html"/>
      <url>/dailyPhoto/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>闲言碎语</title>
      <link href="/essay/index.html"/>
      <url>/essay/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>我的装备</title>
      <link href="/equipment/index.html"/>
      <url>/equipment/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>朋友圈</title>
      <link href="/fcircle/index.html"/>
      <url>/fcircle/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>友人帐</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/json/music.json"/>
      <url>/json/music.json</url>
      
        <content type="html"><![CDATA[[{"name":"青花瓷","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/青花瓷/青花瓷.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002eFUFm2XYZ7z_2.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/青花瓷/青花瓷.lrc"},{"name":"稻香","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/稻香/稻香.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/稻香/稻香.lrc"},{"name":"晴天","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/晴天/晴天.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/晴天/晴天.lrc"},{"name":"七里香","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/七里香/七里香.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/七里香/七里香.lrc"},{"name":"花海","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/花海/花海.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/花海/花海.lrc"},{"name":"反方向的钟","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/反方向的钟/反方向的钟.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/反方向的钟/反方向的钟.lrc"},{"name":"兰亭序","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/兰亭序/兰亭序.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/兰亭序/兰亭序.lrc"},{"name":"说好的辛福呢","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/说好的辛福呢/说好的辛福呢.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/说好的辛福呢/说好的幸福呢.lrc"},{"name":"等你下课 (with 杨瑞代)","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/等你下课/等你下课.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003bSL0v4bpKAx_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/等你下课/等你下课.lrc"},{"name":"我落泪情绪零碎","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/我落泪情绪零碎/我落泪情绪零碎.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000bviBl4FjTpO_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/我落泪情绪零碎/我落泪情绪零碎.lrc"},{"name":"听妈妈的话","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/听妈妈的话/听妈妈的话.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/听妈妈的话/听妈妈的话.lrc"},{"name":"明明就","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/明明就/明明就.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003Ow85E3pnoqi_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/明明就/明明就.lrc"},{"name":"我是如此相信","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/我是如此相信/我是如此相信.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000001hGx1Z0so1YX_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/我是如此相信/我是如此相信.lrc"},{"name":"发如雪","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/发如雪/发如雪.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M0000024bjiL2aocxT_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/发如雪/发如雪.lrc"},{"name":"以父之名","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/以父之名/以父之名.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/以父之名/以父之名.lrc"},{"name":"园游会","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/园游会/园游会.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/园游会/园游会.lrc"},{"name":"本草纲目","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/本草纲目/本草纲目.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/本草纲目/本草纲目.lrc"},{"name":"龙卷风","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/龙卷风/龙卷风.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/龙卷风/龙卷风.lrc"}]]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>音乐馆</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>世界各地风景</title>
      <link href="/wordScenery/index.html"/>
      <url>/wordScenery/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
