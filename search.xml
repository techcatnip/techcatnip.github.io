<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>openEuler安全配置基线</title>
      <link href="/posts/ec805823.html"/>
      <url>/posts/ec805823.html</url>
      
        <content type="html"><![CDATA[<h1 id="openEuler安全配置基线-v1-0"><a href="#openEuler安全配置基线-v1-0" class="headerlink" title="openEuler安全配置基线 v1.0"></a>openEuler安全配置基线 v1.0</h1><table><thead><tr><th>版本</th><th>修订说明</th><th>修订时间</th><th>访问链接</th></tr></thead><tbody><tr><td>1.0</td><td>初始修订</td><td>2023年12月</td><td>本文档</td></tr></tbody></table><h2 id="1-初始部署"><a href="#1-初始部署" class="headerlink" title="1 初始部署"></a>1 初始部署</h2><h2 id="1-1-文件系统"><a href="#1-1-文件系统" class="headerlink" title="1.1 文件系统"></a>1.1 文件系统</h2><h3 id="1-1-1-禁止存在无属主或属组的文件或目录"><a href="#1-1-1-禁止存在无属主或属组的文件或目录" class="headerlink" title="1.1.1 禁止存在无属主或属组的文件或目录"></a>1.1.1 禁止存在无属主或属组的文件或目录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>系统中不允许存在没有属主或属组的文件或目录，这些文件或目录一般都是由于原属主账号被删除，而文件未被删除导致。</p><p>这些文件存在安全隐患，可能导致信息泄露，占用不必要的磁盘空间和系统资源，还可能影响正常业务运行。</p><p>需要注意，在容器场景中，容器和宿主机使用不同的user namespace，这导致容器中的文件在宿主机中可能为无属主或属组的目录和文件。<br>对于容器的rootfs，宿主机已有相应的保护措施：宿主机上的rootfs的父目录，已做了权限控制，仅root用户可以访问。对于此情况的目录和文件可例外。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下两个命令，在系统根目录下查找无属主或属组的目录和文件，如果这两个命令没有返回值，表示系统中不存在无属主或属组的目录和文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find `df -l | sed -n &#x27;2,$p&#x27; | awk &#x27;&#123;print $6&#125;&#x27; ` -xdev -nouser 2&gt;/dev/null</span></span><br><span class="line"><span class="comment"># find `df -l | sed -n &#x27;2,$p&#x27; | awk &#x27;&#123;print $6&#125;&#x27; ` -xdev -nogroup 2&gt;/dev/null</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过rm命令删除无属主或属组的文件，此处需要注意，删除前务必确认确实为无用的文件或目录，否则可使用chown命令将目录或文件修改为正确的、且实际存在的属主或属组，方法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm test -rf</span></span><br><span class="line">或</span><br><span class="line"><span class="comment"># chown test1:test1 test</span></span><br></pre></td></tr></table></figure><h3 id="1-1-2-禁止存在空链接文件"><a href="#1-1-2-禁止存在空链接文件" class="headerlink" title="1.1.2 禁止存在空链接文件"></a>1.1.2 禁止存在空链接文件</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>空链接文件一方面属于冗余文件，浪费系统资源，另一方面如果后续在链接目标位置安装或者创建了同名同路径的文件，但却没有清理历史上的链接文件，该目标文件就可以通过链接进行访问，可能导致文件信息泄露甚至被篡改。链接文件所指向的实际文件如果已经被删除，那么链接文件本身也就失去了存在的必要，务必同时删除，确保系统中不存在空链接文件。</p><p>需要注意，系统运行时，部分目录下存在一些系统临时文件或链接，这些是随进程动态变化的，可以作为例外忽略，这些目录常见的有：&#x2F;proc、&#x2F;run、&#x2F;var、&#x2F;sys、&#x2F;dev。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用find命令在全局或某个目录下查找空链接文件，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find ./ -type l -follow</span></span><br><span class="line">./testlink</span><br></pre></td></tr></table></figure><p>该命令如果返回输出为空，表示在指定目录下没有找到空链接文件，否则会返回空链接文件名，如上面例子中的testlink文件。</p><p>如果要排除某些目录不做搜索，例如排除&#x2F;proc、&#x2F;run、&#x2F;var、&#x2F;sys、&#x2F;dev目录，可使用如下命令，可以搜索到&#x2F;root目录下testlink是空链接文件，而部分系统目录被排除在外，未被搜索：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -path /var -prune -o -path /run -prune -o -path /proc -prune -o -path /sys -prune -o -path /dev -prune -o -type l -follow</span></span><br><span class="line">/dev</span><br><span class="line">/proc</span><br><span class="line">/root/testlink</span><br><span class="line">/run</span><br><span class="line">/var</span><br><span class="line">/sys</span><br></pre></td></tr></table></figure><p>也可以使用-xdev参数，只搜索指定目录所在分区的文件系统，对于其他通过mount挂载的目录不做搜索：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -xdev -type l -follow</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>搜索到空链接文件后，使用rm命令删除该文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find ./ -type l -follow</span></span><br><span class="line">./testlink</span><br><span class="line"><span class="comment"># rm ./testlink</span></span><br></pre></td></tr></table></figure><h3 id="1-1-3-禁止存在隐藏的可执行文件"><a href="#1-1-3-禁止存在隐藏的可执行文件" class="headerlink" title="1.1.3 禁止存在隐藏的可执行文件"></a>1.1.3 禁止存在隐藏的可执行文件</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在linux系统中，以“.”为前缀的文件是隐藏文件（除了当前目录和上层目录的“.”、“..”），系统中不允许存在可执行的隐藏文件。</p><p>.bashrc、.bash_profile、.bash_logout这三个文件是系统在创建用户账号后，账号登录&#x2F;登出shell时的脚本文件，符合业界惯例，可不删除，其他隐藏的可执行文件必须删除，或去除可执行权限。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过find命令可以查找是否存在可执行的隐藏文件，如下命令是在根文件系统下全局查找，如果返回为空，则表示未找到任何可执行的隐藏文件，否则列出相应文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -type f -name &quot;\.*&quot; -perm /+x</span></span><br><span class="line">/etc/skel/.bashrc</span><br><span class="line">/etc/skel/.bash_profile</span><br><span class="line">/etc/skel/.bash_logout</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>根据实际情况，有三种修改方式：</p><ul><li><p>使用rm命令删除隐藏的可执行文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm .testfile</span></span><br></pre></td></tr></table></figure></li><li><p>使用mv命令将隐藏文件修改为普通文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mv .testfile testfile</span></span><br></pre></td></tr></table></figure></li><li><p>使用chmod命令去除可执行权限，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod 644 .testfile</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-4-确保全局可写目录已设置sticky位"><a href="#1-1-4-确保全局可写目录已设置sticky位" class="headerlink" title="1.1.4 确保全局可写目录已设置sticky位"></a>1.1.4 确保全局可写目录已设置sticky位</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>sticky位，又叫粘滞位，普通文件的粘滞位会被内核忽略。粘滞位被设置在目录的执行许可位置上，用t表示，设置了该位后，其它用户就不可以删除该目录下不属于他的文件和目录。但是子目录不继承该权限，要再设置才可使用。对于全局可写的目录，要求必须设置粘滞位。</p><p>如果用户对目录有写权限，则可以删除其中的文件和子目录，即使该用户不是这些文件的所有者，而且也没有读或写许可。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令查找指定目录下有全局可写权限且未设置粘滞位的目录，返回为空表示未找到，举例中test目录为全局可写目录，但未设置粘滞位：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find ./ -type d -perm -0002 -a ! -perm -1000</span></span><br><span class="line">./test</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用chmod命令设置目录粘滞位，其中第一位“1”表示设置粘滞位，设置完成以后，可以通过ll命令查看是否已经设置成功，如下例子中，other用户的x位已经被设置为t：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod 1777 test</span></span><br><span class="line"><span class="comment"># ll -d test</span></span><br><span class="line">drwxrwxrwt. 2 root root 4096 Nov  4 14:31 <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="1-1-5-确保UMASK配置正确"><a href="#1-1-5-确保UMASK配置正确" class="headerlink" title="1.1.5 确保UMASK配置正确"></a>1.1.5 确保UMASK配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>UMASK是默认文件或目录权限的掩码，创建文件或目录的时候，以777权限按位减去UMASK的值，如果是文件，则还需要去掉可执行权限，然后得到文件或目录的默认权限设置。UMASK如果设置不合理，可能导致新建文件权限过小或过大，从而影响业务正常运行或导致安全风险。</p><p>考虑到社区版本在不同场景下的易用性，openEuler发行版默认不配置UMASK，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>按规范要求将UMASK配置为077后，创建的文件默认权限为600，目录默认权限为700，会使属组及其他用户使用受限，降低易用性。</p><p><strong>检查方法：</strong></p><ul><li><p>检查配置文件中UMASK值是否正确，可以添加多个目录同时检查，例如下面代码中同时检查了&#x2F;etc&#x2F;bashrc和用户home目录下.bashrc文件，获得umask值为077：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^umask&quot; /etc/bashrc ~/.bashrc</span></span><br><span class="line">/etc/bashrc:<span class="built_in">umask</span> 0077</span><br><span class="line">/root/.bashrc:<span class="built_in">umask</span> 077</span><br></pre></td></tr></table></figure></li><li><p>使用root用户登录，创建文件或目录，确认权限是否正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># touch test</span></span><br><span class="line"><span class="comment"># ll test</span></span><br><span class="line">-rw-------. 1 root root 0 Nov  4 17:36 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mkdir testdir</span></span><br><span class="line"><span class="comment"># ll -d testdir</span></span><br><span class="line">drwx------. 2 root root 4096 Nov  4 17:36 testdir</span><br></pre></td></tr></table></figure></li><li><p>使用普通账号test登录，创建文件或目录，确认权限是否正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> <span class="built_in">test</span></span><br><span class="line">$ ll <span class="built_in">test</span></span><br><span class="line">-rw-------. 1 <span class="built_in">test</span> <span class="built_in">test</span> 0 Nov  4 17:37 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mkdir</span> testdir</span><br><span class="line">$ ll -d testdir</span><br><span class="line">drwx------. 2 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Nov  4 17:37 testdir</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>可以在两个地方进行修改：</p><ul><li><p>在&#x2F;etc&#x2F;bashrc文件中对umask字段进行修改，该文件变化对全局所有用户下次登录有影响：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/bashrc</span></span><br><span class="line"><span class="built_in">umask</span> 0077</span><br></pre></td></tr></table></figure></li><li><p>在~&#x2F;.bashrc文件中对umask字段进行修改或添加，该文件变化只对当前用户下次登录时有影响，如果该文件中的配置同&#x2F;etc&#x2F;bashrc不一致，则以该文件为准：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /home/test/.bashrc</span><br><span class="line"><span class="built_in">umask</span> 0077</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-6-禁止存在全局可写的文件"><a href="#1-1-6-禁止存在全局可写的文件" class="headerlink" title="1.1.6 禁止存在全局可写的文件"></a>1.1.6 禁止存在全局可写的文件</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong><br>全局可写意味着所有用户都可以对文件进行写操作，通常情况下这种权限并不是必须的。如果文件被不合理的设置了全局可写权限，容易被攻击者篡改，导致安全风险。所以如果文件不得不存在全局可写的权限，需要针对实际场景分析安全风险，确保攻击者无法利用此文件进行攻击。</p><p>可以在根目录下搜索全局可写文件，需要例外的是：“&#x2F;sys”、“&#x2F;proc”这两个系统目录在linux运行时存在大量的全局可写文件，所以在检查时应排除这两个目录，避免混淆。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令在根目录下进行搜索（已排除了“&#x2F;sys”、“&#x2F;proc”这两个目录），返回全局可写文件列表，如果返回为空，表示无全局可写文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -path /proc -prune -o -path /sys -prune -o -type f -perm -0002 -exec ls -lg &#123;&#125; \;</span></span><br><span class="line">-rwxrwxrwx. 1 root 0 Dec  1 17:34 /root/test</span><br></pre></td></tr></table></figure><p>也可以使用-xdev参数，只搜索指定目录所在分区的文件系统，对于其他通过mount挂载的目录不做搜索：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -xdev -type f -perm -0002 -exec ls -lg &#123;&#125; \;</span></span><br><span class="line">-rwxrwxrwx. 1 root 0 Dec  1 17:34 /root/test</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于不合理的权限，使用chmod命令进行修改，去除全局可写，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod 755 test</span></span><br><span class="line"><span class="comment"># ll test</span></span><br><span class="line">-rwxr-xr-x. 1 root root 0 Dec  1 17:34 <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="1-1-7-确保移除不需要的文件系统挂载支持"><a href="#1-1-7-确保移除不需要的文件系统挂载支持" class="headerlink" title="1.1.7 确保移除不需要的文件系统挂载支持"></a>1.1.7 确保移除不需要的文件系统挂载支持</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Linux系统支持多种文件系统，通过ko方式加载进内核。openEuler作为通用操作系统平台，会提供各种文件系统ko，保存在&#x2F;lib&#x2F;modules&#x2F;(kernel version)&#x2F;kernel&#x2F;fs&#x2F;目录下，可以通过insmod&#x2F;modprobe命令进行加载支持。禁用不需要的文件系统的挂载支持，可以缩小攻击面，防止攻击者通过利用某些不常用文件系统的漏洞对系统进行攻击。</p><p>使用者应根据实际场景，确定哪些文件系统是不需要被支持的，并通过配置禁止这些文件系统被挂载，这些文件系统通常包括：</p><p>cramfs、freevxfs、jffs2、hfs、hfsplus、squashfs、udf、vfat、fat、msdos、nfs、ceph、fuse、overlay、xfs</p><p><strong>规则影响：</strong></p><p>移除的文件系统，不再被支持。</p><p><strong>检查方法：</strong></p><p>使用如下命令检查输出结果（例如cramfs，其他文件系统类似），如果输出“install &#x2F;bin&#x2F;true”，表示该文件系统已经被禁止挂载，如果输出“insmod &#x2F;lib&#x2F;modules&#x2F;(kernel version)&#x2F;kernel&#x2F;fs&#x2F;cramfs&#x2F;cramfs.ko”，表示该文件系统未被禁止挂载，并列出ko所在目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe -n -v cramfs | grep -E &#x27;(cramfs|install)&#x27;</span></span><br><span class="line">install /bin/true</span><br></pre></td></tr></table></figure><p>如果上述命令没有回显，再执行以下命令，如果有输出则表示该文件系统已被挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsmod | grep cramfs</span></span><br><span class="line">cramfs  135168  0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对已挂载的文件系统，确定是实际场景不需要被支持的，可通过如下命令移除（例如cramfs，其他文件系统类似）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe -r cramfs</span></span><br></pre></td></tr></table></figure><p>在&#x2F;etc&#x2F;modprobe.d&#x2F;目录下，添加一个任意文件名的，并以.conf为后缀的配置文件，属主和属组均为root, 权限600，并根据实际场景将需要被禁止挂载的文件系统按照如下格式填入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/modprobe.d/test.conf</span></span><br><span class="line">install cramfs /bin/true</span><br><span class="line">install freevxfs /bin/true</span><br><span class="line">install jffs2 /bin/true</span><br><span class="line">install hfs /bin/true</span><br><span class="line">install hfsplus /bin/true</span><br><span class="line">install squashfs /bin/true</span><br><span class="line">install udf /bin/true</span><br><span class="line">install vfat /bin/true</span><br><span class="line">install fat /bin/true</span><br><span class="line">install msdos /bin/true</span><br><span class="line">install nfs /bin/true</span><br><span class="line">install ceph /bin/true</span><br><span class="line">install fuse /bin/true</span><br><span class="line">install overlay /bin/true</span><br><span class="line">install xfs /bin/true</span><br></pre></td></tr></table></figure><h3 id="1-1-8-确保无需修改的分区以只读方式挂载"><a href="#1-1-8-确保无需修改的分区以只读方式挂载" class="headerlink" title="1.1.8 确保无需修改的分区以只读方式挂载"></a>1.1.8 确保无需修改的分区以只读方式挂载</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>以只读方式挂载无需数据修改的文件系统，可以避免无意或恶意的数据篡改行为，减小攻击面。</p><p><strong>规则影响：</strong></p><p>文件系统一旦以只读方式挂载，将无法对文件和目录进行创建、修改、删除动作，用户需要根据实际场景进行配置，操作系统运行必须的文件挂载可以忽略此项要求。</p><p><strong>检查方法：</strong></p><p>通过mount命令查看挂载的文件系统是否符合要求，例如查看&#x2F;root&#x2F;readonly目录是否为只读挂载，可以使用如下命令，如果无返回数据，说明该目录未被挂载，或非只读挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep &quot;\/root\/readonly&quot; | grep &quot;\&lt;ro\&gt;&quot;</span></span><br><span class="line">/dev/vda on /root/readonly <span class="built_in">type</span> ext4 (ro,relatime,seclabel)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>卸载对应挂载点，重新以只读方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /root/readonly</span></span><br><span class="line"><span class="comment"># mount -o ro /dev/vda /root/readonly/</span></span><br></pre></td></tr></table></figure></li><li><p>如果硬盘或分区是通过&#x2F;etc&#x2F;fstab配置文件进行挂载的，那么通过修改该文件，为指定挂载点添加ro挂载方式，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/fstab</span></span><br><span class="line">/dev/vda /root/readonly ext4 ro 0 0</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-9-确保无需挂载设备的分区以nodev方式挂载"><a href="#1-1-9-确保无需挂载设备的分区以nodev方式挂载" class="headerlink" title="1.1.9 确保无需挂载设备的分区以nodev方式挂载"></a>1.1.9 确保无需挂载设备的分区以nodev方式挂载</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>nodev表示不允许挂载设备文件，用于减小攻击面，增加安全性。目录被挂载时，如果设置了nodev选项，那么该目录下所有块设备、字符设备等设备文件将被解析为普通文件，无法按设备文件进行操作。如果挂载时未设置nodev，将导致安全风险，例如攻击者在U盘上创建了一个文件系统，并在其中创建了一个块设备文件（自己的U盘，有相应的权限），而这个块设备实际是指向&#x2F;dev&#x2F;sda之类的服务器硬盘或分区的，如果攻击者有机会将U盘插入到服务器上，服务器又加载了这个U盘，那么攻击者可以通过这个块设备文件访问到相应硬盘数据。如果将上述案例中的U盘改为其他硬盘或分区，也存在类似问题，只要该硬盘或分区上存在恶意构造的设备文件，就可以形成攻击。</p><p>openEuler系统中默认如下目录被nodev挂载：&#x2F;sys、&#x2F;proc、&#x2F;sys&#x2F;kernel&#x2F;security、&#x2F;dev&#x2F;shm、&#x2F;run、&#x2F;sys&#x2F;fs&#x2F;cgroup、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;systemd、&#x2F;sys&#x2F;fs&#x2F;pstore、&#x2F;sys&#x2F;fs&#x2F;bpf、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;files、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;net_cls,net_prio、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;devices、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;freezer、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpu,cpuacct、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;perf_event、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;pids、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;hugetlb、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;memory、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;blkio、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;cpuset、&#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;rdma、&#x2F;sys&#x2F;kernel&#x2F;config、&#x2F;sys&#x2F;kernel&#x2F;debug、&#x2F;dev&#x2F;mqueue、&#x2F;tmp、&#x2F;run&#x2F;user&#x2F;0</p><p>openEuler存在以下目录（部分目录因硬盘分区，部署平台而不同），这些目录默认未被nodev挂载：&#x2F;dev、&#x2F;dev&#x2F;pts、&#x2F;、&#x2F;sys&#x2F;fs&#x2F;selinux、&#x2F;proc&#x2F;sys&#x2F;fs&#x2F;binfmt_misc、&#x2F;dev&#x2F;hugepages、&#x2F;boot、&#x2F;var&#x2F;lib&#x2F;nfs&#x2F;rpc_pipefs、&#x2F;boot&#x2F;efi、&#x2F;home。</p><p>实际场景中，根据业务需要，对不需要挂载设备的分区，采用nodev方式挂载。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过mount命令检查是否存在需要被设置nodev，但却未被设置的挂载点，对返回数据进行分析，确认未设置nodev的挂载点是否正确。此处举例中，除了系统默认未使用nodev挂载的目录外，用户新增的&#x2F;root&#x2F;nodev挂载点未使用nodev方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep -v &quot;nodev&quot; | awk -F &quot; &quot; &#x27;&#123;print $3&#125;&#x27;</span></span><br><span class="line">/dev</span><br><span class="line">/dev/pts</span><br><span class="line">/</span><br><span class="line">/sys/fs/selinux</span><br><span class="line">/proc/sys/fs/binfmt_misc</span><br><span class="line">/dev/hugepages</span><br><span class="line">/boot</span><br><span class="line">/boot/efi</span><br><span class="line">/home</span><br><span class="line">/root/nodev</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>卸载对应挂载点，重新以nodev方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /root/nodev</span></span><br><span class="line"><span class="comment"># mount -o nodev /dev/vda /root/nodev/</span></span><br></pre></td></tr></table></figure></li><li><p>如果硬盘或分区是通过&#x2F;etc&#x2F;fstab配置文件进行挂载的，那么通过修改该文件，为指定挂载点添加nodev挂载方式，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/fstab</span></span><br><span class="line">/dev/vda /root/nodev ext4 nodev 0 0</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-10-确保无可执行文件的分区以noexec方式挂载"><a href="#1-1-10-确保无可执行文件的分区以noexec方式挂载" class="headerlink" title="1.1.10 确保无可执行文件的分区以noexec方式挂载"></a>1.1.10 确保无可执行文件的分区以noexec方式挂载</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>数据盘只是用于保存系统运行过程中的数据，并不需要在数据盘上执行相关命令，对于这种情况，该硬盘或分区必须以noexec方式挂载，提高安全性，减少攻击面。</p><p><strong>规则影响：</strong></p><p>硬盘或分区如果以noexec方式挂载，那么该挂载点目录下的可执行文件无法直接运行。</p><p><strong>检查方法：</strong></p><p>通过mount命令查看指定挂载点目录是否以noexec方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep &quot;\/root\/noexec&quot; | grep &quot;noexec&quot;</span></span><br><span class="line">/dev/vda on /root/noexec <span class="built_in">type</span> ext4 (rw,noexec,relatime,seclabel)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>卸载对应挂载点，重新以noexec方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /root/noexec</span></span><br><span class="line"><span class="comment"># mount -o noexec /dev/vda /root/noexec/</span></span><br></pre></td></tr></table></figure></li><li><p>如果硬盘或分区是通过&#x2F;etc&#x2F;fstab配置文件进行挂载的，那么通过修改该文件，为指定挂载点添加noexec挂载方式，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/fstab</span></span><br><span class="line">/dev/vda /root/noexec ext4 noexec 0 0</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-11-确保可移动设备分区以noexec、nodev方式挂载"><a href="#1-1-11-确保可移动设备分区以noexec、nodev方式挂载" class="headerlink" title="1.1.11 确保可移动设备分区以noexec、nodev方式挂载"></a>1.1.11 确保可移动设备分区以noexec、nodev方式挂载</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>可移动设备本身存在不确定性，来源、过往使用情况、运输过程等都无法保证绝对安全，因此可移动设备往往是病毒传播的主要宿主设备。所以针对可移动设备，要求必须以noexec、nodev方式挂载，提高安全性，减少攻击面。</p><p>noexec可以防止可移动设备上文件被直接执行，如病毒文件，攻击脚本等；</p><p>nodev可以防止可移动设备上不正确的设备文件链接到服务器真实设备，从而导致攻击行为；</p><p>常见的可移动设备如：CD&#x2F;DVD&#x2F;USB等。</p><p><strong>规则影响：</strong></p><p>可移动设备如果以noexec方式挂载，那么该挂载点目录下的可执行文件无法直接运行。</p><p><strong>检查方法：</strong></p><p>通过mount命令查看指定挂载点目录是否以noexec、nodev方式挂载，此处假设&#x2F;dev&#x2F;vda为可移动设备：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep &quot;\/dev\/vda&quot;</span></span><br><span class="line">/dev/vda on /root/noexecdir <span class="built_in">type</span> ext4 (rw,nodev,noexec,relatime,seclabel)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>卸载对应挂载点，重新以nodev、noexec方式挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /root/noexecdir</span></span><br><span class="line"><span class="comment"># mount -o nodev,noexec /dev/vda /root/noexecdir</span></span><br></pre></td></tr></table></figure><h3 id="1-1-12-确保无需SUID-SGID的分区以nosuid方式挂载"><a href="#1-1-12-确保无需SUID-SGID的分区以nosuid方式挂载" class="headerlink" title="1.1.12 确保无需SUID&#x2F;SGID的分区以nosuid方式挂载"></a>1.1.12 确保无需SUID&#x2F;SGID的分区以nosuid方式挂载</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>可执行文件设置SUID位后，即使执行该文件的用户并不是文件的属主，在执行过程中，该进程也会被暂时赋予文件属主的权限。例如普通用户test执行一个权限为755，属主为root的程序，那么如果该程序没有设置SUID位，进程就只有test用户的权限；如果被设置了SUID，执行过程中，进程就拥有root的权限。SGID是类似的功能，只不过是拥有了文件属组的权限。对于不需要有SUID&#x2F;SGID的分区采用nosuid的方式挂载，这样可以使该分区带SUID&#x2F;SGID的文件的S位失效，防止通过该分区的可执行文件进行提权，加强了分区的安全性。</p><p>用户需要根据实际场景，规划各挂载硬盘和分区，设置nosuid挂载项。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过mount命令检查文件系统是否以nosuid方式挂载，该命令返回未使用nosuid方式挂载的硬盘或分区，如下例中返回的挂载点均为系统默认挂载点（部分目录因硬盘分区，部署平台而不同），均需要suid功能，如果命令执行后存在与实际场景相关的目录，需要具体分析该目录是否挂载正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount | grep -v &quot;nosuid&quot;</span></span><br><span class="line">/dev/mapper/openeuler-root on / <span class="built_in">type</span> ext4 (rw,relatime,seclabel)</span><br><span class="line">selinuxfs on /sys/fs/selinux <span class="built_in">type</span> selinuxfs (rw,relatime)</span><br><span class="line">systemd-1 on /proc/sys/fs/binfmt_misc <span class="built_in">type</span> autofs (rw,relatime,fd=33,pgrp=1,<span class="built_in">timeout</span>=0,minproto=5,maxproto=5,direct,pipe_ino=16986)</span><br><span class="line">hugetlbfs on /dev/hugepages <span class="built_in">type</span> hugetlbfs (rw,relatime,seclabel,pagesize=2M)</span><br><span class="line">/dev/sda2 on /boot <span class="built_in">type</span> ext4 (rw,relatime,seclabel)</span><br><span class="line">/dev/sda1 on /boot/efi <span class="built_in">type</span> vfat (rw,relatime,fmask=0077,dmask=0077,codepage=437,iocharset=ascii,shortname=winnt,errors=remount-ro)</span><br><span class="line">/dev/mapper/openEuler-home on /home <span class="built_in">type</span> ext4 (rw,relatime,seclabel)</span><br><span class="line">sunrpc on /var/lib/nfs/rpc_pipefs <span class="built_in">type</span> rpc_pipefs (rw,relatime)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>卸载对应挂载点，重新以nosuid方式挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /root/nosuid</span></span><br><span class="line"><span class="comment"># mount -o nosuid /dev/vda /root/nosuid/</span></span><br></pre></td></tr></table></figure></li><li><p>如果硬盘或分区是通过&#x2F;etc&#x2F;fstab配置文件进行挂载的，那么通过修改该文件，为指定挂载点添加nosuid挂载方式，如：</p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/fstab</span></span><br><span class="line">/dev/vda /root/nosuid ext4 nosuid 0 0</span><br></pre></td></tr></table></figure><h3 id="1-1-13-确保删除文件不必要的SUID和SGID位"><a href="#1-1-13-确保删除文件不必要的SUID和SGID位" class="headerlink" title="1.1.13 确保删除文件不必要的SUID和SGID位"></a>1.1.13 确保删除文件不必要的SUID和SGID位</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在Linux中，SUID（Set User ID）和 SGID（Set Group ID）是在UNIX和类UNIX操作系统中用于控制程序权限的特殊权限位，确保文件不包含不必要的SUID和SGID位非常重要，以提高系统的安全性。这些位允许文件在执行时以文件所有者或文件所属组的权限运行，可能会导致潜在的安全风险</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>可使用如下命令查找系统中的SUID和SGID文件，如果无返回，表示不存在该类文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -type f \( -perm -4000 -o -perm -2000 \) -exec ls -l &#123;&#125; \;</span></span><br><span class="line">null</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>找到SUID或SGID文件，需要审查这些文件并确定是否确实需要这些权限。通常，只有一些特定的系统工具或程序需要SUID或SGID权限，而绝大多数文件不需要。</p><p>如果确定某个文件不需要SUID或SGID权限，可以将其文件删除或移除文件的SUID和SGID位，执行命令行如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm -rf /path/to/file</span></span><br><span class="line">或</span><br><span class="line"><span class="comment"># chmod u-s,g-s /path/to/file</span></span><br></pre></td></tr></table></figure><h3 id="1-1-14-确保关键文件、目录权限最小化"><a href="#1-1-14-确保关键文件、目录权限最小化" class="headerlink" title="1.1.14 确保关键文件、目录权限最小化"></a>1.1.14 确保关键文件、目录权限最小化</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>按照权限最小化要求，系统中的关键文件，特别是包含有敏感信息的文件，必须设置正确的最小的访问权限，只能有相应权限的用户可以访问，目录也是同样要求。文件或目录权限配置不正确，可能导致包含敏感数据的文件信息泄露，例如访问权限设置大于等于644，任何用户都可以访问，甚至篡改；只有root用户可以执行的程序，但却设置了755的权限，导致任何用户都可以执行，引入提权风险。</p><p>常见的需要做访问权限控制的文件或目录类型有：</p><ul><li><p>可执行文件（二进制文件、脚本），存放可执行文件的目录。如果权限配置不当可能会导致提权攻击。</p></li><li><p>配置文件、密钥文件、日志文件、存储有敏感信息的数据文件、系统运行时产生的临时文件、静态文件等。这些文件中可能会含有敏感数据、隐私数据，如果权限配置不当会增加信息泄露的风险。</p></li></ul><p>权限控制基本原则如下：</p><table><thead><tr><th>文件类型</th><th>设置值</th></tr></thead><tbody><tr><td>用户主目录</td><td>750（rwxr-x—）</td></tr><tr><td>程序文件(含脚本文件、库文件等)</td><td>550（r-xr-x—）</td></tr><tr><td>程序文件目录</td><td>550（r-xr-x—）</td></tr><tr><td>配置文件</td><td>640（rw-r—–）</td></tr><tr><td>配置文件目录</td><td>750（rwxr-x—）</td></tr><tr><td>日志文件(记录完毕或者已经归档)</td><td>440（r–r—–）</td></tr><tr><td>日志文件(正在记录)</td><td>640（rw-r—–）</td></tr><tr><td>日志文件目录</td><td>750（rwxr-x—）</td></tr><tr><td>Debug文件</td><td>640（rw-r—–）</td></tr><tr><td>Debug文件目录</td><td>750（rwxr-x—）</td></tr><tr><td>临时文件目录</td><td>750（rwxr-x—）</td></tr><tr><td>维护升级文件目录</td><td>770（rwxrwx—）</td></tr><tr><td>业务数据文件</td><td>640（rw-r—–）</td></tr><tr><td>业务数据文件目录</td><td>750（rwxr-x—）</td></tr><tr><td>密钥组件、私钥、证书、密文文件目录</td><td>700（rwx——-）</td></tr><tr><td>密钥组件、私钥、证书、加密密文</td><td>600（rw——-）</td></tr><tr><td>加解密接口、加解密脚本</td><td>500（r-x——）</td></tr></tbody></table><p>鉴于进程权限最小化原则，系统执行任务时一般使用非root的普通用户，该用户需要访问Linux系统中必要的目录和文件，所以对于系统本身运行依赖的系统目录、配置文件、可执行文件、证书文件，相应权限可适当放宽权限控制，建议如下：</p><table><thead><tr><th>文件类型</th><th>设置值</th></tr></thead><tbody><tr><td>目录</td><td>755（rwxr-xr-x）</td></tr><tr><td>程序文件（含脚本文件、库文件等）</td><td>755（rwxr-xr-x）</td></tr><tr><td>配置文件</td><td>644（rw-r–r–）</td></tr><tr><td>证书文件（无私钥）</td><td>444（r–r–r–）</td></tr></tbody></table><p>常见的需要做访问权限控制的文件的建议权限如下：</p><table><thead><tr><th>文件名称</th><th>设置值</th></tr></thead><tbody><tr><td>&#x2F;etc&#x2F;passwd</td><td>0644（-rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;group</td><td>0644（-rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;shadow</td><td>0000（———-）</td></tr><tr><td>&#x2F;etc&#x2F;gshadow</td><td>0000（———-）</td></tr><tr><td>&#x2F;etc&#x2F;passwd-</td><td>0644（-rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;shadow-</td><td>0000（———-）</td></tr><tr><td>&#x2F;etc&#x2F;group-</td><td>0644（-rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;gshadow-</td><td>0000（———-）</td></tr><tr><td>&#x2F;etc&#x2F;ssh&#x2F;sshd_config</td><td>0600（-rw——-）</td></tr></tbody></table><p><strong>规则影响：</strong></p><p>权限配置不能过大，也不能过小，例如有些系统配置文件，如果将权限设置为600或640，那么普通用户就无法读取，相应的程序可能因为无权读取配置而无法执行。</p><p><strong>检查方法：</strong></p><p>使用ll命令或ls -l命令查看文件权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -l test</span></span><br><span class="line">-rwxr-sr-t. 1 root root 33 Nov  5 14:44 <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用chmod命令修改文件权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod 750 test</span></span><br><span class="line"><span class="comment"># ll test</span></span><br><span class="line">-rwxr-x---. 1 root root 33 Nov  5 14:44 <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="1-1-15-确保用户可打开文件数量配置正确"><a href="#1-1-15-确保用户可打开文件数量配置正确" class="headerlink" title="1.1.15 确保用户可打开文件数量配置正确"></a>1.1.15 确保用户可打开文件数量配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在Linux系统中可以打开的文件总数是有限制的，如果全部资源被某个用户会话占用，其他用户将无法正常打开文件。</p><p>openEuler默认限制每个用户会话最多打开文件句柄数为1024，超过这个数会禁止打开新文件句柄。用户可以修改当前会话的最大允许值，但不能超过管理员设置的Hard上限（openEuler默认524288），root管理员可以修改该上限值，没有限制。用户可根据自身业务特点，设置合理的数值，防止单个用户会话的所有进程打开过多的文件句柄，耗尽系统资源。<br>可以通过ulimit命令进行设置，主要有两个参数：</p><ul><li>-Hn，该参数用于查看或设置上限最大值，这个值对于普通用户会话而言，一旦设定以后，只能调小，不能调大，比如第一次设置为3000（不能超过管理员设置的系统最大值，比如524288），那么后续设置只能为小于等于3000；</li><li>-Sn，该参数用于查看或设置当前上限值，这个值是实际用于打开句柄数判断的值，这个值可以任意调大或调小，但不能超过-Hn设置的上限最大值。</li></ul><p>普通用户进行设置，均只作用于当前会话。</p><p><strong>规则影响：</strong></p><p>设置过小，可能导致用户在当前会话中无法打开必要的文件句柄，设置过大可能导致系统资源耗尽。</p><p><strong>检查方法：</strong></p><ul><li><p>查看当前限制值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -Sn</span></span><br><span class="line">1024</span><br></pre></td></tr></table></figure></li><li><p>查看普通用户可修改的上限值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -Hn</span></span><br><span class="line">524288</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>可以通过修改&#x2F;etc&#x2F;security&#x2F;limits.conf文件配置每个用户默认的上限和上限最大值，比如加入如下行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户名 hard nofile 10000</span><br><span class="line">用户名 soft nofile 2000</span><br></pre></td></tr></table></figure></li><li><p>可以在会话中使用ulimit命令进行临时设置。</p><p>普通用户设置上限2000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -Sn 2000</span><br></pre></td></tr></table></figure><p>普通用户设置上限最大值5000（不能超过原上限最大值）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -Hn 5000</span><br></pre></td></tr></table></figure><p>同时设置上限和上限最大值，可以使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ulimit</span> -n 3000</span><br></pre></td></tr></table></figure><p>root用户设置上限以及上限最大值的方法同普通用户一样，但root用户可以将上限最大值设置为大于openEuler默认值524288：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -Hn 1000000</span></span><br><span class="line"><span class="comment"># ulimit -Hn</span></span><br><span class="line">1000000</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-16-确保软、硬链接文件保护配置正确"><a href="#1-1-16-确保软、硬链接文件保护配置正确" class="headerlink" title="1.1.16 确保软、硬链接文件保护配置正确"></a>1.1.16 确保软、硬链接文件保护配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在Linux系统中，软、硬链接文件是一个文件链接到另一个目标文件，打开该链接文件其实就是打开目标文件。所以，攻击者以低权限用户伪造的软链接文件，可以被高权限用户执行，导致提权安全问题。硬链接文件有同样问题。</p><p>本规则要求系统中对软、硬链接进行加固，如果目标文件和链接文件不是同属主的，且链接文件属主无权执行目标文件的，无论访问该链接的用户是谁，均拒绝访问。</p><p>这里就会存在一种竞争风险，如果一个高权限进程需要在&#x2F;tmp目录（一般在全局可写目录下创建的文件容易被利用攻击，因为其他目录权限控制比较严格）创建一个临时文件A，可能的操作是先判断文件是否存在，如果不存在，就创建并打开。此时，攻击者可以在判断之后，创建之前，利用这个时间间隙创建一个同临时文件A同名的软链接文件到系统关键文件B（需要高权限管理员才能访问），此时，高权限进程创建并访问文件A，其实就相当于直接访问了文件B，原本攻击者对文件B没有权限，但利用高权限进程，访问到了文件B，通过该进程，可以对文件B进行破坏、篡改、数据窃取。</p><p>可以看到在这个案例中，原本文件A和B的属主应该都是root，但因为存在竞争攻击，A的属主变成了攻击者普通用户，临时文件变成了链接文件，B依旧是root属主，结果只要高权限进程有文件B的权限，就可以通过A这个软链接文件访问B。</p><p>openEuler默认已经设置软、硬链接保护。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令检查，如果返回值为1，表示已经启用保护：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl fs.protected_symlinks</span></span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line"><span class="comment"># sysctl fs.protected_hardlinks</span></span><br><span class="line">fs.protected_hardlinks = 1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>openEuler默认已经启用保护，无需设置。</p><ul><li><p>如果因实际场景需要启、闭保护状态，可使用如下命令临时设置，重启后恢复默认值：</p><p>启用保护</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w fs.protected_symlinks=1</span></span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line"><span class="comment"># sysctl -w fs.protected_hardlinks=1</span></span><br><span class="line">fs.protected_hardlinks = 1</span><br></pre></td></tr></table></figure><p>关闭保护</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w fs.protected_symlinks=0</span></span><br><span class="line">fs.protected_symlinks = 0</span><br><span class="line"><span class="comment"># sysctl -w fs.protected_hardlinks=0</span></span><br><span class="line">fs.protected_hardlinks = 0</span><br></pre></td></tr></table></figure></li><li><p>可以通过修改&#x2F;etc&#x2F;sysctl.conf文件，添加如下代码，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，实现永久启、闭保护状态：</p><p>启用保护</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">fs.protected_symlinks = 1</span><br><span class="line">fs.protected_hardlinks = 1</span><br></pre></td></tr></table></figure><p>关闭保护</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">fs.protected_symlinks = 0</span><br><span class="line">fs.protected_hardlinks = 0</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-1-17-避免使用USB存储"><a href="#1-1-17-避免使用USB存储" class="headerlink" title="1.1.17 避免使用USB存储"></a>1.1.17 避免使用USB存储</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>USB存储设备通常用于在服务器之间拷贝数据，但由于USB存储设备上的数据一般情况下无法通过技术手段保护，增加了被攻击的风险。如果USB设备上存在病毒、木马等攻击程序，将可能导致服务器被感染破坏，如果USB存储设备管理不善，将导致数据泄露。所以攻击者可以通过构造、破坏USB存储数据，再利用合法的管理人员在服务器上操作USB存储设备，达到攻击服务器、窃取数据的目的。建议根据实际场景，禁用USB存储。</p><p><strong>规则影响：</strong></p><p>无法使用USB存储数据</p><p><strong>检查方法：</strong></p><p>使用如下命令检查输出结果，如果输出“install &#x2F;bin&#x2F;true”，表示USB存储设备已经被禁止使用；如果输出“insmod &#x2F;lib&#x2F;modules&#x2F;(kernel version)&#x2F;kernel&#x2F;drivers&#x2F;usb&#x2F;storage&#x2F;usb-storage.ko.xz”，表示未被禁止，并列出ko所在目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe -n -v usb-storage</span></span><br><span class="line">install /bin/true</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;modprobe.d&#x2F;目录下，添加一个任意文件名的，并以.conf为后缀的配置文件，属主和属组均为root, 权限600，按照如下格式填入代码，即可禁用USB存储：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/modprobe.d/test.conf</span></span><br><span class="line">install usb-storage /bin/true</span><br></pre></td></tr></table></figure><h3 id="1-1-18-应当分区管理硬盘数据"><a href="#1-1-18-应当分区管理硬盘数据" class="headerlink" title="1.1.18 应当分区管理硬盘数据"></a>1.1.18 应当分区管理硬盘数据</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在安装操作系统时，应根据实际场景特点，将操作系统数据同业务数据分区管理，避免将所有数据放在一个硬盘或分区下，合理规划硬盘分区可以避免或降低如下风险：</p><ul><li>日志文件过大，导致业务或系统数据盘满；</li><li>普通账号home目录过大，导致系统或业务盘满；</li><li>系统分区不独立，导致盘满后，操作系统基础服务故障，引起全面DOS攻击；</li><li>不利于权限最小化控制，不利于数据盘加密；</li><li>盘损坏后不利于系统或数据恢复。</li></ul><p>openEuler作为通用操作系统，默认安装单独分区“&#x2F;boot、&#x2F;tmp、&#x2F;home、&#x2F;”，建议根据实际场景确定其他目录的分区挂载以及大小。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下命令检查指定目录是否挂载合理，具体目录清单可根据实际情况增减，如果返回为空，表示这些目录都没有单独挂载分区，否则返回挂载列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># df | grep -iE &quot;/boot|/tmp|/home|/var|/usr&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>根据实际使用场景对硬盘进行合理划分，建议如下：</p><ul><li>操作系统中的“&#x2F;boot、&#x2F;home、&#x2F;tmp、&#x2F;usr、&#x2F;var”目录，建议在系统安装部署时同根目录“&#x2F;”分开，单独分区挂载，并安装系统文件，其中“&#x2F;tmp”目录一般挂载为tmpfs格式的临时内存文件系统，如果关机后用户业务不需要保持“&#x2F;tmp”目录下文件持久化，可以不指定硬盘分区，操作系统自动挂载tmpfs文件系统；</li><li>业务数据目录建议单独分区或独立硬盘、磁阵挂载；</li><li>本地转储（或保存）的日志，建议单独分区或硬盘、磁阵挂载；</li><li>合理分配各个分区的空间大小。</li></ul><p>对于数据盘，可以通过mount命令进行临时挂载，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount /dev/sdb /mnt/data</span></span><br></pre></td></tr></table></figure><p>也可以修改&#x2F;etc&#x2F;fstab文件，确保下次重启后自动挂载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo &quot;/dev/sdb /home/test ext4 defaults 1 1&quot; &gt;&gt; /etc/fstab</span></span><br></pre></td></tr></table></figure><h3 id="1-1-19-确保LD-LIBRARY-PATH变量定义正确"><a href="#1-1-19-确保LD-LIBRARY-PATH变量定义正确" class="headerlink" title="1.1.19 确保LD_LIBRARY_PATH变量定义正确"></a>1.1.19 确保LD_LIBRARY_PATH变量定义正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>LD_LIBRARY_PATH是Linux的环境变量，程序加载动态链接库时，会优先从该环境变量指定的路径中获取。通常情况下该环境变量不应该被设置，如果被恶意设置为不正确的值，程序在运行时就有可能链接到不正确的动态库，导致安全风险。<br>注：&#x2F;etc&#x2F;ld.so.conf.d中配置也会影响动态库加载，需要确保正确配置。</p><p>openEuler默认不设置该变量，根据实际场景，如果必须设置LD_LIBRARY_PATH，需确保在所有用户上下文中该值都是正确的。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>有多个配置文件可以永久设置LD_LIBRARY_PATH值，需要进行排查，这些文件包括：&#x2F;etc&#x2F;profile、<del>&#x2F;.bashrc、</del>&#x2F;.bash_profile，后两个文件为用户home目录下的文件，每个用户都有，检查时务必不能遗漏。</p><p>使用grep命令进行检查，举例中发现&#x2F;etc&#x2F;profile文件中设置了LD_LIBRARY_PATH值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;LD_LIBRARY_PATH&quot; /etc/profile ~/.bashrc ~/.bash_profile</span></span><br><span class="line">/etc/profile:<span class="built_in">export</span> LD_LIBRARY_PATH=/home/</span><br></pre></td></tr></table></figure></li><li><p>检查当前用户上下文中是否存在LD_LIBRARY_PATH值，如果未设置LD_LIBRARY_PATH，则echo命令执行完以后打印为空，否则打印出当前设置的LD_LIBRARY_PATH值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo $LD_LIBRARY_PATH</span></span><br><span class="line">/home/</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>删除所有配置文件中LD_LIBRARY_PATH配置项，或将其设置为正确值。</p><h3 id="1-1-20-确保用户PATH变量被严格定义"><a href="#1-1-20-确保用户PATH变量被严格定义" class="headerlink" title="1.1.20 确保用户PATH变量被严格定义"></a>1.1.20 确保用户PATH变量被严格定义</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Linux下PATH变量定义的是当前用户上下文中可执行文件查找路径，例如：用户在任意目录下使用ls命令，那么系统会在PATH变量指定的目录下查找ls命令，找到后执行。所有用户上下文中的PATH变量不能包含当前目录“.”。目录必须是在文件系统中真实存在、并符合系统的设计期望的路径。正确的PATH值，可以有效防止系统命令被恶意的指令替代，确保系统命令能够安全执行。</p><p>所以PATH变量应该被定义为正确的值，openEuler系统默认设置为：</p><p>&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</p><p>可以根据实际场景对PATH进行修改，但务必确保正确。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过echo命令可以打印出当前用户上下文中PATH的值，检查是否正确，openEuler root用户上下文中PATH值如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo $PATH</span></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br></pre></td></tr></table></figure><p>openEuler普通用户test上下文中PATH值如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo $PATH</span></span><br><span class="line">/usr/local/bin:/usr/bin</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>PATH环境变量分为两部分，一部分在&#x2F;etc&#x2F;profile文件中设置，一部分在用户目录下.bashrc或.bash_profile文件中设置，前者影响所有用户，后者只影响当前用户。</p><p>所以可以通过修改这两个文件中PATH相关字段代码，即可永久修改系统PATH变量值，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:&lt;attach new path&gt;</span><br></pre></td></tr></table></figure><p>如果只是临时修改当前会话的PATH值，可以执行如下命令，会话关闭后失效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># export PATH=$PATH:&lt;attach new path&gt;</span></span><br><span class="line">或</span><br><span class="line"><span class="comment"># export PATH=&lt;the whole of new path&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-2-软件"><a href="#1-2-软件" class="headerlink" title="1.2 软件"></a>1.2 软件</h2><h3 id="1-2-1-禁止安装FTP客户端"><a href="#1-2-1-禁止安装FTP客户端" class="headerlink" title="1.2.1 禁止安装FTP客户端"></a>1.2.1 禁止安装FTP客户端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong><br>FTP（File Transfer Protocol，文件传输协议），提供Linux服务器同其他服务器、桌面系统、终端设备之间的文件传输功能。FTP协议本身不支持加密传输，数据传输过程中容易被攻击者窃取，所以禁止安装FTP客户端，并使用FTP协议。未安装FTP客户端的设备，无法对外通过FTP协议进行传输，如业务需要进行文件传输，可以通过SFTP进行替代。</p><p><strong>规则影响：</strong></p><p>未安装FTP客户端，将无法同FTP服务器进行协议连接。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了FTP软件，如果命令返回为”package ftp is not installed”，表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q &quot;ftp&quot;</span></span><br><span class="line">package ftp is not installed</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已经安装了FTP软件的系统，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove ftp</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove ftp</span></span><br></pre></td></tr></table></figure><h3 id="1-2-2-禁止安装TFTP客户端"><a href="#1-2-2-禁止安装TFTP客户端" class="headerlink" title="1.2.2 禁止安装TFTP客户端"></a>1.2.2 禁止安装TFTP客户端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong><br>TFTP（Trivial File Transfer Protocol，简单文件传输协议），提供Linux服务器同其他服务器、桌面系统、终端设备之间的文件传输功能。TFTP协议本身不支持认证和加密机制，通信过程中容易被攻击者仿冒、篡改、以及窃取，所以禁止安装TFTP客户端和服务。未安装TFTP客户端和服务的设备，无法对外提供TFTP服务，也无法使用客户端同外界基于TFTP协议进行通信，如业务需要进行文件传输，可以通过SFTP服务进行替代。</p><p><strong>规则影响：</strong></p><p>依赖于TFTP服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了TFTP软件，如果命令返回“package tftp is not installed”，表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q &quot;tftp&quot;</span></span><br><span class="line">package tftp is not installed</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已经安装了TFTP软件的系统，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove tftp tftp-server</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove tftp tftp-server</span></span><br></pre></td></tr></table></figure><h3 id="1-2-3-禁止安装Telnet客户端"><a href="#1-2-3-禁止安装Telnet客户端" class="headerlink" title="1.2.3 禁止安装Telnet客户端"></a>1.2.3 禁止安装Telnet客户端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong><br>Telnet是一种应用层协议，常用于服务器的远程登录、操作控制、系统修改等；Telnet传输数据未被加密，用户名、口令、传输数据等容易被攻击者窃取，所以应禁止安装和使用Telnet客户端工具，可以使用基于ssh协议的客户端工具进行替代。</p><p><strong>规则影响：</strong></p><p>依赖于Telnet服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了Telnet客户端软件，如果命令返回“package telnet is not installed”，表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q &quot;telnet&quot;</span></span><br><span class="line">package telnet is not installed</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已经安装了Telnet软件的系统，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove telnet</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove telnet</span></span><br></pre></td></tr></table></figure><h3 id="1-2-4-禁止安装不安全的SNMP协议版本"><a href="#1-2-4-禁止安装不安全的SNMP协议版本" class="headerlink" title="1.2.4 禁止安装不安全的SNMP协议版本"></a>1.2.4 禁止安装不安全的SNMP协议版本</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>简单网络管理协议（SNMP，Simple Network Management Protocol），是专门设计用于在IP网络中管理网络节点的一种标准协议，该协议允许网元之间传递相关网络管理、控制数据。对于不需要SNMP的场景，如果安装了SNMP，则增加了系统资源消耗，并扩大了攻击面，特别是如果使用了SNMP v1.0协议，将导致攻击者可以轻易窃取、篡改、伪造SNMP报文，对各网元进行攻击。</p><p>openEuler安装镜像中提供了net-snmp安装包，但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于SNMP服务的程序执行受限制。</p><p><strong>检查方法：</strong> </p><p>可通过如下命令检查是否安装了snmp软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep -E &quot;net-snmp-[0-9]&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong> </p><p>对于已安装snmp组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove net-snmp</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove net-snmp</span></span><br></pre></td></tr></table></figure><h3 id="1-2-5-禁止安装python2"><a href="#1-2-5-禁止安装python2" class="headerlink" title="1.2.5 禁止安装python2"></a>1.2.5 禁止安装python2</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>python2 社区已经于2020年1月1日停止维护与改进。继续使用该软件容易扩大系统攻击面，增加系统漏洞和被攻击风险，所以禁止使用python2。若有使用python的诉求，建议使用主流版本以减小安全风险。</p><p>openEuler安装镜像中不提供python2相关软件包。</p><p><strong>规则影响：</strong></p><p>依赖于python2的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了python2软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;python2-&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong> </p><p>对于已安装python2组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove python2</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove python2</span></span><br></pre></td></tr></table></figure><h3 id="1-2-6-确保yum源配置GPG校验"><a href="#1-2-6-确保yum源配置GPG校验" class="headerlink" title="1.2.6 确保yum源配置GPG校验"></a>1.2.6 确保yum源配置GPG校验</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>安装包在网络传输或本地存储时存在被攻击者恶意篡改的可能，若未对安装包进行完整性校验，则可能安装了攻击者篡改后的软件，导致服务器甚至整个网络集群遭受攻击。如果使用repo源进行操作系统软件安装升级，必须配置GPG校验。</p><p>openEuler支持使用dnf或yum命令从repo源下载、安装或升级rpm包，通过&#x2F;etc&#x2F;yum.repo.d目录下的文件进行repo源配置，必须配置GPG校验，在系统中必须已安装GPG公钥，或者在repo源配置文件中指定公钥下载地址。</p><p>GPG公钥是校验RPM包合法性的关键，请确保安装可信的GPG公钥。</p><p><strong>规则影响：</strong></p><p>无GPG的repo源无法正常使用。</p><p><strong>检查方法：</strong></p><p>检查系统中是否已经加载GPG公钥，如果返回为空，表示未安装公钥，如果有不同的repo源配置，可能会有多个不同的公钥返回：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa gpg-pubkey*</span></span><br><span class="line">gpg-pubkey-e2ec75bc-5c78bcae</span><br></pre></td></tr></table></figure><p>检查repo源配置文件中是否包含有“gpgcheck&#x3D;1”字段，如果有多个配置文件，则每个配置文件都应该设置该字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -iE &quot;^gpgcheck[ ]*=[ ]*1&quot; /etc/yum.repos.d/ -rn</span></span><br><span class="line">/etc/yum.repos.d/base.repo:6:gpgcheck=1</span><br></pre></td></tr></table></figure><p>检查repo源配置文件中是否已配置公钥下载地址（如果系统中已经安装有对应repo源的公钥，则不是必须配置）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -iE &quot;^gpgkey&quot; /etc/yum.repos.d/ -rn</span></span><br><span class="line">/etc/yum.repos.d/base_tmp.repo:7:gpgkey=&lt;repo源GPG公钥地址&gt;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>openEuler所有商用发布的rpm包都经过GPG私钥签名，通过rpm命令进行安装时会校验签名是否合法，如果校验不通过，可以安装，但会给出告警提示（如下）。禁止通过添加–nosignature –nodigest等方式跳过签名和完整性校验。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -ivh keyutils-&lt;version numbers&gt;.rpm</span></span><br><span class="line">warning: keyutils-&lt;version numbers&gt;.rpm: Header V4 RSA/SHA256 Signature, key ID e2ec75bc: NOKEY</span><br><span class="line">Verifying...            <span class="comment">################################# [100%]</span></span><br><span class="line">Preparing...            <span class="comment">################################# [100%]</span></span><br><span class="line">Updating / installing...</span><br><span class="line">   1:keyutils-&lt;version numbers&gt;  <span class="comment">################################# [100%]</span></span><br></pre></td></tr></table></figure><p>通过repo源进行rpm包安装时，必须在repo源配置文件中添加gpgcheck&#x3D;1字段，开启GPG校验，并添加正确的GPG公钥下载地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/yum.repos.d/base.repo</span></span><br><span class="line">[Euler]</span><br><span class="line">name=Euler</span><br><span class="line">baseurl=&lt;repo源地址&gt;</span><br><span class="line">gpgkey=&lt;repo源GPG公钥地址&gt;</span><br><span class="line">enabled=1</span><br><span class="line">priority=1</span><br><span class="line">gpgcheck=1</span><br></pre></td></tr></table></figure><p>如果repo配置文件中不包含GPG公钥下载地址，则必须通过rpm命令安装对应源的公钥，如果有多个repo源，则每个repo源可能有不同的GPG公钥，需要分别安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm --import ./key</span></span><br></pre></td></tr></table></figure><h3 id="1-2-7-禁止启用debug-shell服务"><a href="#1-2-7-禁止启用debug-shell服务" class="headerlink" title="1.2.7 禁止启用debug-shell服务"></a>1.2.7 禁止启用debug-shell服务</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>debug-shell 服务主要是用来定位系统引导过程中出现的问题，该服务随systemd安装而被安装。开启debug-shell服务后可以在系统启动过程中，systemd启动阶段按下ctrl + alt + F9，攻击者不需要认证直接进入root shell。该过程安全风险很高，攻击者可以通过篡改数据，执行非法程序等手段破坏系统。</p><p>openEuler默认禁止启动debug-shell服务。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查是否启动了服务，如果命令返回为disable，则表示服务未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled debug-shell</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装debug-shell组件的服务器，可以禁用debug-shell服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable debug-shell</span></span><br></pre></td></tr></table></figure><h3 id="1-2-8-禁止安装rsync服务"><a href="#1-2-8-禁止安装rsync服务" class="headerlink" title="1.2.8 禁止安装rsync服务"></a>1.2.8 禁止安装rsync服务</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>rsync服务可以用于在服务器之间或者服务器本地不同硬盘分区之间同步数据，但由于rsync使用不加密的传输协议，存在信息泄露的风险。若启用rsync服务，并且在不同服务器之间通过网络传输数据，则攻击者可以通过监听服务器端口或者路由器、交换机数据报文，窃取数据。</p><p>openEuler安装镜像中提供了rsync安装包，要求在生产环境中不启动rsync服务。</p><p><strong>规则影响：</strong></p><p>依赖于rsync服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>步骤1：</p><p>检查是否安装了rsync软件，如果命令返回为空，则表示未安装，符合规范要求，检查结束，否则继续执行步骤2。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;rsync&quot;</span></span><br></pre></td></tr></table></figure><p>步骤2：</p><p>安装了rsync软件时，检查rsync服务是否开启，disabled表示未启用服务，符合规范要求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled rsyncd</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装rsync组件的服务器，可以禁用rsyncd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable rsyncd</span></span><br></pre></td></tr></table></figure><h3 id="1-2-9-禁止安装avahi服务"><a href="#1-2-9-禁止安装avahi服务" class="headerlink" title="1.2.9 禁止安装avahi服务"></a>1.2.9 禁止安装avahi服务</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>avahi是一种零配置的网络实现，包括用于多播DNS&#x2F;DNS-SD服务的自动发现及自动广播。例如，用户可以将服务器接入网络，并让avahi自动广播其上运行的网络服务，从而方便其他用户访问这些服务。通常并不需要自动发现或者自动广播业务，如果启用不必要的avahi服务，不仅浪费了系统资源，还扩大了攻击面，攻击者可以轻易获取服务器服务情况，并进行针对性的攻击。</p><p><strong>规则影响：</strong></p><p>依赖于avahi服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了avahi软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;avahi&quot;</span></span><br></pre></td></tr></table></figure><p>注意，由于其他组件依赖，系统默认安装有avahi-libs。同时，可以通过systemctl命令检查是否安装avahi服务（如下返回表示未启动，且未安装avahi服务）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled avahi-daemon</span></span><br><span class="line">Failed to get unit file state <span class="keyword">for</span> avahi-daemon.service: No such  file or directory</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装avahi组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove avahi</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove avahi</span></span><br></pre></td></tr></table></figure><h3 id="1-2-10-禁止安装LDAP服务"><a href="#1-2-10-禁止安装LDAP服务" class="headerlink" title="1.2.10 禁止安装LDAP服务"></a>1.2.10 禁止安装LDAP服务</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>LDAP（Lightweight Directory Access Protocol，轻型目录访问协议）是一个轻量级的目录访问协议，提供访问控制和维护分布式的目录信息。系统提供LDAP服务会增加系统资源占用，且扩大了攻击面，如果用户业务场景不需要提供LDAP服务，则禁止安装LDAP服务。</p><p>openEuler安装镜像中提供了openldap-servers安装包，但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于LDAP服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了openldap-servers软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;openldap-servers&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装openldap-servers组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove openldap-servers</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove openldap-servers</span></span><br></pre></td></tr></table></figure><h3 id="1-2-11-禁止安装打印服务"><a href="#1-2-11-禁止安装打印服务" class="headerlink" title="1.2.11 禁止安装打印服务"></a>1.2.11 禁止安装打印服务</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>CUPS（Common Unix Printing System，Unix通用打印系统），启用该服务的服务器为网络内其他设备提供打印服务。提供CUPS服务会占用系统资源，并扩大攻击面。如果业务场景不需要提供打印服务，则禁止安装打印服务。</p><p>openEuler安装镜像中提供了CUPS相关的安装包，但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于CUPS服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了CUPS软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa cups</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装CUPS组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove cups</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove cups</span></span><br></pre></td></tr></table></figure><h3 id="1-2-12-禁止安装NIS服务端"><a href="#1-2-12-禁止安装NIS服务端" class="headerlink" title="1.2.12 禁止安装NIS服务端"></a>1.2.12 禁止安装NIS服务端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>NIS（Network Information Service，网络信息服务），以客户端&#x2F;服务器形式存在，客户端（ypbind）从服务器获取分发的配置信息。NIS服务本质上是一个不安全的服务，容易受到DOS、缓冲区溢出等攻击。如果业务不涉及NIS服务，禁止安装NIS服务端。</p><p>openEuler安装镜像中提供了NIS服务端安装包（ypserv），但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于NIS服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了ypserv软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;ypserv&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装ypserv组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove ypserv</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove ypserv</span></span><br></pre></td></tr></table></figure><h3 id="1-2-13-禁止安装NIS客户端"><a href="#1-2-13-禁止安装NIS客户端" class="headerlink" title="1.2.13 禁止安装NIS客户端"></a>1.2.13 禁止安装NIS客户端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>NIS（Network Information Service，网络信息服务），以客户端&#x2F;服务器形式存在，客户端（ypbind）从服务器获取分发的配置信息。NIS服务本质上是一个不安全的服务，容易受到DOS、缓冲区溢出等攻击。如果业务不涉及NIS服务，禁止安装并使用NIS客户端。</p><p>openEuler安装镜像中提供了ypbind安装包，但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于NIS服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了ypbind软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;ypbind&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装ypbind组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove ypbind</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove ypbind</span></span><br></pre></td></tr></table></figure><h3 id="1-2-14-禁止安装LDAP客户端"><a href="#1-2-14-禁止安装LDAP客户端" class="headerlink" title="1.2.14 禁止安装LDAP客户端"></a>1.2.14 禁止安装LDAP客户端</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>LDAP（Lightweight Directory Access Protocol，轻型目录访问协议）是一个轻量级的目录访问协议，提供访问控制和维护分布式的目录信息。系统提供LDAP客户端会造成系统资源浪费，且扩大了攻击面。如果业务场景不需要使用LDAP服务，则禁止安装LDAP客户端。</p><p>openEuler安装镜像中提供了openldap-clients安装包，但默认未安装。</p><p><strong>规则影响：</strong></p><p>依赖于LDAP服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>检查是否安装了openldap-clients软件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep &quot;openldap-clients&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装openldap-clients组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove openldap-clients</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove openldap-clients</span></span><br></pre></td></tr></table></figure><h3 id="1-2-15-禁止安装网络嗅探类工具"><a href="#1-2-15-禁止安装网络嗅探类工具" class="headerlink" title="1.2.15 禁止安装网络嗅探类工具"></a>1.2.15 禁止安装网络嗅探类工具</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>生产环境中如果包含有网络嗅探类工具，容易被攻击者利用这些工具进行网络分析，辅助网络攻击。所以应在生产环境中禁止安装各类网络嗅探、抓包分析类工具，例如tcpdump、ethereal、wireshark等。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>编写脚本工具，在生产环境或镜像环境中通过关键字扫描来判断是否存在网络嗅探类工具，脚本中可以包含如下命令：</p><ul><li><p>查找相关rpm包是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有rpm包名（此处只是举例，实际包名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的rpm包列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep -iE &quot;^(wireshark-|netcat-|tcpdump-|nmap-|ethereal-)&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>查找相关命令是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有命令名（此处只是举例，实际命令名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的命令列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># files=`find / -type f \( -name &quot;wireshark&quot; -o -name  &quot;netcat&quot; -o -name &quot;tcpdump&quot; -o -name &quot;nmap&quot; -o  -name &quot;ethereal&quot; \) 2&gt;/dev/null`;for f in $files;do if [ -n &quot;$f&quot; ];then file $f | grep -i &quot;ELF&quot; ;fi;done</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>如果用户业务环境中安装有网络嗅探类软件，需通过rpm命令查找并删除软件包，例如删除nmap：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -e nmap</span></span><br></pre></td></tr></table></figure><p>或者通过rm命令手工删除nmap命令文件，但这种方式仅限于非rpm包方式安装的网络嗅探工具，且需确保删除所有相关文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /usr/bin/nmap</span></span><br></pre></td></tr></table></figure><h3 id="1-2-16-禁止安装调测类工具"><a href="#1-2-16-禁止安装调测类工具" class="headerlink" title="1.2.16 禁止安装调测类工具"></a>1.2.16 禁止安装调测类工具</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>业务环境中如果包含有调测类脚本、工具，容易被攻击者利用并攻击。所以应在生产环境中严禁安装各类调测工具、文件，包括但不限于：代码调试工具，用于调测功能的提权命令、脚本、工具，调试阶段使用的证书、密钥，用于性能测试的perf工具、打点、打桩工具，用于CVE等安全问题验证的攻击脚本、工具脚本等。常见的开源第三方调测类工具包括：strace、gdb、readelf、perf等。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>编写脚本工具，在业务环境或镜像环境中通过关键字扫描来判断是否存在调测类工具，脚本中可以包含如下命令：</p><ul><li><p>查找相关rpm包是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有rpm包名（此处只是举例，实际包名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的rpm包列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep -iE &quot;^strace-|^gdb-|^perf-|^binutils-extra|^appict|^kmem_analyzer_tools&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>查找相关命令是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有命令名（此处只是举例，实际命令名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的命令列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -type f \( -name &quot;gdb&quot; -o -name  &quot;perf&quot; -o -name &quot;strace&quot; -o -name &quot;readelf&quot; \)</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>如果用户业务环境中安装有调测类软件，需通过rpm命令查找并删除软件包，例如删除gdb：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -e gdb</span></span><br></pre></td></tr></table></figure><p>或者通过rm命令手工删除gdb命令文件，但这种方式仅限于非rpm包方式安装的调测工具，且需确保删除所有相关文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /usr/bin/gdb</span></span><br></pre></td></tr></table></figure><h3 id="1-2-17-禁止安装开发编译类工具"><a href="#1-2-17-禁止安装开发编译类工具" class="headerlink" title="1.2.17 禁止安装开发编译类工具"></a>1.2.17 禁止安装开发编译类工具</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>业务环境中如果包含有编译工具，容易被攻击者利用，对环境内关键文件进行编辑篡改、逆向分析，从而实施攻击行为。所以应在生产环境中严禁安装各类编译、反编译、二进制分析类工具，包括但不限于：编译工具，反编译工具，编译环境等。常见的第三方开发编译类工具包括：gcc、cpp、mcpp、flex、cmake、make、rpm-build、ld、ar等。</p><p>如果业务环境在部署或运行过程中依赖python、lua、perl等解释器，则可以保留解释器运行环境。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>编写脚本工具，在业务环境或镜像环境中通过关键字扫描来判断是否存在开发编译类工具，脚本中可以包含如下命令：</p><ul><li><p>查找相关rpm包是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有rpm包名（此处只是举例，实际包名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的rpm包列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa | grep -iE &quot;^(gcc-|cpp-|mcpp-|flex-|cmake-|make-|rpm-build-|binutils-extra|elfutils-extra|llvm-|rpcgen-|gcc-c++|libtool)&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>查找相关命令是否被安装，用户可根据自身场景，在此基础上添加需要检查的所有命令名（此处只是举例，实际命令名及范围由用户确定），如果返回为空，表示未安装，否则返回已安装的命令列表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># files=`find / -type f \( -name &quot;gcc&quot; -o -name &quot;g++&quot; -o -name &quot;c++&quot; -o -name  &quot;cpp&quot; -o -name &quot;mcpp&quot; -o -name &quot;flex&quot; -o -name &quot;lex&quot; -o -name  &quot;cmake&quot; -o -name &quot;make&quot; -o -name &quot;rpmbuild&quot; -o  -name &quot;ld&quot; -o -name &quot;ar&quot; -o -name &quot;llc&quot; -o -name &quot;rpcgen&quot; -o -name &quot;libtool&quot; -o -name &quot;javac&quot; -o -name &quot;objdump&quot; -o -name &quot;eu-objdump&quot; -o -name &quot;eu-readelf&quot; -o -name &quot;nm&quot; \) 2&gt; /dev/null`; for f in $files; do if [ -n &quot;$f&quot; ]; then file $f | grep -i &quot;ELF&quot;; fi; done</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>如果业务环境中安装有开发编译类软件，需通过rpm命令查找并删除软件包，例如删除gcc：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -e gcc</span></span><br></pre></td></tr></table></figure><p>或者通过rm命令手工删除gcc命令文件，但这种方式仅限于非rpm包方式安装的开发编译工具，且需确保删除所有相关文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /usr/bin/gcc</span></span><br></pre></td></tr></table></figure><h3 id="1-2-18-避免安装X-Window系统"><a href="#1-2-18-避免安装X-Window系统" class="headerlink" title="1.2.18 避免安装X Window系统"></a>1.2.18 避免安装X Window系统</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>X Window在Linux系统中提供图形界面供用户登录和操作，通常情况下服务器场景无需图形界面，管理员通过命令行即可对服务器完成配置修改。X Window图形界面扩大了攻击面，不常用或相对小众的图形界面组件可能存在较多的软件缺陷，容易被攻击者利用，进而对系统进行破坏。另外，在无需图形界面的服务器上安装X Window组件，浪费了服务器资源，增加了维护成本</p><p><strong>规则影响：</strong></p><p>X Windows相关组件无法使用</p><p><strong>检查方法：</strong></p><p>检查是否安装了X Window相关组件，如果命令返回为空，则表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -qa &quot;xorg-x11&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装X Window组件的服务器，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove &lt;package name&gt;</span></span><br><span class="line">或</span><br><span class="line"><span class="comment"># dnf remove &lt;package name&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-19-避免安装HTTP服务"><a href="#1-2-19-避免安装HTTP服务" class="headerlink" title="1.2.19 避免安装HTTP服务"></a>1.2.19 避免安装HTTP服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>HTTP代表超文本协议（Hypertext Transfer Protocol，HTTP）,是一个简单的请求-响应协议，它通常运行在TCP之上。它指定了客户端可能发送给服务器什么样的消息以及得到什么样的响应。请求和响应消息的头以ASCII形式给出；而消息内容则具有一个类似MIME的格式。HTTP服务器允许客户端（通常是浏览器）通过HTTP协议请求网页、图像、文档等Web内容，并将这些内容传送给客户端。</p><p><strong>规则影响：</strong></p><p>依赖于HTTP服务的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了httpd客户端软件，如果命令返回“package httpd is not installed”，表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q &quot;httpd&quot;</span></span><br><span class="line">package httpd is not installed</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已经安装了httpd软件的系统，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove httpd</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove httpd</span></span><br></pre></td></tr></table></figure><h3 id="1-2-20-避免安装samba服务"><a href="#1-2-20-避免安装samba服务" class="headerlink" title="1.2.20 避免安装samba服务"></a>1.2.20 避免安装samba服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>samba守护进程允许系统管理员配置Linux系统以与windows桌面共享文件系统和目录。samba将通过服务器信息块（SMB）协议公布文件系统和目录。Windows桌面用户将能够将这些目录和文件系统作为盘符挂载在系统上。</p><p><strong>规则影响：</strong></p><p>与Windows系统进行文件共享或打印共享受限制。</p><p><strong>检查方法：</strong></p><p>可通过如下命令检查是否安装了samba软件，如果命令返回“package samba is not installed”，表示未安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm -q &quot;samba&quot;</span></span><br><span class="line">package samba is not installed</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已经安装了samba软件的系统，可以通过yum或dnf命令进行卸载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum remove samba</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf remove samba</span></span><br></pre></td></tr></table></figure><h3 id="1-2-21-避免启用DNS服务"><a href="#1-2-21-避免启用DNS服务" class="headerlink" title="1.2.21 避免启用DNS服务"></a>1.2.21 避免启用DNS服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>域名系统(DNS)是一种分层命名系统，它将名称映射到计算机、服务和其它联网资源的IP地址。</p><p>除非系统被专门指定用作DNS服务器，否则建议禁用DNS Server以减少潜在的攻击面。</p><p><strong>规则影响：</strong></p><p>将无法作为域名服务器提供域名解析服务。</p><p><strong>检查方法：</strong></p><p>检查是否启动了服务，如果命令返回为disable，则表示服务未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled named</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装named组件的服务器，可以禁用named服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable named</span></span><br></pre></td></tr></table></figure><h3 id="1-2-22-避免启用NFS服务"><a href="#1-2-22-避免启用NFS服务" class="headerlink" title="1.2.22 避免启用NFS服务"></a>1.2.22 避免启用NFS服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>网络文件系统 (NFS) 是 UNIX 环境中最早也是分布最广泛的文件系统之一。它为系统提供了通过网络挂载其他服务器的文件系统的能力。如果系统不导出NFS共享，建议禁用NFS以减少远程攻击面。</p><p><strong>规则影响：</strong></p><p>禁用NFS会影响到系统上依赖NFS的服务和应用程序，以及现有的NFS挂载点。在禁用NFS之前，应确保了解系统上的使用情况，并考虑是否有替代方法来满足文件共享和数据访问的需求。</p><p><strong>检查方法：</strong></p><p>检查是否启动了服务，如果命令返回为disable，则表示服务未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled nfs-server</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装nfs组件的服务器，可以禁用nfs-server服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable nfs-server</span></span><br></pre></td></tr></table></figure><h3 id="1-2-23-避免启用RPC服务"><a href="#1-2-23-避免启用RPC服务" class="headerlink" title="1.2.23 避免启用RPC服务"></a>1.2.23 避免启用RPC服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>rpcbind服务将远程过程调用(RPC)服务映射到它们侦听的端口。RPC进程在启动时通知rpcbind，注册它们正在侦听的端口以及它们期望服务的RPC程序编号。然后，客户端系统使用特定的RPC程序号联系服务器上的rpcbind。rpcbind服务将客户端重定向到正确的端口号，以便它可以与请求的服务进行通信。</p><p>如果系统不需要基于 rpc 的服务，建议禁用 rpcbind 以减少远程攻击面。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查是否启动了服务，如果命令返回为disabled，则表示服务未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled rpcbind</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装rpcbind组件的服务器，可以禁用rpcbind服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable rpcbind</span></span><br></pre></td></tr></table></figure><h3 id="1-2-24-避免启用DHCP服务"><a href="#1-2-24-避免启用DHCP服务" class="headerlink" title="1.2.24 避免启用DHCP服务"></a>1.2.24 避免启用DHCP服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>动态主机配置协议（DHCP）是一项允许为机器动态分配IP地址的服务。</p><p>除非系统专门设置为充当DHCP Server，否则建议禁用该服务以减少潜在的攻击面。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查是否启动了服务，如果命令返回为disabled，则表示服务未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled dhcpd</span></span><br><span class="line">disabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>对于已安装dhcpd组件的服务器，可以禁用dhcpd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now disable dhcpd</span></span><br></pre></td></tr></table></figure><h2 id="2-安全访问"><a href="#2-安全访问" class="headerlink" title="2 安全访问"></a>2 安全访问</h2><h2 id="2-1-账户"><a href="#2-1-账户" class="headerlink" title="2.1 账户"></a>2.1 账户</h2><h3 id="2-1-1-禁止无需登录的账号设置登录能力"><a href="#2-1-1-禁止无需登录的账号设置登录能力" class="headerlink" title="2.1.1 禁止无需登录的账号设置登录能力"></a>2.1.1 禁止无需登录的账号设置登录能力</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通常情况下，Linux系统中存在多个账号，而这些账号并不一定都是需要登录的，例如systemd、dhcp等软件安装时会自带安装一些账号，这些账号只是为了运行相关的服务进程。对于无需进行登录的账号，必须禁止其登录能力。如果允许非登录账号有登录能力，将扩大攻击面，攻击者可以利用这些账号进行bash交互操作，从而攻击系统。</p><p>注意，sync、shutdown、halt属于特殊账号，通常情况下不能将shell设置为nologin或false，这几个账号在&#x2F;shadow文件中口令设置为“*”，所以并不能直接登录。</p><p>openEuler默认满足无需登录的账号不具备登录能力。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong> </p><p>检查的目的是确认是否所有不该登录的账号都被设置了&#x2F;sbin&#x2F;nologin或&#x2F;bin&#x2F;false，或对应的口令被锁定。</p><ul><li><p>使用如下命令查看&#x2F;etc&#x2F;passwd文件中非登录账号是否都已经被设置正确，命令执行后会列出所有设置了禁止登录的账号，可根据业务场景对这些账号进行比对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | grep &quot;\/sbin\/nologin\|\/bin\/false&quot; | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>使用如下命令查看&#x2F;etc&#x2F;passwd文件中所有允许登录的账号，命令执行后会列出所有允许登录的账号，可根据业务场景对这些账号进行比对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | grep -v &quot;\/sbin\/nologin\|\/bin\/false&quot; | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>如下命令执行后会列出所有口令被锁定的账号，可根据业务场景对这些账号进行比对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27; | xargs -I &#x27;&#123;&#125;&#x27; passwd -S &#x27;&#123;&#125;&#x27; | awk &#x27;($2==&quot;L&quot; || $2==&quot;LK&quot;) &#123;print $1&#125;&#x27; </span></span><br></pre></td></tr></table></figure></li><li><p>如下命令执行后会列出所有口令未被锁定的账号，可根据业务场景对这些账号进行比对：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27; | xargs -I &#x27;&#123;&#125;&#x27; passwd -S &#x27;&#123;&#125;&#x27; | awk &#x27;($2!=&quot;L&quot; &amp;&amp; $2!=&quot;LK&quot;) &#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong> </p><p>有两种方法可以锁定和解锁用户账号：</p><ul><li><p>通过usermod命令修改&#x2F;etc&#x2F;passwd文件，将指定账号的登录shell设置为&#x2F;sbin&#x2F;nologin或&#x2F;bin&#x2F;false，该方法不仅可以防止用户登录，还可以防止使用su命令切换为指定用户账号，优先推荐该方法，操作如下（test为账号名）：</p><p>锁定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -s /sbin/nologin test</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -s /bin/false test</span></span><br></pre></td></tr></table></figure><p>解锁：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -s /bin/bash test</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;shadow文件，在指定账号的第二个字段中添加感叹号“!”或“!!”，锁定口令，可通过如下命令操作（test为账号名，如果账号并未设置口令，则会提示操作失败）：</p><p>锁定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -L test</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -l test</span></span><br></pre></td></tr></table></figure><p>解锁：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -U test</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -u test</span></span><br></pre></td></tr></table></figure><p>使用usermod命令锁定的口令，可以使用passwd命令进行解锁，反之亦然。锁定或解锁后可以通过如下命令检查状态，LK表示口令已经锁定，NP表示口令未设置，PS表示口令已被设置，且未锁定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -S test</span></span><br><span class="line"><span class="built_in">test</span> LK 2022-01-01 0 30 10 35 (Password locked.)</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -S test</span></span><br><span class="line"><span class="built_in">test</span> NP 2020-12-03 0 50 10 35 (Empty password.)</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -S test</span></span><br><span class="line"><span class="built_in">test</span> PS 2022-01-01 0 30 10 35 (Password <span class="built_in">set</span>, SHA512 crypt.)</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-2-禁止存在不使用的账号"><a href="#2-1-2-禁止存在不使用的账号" class="headerlink" title="2.1.2 禁止存在不使用的账号"></a>2.1.2 禁止存在不使用的账号</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>如果系统中存在业务无关的账号，容易被攻击者利用该账号进行攻击行为。系统应该只保留业务所必须的账号，其他用于安装部署、调试验证，以及问题定位等的账号都必须被删除。</p><p>openEuler默认满足不存在不使用的账号。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>openEuler默认只保留系统运行必须的账号，根据自身业务场景确定是否存在业务无关账号，可以使用如下命令查找系统中所有账号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk  -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27;  </span></span><br></pre></td></tr></table></figure><p>按照以下步骤进行查询和判断：</p><ul><li>在未部署业务的平台上，使用上述命令获取所有账号信息；</li><li>在完整部署业务的平台上，使用上述命令获取所有账号信息；</li><li>对比两者返回结果，对差异部分进行分析，是否符合业务设计。</li></ul><p><strong>修复方法：</strong></p><p>如果存在业务无关账号，可通过如下步骤进行删除：</p><ul><li><p>查找所有该账号为属主的文件，并通过rm命令手工删除这些文件，如下（test为账号名，&#x2F;home&#x2F;test目录在删除账号时可通过参数自动删除，xxx表示需要被删除的文件或目录）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -user test</span></span><br><span class="line"><span class="comment"># rm xxx -rf</span></span><br></pre></td></tr></table></figure></li><li><p>删除账号，包括home目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># userdel -rf test</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-3-确保不同账号初始分配不同的组ID"><a href="#2-1-3-确保不同账号初始分配不同的组ID" class="headerlink" title="2.1.3 确保不同账号初始分配不同的组ID"></a>2.1.3 确保不同账号初始分配不同的组ID</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>不同用户账号的初始登录组必须不同，如果某个用户账号需要访问其他组的文件，则需要通过命令明确指定加入该组。在大多数情况下，文件权限设置为640，文件夹设置为750，那么同组用户账号是可以对文件进行访问的，所以如果两个不相干的用户账号被设置为同一个组，存在文件被意外读取甚至篡改的可能。</p><p>openEuler默认满足不同账号初始分配不同的组ID。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;passwd文件中各个账号所属的组id是否不同，可执行如下命令，如果没有相同组id，则命令执行后无输出，否则输出组id号以及相同组id的账号数量，如下面例子中输出1003 2，表示有两个账号的用户组id为1003：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;a[$4]++&#125;END&#123;for(i in a)&#123;if(a[i]!=1 &amp;&amp; i!=0)&#123;print i, a[i]&#125;&#125;&#125;&#x27;</span></span><br><span class="line">1003 2</span><br></pre></td></tr></table></figure><p>注意：上面命令中过滤了root用户组，因为sync、shutdown等系统账号都属于root组，属于例外场景，在本规范中不做要求。</p><p><strong>修复方法：</strong></p><ul><li><p>添加新账号时，不使用-g参数指定group，而是让系统直接自动分配新的group组，此处-U参数表示需要创建新用户组，默认可以不加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd test</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd test</span></span><br></pre></td></tr></table></figure></li><li><p>如果新账号需要被加入其它组，则可以通过-G参数指定，该命令为test1账号新建一个test1的组，作为test1账号默认登录组，另外会将test1账号加入用户组test：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd -G test test1</span></span><br></pre></td></tr></table></figure><p>通过如下命令检查test1同test的默认登录组不同：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | grep test</span></span><br><span class="line"><span class="built_in">test</span>:x:1007:1007::/home/test:/bin/bash</span><br><span class="line">test1:x:1008:1008::/home/test1:/bin/bash</span><br></pre></td></tr></table></figure><p>通过如下命令可以看到test1账号同时被加入了test组：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id test1</span></span><br><span class="line">uid=1008(test1) gid=1008(test1) <span class="built_in">groups</span>=1008(test1),1007(<span class="built_in">test</span>)</span><br></pre></td></tr></table></figure><p>test1账号登录后（或者su切换），可以通过newgrp命令切换到test组，命令执行后当前gid已经变成test组的id了，但这并不会改变&#x2F;etc&#x2F;passwd中的组id：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># su test1</span></span><br><span class="line">$ newgrp <span class="built_in">test</span></span><br><span class="line">$ <span class="built_in">id</span></span><br><span class="line">uid=1008(test1) gid=1007(<span class="built_in">test</span>) <span class="built_in">groups</span>=1007(<span class="built_in">test</span>),1008(test1) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure></li><li><p>如果是已有账号，需要加入其他组，则可以通过如下命令操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -a -G root test1</span></span><br></pre></td></tr></table></figure><p>执行后，test1账号被加入到root组，查看结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id test1</span></span><br><span class="line">uid=1008(test1) gid=1008(test1) <span class="built_in">groups</span>=1008(test1),0(root),1007(<span class="built_in">test</span>)</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-4-禁止存在UID为0的非root账号"><a href="#2-1-4-禁止存在UID为0的非root账号" class="headerlink" title="2.1.4 禁止存在UID为0的非root账号"></a>2.1.4 禁止存在UID为0的非root账号</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>UID为0的账号是linux系统中的超级管理员账号，账号名业界约定俗成为root，系统中不允许存在非root账号的UID等于0。如果将root账号UID改为其他值，而其他账号test的UID改为0，那么就会导致账号test拥有超级管理员权限，主要有以下几个问题：</p><ul><li>业界通用的安全扫描工具会认为账号test设置了非法UID；</li><li>增加管理成本，如果用户在使用test账号时没有意识到是超级管理员，可能因疏忽的缘故导致系统被破坏。</li></ul><p>openEuler默认满足不存在UID为0的非root账号。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下命令检查&#x2F;etc&#x2F;passwd文件中是否存在UID为0的非root账号，如下例子中命令执行后返回test 0，表示test账号的UID是0。如果没有UID为0的非root账号，命令无返回输出。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;if($1!=&quot;root&quot; &amp;&amp; $3==0)&#123;print $1, $3&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">test</span> 0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>直接修改&#x2F;etc&#x2F;passwd对应账号的UID字段，然后重启系统，需要确保修改的UID不能同其他账号重复。</p><p>注意：usermod命令可以修改账号UID，但如果被修改的账号UID原先为0，则会报错，因为UID为0的账号会被1号进程使用，所以只能通过手工方式直接修改&#x2F;etc&#x2F;passwd文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -u 2000 test</span></span><br><span class="line">usermod: user <span class="built_in">test</span> is currently used by process 1</span><br></pre></td></tr></table></figure><h3 id="2-1-5-确保账号、组及口令文件权限正确"><a href="#2-1-5-确保账号、组及口令文件权限正确" class="headerlink" title="2.1.5 确保账号、组及口令文件权限正确"></a>2.1.5 确保账号、组及口令文件权限正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Linux操作系统中用户账号、口令、用户组等认证相关信息都记录在&#x2F;etc目录下的配置文件中，这些文件需要设置合理的访问权限，否则容易被攻击者窃取或篡改。</p><p>这些文件属主和属组必须为root和root组，对应的访问权限必须为：</p><table><thead><tr><th>文件</th><th>设置值</th></tr></thead><tbody><tr><td>&#x2F;etc&#x2F;passwd</td><td>644（rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;shadow</td><td>000（———）</td></tr><tr><td>&#x2F;etc&#x2F;group</td><td>644（rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;gshadow</td><td>000（———）</td></tr><tr><td>&#x2F;etc&#x2F;passwd-</td><td>644（rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;shadow-</td><td>000（———）</td></tr><tr><td>&#x2F;etc&#x2F;group-</td><td>644（rw-r–r–）</td></tr><tr><td>&#x2F;etc&#x2F;gshadow-</td><td>000（———）</td></tr></tbody></table><p>如果权限配置比表格中更加严格，则普通用户登录时可能无法读取passwd或group配置文件中的信息。导致登录或者执行操作失败。</p><p>如果权限配置比表格中更加宽松，则可能导致配置文件信息被攻击者窃取或篡改。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令进行检查，如果返回信息同上表不符，则表示未满足权限要求：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ll /etc/passwd</span></span><br><span class="line">-rw-r--r--. 1 root root 1343 Dec  5 07:37 /etc/passwd</span><br><span class="line"><span class="comment"># ll /etc/shadow</span></span><br><span class="line">----------. 1 root root 786 Dec  5 07:38 /etc/shadow</span><br><span class="line"><span class="comment"># ll /etc/group</span></span><br><span class="line">-rw-r--r--. 1 root root 609 Dec 14 12:59 /etc/group</span><br><span class="line"><span class="comment"># ll /etc/gshadow</span></span><br><span class="line">----------. 1 root root 485 Dec  5 07:37 /etc/gshadow</span><br><span class="line"><span class="comment"># ll /etc/passwd-</span></span><br><span class="line">-rw-r--r--. 1 root root 1295 Dec  5 07:36 /etc/passwd-</span><br><span class="line"><span class="comment"># ll /etc/shadow-</span></span><br><span class="line">----------. 1 root root 681 Dec  5 07:37 /etc/shadow-</span><br><span class="line"><span class="comment"># ll /etc/group-</span></span><br><span class="line">-rw-r--r--. 1 root root 609 Dec  5 07:37 /etc/group-</span><br><span class="line"><span class="comment"># ll /etc/gshadow-</span></span><br><span class="line">----------. 1 root root 474 Dec  5 07:36 /etc/gshadow-</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果文件权限不符合规范要求，可以通过chown和chmod命令进行修改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown root:root &lt;passwd/group/shadow config file&gt;</span></span><br><span class="line"><span class="comment"># chmod &lt;access permissions&gt; &lt;passwd/group/shadow config file&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-1-6-确保账号拥有自己的Home目录"><a href="#2-1-6-确保账号拥有自己的Home目录" class="headerlink" title="2.1.6 确保账号拥有自己的Home目录"></a>2.1.6 确保账号拥有自己的Home目录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>每个用户账号必须有自己的Home目录，用来存放账号相关的数据，该目录的属主必须是用户自身。如果Home目录属主不是自身，那么可能无法对该目录进行读写，或者该目录下保存的用户数据可以被其他用户（如属主）读取或篡改。如果没有Home目录，则用户账号登录后将无法获取到自身的环境配置数据。</p><p>openEuler默认满足每个账户拥有自己的Home目录。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下脚本进行检查，如果无返回输出，则表示所有用户账号均有Home目录，目录属主正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line"> </span><br><span class="line">grep -E -v <span class="string">&#x27;^(halt|sync|shutdown)&#x27;</span> <span class="string">&quot;/etc/passwd&quot;</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;($7 != &quot;/bin/false&quot; &amp;&amp; $7 != &quot;/sbin/nologin&quot; &amp;&amp; $7 != &quot;/usr/sbin/nologin&quot;) &#123;print $1 &quot; &quot; $6&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> name home;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$home</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;No home folder \&quot;<span class="variable">$home</span>\&quot; of \&quot;<span class="variable">$name</span>\&quot;.&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">            owner=`<span class="built_in">ls</span> -l -d <span class="variable">$home</span> | awk -F <span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>`</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$owner</span>&quot;</span> != <span class="string">&quot;<span class="variable">$name</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;\&quot;<span class="variable">$home</span>\&quot; is owned by <span class="variable">$owner</span>, not \&quot;<span class="variable">$name</span>\&quot;.&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>删除相应的用户账号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># userdel -r test</span></span><br><span class="line">userdel: <span class="built_in">test</span> home directory (/home/test) not found</span><br></pre></td></tr></table></figure></li><li><p>使用useradd命令添加用户账号（同时自动创建Home目录）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd test</span></span><br><span class="line"><span class="comment"># ll -d /home/test/</span></span><br><span class="line">drwx------. 2 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Feb  2 13:19 /home/test/</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-7-确保-etc-passwd中的组都存在"><a href="#2-1-7-确保-etc-passwd中的组都存在" class="headerlink" title="2.1.7 确保&#x2F;etc&#x2F;passwd中的组都存在"></a>2.1.7 确保&#x2F;etc&#x2F;passwd中的组都存在</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>要求在&#x2F;etc&#x2F;passwd中涉及到的用户组，都必须在&#x2F;etc&#x2F;group文件中真实存在。如果管理员通过手工方式修改这两个文件，则可能因为人为错误而导致用户组不正确。如果&#x2F;etc&#x2F;passwd中的用户组在&#x2F;etc&#x2F;group中不存在，那么将导致用户组权限管理风险。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下脚本进行检查，如果无返回输出，则表示所有用户组设置正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">  </span><br><span class="line">grep -E -v <span class="string">&#x27;^(halt|sync|shutdown)&#x27;</span> <span class="string">&quot;/etc/passwd&quot;</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;($7 != &quot;/bin/false&quot; &amp;&amp; $7 != &quot;/sbin/nologin&quot;) &#123;print $4&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> group;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    grep -q -P <span class="string">&quot;^.*?:[^:]*:<span class="variable">$group</span>:&quot;</span> <span class="string">&quot;/etc/group&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Group <span class="variable">$group</span> not found&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>分析两个文件不匹配的原因，可以有两种修复方式：</p><ul><li><p>通过删除账号，重新添加的方式进行修复：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># userdel -r test</span></span><br><span class="line"><span class="comment"># useradd test</span></span><br></pre></td></tr></table></figure></li><li><p>通过删除或添加组的方式进行修复（其中xxx表示gid的值）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># groupdel testgroup</span></span><br><span class="line"><span class="comment"># groupadd -g xxx testgroup</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-1-8-确保UID唯一"><a href="#2-1-8-确保UID唯一" class="headerlink" title="2.1.8 确保UID唯一"></a>2.1.8 确保UID唯一</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>要求在&#x2F;etc&#x2F;passwd中涉及到的用户账号UID唯一。Linux系统中根据UID来判断账号权限，如果多个账号使用同一个UID，则会导致这些账号拥有一样的权限，可以相互访问Home目录，以及各自创建的文件，导致越权以及信息泄露。</p><p>通常情况下使用useradd等命令添加用户账号，不会存在UID重复问题，但如果管理员操作失误，直接修改&#x2F;etc&#x2F;passwd文件，则可能导致问题。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令进行检查，如果无返回输出，则表示所有UID设置正确，且唯一，否则列出UID和对应的复用次数，如3003这个UID被两个账号使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;a[$3]++&#125;END&#123;for(i in a)&#123;if(a[i]!=1)&#123;print i, a[i]&#125;&#125;&#125;&#x27;</span></span><br><span class="line">3003 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>分析UID被重复使用的原因，然后删除出现问题的账号，并重新添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># userdel -r test</span></span><br><span class="line"><span class="comment"># useradd test</span></span><br></pre></td></tr></table></figure><h3 id="2-1-9-确保账号名唯一"><a href="#2-1-9-确保账号名唯一" class="headerlink" title="2.1.9 确保账号名唯一"></a>2.1.9 确保账号名唯一</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>要求在&#x2F;etc&#x2F;passwd中涉及到的账号名唯一。如果&#x2F;etc&#x2F;passwd中的账号名重复，则实际只有&#x2F;etc&#x2F;passwd文件中第一个该账号的UID有效。</p><p>通常情况下使用useradd等命令添加用户账号，不会存在账号名重复问题，但如果管理员操作失误，直接修改&#x2F;etc&#x2F;passwd文件，则可能导致问题。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令进行检查，如果无返回输出，则表示所有账号名唯一，否则列出账号名和对应的复用次数，如test这个账号存在重复：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/passwd | awk -F &quot;:&quot; &#x27;&#123;a[$1]++&#125;END&#123;for(i in a)&#123;if(a[i]!=1)&#123;print i, a[i]&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">test</span> 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>分析账号名被重复使用的原因，然后手工删除&#x2F;etc&#x2F;passwd文件中出现问题的账号，并按需确定是否使用useradd命令重新添加正确的账号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd test</span></span><br></pre></td></tr></table></figure><h3 id="2-1-10-确保GID唯一"><a href="#2-1-10-确保GID唯一" class="headerlink" title="2.1.10 确保GID唯一"></a>2.1.10 确保GID唯一</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>要求在&#x2F;etc&#x2F;group中涉及到的用户组GID唯一。Linux系统中根据GID来判断用户组权限，如果多个用户组使用同一个GID，则会导致这些用户组拥有一样的权限，可以相互访问拥有组权限的目录，导致越权以及信息泄露。</p><p>通常情况下使用useradd&#x2F;groupadd等命令添加用户账号&#x2F;用户组，不会存在GID重复问题，但如果管理员操作失误，直接修改&#x2F;etc&#x2F;group文件，则可能导致问题。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令进行检查，如果无返回输出，则表示所有GID唯一，否则列出GID和对应的复用次数，如3003这个GID被两个用户组使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/group | awk -F &quot;:&quot; &#x27;&#123;a[$3]++&#125;END&#123;for(i in a)&#123;if(a[i]!=1)&#123;print i, a[i]&#125;&#125;&#125;&#x27;</span></span><br><span class="line">3003 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>分析GID被重复使用的原因，然后删除出现问题的用户组（注意，修复时需按照实际场景，先删除属于该用户组的用户账号）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># groupdel test1</span></span><br></pre></td></tr></table></figure><h3 id="2-1-11-确保组名唯一"><a href="#2-1-11-确保组名唯一" class="headerlink" title="2.1.11 确保组名唯一"></a>2.1.11 确保组名唯一</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>要求在&#x2F;etc&#x2F;group中涉及到的用户组名唯一。如果&#x2F;etc&#x2F;group中的用户组名重复，则实际只有&#x2F;etc&#x2F;group文件中第一个该用户组的GID有效。</p><p>通常情况下使用useradd&#x2F;groupadd等命令添加用户账号&#x2F;用户组，不会存在用户组名重复问题，但如果管理员操作失误，直接修改&#x2F;etc&#x2F;group文件，则可能导致问题。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令进行检查，如果无返回输出，则表示所有用户组名唯一，否则列出组名和对应的复用次数，如test这个组名存在重复：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/group | awk -F &quot;:&quot; &#x27;&#123;a[$1]++&#125;END&#123;for(i in a)&#123;if(a[i]!=1)&#123;print i, a[i]&#125;&#125;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">test</span> 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>分析用户组名被重复使用的原因，然后手工删除&#x2F;etc&#x2F;group文件中出现问题的用户组，并按需确定是否使用groupadd命令重新添加正确的组名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># groupadd test</span></span><br></pre></td></tr></table></figure><h3 id="2-1-12-应当正确设置账号有效期"><a href="#2-1-12-应当正确设置账号有效期" class="headerlink" title="2.1.12 应当正确设置账号有效期"></a>2.1.12 应当正确设置账号有效期</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>账号应该根据自身的应用场景进行生命周期管理，例如临时创建的管理、维护账号；定期业务所需要的账号，业务生命周期结束，账号生命周期也结束了。对于这类账号，应该在生命周期结束时就直接删除，但由于管理原因，往往容易遗忘，所以建议管理员在创建账号的过程中，同时设定账号的过期时间。（注：系统账号可根据业务实际情况设置，系统账号通常用于系统服务及程序运行，不具备登录条件，不需要关注有效期。）</p><p>如果账号已经不再需要，但并没有被删除，也没有被禁用，那么由于该账号相关管理疏漏，有可能导致口令泄露或者账号被非法使用。例如原本用于日志维护的临时账号应该在1个月后过期，但到期后并没有被禁用，那么相应的管理人员在后续的时间内，依旧可以使用该账号登录系统，导致安全风险。</p><p><strong>规则影响：</strong></p><p>过期账号无法正常登陆。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;shadow文件中除默认账号及无法登陆的账号外，所有的账号的第8个字段是否有值，这个值是从1970年1月1日开始计算的天数累加值，例如这个值如果是1，表示账号有效期到1970年1月2日24点过期。</p><p>可以通过如下命令检查，如果设置了过期时间，则直接返回该值，否则无返回数据（test为需要检查的账号）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/shadow | grep &quot;test&quot; | awk -F &quot;:&quot; &#x27;&#123;if($8!=&quot;&quot;)&#123;print $8&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过usermod命令设置账号的过期时间，如（test为需要被设置的账号，yyyy-mm-dd为过期时间）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usermod -e yyyy-mm-dd test</span></span><br></pre></td></tr></table></figure><h3 id="2-1-13-避免Home目录下存在-forward文件"><a href="#2-1-13-避免Home目录下存在-forward文件" class="headerlink" title="2.1.13 避免Home目录下存在.forward文件"></a>2.1.13 避免Home目录下存在.forward文件</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>“.forward”文件可以配置一个email地址，当用户收到邮件时，会自动转发到该地址。如无相关邮件转发场景，建议删除“.forward”文件。如果存在“.forward”文件，可能导致携带有敏感信息的用户邮件被自动转发到高风险的邮箱。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下脚本进行检查，如果无返回输出，则表示所有Home目录下无“.forward”文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line">  </span><br><span class="line">grep -E -v <span class="string">&#x27;^(halt|sync|shutdown)&#x27;</span> <span class="string">&quot;/etc/passwd&quot;</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;($7 != &quot;/bin/false&quot; &amp;&amp; $7 != &quot;/sbin/nologin&quot;) &#123;print $6&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> home;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$home</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        find <span class="variable">$home</span> -name <span class="string">&quot;.forward&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用rm命令将检查方法找到“.forward”文件删除。</p><h3 id="2-1-14-避免Home目录下存在-netrc文件"><a href="#2-1-14-避免Home目录下存在-netrc文件" class="headerlink" title="2.1.14 避免Home目录下存在.netrc文件"></a>2.1.14 避免Home目录下存在.netrc文件</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>“.netrc”文件保存用于登录远端ftp服务器的口令，如无相关ftp场景，建议删除“.netrc”文件。“.netrc”文件中存储的口令是明文的，容易被攻击者窃取，从而导致ftp服务器敏感数据泄露，甚至服务器遭受攻击。</p><p><strong>规则影响：</strong></p><p>ftp服务器自动登录受限制</p><p><strong>检查方法：</strong></p><p>使用如下脚本进行检查，如果无返回输出，则表示所有Home目录下无“.netrc”文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">grep -E -v <span class="string">&#x27;^(halt|sync|shutdown)&#x27;</span> <span class="string">&quot;/etc/passwd&quot;</span> | awk -F <span class="string">&quot;:&quot;</span> <span class="string">&#x27;($7 != &quot;/bin/false&quot; &amp;&amp; $7 != &quot;/sbin/nologin&quot;) &#123;print $6&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> home;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$home</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        find <span class="variable">$home</span> -name <span class="string">&quot;.netrc&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用rm命令将检查方法找到“.netrc”文件删除。</p><h2 id="2-2-口令"><a href="#2-2-口令" class="headerlink" title="2.2 口令"></a>2.2 口令</h2><h3 id="2-2-1-确保口令复杂度设置正确"><a href="#2-2-1-确保口令复杂度设置正确" class="headerlink" title="2.2.1 确保口令复杂度设置正确"></a>2.2.1 确保口令复杂度设置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>口令设置过于简单，容易被猜测，太短的口令、纯数字或纯字母的口令容易被暴力破解工具猜测出来。在系统设置口令时，应强制用户使用复杂口令。对于高安全要求的业务场景，可参考业界最佳实践，比如：口令长度设置为14位或更长，对于四种字符组合，建议每种字符至少出现一次，保证口令不会被轻易破解。</p><p>openEuler要求设置口令复杂度如下：</p><ul><li>口令长度至少8个字符。</li><li>口令必须包含如下至少3种字符的组合：<ul><li>至少一个小写字母。</li><li>至少一个大写字母。</li><li>至少一个数字。</li><li>至少一个特殊字符：&#96;~!@#$%^&amp;*()-_&#x3D;+|[{}];:’”,&lt;.&gt;&#x2F;?和空格。</li></ul></li></ul><p>考虑到在不同场景下的易用性，openEuler默认不配置enforce_for_root和retry值，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>口令规则太过复杂，又会影响系统的易用性，给用户的正常使用造成不便。所以可以根据实际需求和使用场景，设计符合安全要求的口令复杂度。</p><p><strong>检查方法：</strong></p><p>方法1：</p><ul><li><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth分别提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep system-auth /etc/pam.d/ -r</span></span><br><span class="line">/etc/pam.d/login:auth       substack     system-auth</span><br><span class="line">/etc/pam.d/login:account    include      system-auth</span><br><span class="line">/etc/pam.d/login:password   include      system-auth</span><br><span class="line">/etc/pam.d/login:session    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:auth       include      system-auth</span><br><span class="line">/etc/pam.d/sudo:account    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:password   include      system-auth</span><br><span class="line">/etc/pam.d/sudo:session    include      system-auth-su</span><br></pre></td></tr></table></figure><p>以上只列举部分显示结果，从以上结果可知，login和sudo的账号认证采用&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中的配置。</p><p>后续以&#x2F;etc&#x2F;pam.d&#x2F;system-auth为例进行说明。</p></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“设置口令复杂度”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_pwquality /etc/pam.d/system-auth</span></span><br><span class="line">password    requisite     pam_pwquality.so minlen=8 minclass=3 enforce_for_root try_first_pass local_users_only retry=3 dcredit=0 ucredit=0 lcredit=0 ocredit=0</span><br></pre></td></tr></table></figure></li></ul><p>方法2：</p><ul><li><p>在&#x2F;etc&#x2F;security&#x2F;pwquality.conf文件中检查“设置口令复杂度”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cat /etc/security/pwquality.conf</span></span><br><span class="line">minlen=8</span><br><span class="line">minclass=3</span><br><span class="line">retry=3</span><br><span class="line">dcredit=0</span><br><span class="line">ucredit=0</span><br><span class="line">lcredit=0</span><br><span class="line">ocredit=0</span><br><span class="line">enforce_for_root</span><br></pre></td></tr></table></figure><p>此处仅列举本规范关注的配置项。</p></li></ul><p><strong>修复方法：</strong></p><p>方法1：</p><ul><li>口令复杂度的设置可以通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件实现。以&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件为例，具体配置字段如下：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">password    requisite     pam_pwquality.so minlen=8 minclass=3 enforce_for_root try_first_pass local_users_only retry=3 dcredit=0 ucredit=0 lcredit=0 ocredit=0</span><br></pre></td></tr></table></figure></li></ul><p>方法2：</p><ul><li>在&#x2F;etc&#x2F;security&#x2F;pwquality.conf文件中配置如下字段：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/security/pwquality.conf</span></span><br><span class="line">minlen=8</span><br><span class="line">minclass=3</span><br><span class="line">retry=3</span><br><span class="line">dcredit=0</span><br><span class="line">ucredit=0</span><br><span class="line">lcredit=0</span><br><span class="line">ocredit=0</span><br><span class="line">enforce_for_root</span><br></pre></td></tr></table></figure></li></ul><p>pam_pwquality.so配置项参数字段说明如下表：</p><table><thead><tr><th><strong>配置项</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>minlen&#x3D;8</td><td>口令长度至少包含8个字符。 说明： 建议配置更长的口令最小长度。</td></tr><tr><td>minclass&#x3D;3</td><td>口令至少包含大写字母、小写字母、数字和特殊字符中的任意3种</td></tr><tr><td>ucredit&#x3D;0</td><td>口令包含任意个大写字母</td></tr><tr><td>lcredit&#x3D;0</td><td>口令包含任意个小写字母</td></tr><tr><td>dcredit&#x3D;0</td><td>口令包含任意个数字</td></tr><tr><td>ocredit&#x3D;0</td><td>口令包含任意个特殊字符</td></tr><tr><td>retry&#x3D;3</td><td>每次修改最多可以尝试3次</td></tr><tr><td>enforce_for_root</td><td>本设置对root账号同样有效</td></tr></tbody></table><h3 id="2-2-2-禁止使用历史口令"><a href="#2-2-2-禁止使用历史口令" class="headerlink" title="2.2.2 禁止使用历史口令"></a>2.2.2 禁止使用历史口令</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>频繁使用相同的历史口令容易造成口令泄露而被攻击者攻击。为了用户账号的安全，需要配置“禁用历史口令”功能。根据业务实际场景，合理的设置禁用历史口令次数，但不得小于5次。</p><p>考虑到社区版本在不同场景下的易用性，openEuler发行版默认不配置禁用历史口令，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>禁止历史口令次数设置过大，易增加口令管理成本。</p><p><strong>检查方法：</strong></p><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth都各自提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定。</p><ul><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“禁用历史口令”的配置情况，检查配置remember值是否不小于5：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_pwhistory /etc/pam.d/system-auth</span></span><br><span class="line">password    required      pam_pwhistory.so use_authtok remember=5 enforce_for_root</span><br></pre></td></tr></table></figure></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;password-auth文件中检查“禁用历史口令”的配置情况，检查配置remember值是否不小于5：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_pwhistory /etc/pam.d/password-auth</span></span><br><span class="line">password    required      pam_pwhistory.so use_authtok remember=5 enforce_for_root</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>“禁用历史口令”的设置可以通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件实现。</p><ul><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件配置如下字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">password    required      pam_pwhistory.so use_authtok remember=5 enforce_for_root</span><br></pre></td></tr></table></figure></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;password-auth文件配置如下字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/password-auth</span></span><br><span class="line">password    required      pam_pwhistory.so use_authtok remember=5 enforce_for_root</span><br></pre></td></tr></table></figure></li></ul><p>pam_pwhistory.so配置项参数字段说明如下表：</p><table><thead><tr><th><strong>配置项</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>remember&#x3D;5</td><td>口令不能修改为过去5次使用过的旧口令</td></tr><tr><td>enforce_for_root</td><td>本设置对root账号同样有效</td></tr></tbody></table><h3 id="2-2-3-确保用户修改自身口令时需验证旧口令"><a href="#2-2-3-确保用户修改自身口令时需验证旧口令" class="headerlink" title="2.2.3 确保用户修改自身口令时需验证旧口令"></a>2.2.3 确保用户修改自身口令时需验证旧口令</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>为了防止第三方恶意修改其他账户口令，用户修改自身口令时需验证旧口令。</p><p>按照业界通用做法，root账号修改自身口令时不需要验证旧口令。root账号可以直接修改&#x2F;etc&#x2F;passwd和&#x2F;etc&#x2F;shadow文件，在修改自身口令时验证旧口令无实质的安全提升，所以遵循业界通常做法，root账号在修改口令时，无需验证旧口令。而普通账号需要验证通过旧口令后，才能进行新口令的设置，否则会引发安全风险，例如：普通账号的所有者在登录系统后未锁定屏幕，而直接离开座位，附近的攻击者可以在终端上修改该普通账号的口令。</p><p>该规则为pam_unix模块默认支持，无需额外配置。</p><p><strong>规则影响：</strong></p><p>普通用户如果忘记旧口令，则无法自行修改口令，降低易用性。</p><p><strong>检查方法：</strong></p><ul><li><p>root账号更改口令情况如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd</span></span><br><span class="line">Changing password <span class="keyword">for</span> user root.</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></li><li><p>普通账号（如test）更改口令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ passwd</span><br><span class="line">Changing password <span class="keyword">for</span> user <span class="built_in">test</span>.</span><br><span class="line">Changing password <span class="keyword">for</span> <span class="built_in">test</span>.</span><br><span class="line">Current password:</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>该规则为pam_unix模块默认支持，无需配置。</p><h3 id="2-2-4-确保口令中不包含账号字符串"><a href="#2-2-4-确保口令中不包含账号字符串" class="headerlink" title="2.2.4 确保口令中不包含账号字符串"></a>2.2.4 确保口令中不包含账号字符串</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>为了用户账号的安全，要求配置“口令中不包含账号字符串”功能。</p><p>口令跟账号名字符相同，或者是账号名字符逆序容易被攻击者猜测，而且口令中包含账号名字符，也增加了口令被破译的风险。账号名小于等于3个字符的情况下不作要求，但建议实际场景中设置长度合理的账号名。</p><p>账号名大于3个字符时，其口令不能是如下字符：</p><ul><li>账号名称</li><li>账号名称逆序</li><li>包含账号名称字符</li></ul><p><strong>规则影响：</strong></p><p>无法设置包含账号字符串的口令。</p><p><strong>检查方法：</strong></p><ul><li><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth分别提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep system-auth /etc/pam.d/ -r</span></span><br><span class="line">/etc/pam.d/login:auth       substack     system-auth</span><br><span class="line">/etc/pam.d/login:account    include      system-auth</span><br><span class="line">/etc/pam.d/login:password   include      system-auth</span><br><span class="line">/etc/pam.d/login:session    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:auth       include      system-auth</span><br><span class="line">/etc/pam.d/sudo:account    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:password   include      system-auth</span><br><span class="line">/etc/pam.d/sudo:session    include      system-auth-su</span><br></pre></td></tr></table></figure><p>以上只列举部分显示结果，从以上结果可知，login和sudo的账号认证采用&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中的配置。</p><p>后续以&#x2F;etc&#x2F;pam.d&#x2F;system-auth为例进行说明。</p></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“口令中不包含账号字符串”的配置情况，不应包含“usercheck&#x3D;0”字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_pwquality /etc/pam.d/system-auth</span></span><br><span class="line">password    requisite     pam_pwquality.so minlen=8 minclass=3 enforce_for_root try_first_pass local_users_only retry=3 dcredit=0 ucredit=0 lcredit=0 ocredit=0</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>pam_pwquality.so是一个执行口令质量检测的pam模块，默认支持“口令中不包含账号字符串”该功能。所以，配置文件中包含该模块，且未配置“usercheck&#x3D;0”，即可实现对应的功能；反之，则无法实现。</p><p>通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件实现。以&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件为例，如果配置中存在“usercheck&#x3D;0”字段，则删除，具体配置字段如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">password    requisite     pam_pwquality.so minlen=8 minclass=3 enforce_for_root try_first_pass local_users_only retry=3 dcredit=0 ucredit=0 lcredit=0 ocredit=0</span><br></pre></td></tr></table></figure><h3 id="2-2-5-确保口令使用强Hash算法加密"><a href="#2-2-5-确保口令使用强Hash算法加密" class="headerlink" title="2.2.5 确保口令使用强Hash算法加密"></a>2.2.5 确保口令使用强Hash算法加密</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>出于系统安全考虑，口令不允许明文存储在系统中，应该加密保护。在不需要还原口令的场景，必须使用不可逆算法加密。如果加密算法强度过低，攻击者可以通过加大算力，在口令被更新前，强行计算出相同hash结果的原始字符串，无论该字符串是否同原口令一致，均可用以登录对应账号。目前业界已知的MD5、sha1等弱算法，均可在有限算力情况下碰撞出相同密文的两段不同原文。对用户账号的口令使用强hash算法进行加密，能有效加大口令被碰撞破解的难度，从而降低口令泄漏的风险。可根据实际需求，进行口令加密算法配置，但是配置的算法强度不得低于sha512。</p><p>openEuler目前口令加密默认采用sha512算法，已满足安全要求。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth分别提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep system-auth /etc/pam.d/ -r</span></span><br><span class="line">/etc/pam.d/login:auth       substack     system-auth</span><br><span class="line">/etc/pam.d/login:account    include      system-auth</span><br><span class="line">/etc/pam.d/login:password   include      system-auth</span><br><span class="line">/etc/pam.d/login:session    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:auth       include      system-auth</span><br><span class="line">/etc/pam.d/sudo:account    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:password   include      system-auth</span><br><span class="line">/etc/pam.d/sudo:session    include      system-auth-su</span><br></pre></td></tr></table></figure><p>以上只列举部分显示结果，从以上结果可知，login和sudo的账号认证采用&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中的配置。</p><p>后续以&#x2F;etc&#x2F;pam.d&#x2F;system-auth为例进行说明。</p></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“口令使用强Hash算法加密”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep sha512 /etc/pam.d/system-auth</span></span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>“口令使用强Hash算法加密”的设置可以通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件实现。</p><p>以&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件为例，具体配置字段如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br></pre></td></tr></table></figure><h3 id="2-2-6-确保弱口令字典设置正确"><a href="#2-2-6-确保弱口令字典设置正确" class="headerlink" title="2.2.6 确保弱口令字典设置正确"></a>2.2.6 确保弱口令字典设置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>若用户口令是弱口令，就很容易被攻击者猜测到、或者在较短时间内通过字典攻击法进行破解。弱口令字典是一个包含强度不够、容易被猜测到的口令的集合。弱口令包括：系统默认的口令、过去曾被泄露的口令等。OS提供口令字典检查功能，在创建、修改口令的时候检查，如果命中则禁止使用该口令。弱口令字典可更新、可扩展。可根据实际业务场景，设定适合本业务的弱口令字典。</p><p>在升级场景中需要注意：历史版本是否启用了弱口令字典检查，或者新版本是否新增了弱口令清单。</p><p><strong>规则影响：</strong></p><p>原系统中可以使用的口令在新版本中可能被认定为弱口令，导致口令无法设置成功。</p><p><strong>检查方法：</strong></p><p>方法1：</p><ul><li><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth分别提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep system-auth /etc/pam.d/ -r</span></span><br><span class="line">/etc/pam.d/login:auth       substack     system-auth</span><br><span class="line">/etc/pam.d/login:account    include      system-auth</span><br><span class="line">/etc/pam.d/login:password   include      system-auth</span><br><span class="line">/etc/pam.d/login:session    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:auth       include      system-auth</span><br><span class="line">/etc/pam.d/sudo:account    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:password   include      system-auth</span><br><span class="line">/etc/pam.d/sudo:session    include      system-auth-su</span><br></pre></td></tr></table></figure><p>以上只列举部分显示结果，从以上结果可知，login和sudo的账号认证采用&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中的配置。</p><p>后续以&#x2F;etc&#x2F;pam.d&#x2F;system-auth为例进行说明。</p></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“设置弱口令字典”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_pwquality /etc/pam.d/system-auth</span></span><br><span class="line">password    requisite     pam_pwquality.so minlen=8 minclass=3 enforce_for_root try_first_pass local_users_only retry=3 dcredit=0 ucredit=0 lcredit=0 ocredit=0</span><br></pre></td></tr></table></figure><p>如果没有配置dictcheck&#x3D;0，则默认为开启，无需手动配置。</p></li><li><p>使用如下命令，导出字典库到文件dictionary.txt中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cracklib-unpacker /usr/share/cracklib/pw_dict &gt; dictionary.txt</span></span><br></pre></td></tr></table></figure></li></ul><p>方法2：</p><ul><li><p>在&#x2F;etc&#x2F;security&#x2F;pwquality.conf文件中检查“弱口令字典”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -rnR &quot;dictcheck&quot; /etc/security/pwquality.conf</span></span><br></pre></td></tr></table></figure><p>如果没有配置dictcheck&#x3D;0，则默认开启，无需手动配置。</p></li></ul><p><strong>修复方法：</strong></p><p>pam_pwquality.so是一个执行口令质量检测的pam模块，默认支持“设置弱口令字典”功能，使用如下操作可以更新弱口令字典库：</p><ul><li><p>使用如下命令，导出字典库到文件dictionary.txt中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cracklib-unpacker /usr/share/cracklib/pw_dict &gt; dictionary.txt</span></span><br></pre></td></tr></table></figure></li><li><p>将弱口令字典导出并修改后，可执行如下命令进行字典库更新：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create-cracklib-dict dictionary.txt</span></span><br></pre></td></tr></table></figure></li><li><p>可在原字典库基础上新增其他字典内容，如custom.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create-cracklib-dict dictionary.txt custom.txt</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-7-确保口令有效期设置正确"><a href="#2-2-7-确保口令有效期设置正确" class="headerlink" title="2.2.7 确保口令有效期设置正确"></a>2.2.7 确保口令有效期设置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>如果口令长期不修改，则通过暴力破解等方法，容易增加口令被破解的可能性，从而影响系统安全；但该值如果设置过小，则导致口令频繁修改，增加管理成本，且容易导致用户因长时间未登录而无法再次登录，所以在设置该值时需要根据实际业务场景进行判断。</p><p>口令需要设置有效期，口令过期后用户重新登录时，提示口令过期，并强制修改，否则无法进入系统。口令最大有效期应为90天或者更短；口令过期前7天或更长时间应开始提示用户修改口令；两次修改口令的最小间隔时间建议设置为7天，可根据业务场景调整。</p><p>由于root是最高权限账号，如果长期未登录，导致root口令过期，或者因为频繁修改导致遗忘，系统将无法登录，存在管理风险。建议根据实际业务场景决定是否设置root口令过期时间，对于需要频繁登录root账号的场景，建议设置较短的过期时间；对于日常管理使用非root账号的，建议设置相对较长的过期时间。</p><p>考虑到社区版本在不同场景下的易用性，openEuler发行版默认不配置口令有效期和两次修改口令的最小间隔时间，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>PASS_MAX_DAYS（口令有效期）：设置过长，会降低安全性，增加被暴力破解的概率，设置过短，会增加口令的管理复杂度；</p><p>PASS_WARN_AGE（口令过期前提醒）：设置过长，会过早提醒，降低用户体验，设置过短，会导致用户错过修改口令时间；</p><p>PASS_MIN_DAYS（两次修改口令的最小间隔时间）：设置过短，用户可以频繁更改口令以规避历史口令防重用检查机制；</p><p><strong>检查方法：</strong></p><ul><li><p>检查&#x2F;etc&#x2F;login.defs文件中是否已经配置相关字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^PASS_MAX_DAYS /etc/login.defs </span></span><br><span class="line">PASS_MAX_DAYS 90</span><br><span class="line"><span class="comment"># grep ^PASS_WARN_AGE /etc/login.defs </span></span><br><span class="line">PASS_WARN_AGE 7</span><br><span class="line"><span class="comment"># grep ^PASS_MIN_DAYS /etc/login.defs</span></span><br><span class="line">PASS_MIN_DAYS 0</span><br></pre></td></tr></table></figure></li><li><p>检查&#x2F;etc&#x2F;shadow文件中指定账号的配置是否正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^test: /etc/shadow </span></span><br><span class="line"><span class="built_in">test</span>:!:18599:0:90:7:35::  </span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>有两种设置方法：</p><ul><li><p>修改&#x2F;etc&#x2F;login.defs文件中的默认配置，对后续新建账号口令默认生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/login.defs</span></span><br><span class="line">PASS_MAX_DAYS 90</span><br><span class="line">PASS_MIN_DAYS 0</span><br><span class="line">PASS_WARN_AGE 7</span><br></pre></td></tr></table></figure></li><li><p>修改shadow文件中具体某个账号的口令有效期，新增的账号，口令的默认有效期同&#x2F;etc&#x2F;login.defs文件中定义一致，对应的值会写到shadow文件中，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># useradd test</span></span><br><span class="line"><span class="comment"># cat /etc/shadow | grep test</span></span><br><span class="line"><span class="built_in">test</span>:!:18599:0:90:7:35::</span><br></pre></td></tr></table></figure><p>shadow文件中每一行记录一个账号的口令信息，通过冒号“:”划分为9个字段，如上举例中：</p><ul><li>第4字段表示两次修改口令的最小间隔时间，默认为0，表示不作限制；</li><li>第5字段表示口令最大有效期（自设置之日起），默认90天，设置成99999表示永不过期；</li><li>第6字段表示口令过期前几天开始提醒，默认7天；</li><li>第7个字段表示口令修改有效期，过期后几天内允许用户修改。时间段内，用户登录时强制要求修改口令；超过这个时间，直接拒绝用户登录，默认值是35天。</li></ul><p>管理员可通过passwd命令进行修改。</p><p>设置两次口令修改最小间隔时间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -n 0 test</span></span><br><span class="line">Adjusting aging data <span class="keyword">for</span> user <span class="built_in">test</span>.</span><br><span class="line">passwd: Success</span><br></pre></td></tr></table></figure><p>设置口令最大有效期：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -x 90 test</span></span><br><span class="line">Adjusting aging data <span class="keyword">for</span> user <span class="built_in">test</span>.</span><br><span class="line">passwd: Success</span><br></pre></td></tr></table></figure><p>设置口令过期前提醒时间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -w 7 test</span></span><br><span class="line">Adjusting aging data <span class="keyword">for</span> user <span class="built_in">test</span>.</span><br><span class="line">passwd: Success</span><br></pre></td></tr></table></figure><p>设置口令修改有效期（无法通过&#x2F;etc&#x2F;login.defs设置默认值）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -i 35 test</span></span><br><span class="line">Adjusting aging data <span class="keyword">for</span> user <span class="built_in">test</span>.</span><br><span class="line">passwd: Success </span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-8-禁止空口令登录"><a href="#2-2-8-禁止空口令登录" class="headerlink" title="2.2.8 禁止空口令登录"></a>2.2.8 禁止空口令登录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>空口令登录是指在用户账号登录时，不输入口令的情况下也能成功登录系统。</p><p>若允许空口令登录，会增加空口令账号本身被攻击或被用来作为攻击账号的风险。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;ssh&#x2F;sshd_config中是否配置了禁止空口令登录的字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^PermitEmptyPasswords /etc/ssh/sshd_config | grep no</span></span><br><span class="line">PermitEmptyPasswords no</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;ssh&#x2F;sshd_config中配置禁止空口令登录，并重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="2-2-9-确保Grub已设置口令保护"><a href="#2-2-9-确保Grub已设置口令保护" class="headerlink" title="2.2.9 确保Grub已设置口令保护"></a>2.2.9 确保Grub已设置口令保护</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Grub是Linux的默认引导程序，通过引导程序可以设置系统的启动模式，而设置Grub口令可以防御攻击者通过修改Grub设置进入单用户模式。</p><p>如果没有设置Grub口令，攻击者可以轻易进入Grub编辑菜单，通过修改启动参数进行攻击行为，例如：进入单用户模式修改root口令，窃取数据。</p><p>UEFI和legacy是两种不同的引导方式，对应的Grub配置文件路径会存在差异。UEFI的配置路径为：&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler，legecy的配置路径为&#x2F;boot&#x2F;grub2。</p><p><strong>规则影响：</strong></p><p>需要验证Grub口令后才能进入Grub编辑菜单。</p><p><strong>检查方法：</strong></p><p>UEFI模式下：</p><p>方法1：</p><ul><li><p>查看grub.cfg配置文件是否存在password_pbkdf2相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep password_pbkdf2 /boot/efi/EFI/openEuler/grub.cfg</span></span><br><span class="line">password_pbkdf2 root <span class="variable">$&#123;GRUB2_PASSWORD&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>GRUB2_PASSWORD是定义在user.cfg文件中的口令密文，“xxxx”表示密文内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /boot/efi/EFI/openEuler/user.cfg</span></span><br><span class="line">GRUB2_PASSWORD=grub.pbkdf2.sha512.10000.xxxx</span><br></pre></td></tr></table></figure></li></ul><p>方法2：</p><ul><li><p>查看grub.cfg配置文件是否存在password_pbkdf2相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep grub.pbkdf2.sha512.10000 /boot/efi/EFI/openEuler/grub.cfg</span></span><br><span class="line">grub.pbkdf2.sha512.10000.xxxx</span><br></pre></td></tr></table></figure></li></ul><p>legecy模式下：</p><p>方法1：</p><ul><li><p>查看grub.cfg配置文件是否存在password_pbkdf2相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep password_pbkdf2 /boot/grub2/grub.cfg</span></span><br><span class="line">password_pbkdf2 root <span class="variable">$&#123;GRUB2_PASSWORD&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>GRUB2_PASSWORD是定义在user.cfg文件中的口令密文，“xxxx”表示密文内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /boot/grub2/user.cfg</span></span><br><span class="line">GRUB2_PASSWORD=grub.pbkdf2.sha512.10000.xxxx</span><br></pre></td></tr></table></figure></li></ul><p>方法2：</p><ul><li><p>查看grub.cfg配置文件是否存在password_pbkdf2相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep grub.pbkdf2.sha512.10000 /boot/grub2/grub.cfg</span></span><br><span class="line">grub.pbkdf2.sha512.10000.xxxx</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>openEuler在安装阶段通过人工方式在图形界面设置Grub2口令。</p></li><li><p>建议用户首次登录时修改口令并定期更新，避免口令泄露后，启动选项被篡改，导致系统启动异常。</p><p>在终端输入grub2-mkpasswd-pbkdf2后，根据提示输入明文口令后，生成sha512加密的口令密文，“xxxx”表示密文内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grub2-mkpasswd-pbkdf2</span></span><br><span class="line">Enter password: </span><br><span class="line">Reenter password: </span><br><span class="line">PBKDF2 <span class="built_in">hash</span> of your password is </span><br><span class="line">grub.pbkdf2.sha512.10000.xxxx</span><br></pre></td></tr></table></figure><p>UEFI模式下，将新口令密文输出到&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler&#x2F;user.cfg文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo &quot;GRUB2_PASSWORD=grub.pbkdf2.sha512.10000.xxxx&quot; &gt; /boot/efi/EFI/openEuler/user.cfg</span></span><br></pre></td></tr></table></figure><p>legecy模式下，将新口令密文输出到&#x2F;boot&#x2F;grub2&#x2F;user.cfg文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo &quot;GRUB2_PASSWORD=grub.pbkdf2.sha512.10000.xxxx&quot; &gt; /boot/grub2/user.cfg</span></span><br></pre></td></tr></table></figure></li><li><p>系统下次重启时，如果需要进入Grub2菜单，将需要验证新口令。</p></li></ul><h3 id="2-2-10-确保单用户模式已设置口令保护"><a href="#2-2-10-确保单用户模式已设置口令保护" class="headerlink" title="2.2.10 确保单用户模式已设置口令保护"></a>2.2.10 确保单用户模式已设置口令保护</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>编辑grub启动菜单，在linux启动命令行添加“s”或“single”命令，可以进入单用户模式，单用户模式属于紧急救援模式，可以对系统进行修改。例如修改root口令，所以要求在进入单用户模式时，验证root口令。</p><p>openEuler系统默认已经加固，进入单用户模式必须输入root口令。</p><p><strong>规则影响：</strong></p><p>如果管理员忘记root口令，将无法通过单用户模式进入系统修改。</p><p><strong>检查方法：</strong></p><p>通过grep命令检查rescue和emergency服务中是否使用systemd-sulogin-shell登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep /systemd-sulogin-shell /usr/lib/systemd/system/rescue.service</span></span><br><span class="line"><span class="comment"># grep /systemd-sulogin-shell /usr/lib/systemd/system/emergency.service</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rescue.service文件中，修改ExecStart项为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/lib/systemd/system/rescue.service</span></span><br><span class="line">ExecStart=-/usr/lib/systemd/systemd-sulogin-shell rescue</span><br></pre></td></tr></table></figure></li><li><p>在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;emergency.service文件中，修改ExecStart项为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/lib/systemd/system/emergency.service</span></span><br><span class="line">ExecStart=-/usr/lib/systemd/systemd-sulogin-shell emergency</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-11-确保账号在首次登录时强制修改口令"><a href="#2-2-11-确保账号在首次登录时强制修改口令" class="headerlink" title="2.2.11 确保账号在首次登录时强制修改口令"></a>2.2.11 确保账号在首次登录时强制修改口令</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>对于非用户本人设置的口令，如管理员重置的口令，如果在业务环境上没有被及时修改，极易引起低成本的攻击事件，所以要求用户在首次登录账号时强制修改口令。<br>root口令除外。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;shadow文件中指定账号的配置是否正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^test: /etc/shadow </span></span><br><span class="line"><span class="built_in">test</span>:!:0:0:90:7:35::</span><br></pre></td></tr></table></figure><p>此处，以冒号“:”分割的第3个字段，如果是0，表示此账号对应口令已被强制设置为过期。</p><p><strong>修复方法：</strong></p><p>管理员在重置账号口令后，通过如下命令可以将该口令立即过期，该账号下次登录时会被要求强制口令修改，此种方式过期的口令不受口令修改有效期（默认35天）的约束（test为举例的账号）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># passwd -e test</span></span><br></pre></td></tr></table></figure><h2 id="2-3-身份认证"><a href="#2-3-身份认证" class="headerlink" title="2.3 身份认证"></a>2.3 身份认证</h2><h3 id="2-3-1-确保登录失败一定次数后锁定账号"><a href="#2-3-1-确保登录失败一定次数后锁定账号" class="headerlink" title="2.3.1 确保登录失败一定次数后锁定账号"></a>2.3.1 确保登录失败一定次数后锁定账号</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>用户使用账号登录系统，如果连续登录失败一定次数后，系统会锁定该账号登录，即一定时间内不允许该账号继续登录，防止恶意的破解系统口令。账号锁定期间，任何输入被判定为无效，锁定时间不因用户的再次输入而重新计时；解锁后，错误输入记录被清空。通过上述设置可以有效防范口令暴力破解，增强系统的安全性。系统默认设定的连续登录失败次数为3次；登录失败后，默认锁定的时间为300s。</p><p>考虑到社区版本在不同场景下的易用性，openEuler发行版默认不提供该项安全功能，用户应根据实际应用场景和需求，对默认的失败次数和锁定时间进行配置。</p><p><strong>规则影响：</strong></p><p>失败次数数值设置过小和锁定时间的数值设置过大，会影响使用体验。</p><p><strong>检查方法：</strong></p><ul><li><p>&#x2F;etc&#x2F;pam.d&#x2F;system-auth和&#x2F;etc&#x2F;pam.d&#x2F;password-auth分别提供该功能项的配置，不同应用程序或者服务对应的配置项，需根据各自include的配置文件而定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep system-auth /etc/pam.d/ -r</span></span><br><span class="line">/etc/pam.d/login:auth       substack     system-auth</span><br><span class="line">/etc/pam.d/login:account    include      system-auth</span><br><span class="line">/etc/pam.d/login:password   include      system-auth</span><br><span class="line">/etc/pam.d/login:session    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:auth       include      system-auth</span><br><span class="line">/etc/pam.d/sudo:account    include      system-auth</span><br><span class="line">/etc/pam.d/sudo:password   include      system-auth</span><br><span class="line">/etc/pam.d/sudo:session    include      system-auth-su</span><br></pre></td></tr></table></figure><p>以上只列举部分显示结果，从以上结果可知，login和sudo的账号认证采用&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中的配置。</p><p>后续以&#x2F;etc&#x2F;pam.d&#x2F;system-auth为例进行说明。</p></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“连续失败登录次数”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep deny /etc/pam.d/system-auth</span></span><br><span class="line">auth  required  pam_faillock.so preauth audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  [default=die] pam_faillock.so authfail audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  sufficient  pam_faillock.so authsucc audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth      required   pam_deny.so</span><br><span class="line">password  required   pam_deny.so</span><br></pre></td></tr></table></figure></li><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中检查“锁定时间”的配置情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep unlock_time /etc/pam.d/system-auth</span></span><br><span class="line">auth  required  pam_faillock.so preauth audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  [default=die] pam_faillock.so authfail audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  sufficient  pam_faillock.so authsucc audit deny=3 even_deny_root unlock_time=300</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>可以通过修改&#x2F;etc&#x2F;pam.d&#x2F;password-auth和&#x2F;etc&#x2F;pam.d&#x2F;system-auth中所有“deny&#x3D;”和“unlock_time&#x3D;”字段后的数，来分别完成对“连续失败登录次数”和“锁定时间”的配置。以&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件为例，具体配置字段如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">auth  required  pam_faillock.so preauth audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  [default=die] pam_faillock.so authfail audit deny=3 even_deny_root unlock_time=300</span><br><span class="line">auth  sufficient  pam_faillock.so authsucc audit deny=3 even_deny_root unlock_time=300</span><br></pre></td></tr></table></figure><h3 id="2-3-2-确保会话超时时间设置正确"><a href="#2-3-2-确保会话超时时间设置正确" class="headerlink" title="2.3.2 确保会话超时时间设置正确"></a>2.3.2 确保会话超时时间设置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>设置合理的会话超时时间可以降低因管理员人为原因而导致系统被攻击者攻击的风险。</p><p>考虑到社区版本在不同场景下的易用性，openEuler发行版默认不配置会话超时时间，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>会话超时时间设置过长，甚至永不超时，当管理员离开时没有退出登录，其他人员就可以直接在终端上以管理员权限进行操作。<br>如果设置过短，则频繁锁定，增加管理员输入口令次数，降低用户体验的同时，也容易引入安全风险，管理员周边人员有较多的机会可以窥探到输入的口令。</p><p><strong>检查方法：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^export TMOUT&quot; /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> TMOUT=300</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>修改&#x2F;etc&#x2F;profile文件TMOUT字段，根据业务场景修改为合理的值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> TMOUT=&lt;seconds&gt;</span><br></pre></td></tr></table></figure></li><li><p>使用source命令使之生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source /etc/profile    </span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-3-3-确保Warning-Banners包含合理的信息"><a href="#2-3-3-确保Warning-Banners包含合理的信息" class="headerlink" title="2.3.3 确保Warning Banners包含合理的信息"></a>2.3.3 确保Warning Banners包含合理的信息</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Warning Banners包含有系统登录界面添加的警告信息，为所有登录系统的用户标识出本系统的安全警告，安全警告可以根据业务场景包括系统所属的组织，登录行为所受到的监视或者记录，非授权登录或者入侵会受到的法律制裁等内容。不合适的安全警告信息，可能增加系统被攻击的风险，或触犯当地法律法规。</p><p>Warning Banners不应将系统版本、应用服务器类型、功能等暴露给用户，避免攻击者获取到系统信息，实施攻击。除此之外，还需要正确配置文件所有权，否则未经授权的用户可能会使用不正确或误导性信息来修改文件。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>通过cat命令，查看&#x2F;etc&#x2F;motd、&#x2F;etc&#x2F;issue、&#x2F;etc&#x2F;issue.net三个文件中警告信息是否合理，是否存在系统版本、应用服务器类型、功能等信息；</p></li><li><p>通过ll命令查看&#x2F;etc&#x2F;motd、&#x2F;etc&#x2F;issue、&#x2F;etc&#x2F;issue.net三个文件权限是否为644；</p></li></ul><p><strong>修复方法：</strong></p><ul><li><p>通过vim命令，修改&#x2F;etc&#x2F;motd、&#x2F;etc&#x2F;issue、&#x2F;etc&#x2F;issue.net三个文件中的告警信息；</p></li><li><p>通过chmod命令修改&#x2F;etc&#x2F;motd、&#x2F;etc&#x2F;issue、&#x2F;etc&#x2F;issue.net三个文件的权限为644；</p></li></ul><h3 id="2-3-4-应当正确配置Banner路径"><a href="#2-3-4-应当正确配置Banner路径" class="headerlink" title="2.3.4 应当正确配置Banner路径"></a>2.3.4 应当正确配置Banner路径</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Banner路径指向一个文件，文件中包含有用户登录SSH前在客户端给出的提示信息，用户可根据实际业务场景配置该文件中的内容。</p><p>如果不配置，则默认没有显示。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^Banner&quot; /etc/ssh/sshd_config</span></span><br><span class="line">Banner /etc/issue.net</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置Banner字段指向的文件，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">Banner /etc/issue.net</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure></li><li><p>修改Banner指向文件中的内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/issue.net</span></span><br><span class="line">Authorized <span class="built_in">users</span> only. All activities may be monitored and reported.</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-4-访问控制"><a href="#2-4-访问控制" class="headerlink" title="2.4 访问控制"></a>2.4 访问控制</h2><h3 id="2-4-1-限制历史命令记录数量"><a href="#2-4-1-限制历史命令记录数量" class="headerlink" title="2.4.1 限制历史命令记录数量"></a>2.4.1 限制历史命令记录数量</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>HISTSIZE是一个环境变量，用于控制命令历史记录的大小。具体来说，HISTSIZE定义了命令历史记录中可以存储的命令条目数量。通过设置HISTSIZE的值，可以限制或增加命令历史记录的大小，从而控制在命令行终端中可用的以前输入的命令数量。</p><p>例如，设置HISTSIZE&#x3D;100将限制命令历史记录最多存储100条命令。一旦命令历史记录达到这个限制，新的命令将会覆盖最旧的命令，以保持历史记录的大小不超过指定的值。</p><p>作用：较小的历史记录可以减少敏感信息（如密码）在历史记录中被保留的风险。</p><p>建议系统限制查看历史命令的数量，建议50或100</p><p><strong>规则影响：</strong></p><p>限制的值设置过小，会导致历史使用的命令不可见，易用性下降。</p><p><strong>检查方法：</strong></p><ol><li>查看环境变量 HISTSIZE 设置的值：</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo $HISTSIZE</span></span><br><span class="line">100</span><br></pre></td></tr></table></figure><ol start="2"><li>查看 profile 文件 HISTSIZE 设置的值：</li></ol>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -iP &quot;^HISTSIZE&quot; /etc/profile</span></span><br><span class="line">HISTSIZE=100</span><br></pre></td></tr></table></figure><p>如果检测1中输出为1-100范围，且检测2中”HISTSIZE&#x3D;”等于号之后输出的值为1-100的范围，说明通过检查，否则检测未通过。</p><p><strong>修复方法：</strong></p><p>查看profile文件中环境变量HISTSIZE的值，运行以下命令设置历史命令记录数量为1-100范围内的值并生效即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -qiP &quot;^HISTSIZE&quot; /etc/profile &amp;&amp; sed -i &quot;/^HISTSIZE/cHISTSIZE=100&quot; /etc/profile || echo -e &quot;HISTSIZE=100&quot; &gt;&gt; /etc/profile</span></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure><h3 id="2-4-2-应当启用enforce模式"><a href="#2-4-2-应当启用enforce模式" class="headerlink" title="2.4.2 应当启用enforce模式"></a>2.4.2 应当启用enforce模式</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SELinux是Linux发行版中内置的安全模块，通过细粒度的访问控制机制，实现应用程序对资源的访问控制，从而提高系统的安全性。SELinux的运行模式有三种：</p><ul><li><p>enforcing（强制模式）：当访问无权限时，阻止资源访问，并记录audit日志；</p></li><li><p>permissive（宽容模式）：当访问无权限时，仅记录audit日志，不阻止资源访问；</p></li><li><p>disable（禁用模式）：关闭SELinux功能；</p></li></ul><p>SELinux只有工作在enforcing模式时才能有效启用并保护系统，若工作在其它模式，则无法对系统提供保护，而系统中的进程会默认有较大的权限（尤其是以root身份运行的进程），可能会给系统带来安全风险。</p><p><strong>规则影响：</strong></p><p>系统开启enforce模式会拒绝部分高风险操作（依赖于策略配置），易用性降低。</p><p><strong>检查方法：</strong></p><p>输入命令查看当前系统SELinux运行模式是否为enforcing：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># getenforce</span></span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure><p>使用如下命令查看系统默认SELinux运行模式是否为enforcing：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^SELINUX=&quot; /etc/selinux/config</span></span><br><span class="line">SELINUX=enforcing</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用setenforce命令设置当前系统SELinux的运行模式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setenforce 1</span></span><br><span class="line"><span class="comment"># getenforce</span></span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure><p>设置&#x2F;etc&#x2F;selinux&#x2F;config文件中的SELINUX参数，重启操作系统后生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELINUX=enforcing</span><br></pre></td></tr></table></figure><h3 id="2-4-3-应当正确配置SELinux策略"><a href="#2-4-3-应当正确配置SELinux策略" class="headerlink" title="2.4.3 应当正确配置SELinux策略"></a>2.4.3 应当正确配置SELinux策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SELinux的策略分为两种，系统基础策略和自定义策略：</p><p>基础策略：定义在基础策略包中的策略，包括selinux-policy、selinux-policy-targeted、selinux-policy-mls等。</p><p>自定义策略：用户修改或添加的策略。</p><p>SELinux可以实现进程级别的强制访问控制，通过根据最小权限原则配置合理的策略，限制系统中关键应用和关键资源的行为，可以提高系统的安全性。</p><p>如果未对应用程序配置合理的策略，可能产生两种影响：</p><ul><li><p>如果未对应用程序配置策略，应用程序有可能运行在unconfined_t或其他权限较大的域，若被攻击可能对系统或业务造成较大影响；</p></li><li><p>如果为应用程序配置了不合理的策略，有可能影响应用程序的正常运行。</p></li></ul><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>运行以下命令查看当前系统策略，建议配置为targeted：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sestatus | grep &#x27;Loaded policy name&#x27;</span></span><br><span class="line">Loaded policy name:             targeted</span><br></pre></td></tr></table></figure><p>运行以下命令，输出为空，表示无异常规则和异常访问行为，若不为空，需要分析被禁止的访问行为是否为正常访问行为，如果为正常访问行为，则需要修改策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep avc /var/log/audit/audit.log*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>设置基础策略包为targeted策略包：</p><ul><li><p>安装目标基础策略包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install selinux-policy-targeted</span></span><br></pre></td></tr></table></figure></li><li><p>设置&#x2F;etc&#x2F;selinux&#x2F;config文件中的SELINUXTYPE参数以修改系统基础策略包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SELINUXTYPE=targeted</span></span><br></pre></td></tr></table></figure></li><li><p>在根目录下创建.autorelabel文件，用于系统重启后刷新文件标签：</p></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># touch /.autorelabel</span></span><br></pre></td></tr></table></figure><ul><li>重启操作系统。</li></ul><p>若应用程序运行异常，需要为应用程序配置合理的SELinux策略。</p><h3 id="2-4-4-确保su受限使用"><a href="#2-4-4-确保su受限使用" class="headerlink" title="2.4.4 确保su受限使用"></a>2.4.4 确保su受限使用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>su命令可以使一个普通用户拥有超级用户或其他用户的权限，它经常被用于从普通用户账号切换到系统root账号。su命令为用户变更身份提供了便捷的途径，但如果不加约束的使用su命令，会给系统带来潜在的风险。通过对用户使用su访问root账号的权限进行限制，仅对部分账号进行su使用授权，可以提高系统账号使用的安全性。</p><p>openEuler默认仅允许wheel组中的普通用户具有su的使用权限。</p><p><strong>规则影响：</strong></p><p>非wheel组用户无法使用su</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;pam.d&#x2F;su中是否配置了非wheel组用户账号禁止使用su：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep pam_wheel.so /etc/pam.d/su | grep required</span></span><br><span class="line">auth required pam_wheel.so use_uid</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;pam.d&#x2F;su配置文件，配置非wheel组用户账号禁止使用su：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/su</span></span><br><span class="line">auth required pam_wheel.so use_uid</span><br></pre></td></tr></table></figure><h3 id="2-4-5-确保普通用户通过sudo运行特权程序"><a href="#2-4-5-确保普通用户通过sudo运行特权程序" class="headerlink" title="2.4.5 确保普通用户通过sudo运行特权程序"></a>2.4.5 确保普通用户通过sudo运行特权程序</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>sudo可以使设定的普通用户以root权限执行某些特定的程序。大部分系统管理命令都需要使用root权限执行，对于系统管理员来说，适当地对其他用户授权可以减轻系统管理员负担，但直接授予普通用户root口令会带来安全风险，使用sudo则可以规避这一问题。系统中需要以root账号运行的特权程序，可以使用sudo机制避免使用root账号登录。 </p><p>使用sudo代替root用户运行特权程序不仅可以减轻系统管理员负担，同时由于使用sudo时无需输入root口令，这提高了安全性。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;sudoers中是否配置了普通用户执行sudo：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;(root)&quot; /etc/sudoers</span></span><br><span class="line">test_sudo  ALL=(root)  /bin/ping</span><br></pre></td></tr></table></figure><p>说明：示例中“&#x2F;bin&#x2F;ping”为可以使用sudo执行的程序。实际上，具体的程序由用户根据业务场景进行配置。</p><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;sudoers配置文件，对需要以root执行指定特权的用户配置权限。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sudoers</span></span><br><span class="line">test_sudo  ALL=(root)  /bin/ping</span><br></pre></td></tr></table></figure><p>上一行配置一共包含四个字段，如上举例中：</p><p>第一个字段test_sudo为用户账号，实际配置时还可以指定为某一用户组，这样该用户组内的所有用户账号均可按后边的规则执行sudo；</p><p>第二个字段ALL意思是在任何主机名下都适用；</p><p>第三个字段root表明第一个字段所设定的用户账号或用户组可以切换到root下执行特权程序；</p><p>第四个字段中&#x2F;bin&#x2F;ping即为指定的特权程序，多个特权程序用逗号隔开。</p><h3 id="2-4-6-确保sudoers不能配置低权限用户可写的脚本"><a href="#2-4-6-确保sudoers不能配置低权限用户可写的脚本" class="headerlink" title="2.4.6 确保sudoers不能配置低权限用户可写的脚本"></a>2.4.6 确保sudoers不能配置低权限用户可写的脚本</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>sudo可以使设定的普通用户以root权限执行某些特定的程序，与之对应的配置文件为&#x2F;etc&#x2F;sudoers。管理员用户可以配置相应的规则使某些脚本或二进制文件以root的权限运行，所以sudo配置的脚本应该只有root可写，不能配置低权限用户可写的脚本，若配置了低权限用户可写的脚本则该用户可以通过修改该脚本实现提权操作。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查sudo配置文件&#x2F;etc&#x2F;sudoers，检查特权程序是否为低权限用户可写。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;(root)&quot; /etc/sudoers</span></span><br><span class="line">test_sudo  ALL=(root)  /bin/xxx.sh</span><br><span class="line"><span class="comment"># ll /bin/xxx.sh</span></span><br><span class="line">-rw-------. 1 root root 451 Mar 27 17:00 /bin/xxx.sh</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>例如一个&#x2F;etc&#x2F;sudoers配置文件中的脚本为低权限用户可写，则用户需要根据实际的业务场景进行修复：</p><ul><li><p>修复方法1</p><p>修改&#x2F;etc&#x2F;sudoers配置文件中的脚本的文件权限，去除掉低特权用户的可写权限以防止该用户实现提权操作。</p></li><li><p>修复方法2</p><p>修改&#x2F;etc&#x2F;sudoers配置文件删除低权限用户可配置的脚本文件，防止低权限用户实现提权操作</p></li></ul><h3 id="2-4-7-确保普通用户不能借助pkexec配置提权root"><a href="#2-4-7-确保普通用户不能借助pkexec配置提权root" class="headerlink" title="2.4.7 确保普通用户不能借助pkexec配置提权root"></a>2.4.7 确保普通用户不能借助pkexec配置提权root</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>pkexec命令可以使一个普通用户拥有超级用户或其他用户的权限，当验证通过后便会以超级用户的权限来执行相应的程序。pkexec为用户变更身份提供了便捷的路径，但是如果不加约束的使用pkexec命令，会给系统带来潜在的安全风险。通过对用户使用pkexec访问root账号的权限进行限制，限制了其他账号的使用。可以提高系统账号使用的安全性。</p><p>openEuler默认配置使用pkexec需要验证root口令，且仅有root可获得系统管理员权限。</p><p><strong>规则影响：</strong></p><p>普通用户不能使用pkexec。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;polkit-1&#x2F;rules.d&#x2F;50-default.rules中是否配置了仅root用户可以使用pkexec：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/polkit-1/rules.d/50-default.rules</span></span><br><span class="line">/* -*- mode: js; js-indent-level: 4; indent-tabs-mode: nil -*- */</span><br><span class="line"></span><br><span class="line">// DO NOT EDIT THIS FILE, it will be overwritten on update</span><br><span class="line">//</span><br><span class="line">// Default rules <span class="keyword">for</span> polkit</span><br><span class="line">//</span><br><span class="line">// See the polkit(8) man page <span class="keyword">for</span> more information</span><br><span class="line">// about configuring polkit.</span><br><span class="line"></span><br><span class="line">polkit.addAdminRule(<span class="keyword">function</span>(action, subject) &#123;</span><br><span class="line">    <span class="built_in">return</span> [<span class="string">&quot;unix-user:0&quot;</span>];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;polkit-1&#x2F;rules.d&#x2F;50-default.rules配置文件，仅root用户可以使用pkexec：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/polkit-1/rules.d/50-default.rules</span></span><br><span class="line">polkit.addAdminRule(<span class="keyword">function</span>(action, subject) &#123;</span><br><span class="line">    <span class="built_in">return</span> [<span class="string">&quot;unix-user:0&quot;</span>];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="2-4-8-确保su命令继承用户环境变量不会引入提权"><a href="#2-4-8-确保su命令继承用户环境变量不会引入提权" class="headerlink" title="2.4.8 确保su命令继承用户环境变量不会引入提权"></a>2.4.8 确保su命令继承用户环境变量不会引入提权</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>su命令可以使一个普通用户拥有超级用户或其他用户的权限，它经常被用于从普通用户账号切换到系统root账号。su命令为用户变更身份提供了便捷的途径，但如果不加约束的使用su命令，会给系统带来潜在的风险，su命令切换用户时不会自动为用户设置PATH。如果通过su切换用户后系统会自动初始化环境变量PATH，则可以有效防范由于继承环境变量PATH而导致的提权问题。</p><p>openEuler默认设置su完成后，PATH会自动初始化。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;login.defs中是否配置了自动初始化环境变量PATH，即ALWAYS_SET_PATH&#x3D;yes：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/login.defs | grep ALWAYS_SET_PATH=yes</span></span><br><span class="line">ALWAYS_SET_PATH=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;login.defs配置文件添加如下配置，使切换用户后系统会自动初始化环境变量PATH：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/login.defs</span></span><br><span class="line">ALWAYS_SET_PATH=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><h3 id="2-4-9-避免root用户本地接入系统"><a href="#2-4-9-避免root用户本地接入系统" class="headerlink" title="2.4.9 避免root用户本地接入系统"></a>2.4.9 避免root用户本地接入系统</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>root是Linux系统中的超级特权用户，具有所有Linux系统资源的访问权限。如果允许直接使用root账号登录Linux系统对系统进行操作，会带来很多潜在的安全风险，为了规避由此带来的风险，应禁止直接使用root帐号登录操作系统，仅在必要的情况通过其他技术手段（如：sudo或su）间接的使用root账号。</p><p>由于root账号拥有最高权限，直接使用root登录存在如下风险：</p><ul><li><p>高危误操作可能直接导致服务器瘫痪，例如误删除、修改系统关键文件；</p></li><li><p>如果有多人需要root权限操作，则root口令将有多人保管，容易导致口令泄露，同时增加了口令维护成本。</p></li></ul><p>openEuler默认不进行配置，如果实际场景中不存在需要使用root账号在本地登录的情况，建议禁用root账号本地登录。</p><p><strong>规则影响：</strong></p><p>root账号无法本地接入系统。</p><p><strong>检查方法：</strong></p><ul><li><p>检查&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中是否添加了account类型的pam_access.so模块，且该模块必须在sufficient控制行之前加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/pam.d/system-auth</span></span><br><span class="line">account     required      pam_unix.so</span><br><span class="line">account     required      pam_faillock.so</span><br><span class="line">account     sufficient    pam_localuser.so</span><br><span class="line">account     sufficient    pam_succeed_if.so uid &lt; 1000 quiet</span><br></pre></td></tr></table></figure></li><li><p>并且，检查&#x2F;etc&#x2F;security&#x2F;access.conf文件中是否设置对root用户登录tty1的限制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^\-:root&quot; /etc/security/access.conf</span></span><br></pre></td></tr></table></figure></li><li><p>使用串口尝试登录root账号，确认是否拒绝登录。如果拒绝登录，串口打印信息如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Authorized <span class="built_in">users</span> only. All activities may be monitored and reported.</span><br><span class="line">localhost login: root</span><br><span class="line">Password:</span><br><span class="line"></span><br><span class="line">Permission denied </span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>在&#x2F;etc&#x2F;pam.d&#x2F;system-auth文件中添加了account类型的pam_access.so模块，且该模块必须在sufficient控制行之前加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/system-auth</span></span><br><span class="line">…</span><br><span class="line">account     required      pam_unix.so</span><br><span class="line">account     required      pam_faillock.so</span><br><span class="line">account     required      pam_access.so</span><br><span class="line">account     sufficient     pam_localuser.so</span><br><span class="line">…</span><br></pre></td></tr></table></figure></li><li><p>在&#x2F;etc&#x2F;security&#x2F;access.conf文件中添加对root用户登录tty1的限制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/security/access.conf</span></span><br><span class="line">-:root:tty1</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-4-10-避免使用标签为unconfined-service-t的程序"><a href="#2-4-10-避免使用标签为unconfined-service-t的程序" class="headerlink" title="2.4.10 避免使用标签为unconfined_service_t的程序"></a>2.4.10 避免使用标签为unconfined_service_t的程序</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SELinux设置unconfined_service_t标签的目的是使一些未配置SELinux策略的第三方服务进程不受约束地运行。默认情况下，systemd运行标签为bin_t或usr_t（一般位于&#x2F;usr&#x2F;bin、&#x2F;opt等目录下）的第三方应用程序时，产生的进程标签为unconfined_service_t。</p><p>与其他高权限标签（如unconfined_t、initrc_t等）的区别是，unconfined_service_t只有极少的域转换规则，这意味着即使进程运行那些已经配置过SELinux策略的应用程序，新进程的标签也依然为unconfined_service_t，进程配置的SELinux策略也不会生效，如果被攻击会对系统造成较大的影响。</p><p><strong>规则影响：</strong></p><p>标签为unconfined_service_t的程序运行受限制</p><p><strong>检查方法：</strong></p><p>运行以下命令，若返回值为空，表示当前系统中没有标签为unconfined_service_t的进程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -eZ | grep unconfined_service_t</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>为应用程序配置合理的SELinux策略，并添加域转换规则，使其被执行时转换到配置策略的进程标签。</p><h2 id="2-5-完整性"><a href="#2-5-完整性" class="headerlink" title="2.5 完整性"></a>2.5 完整性</h2><h3 id="2-5-1-应当启用IMA度量"><a href="#2-5-1-应当启用IMA度量" class="headerlink" title="2.5.1 应当启用IMA度量"></a>2.5.1 应当启用IMA度量</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>IMA（Integrity Measurement Architecture）完整性度量架构是内核提供的完整性保护功能，开启IMA时，可基于用户自定义的策略为系统中的重要文件提供完整性度量，度量结果可被用于本地以及远程完整性证明。</p><p>系统未开启IMA度量功能时，无法实时记录关键文件的摘要信息，不能识别对文件内容或属性的篡改。本地证明、远程证明等保护系统完整性的功能依赖于IMA度量提供的摘要值，因此也无法使用，或者完整性保护不全。</p><p>IMA全局策略配置与具体环境相关，通常情况下完整性保护只针对于不可变文件（如可执行文件、动态库等），如果策略配置不当，可能导致性能及内存开销过大，建议用户根据自身情况决定是否开启IMA，并配置正确的策略。</p><p>注意：由于IMA只是全局完整性保护机制中的度量部分，要完整使用需依赖TPM 2.0及远程证明服务，本规范仅对IMA度量部分进行说明、建议。如果系统未集成TPM 2.0及远程证明服务，则不应启用IMA度量功能。</p><p>IMA度量不支持容器环境和虚拟机环境，且要求UEFI启动，不支持Legacy模式。</p><p><strong>规则影响：</strong></p><ul><li>开启IMA度量会导致系统启动时间和文件访问时间有轻微增加。</li><li>如果策略配置不当（如对实时变化的日志文件、临时文件等进行度量），可导致度量日志增长过快、占用系统内存过大，且度量日志所占用内存在系统下次重启前不会被释放，进而影响业务正常运行。另外由于被度量文件一直在变化，引发度量值变化，而远程证明基线值无法同步更新，导致远程证明失败，失去完整性保护的意义。</li></ul><p><strong>检查方法：</strong></p><ul><li><p>首先确认当前内核启动参数中是否配置了integrity&#x3D;1，如果查不到该参数，则说明IMA没有开启：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline | grep integrity=1</span></span><br><span class="line">BOOT_IMAGE=/vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M quiet  integrity=1</span><br></pre></td></tr></table></figure></li><li><p>确认IMA开启后，查看&#x2F;sys&#x2F;kernel&#x2F;security&#x2F;ima&#x2F;runtime_measurement_count文件中存储的度量记录数，如果该值大于1，则表示已配置IMA度量策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /sys/kernel/security/ima/runtime_measurements_count</span></span><br><span class="line">2053</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>在&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler&#x2F;grub.cfg文件中配置启动参数“integrity&#x3D;1 ima_appraise&#x3D;off evm&#x3D;ignore”（其中后两个参数可不配置），并重启系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/efi/EFI/openEuler/grub.cfg</span></span><br><span class="line">        linuxefi   /vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M integrity=1 ima_appraise=off evm=ignore</span><br></pre></td></tr></table></figure></li><li><p>配置度量策略，一共有两种方式：</p><p>在&#x2F;etc&#x2F;ima目录下添加策略文件ima-policy，该方式比较灵活，可以在ima-policy文件中自定义各自策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ima/ima-policy</span></span><br><span class="line">&lt;ima policy lines&gt;</span><br></pre></td></tr></table></figure><p>在启动参数中配置ima_policy&#x3D;&lt;tcb&#x2F;exec_tcb&gt;，该方式使用系统默认的几种策略（默认策略度量文件范围大，请谨慎使用），并重启系统：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/efi/EFI/openEuler/grub.cfg</span></span><br><span class="line">        linuxefi   /vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M integrity=1 ima_policy=tcb</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-5-2-应当启用aide入侵检测"><a href="#2-5-2-应当启用aide入侵检测" class="headerlink" title="2.5.2 应当启用aide入侵检测"></a>2.5.2 应当启用aide入侵检测</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>aide（advanced intrusion detection environment）是一款入侵检测工具，可以用来检查系统中文件和目录的完整性，识别遭到恶意篡改的文件或目录。其完整性检查的原理是先构造一个基准数据库，该数据库包含文件或目录的一些属性如权限、所属用户等，在进行完整性检查时将当前系统的状态与基准数据库进行对比得出检查结果，最后报告当前系统的文件或目录变更情况，即检查报告。</p><p>启用aide入侵检测能有效识别恶意篡改文件或目录的行为，从而提升系统完整性安全。需要检查的文件或目录可以按需配置，灵活性高，用户只需要查询检查报告即可以判断是否存在恶意篡改行为。</p><p><strong>规则影响：</strong></p><p>需检查的文件越多，检查过程所需时间越长。如果用户启用aide，应根据自身业务场景，合理配置检查策略。</p><p><strong>检查方法：</strong></p><ul><li><p>检查是否安装了aide软件包（如果返回-bash: aide: command not found，表示未安装）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aide --version</span></span><br><span class="line">Aide 0.16</span><br></pre></td></tr></table></figure></li><li><p>检查&#x2F;etc&#x2F;aide.conf文件中是否已经配置需要监控的文件或目录，举例仅表示默认配置监控目录中的&#x2F;boot目录，用户若自行配置了需要监控的文件或目录，则确认相应的文件或目录已配置即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep boot /etc/aide.conf | grep NORMAL</span></span><br><span class="line">/boot  NORMAL</span><br></pre></td></tr></table></figure></li><li><p>检查是否存在基准数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls /var/lib/aide/aide.db.gz</span></span><br><span class="line">/var/lib/aide/aide.db.gz</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>如果未安装aide，则使用yum或dnf命令安装软件包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install aide</span><br><span class="line">或</span><br><span class="line">dnf install aide</span><br></pre></td></tr></table></figure></li><li><p>在配置文件&#x2F;etc&#x2F;aide.conf中配置需要被监控的文件或目录。&#x2F;etc&#x2F;aide.conf中默认已经配置了部分需要监控的目录，包括&#x2F;boot, &#x2F;bin, &#x2F;lib, &#x2F;lib64等重要目录。用户可以根据需要，自行添加需要监控的文件或目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/aide.conf</span></span><br><span class="line">/boot   NORMAL</span><br><span class="line">/bin    NORMAL</span><br><span class="line">/lib    NORMAL</span><br><span class="line">/lib64  NORMAL</span><br><span class="line">&lt;add new folders&gt;</span><br></pre></td></tr></table></figure></li><li><p>生成基准数据库，执行初始化命令后，在&#x2F;var&#x2F;lib&#x2F;aide目录下生成aide.db.new.gz，将其重命名aide.db.gz，即为基准数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aide --init</span></span><br><span class="line"><span class="comment"># mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span></span><br></pre></td></tr></table></figure></li><li><p>入侵检查，执行aide –check; 检查的结果会在屏幕打印，同时会保存到&#x2F;var&#x2F;log&#x2F;aide&#x2F;aide.log日志文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aide --check</span></span><br></pre></td></tr></table></figure></li><li><p>更新基准数据库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aide --update</span></span><br><span class="line"><span class="comment"># mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="2-6-数据安全"><a href="#2-6-数据安全" class="headerlink" title="2.6 数据安全"></a>2.6 数据安全</h2><h3 id="2-6-1-应当启用haveged服务"><a href="#2-6-1-应当启用haveged服务" class="headerlink" title="2.6.1 应当启用haveged服务"></a>2.6.1 应当启用haveged服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>haveged服务提供了一个易用的、不可预测的随机数生成器，生成的随机数用于补充系统熵池，可解决某些情况下系统熵过低的问题。建议在有加解密或生成密钥需求的场景下（例如使用openssl和gnutls）都开启此服务。</p><p>如果haveged服务没有开启，需要生成强伪随机数的进程从&#x2F;dev&#x2F;random取值时，会因为取不到足够的值而陷入等待，直至取到新的随机字节后才返回。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查环境中haveged服务是否处于正常运行状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-active haveged</span></span><br><span class="line">active</span><br></pre></td></tr></table></figure><p>如果显示处于active状态，说明haveged服务正在运行，反之如果显示处于inactive状态，说明服务未开启。</p><p><strong>修复方法：</strong></p><p>开启haveged服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start haveged</span></span><br></pre></td></tr></table></figure><p>如果要将其设置为随系统启动，可以这样配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable haveged.service</span></span><br></pre></td></tr></table></figure><h3 id="2-6-2-应当设置全局加解密策略配置不低于DEFAULT"><a href="#2-6-2-应当设置全局加解密策略配置不低于DEFAULT" class="headerlink" title="2.6.2 应当设置全局加解密策略配置不低于DEFAULT"></a>2.6.2 应当设置全局加解密策略配置不低于DEFAULT</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>系统全局加解密策略用于指定加解密组件允许的算法，通过修改&#x2F;etc&#x2F;crypto-policies&#x2F;config配置文件可以改变预置的安全策略级别，从而改变应用程序可使用的算法集。</p><p>openEuler系统默认配置DEFAULT策略，提供LEGACY、DEFAULT、NEXT、FUTURE、FIPS可供选择，建议用户设置不低于DEFAULT的策略级别，即禁止设置LEGACY模式。</p><p>LEGACY：LEGACY策略可确保与旧系统的最大兼容性，但是该策略的安全性较低。该策略提供的安全级别至少为64位。<br>DEFAULT：DEFAULT策略是符合当前标准的默认策略。该策略提供的安全级别至少为80位。<br>NEXT：NEXT策略是为即将发布的操作系统准备的策略。该策略提供的安全级别至少为112位（注：DNSSec所需的SHA-1签名和其他仍普遍使用的SHA-1签名除外）。<br>FUTURE：FUTURE策略为安全级别较高的策略，可以抵御近期大多数的攻击方式。该策略提供的安全级别至少为128位。<br>FIPS：FIPS策略是符合FIPS 140-2要求的策略。该策略提供的安全级别至少为112位。</p><p><strong>规则影响：</strong></p><p>如果全局加解密策略设置过于宽松，将允许使用不安全加解密算法，降低系统整体安全性。</p><p>如果全局加解密策略设置过于严格，则可能由于客户端不支持更加安全的加解密算法，而导致存在兼容性问题。</p><p>如果业务程序未使用系统加解密模块，而是自行调用第三方加解密算法库进行操作，则不受影响。</p><p><strong>检查方法：</strong></p><p>检查环境中&#x2F;etc&#x2F;crypto-policies&#x2F;config文件是否未配置LEGACY模式，如果返回信息为空，或者仅返回位于注释信息中的LEGACY字段，表示未配置LEGACY：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/crypto-policies/config | grep &quot;LEGACY&quot;</span></span><br></pre></td></tr></table></figure><p>亦可通过如下方式检查当前配置的模式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/crypto-policies/config | grep -v &quot;^#&quot;</span></span><br><span class="line">DEFAULT</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;crypto-policies&#x2F;config文件中配置合适的策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/crypto-policies/config</span></span><br><span class="line">DEFAULT</span><br></pre></td></tr></table></figure><h2 id="3-运行和服务"><a href="#3-运行和服务" class="headerlink" title="3 运行和服务"></a>3 运行和服务</h2><h2 id="3-1-网络"><a href="#3-1-网络" class="headerlink" title="3.1 网络"></a>3.1 网络</h2><h3 id="3-1-1-避免使用不常见网络服务"><a href="#3-1-1-避免使用不常见网络服务" class="headerlink" title="3.1.1 避免使用不常见网络服务"></a>3.1.1 避免使用不常见网络服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>一些不常见的协议，往往使用场景较少，社区发展较慢，安全问题不易被快速解决，如果未关闭这些并不使用的协议，可能导致攻击者利用协议或代码漏洞进行攻击。</p><p>流控制传输协议（SCTP，Stream Control Transmission Protocol）是一种在网络连接两端之间同时传输多个数据流的协议，SCTP提供的服务与UDP和TCP类似。</p><p>透明进程间通信（TIPC，Transparent Inter-process Communication）是一种用于进程间通信的网络通信协议，原本是为集群间通信特别设计的。它允许设计人员能够创建可以和其它应用快速可靠通信的应用，无须考虑其它需要通信的应用在集群环境中的位置。</p><p>如果业务场景不需要使用SCTP和TIPC等服务，要求从内核中关闭支持，减小攻击场景。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>使用modprobe命令检查sctp，如果输出“install &#x2F;bin&#x2F;true”，表示sctp已经被禁止使用；如果输出“insmod &#x2F;lib&#x2F;modules&#x2F;(kernel version)&#x2F;kernel&#x2F;net&#x2F;sctp&#x2F;sctp.ko”，表示未被禁止，并列出ko所在目录；如果输出“modprobe: FATAL: Module sctp not found in directory &#x2F;lib&#x2F;modules&#x2F;(kernel version)”，表示不存在该ko文件，可不用处理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe -n -v sctp</span></span><br><span class="line">install /bin/true </span><br></pre></td></tr></table></figure></li><li><p>使用modprobe命令检查tipc，如果输出“install &#x2F;bin&#x2F;true”，表示tipc已经被禁止使用；如果输出“insmod &#x2F;lib&#x2F;modules&#x2F;(kernel version)&#x2F;kernel&#x2F;net&#x2F;tipc&#x2F;tipc.ko”，表示未被禁止，并列出ko所在目录，根据平台不同，即使已经禁用tipc，命令执行后也可能会列出tipc的依赖ko，如udp_tunnel.ko和ip6_udp_tunnel.ko，可不用处理；如果输出“modprobe: FATAL: Module tipc not found in directory &#x2F;lib&#x2F;modules&#x2F;(kernel version)”，表示不存在该ko文件，可不用处理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe -n -v tipc</span></span><br><span class="line">insmod /lib/modules/(kernel version)/kernel/net/ipv4/udp_tunnel.ko </span><br><span class="line">insmod /lib/modules/(kernel version)/kernel/net/ipv6/ip6_udp_tunnel.ko</span><br><span class="line">install /bin/true</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;modprobe.d&#x2F;目录下，添加一个任意文件名，并以.conf为后缀的配置文件，属主和属组均为root, 权限600，按照如下格式填入内容，即可禁用sctp和tipc协议：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/modprobe.d/test.conf</span></span><br><span class="line">install sctp /bin/true</span><br><span class="line">install tipc /bin/true</span><br></pre></td></tr></table></figure><h3 id="3-1-2-避免使用无线网络"><a href="#3-1-2-避免使用无线网络" class="headerlink" title="3.1.2 避免使用无线网络"></a>3.1.2 避免使用无线网络</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>如果硬件设备包含WIFI等无线模块，且系统启用了WIFI，则服务器存在通过无线连接网络的可能，如果是不受控的连接，则一方面可能导致网络不稳定，另一方面增加了攻击面。</p><p>当不存在使用无线网络的场景，建议用户根据实际情况关闭无线网络功能。</p><p><strong>规则影响：</strong></p><p>依赖于无线网络的程序运行受限制</p><p><strong>检查方法：</strong></p><p>通过nmcli命令查看无线网络配置，如果WIFI和WWAN为enabled，表示已启用无线网络，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmcli radio all</span></span><br><span class="line">WIFI-HW  WIFI     WWAN-HW  WWAN    </span><br><span class="line">enabled  enabled  enabled  enabled</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过nmcli命令可永久关闭WIFI和WWAN，即使系统重启也依旧保持关闭状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmcli radio all off</span></span><br><span class="line"><span class="comment"># nmcli radio all</span></span><br><span class="line">WIFI-HW  WIFI     WWAN-HW  WWAN    </span><br><span class="line">enabled  disabled  enabled  disabled</span><br></pre></td></tr></table></figure><h2 id="3-2-防火墙"><a href="#3-2-防火墙" class="headerlink" title="3.2 防火墙"></a>3.2 防火墙</h2><h3 id="3-2-1-应当启用firewalld服务"><a href="#3-2-1-应当启用firewalld服务" class="headerlink" title="3.2.1 应当启用firewalld服务"></a>3.2.1 应当启用firewalld服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>防火墙作为一种网络或系统之间强制实行访问控制的机制，是确保网络安全的重要手段。针对不同的需求和应用环境，可以量身定制出不同的防火墙系统。如果系统中没有配置防火墙服务，可能会导致系统被外部攻击、内部数据被窃取或篡改，大量无效流量浪费带宽、访问一些存在安全风险或业务无关的网站导致信息泄露。</p><p>对于连接到网络上的Linux系统来说，防火墙是必不可少的防御机制，它只允许合法的网络流量进出系统，而禁止其它任何网络流量，例如只限定允许的IP地址访问其SSH服务。因而，可以定制防火墙配置来满足任何特定需求和任何安全性需求。</p><p>openEuler提供firewalld、iptables、nftables三种常用的防火墙服务配置界面，其中firewalld底层实际调用iptables或nftables机制。</p><p>openEuler默认且建议启用firewalld服务，并关闭iptables、nftables服务。</p><p>三种防火墙服务建议只启用一种，不建议同时启用多种，如果多种防火墙规则设置不正确，可能导致规则冲突、防护混乱。</p><p><strong>规则影响：</strong></p><p>防火墙配置错误可能起不到防护作用，还有可能会导致正常的业务无法通信。</p><p><strong>检查方法：</strong></p><p>通过如下命令检查firewalld服务已经启用，并且iptables和nftables服务未被启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service firewalld status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: active (running) since Wed 2021-02-03  00:14:10 CST; 14h ago</span><br><span class="line"><span class="comment"># service iptables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br><span class="line"><span class="comment"># service nftables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用如下方法启用firewalld服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service firewalld start</span></span><br><span class="line"><span class="comment"># systemctl enable firewalld</span></span><br></pre></td></tr></table></figure><p>使用如下方法关闭iptables和nftables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables stop</span></span><br><span class="line"><span class="comment"># service nftables stop</span></span><br><span class="line"><span class="comment"># systemctl disable iptables</span></span><br><span class="line"><span class="comment"># systemctl disable nftables</span></span><br></pre></td></tr></table></figure><h3 id="3-2-2-应当配置正确的默认区域"><a href="#3-2-2-应当配置正确的默认区域" class="headerlink" title="3.2.2 应当配置正确的默认区域"></a>3.2.2 应当配置正确的默认区域</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>Firewalld服务通过区域（zone）概念，允许将防火墙划分为几个独立的规则区域，不同的接口或源地址可以绑定到不同的区域，实现不同的控制逻辑。一个区域可以配置许多不同的网络接口或源，但反过来，一个接口或源只能绑定到一个区域中，避免报文进出时无法确定执行哪个区域的规则。</p><p>如果一个区域在处理接口或源的报文时，发现并没有显式的规则匹配，此时该区域可以决定如何处理该报文，比如接收、拒绝，或者直接交由默认区域处理。</p><p>可以根据实际业务场景，配置合适的默认区域，所有未被显式划分到指定区域的接口、源地址、连接等网络资源，都应该被分配到默认区域。</p><p>如果默认区域配置不合理，则可能对未绑定到其他区域的网络资源产生非预期的影响。</p><p>如果所有网络资源都已经显式的绑定到其他区域，且已经制定详尽的规则，默认区域未配置任何规则，则默认区域将不影响业务。但这不是推荐的做法。</p><p>openEuler firewalld服务共提供11种区域类型：Server、Workstation、block、dmz、drop、external、home、internal、public、trusted、work。默认配置为public。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用firewall-cmd命令查询默认区域配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --get-default-zone</span></span><br><span class="line">public</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用firewall-cmd命令配置默认区域：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --set-default-zone=&lt;name of zone&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-3-应当确保网络接口绑定正确区域"><a href="#3-2-3-应当确保网络接口绑定正确区域" class="headerlink" title="3.2.3 应当确保网络接口绑定正确区域"></a>3.2.3 应当确保网络接口绑定正确区域</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>不同的防火墙区域可以制定不同的过滤策略，如果服务器网络比较复杂，有多个接口，且不同接口承担不同的业务功能，建议将接口配置到不同的区域，并制定不同的防火墙策略，比如外网业务接口不允许SSH访问，而内网管理接口可以开放SSH访问。如果所有接口都配置到一个区域中，防火墙策略不利于对不同接口进行不同配置，增加管理复杂度，降低防火墙安全防护的过滤效率，因配置问题，可能导致不该接收的报文未被拒绝或丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查各个区域配置的接口情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --get-active-zones</span></span><br><span class="line">public</span><br><span class="line">  interfaces: eth0</span><br><span class="line">work</span><br><span class="line">  interfaces: eth1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用firewall-cmd命令从指定区域移除接口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --zone=work --remove-interface eth1</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure><p>使用firewall-cmd命令往指定区域增加接口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --zone=work --add-interface eth1</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure><p>使用firewall-cmd命令将当前防火墙配置固化到配置文件中，使之永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --runtime-to-permanent</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure><h3 id="3-2-4-避免开启不必要的服务和端口"><a href="#3-2-4-避免开启不必要的服务和端口" class="headerlink" title="3.2.4 避免开启不必要的服务和端口"></a>3.2.4 避免开启不必要的服务和端口</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>在区域中需要精确配置哪些接口、服务、端口等是要开启的，哪些是必须关闭的。正确配置后可以防止不被允许的报文被接收处理，减少服务器暴露的端口，减小攻击面。</p><p>如果配置不正确，原本应该被禁止的接口或端口被开放出去，攻击者就可以利用这些接口或端口实施攻击行为，增加服务器和其他网元的风险。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下脚本查看所有active状态的区域，检查区域中接口、服务、端口等配置是否合理（此处public、work两个区域只是举例，配置的接口、服务、端口等需要根据实际部署情况确定）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for zone in $(firewall-cmd --get-active-zones | grep -v &quot;^[[:space:]]&quot;); do firewall-cmd --list-all --zone=$zone; done</span></span><br><span class="line">public (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth1</span><br><span class="line">  sources: </span><br><span class="line">  services: ssh mdns dhcpv6-client</span><br><span class="line">  ports: </span><br><span class="line">  protocols: </span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br><span class="line"></span><br><span class="line">work (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth2</span><br><span class="line">  sources: </span><br><span class="line">  services: ssh mdns dhcpv6-client samba</span><br><span class="line">  ports: 80/tcp</span><br><span class="line">  protocols: </span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用如下命令，删除指定区域中对应的服务、端口等：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --zone=work --remove-service samba</span></span><br><span class="line">success</span><br><span class="line"><span class="comment"># firewall-cmd --zone=work --remove-port 80/tcp</span></span><br><span class="line">success</span><br><span class="line"><span class="comment"># firewall-cmd --list-all --zone=work</span></span><br><span class="line">work (active)</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth1</span><br><span class="line">  sources: </span><br><span class="line">  services: ssh mdns dhcpv6-client</span><br><span class="line">  ports: </span><br><span class="line">  protocols: </span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports: </span><br><span class="line">  source-ports: </span><br><span class="line">  icmp-blocks: </span><br><span class="line">  rich rules: </span><br></pre></td></tr></table></figure><p>使用firewall-cmd命令将当前防火墙配置固化到配置文件中，使之永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --runtime-to-permanent</span></span><br><span class="line">success</span><br></pre></td></tr></table></figure><h3 id="3-2-5-应当启用iptables服务"><a href="#3-2-5-应当启用iptables服务" class="headerlink" title="3.2.5 应当启用iptables服务"></a>3.2.5 应当启用iptables服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>Iptables是Linux操作系统提供的一套基于IPv4和IPv6过滤规则链的防火墙管理工具，同时提供防火墙服务。</p><p>Iptables服务区分IPv4和IPv6，所以需要分别配置策略和启闭服务。</p><p>openEuler默认且建议使用firewalld服务。如果必须使用iptables提供防火墙服务，则必须关闭firewalld和nftables服务。如果未启用任何防火墙服务，则将提高系统被攻击、篡改的可能。</p><p>三种防火墙服务建议只启用一种，不建议同时启用多种，如果多种防火墙规则设置不正确，可能导致规则冲突、防护混乱。</p><p><strong>规则影响：</strong></p><p>如果启用多个防火墙服务，可能导致因为策略配置不一致而造成业务中断。</p><p><strong>检查方法：</strong></p><p>通过如下方式检查iptables服务已经被启用，firewalld和nftables服务未被启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: active (exited) since Wed 2021-02-03 00:14:10 CST; 14h ago</span><br><span class="line"><span class="comment"># service firewalld status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br><span class="line"><span class="comment"># service nftables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br></pre></td></tr></table></figure><p>检查ip6tables服务是否已经启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: active (exited) since Wed 2021-02-03 00:14:10 CST; 14h ago</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用如下方法启用iptables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables start</span></span><br><span class="line"><span class="comment"># systemctl enable iptables</span></span><br></pre></td></tr></table></figure><p>使用如下方法启用ip6tables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables start</span></span><br><span class="line"><span class="comment"># systemctl enable ip6tables</span></span><br></pre></td></tr></table></figure><p>使用如下方法关闭firewalld和nftables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service firewalld stop</span></span><br><span class="line"><span class="comment"># service nftables stop</span></span><br><span class="line"><span class="comment"># systemctl disable firewalld</span></span><br><span class="line"><span class="comment"># systemctl disable nftables</span></span><br></pre></td></tr></table></figure><h3 id="3-2-6-应当正确配置iptables默认拒绝策略"><a href="#3-2-6-应当正确配置iptables默认拒绝策略" class="headerlink" title="3.2.6 应当正确配置iptables默认拒绝策略"></a>3.2.6 应当正确配置iptables默认拒绝策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>通常情况下，iptables策略配置可以分为白名单方式和黑名单方式两种，建议通过白名单方式配置，只要不符合白名单中规则的链接，全部禁止。所以可以先配置对INPUT、OUTPUT、FORWARD链的DROP或REJECT策略，然后针对需要开放的端口和服务配置ACCEPT策略。</p><p><strong>规则影响：</strong></p><p>通过黑名单方式配置策略，由于未被配置为DROP或REJECT的链接都将被ACCEPT，容易因为遗漏而导致安全风险。</p><p><strong>检查方法：</strong></p><p>使用如下命令检查IPv4的INPUT、OUTPUT、FORWARD链默认是否为拒绝策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -L | grep -E &quot;INPUT|OUTPUT|FORWARD&quot;</span></span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">Chain OUTPUT (policy DROP)</span><br></pre></td></tr></table></figure><p>使用如下命令检查IPv6的INPUT、OUTPUT、FORWARD链默认是否为拒绝策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -L | grep -E &quot;INPUT|OUTPUT|FORWARD&quot;</span></span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">Chain OUTPUT (policy DROP)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用如下命令配置INPUT、OUTPUT、FORWARD链的默认策略为拒绝。需要注意的是，如果通过网络连接进行远程配置操作，那么策略被修改后网络就会断开，需要通过串口进行连接配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -j DROP</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -j DROP</span></span><br><span class="line"><span class="comment"># iptables -A FORWARD -j DROP</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]</span><br></pre></td></tr></table></figure><p>配置IPv6默认策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -A INPUT -j DROP</span></span><br><span class="line"><span class="comment"># ip6tables -A OUTPUT -j DROP</span></span><br><span class="line"><span class="comment"># ip6tables -A FORWARD -j DROP</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables save</span></span><br><span class="line">ip6tables: Saving firewall rules to /etc/sysconfig/ip6tables: [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="3-2-7-应当正确配置iptables-loopback策略"><a href="#3-2-7-应当正确配置iptables-loopback策略" class="headerlink" title="3.2.7 应当正确配置iptables loopback策略"></a>3.2.7 应当正确配置iptables loopback策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>回环地址是服务器上一个特殊的地址，以127.0.0.0&#x2F;8表示，同网卡无关，主要用于本机进程间通信，不应该从网卡上收到源地址为127.0.0.0&#x2F;8的报文，此类报文应该被丢弃。如果回环地址策略设置不正确，则可能导致本机进程间通信失败，或者从网卡收到欺骗报文。</p><p>服务器需要设置策略，允许接收和处理lo接口的回环地址报文，但拒绝从网卡收到的报文。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>查看IPv4的INPUT、OUTPUT链是否已经正确配置回环地址策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -L INPUT -v -n</span></span><br><span class="line">Chain INPUT (policy DROP 389 packets, 125K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"> 1089 81354 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22</span><br><span class="line">   10   840 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 DROP       all  --  *      *       127.0.0.0/8          0.0.0.0/0</span><br><span class="line"><span class="comment"># iptables -L OUTPUT -v -n</span></span><br><span class="line">Chain OUTPUT (policy DROP 58 packets, 11780 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">  871 94717 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22</span><br><span class="line">   17  1428 ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0</span><br></pre></td></tr></table></figure><p>查看IPv6的INPUT、OUTPUT链是否已经正确配置回环地址策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -L INPUT -v -n</span></span><br><span class="line">Chain INPUT (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     all      lo     *       ::/0                 ::/0</span><br><span class="line">    0     0 DROP       all      *      *       ::1                  ::/0</span><br><span class="line"><span class="comment"># ip6tables -L OUTPUT -v -n</span></span><br><span class="line">Chain OUTPUT (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     all      *      lo      ::/0                 ::/0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令设置允许接收和处理lo接口报文，拒绝源地址为127.0.0.0&#x2F;8的报文。iptables是按照顺序进行规则匹配的，所以DROP规则必须被添加在另外两条规则之后，否则由于lo接口发出的报文源地址也是127.0.0.0&#x2F;8，会被DROP规则丢弃：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -i lo -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -o lo -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -s 127.0.0.0/8 -j DROP</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]</span><br></pre></td></tr></table></figure><p>配置IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -A INPUT -i lo -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A OUTPUT -o lo -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A INPUT -s ::1 -j DROP</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables save</span></span><br><span class="line">ip6tables: Saving firewall rules to /etc/sysconfig/ip6tables: [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="3-2-8-应当正确配置iptables-INPUT策略"><a href="#3-2-8-应当正确配置iptables-INPUT策略" class="headerlink" title="3.2.8 应当正确配置iptables INPUT策略"></a>3.2.8 应当正确配置iptables INPUT策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>INPUT链的作用是对从外部接收的报文进行过滤，任何对外提供的服务，都需要配置对应的INPUT策略，开启相关的端口，外部客户端才能通过该端口访问该服务。</p><p>如果未配置，由于默认策略配置为DROP，所有外部尝试访问相关业务的报文都将被丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查INPUT链配置的策略是否满足业务需要，如下例子中开启了目标端口为22的tcp报文通道（即SSH协议的默认端口），且不限制源、目标IP地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -L INPUT -v -n</span></span><br><span class="line">Chain INPUT (policy DROP 2132 packets, 683K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"> 1207 90226 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22</span><br></pre></td></tr></table></figure><p>检查IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -L INPUT -v -n</span></span><br><span class="line">Chain INPUT (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     all      lo     *       ::/0                 ::/0</span><br><span class="line">    0     0 DROP       all      *      *       ::1                  ::/0</span><br><span class="line">    0     0 ACCEPT     tcp      *      *       ::/0                 ::/0                 tcp dpt:22</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令新增ACCEPT策略到INPUT链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -p &lt;protocol&gt; -s &lt;source ip&gt; -d &lt;dest ip&gt; --dport &lt;dest port&gt; -j ACCEPT</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]</span><br></pre></td></tr></table></figure><p>配置IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -A INPUT -p &lt;protocol&gt; -s &lt;source ip&gt; -d &lt;dest ip&gt; --dport &lt;dest port&gt; -j ACCEPT</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># ip6tables -A INPUT -p tcp --dport 22 -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables save</span></span><br><span class="line">ip6tables: Saving firewall rules to /etc/sysconfig/ip6tables: [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="3-2-9-应当正确配置iptables-OUTPUT策略"><a href="#3-2-9-应当正确配置iptables-OUTPUT策略" class="headerlink" title="3.2.9 应当正确配置iptables OUTPUT策略"></a>3.2.9 应当正确配置iptables OUTPUT策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>服务器外发报文主要有两种情况，一种是主机进程主动连接外部服务器，比如http访问，或者外发数据到日志服务器等，另一种是外部访问本机服务，本机进行回复的报文。</p><p>如果未配置OUTPUT策略，由于默认策略是DROP，服务器所有外发报文都将被丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查OUTPUT链配置的策略是否满足业务需要，如下例子中开启了源端口为22的tcp报文通道（即SSH协议的默认端口），且不限制源、目标IP地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -L OUTPUT -v -n</span></span><br><span class="line">Chain OUTPUT (policy DROP 30 packets, 9840 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"> 1383  156K ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22</span><br></pre></td></tr></table></figure><p>检查IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -L OUTPUT -v -n</span></span><br><span class="line">Chain OUTPUT (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     all      *      lo      ::/0                 ::/0</span><br><span class="line">    0     0 ACCEPT     tcp      *      *       ::/0                 ::/0                 tcp spt:22</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令新增ACCEPT策略到OUTPUT链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A OUTPUT -p &lt;protocol&gt; -s &lt;source ip&gt; -d &lt;dest ip&gt; --sport &lt;src port&gt; -j ACCEPT</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]</span><br></pre></td></tr></table></figure><p>配置IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -A OUTPUT -p &lt;protocol&gt; -s &lt;source ip&gt; -d &lt;dest ip&gt; --sport &lt;src port&gt; -j ACCEPT</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># ip6tables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables save</span></span><br><span class="line">ip6tables: Saving firewall rules to /etc/sysconfig/ip6tables: [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="3-2-10-应当正确配置iptables-INPUT、OUTPUT关联策略"><a href="#3-2-10-应当正确配置iptables-INPUT、OUTPUT关联策略" class="headerlink" title="3.2.10 应当正确配置iptables INPUT、OUTPUT关联策略"></a>3.2.10 应当正确配置iptables INPUT、OUTPUT关联策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>虽然可以通过配置协议、ip和端口等，将进出服务器的报文策略配置到INPUT和OUTPUT链，但有些情况下会比较复杂，比如客户端通过某端口访问服务器，但服务器在返回响应报文时并不一定从原端口返回，可能使用随机的源端口，这种情况下通过sport参数很难配置准确的策略。</p><p>此时需要考虑使用关联链接的方式配置策略，如果一个外发的报文属于一个已经存在的网络链接，则直接放行；如果一个接收的报文，属于一个已经存在的网络链接，也直接放行。因为这些已经存在的链接必定是经过其他策略过滤和检查的，否则无法建立。</p><p>如果不通过关联链接的方式配置策略，则需要将所有可能的链接情况全部分析清楚并配置对应的策略，如果配置过松，可能导致安全风险，如果配置过严，可能导致业务中断。</p><p><strong>规则影响</strong>：</p><p>无</p><p><strong>检查方法：</strong></p><p>检查INPUT和OUTPUT链是否配置了关联策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -L</span></span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             state ESTABLISHED</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             state ESTABLISHED</span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere             state ESTABLISHED</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy DROP)</span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             state NEW,ESTABLISHED</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             state NEW,ESTABLISHED</span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere             state NEW,ESTABLISHED</span><br></pre></td></tr></table></figure><p>检查IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -L</span></span><br><span class="line">Chain INPUT (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">ACCEPT     all      anywhere             anywhere</span><br><span class="line">DROP       all      localhost            anywhere</span><br><span class="line">ACCEPT     tcp      anywhere             anywhere             tcp dpt:ssh</span><br><span class="line">ACCEPT     tcp      anywhere             anywhere             state ESTABLISHED</span><br><span class="line">ACCEPT     udp      anywhere             anywhere             state ESTABLISHED</span><br><span class="line">ACCEPT     icmp     anywhere             anywhere             state ESTABLISHED</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">ACCEPT     all      anywhere             anywhere</span><br><span class="line">ACCEPT     tcp      anywhere             anywhere             tcp spt:ssh</span><br><span class="line">ACCEPT     tcp      anywhere             anywhere             state NEW,ESTABLISHED</span><br><span class="line">ACCEPT     udp      anywhere             anywhere             state NEW,ESTABLISHED</span><br><span class="line">ACCEPT     icmp     anywhere             anywhere             state NEW,ESTABLISHED</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令配置OUTPUT链的tcp、udp和icmp策略，允许所有新建和已建立链接的报文外发；配置INPUT链的tcp、udp和icmp策略，允许所有已建立链接的报文接收：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A OUTPUT -p tcp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p udp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A OUTPUT -p icmp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p udp -m state --state ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p icmp -m state --state ESTABLISHED -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service iptables save</span></span><br><span class="line">iptables: Saving firewall rules to /etc/sysconfig/iptables: [  OK  ]</span><br></pre></td></tr></table></figure><p>配置IPv6：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip6tables -A OUTPUT -p tcp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A OUTPUT -p udp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A OUTPUT -p icmp -m state --state NEW,ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A INPUT -p udp -m state --state ESTABLISHED -j ACCEPT</span></span><br><span class="line"><span class="comment"># ip6tables -A INPUT -p icmp -m state --state ESTABLISHED -j ACCEPT</span></span><br></pre></td></tr></table></figure><p>通过如下命令使当前配置的策略永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ip6tables save</span></span><br><span class="line">ip6tables: Saving firewall rules to /etc/sysconfig/ip6tables: [  OK  ]</span><br></pre></td></tr></table></figure><h3 id="3-2-11-应当启用nftables服务"><a href="#3-2-11-应当启用nftables服务" class="headerlink" title="3.2.11 应当启用nftables服务"></a>3.2.11 应当启用nftables服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>nftables是Linux内核的子系统，提供对网络数据包的过滤和分类，nftables替换了Netfilter的iptables部分。与iptables相比，nftable更容易扩展到新协议，nftables将在未来替代iptables。另外，nftables不同于firewalld和iptables，操作系统默认未配置任何策略，需要管理员手工配置。</p><p>需要注意的是，openEuler默认且建议使用firewalld服务。如果必须使用nftables提供防火墙服务，则必须关闭firewalld和iptables服务。如果未启用任何防火墙服务，则将提高系统被攻击、篡改的可能。</p><p>三种防火墙服务建议只启用一种，不建议同时启用多种，如果多种防火墙规则设置不正确，可能导致规则冲突、防护混乱。</p><p><strong>规则影响：</strong></p><p>如果启用多个防火墙服务，可能导致因为策略配置不一致而造成业务中断。</p><p><strong>检查方法：</strong></p><p>通过如下方式检查nftables服务已经被启用，firewalld和iptables服务未被启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nftables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: active (exited) since Wed 2020-12-16 07:04:32 CST; 6s ago</span><br><span class="line"><span class="comment"># service firewalld status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br><span class="line"><span class="comment"># service iptables status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">Active: inactive (dead)</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使用如下方法启用nftables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service nftables start</span></span><br><span class="line"><span class="comment"># systemctl enable nftables</span></span><br></pre></td></tr></table></figure><p>使用如下方法关闭firewalld和iptables服务，并配置永久生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service firewalld stop</span></span><br><span class="line"><span class="comment"># service iptables stop</span></span><br><span class="line"><span class="comment"># systemctl disable firewalld</span></span><br><span class="line"><span class="comment"># systemctl disable iptables</span></span><br></pre></td></tr></table></figure><h3 id="3-2-12-应当配置nftables默认拒绝策略"><a href="#3-2-12-应当配置nftables默认拒绝策略" class="headerlink" title="3.2.12 应当配置nftables默认拒绝策略"></a>3.2.12 应当配置nftables默认拒绝策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>从安全角度考虑，nftables基础链类似于iptables，（input、output、forward）需要配置所有报文的拒绝策略，然后再在基础链中添加允许策略，开放相关服务和端口。</p><p>如果没有配置基础链，或没有指定基础链的hook规则，报文将不会被nftables捕捉到，也就无法进行过滤处理。</p><p><strong>规则影响：</strong></p><p>如果基础链未配置DROP或REJECT策略，报文默认都将被ACCEPT，容易因为遗漏拒绝策略而导致安全风险。</p><p><strong>检查方法：</strong></p><p>通过如下方法检查是否配置了input、output和forward的DROP策略，注意举例中同时已经配置了SSH的input和output ACCEPT策略，如果不配置，通过SSH远程登录将断开：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain input &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook input priority 0; policy drop;</span><br><span class="line">tcp dport ssh accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain output &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook output priority 0; policy drop;</span><br><span class="line">tcp sport ssh accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain forward &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook forward priority 0; policy drop;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>首先创建table：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add table inet &lt;table name&gt;</span></span><br></pre></td></tr></table></figure><p>然后通过如下方法在table中配置input、output、forward基础链的drop策略，注意，配置后网络将可能断开：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add chain inet &lt;table name&gt; &lt;chain name&gt; &#123; type filter hook input priority 0\; policy drop\; &#125;</span></span><br><span class="line"><span class="comment"># nft add chain inet &lt;table name&gt; &lt;chain name&gt; &#123; type filter hook output priority 0\; policy drop\; &#125;</span></span><br><span class="line"><span class="comment"># nft add chain inet &lt;table name&gt; &lt;chain name&gt; &#123; type filter hook forward priority 0\; policy drop\; &#125;</span></span><br></pre></td></tr></table></figure><p>通过如下方式将当前配置的规则保存到配置文件中，以便系统重启后能够自动加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><p>注意，上述方式保存配置文件会覆盖原有配置内容，亦可将当前规则导出到单独文件中，或者直接在文件中编写新规则，然后在&#x2F;etc&#x2F;sysconfig&#x2F;nftables.conf配置文件中通过include方式加载，此种方式需要注意避免多个include规则文件内有重复规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/nftables/new_test_rules.nft</span></span><br><span class="line"><span class="comment"># echo &quot;include \&quot;/etc/nftables/new_test_rules.nft\&quot;&quot; &gt;&gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><h3 id="3-2-13-应当配置nftables-loopback策略"><a href="#3-2-13-应当配置nftables-loopback策略" class="headerlink" title="3.2.13 应当配置nftables loopback策略"></a>3.2.13 应当配置nftables loopback策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>回环地址是服务器上一个特殊的地址，以127.0.0.0&#x2F;8表示，同网卡无关，主要用于本机进程间通信，不应该从网卡上收到源地址为127.0.0.0&#x2F;8的报文，此类报文应该被丢弃。如果回环地址策略设置不正确，则可能导致本机进程间通信失败，或者从网卡收到欺骗报文。</p><p>服务器需要设置策略，允许接收和处理lo接口的回环地址报文，但拒绝从网卡收到的报文。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>查看是否已经配置回环地址策略，input链需要配置从“lo”设备接收报文的ACCEPT策略，配置从非“lo”设备接收，且源地址为127.0.0.0&#x2F;8的报文的DROP策略，在output链需要配置源地址为127.0.0.0&#x2F;8的报文的ACCEPT策略：</p><p>IPv4配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain input &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook input priority 0; policy drop;</span><br><span class="line">tcp dport ssh accept</span><br><span class="line">iif <span class="string">&quot;lo&quot;</span> accept</span><br><span class="line">iif != <span class="string">&quot;lo&quot;</span> ip saddr 127.0.0.0/8 drop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain output &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook output priority 0; policy drop;</span><br><span class="line">tcp sport ssh accept</span><br><span class="line">ip saddr 127.0.0.0/8 accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain forward &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook forward priority 0; policy drop;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IPv6配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain input &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook input priority 0; policy drop;</span><br><span class="line">tcp dport ssh accept</span><br><span class="line">iif <span class="string">&quot;lo&quot;</span> accept</span><br><span class="line">iif != <span class="string">&quot;lo&quot;</span> ip6 saddr ::1 drop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain output &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook output priority 0; policy drop;</span><br><span class="line">tcp sport ssh accept</span><br><span class="line">ip6 saddr ::1 accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain forward &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook forward priority 0; policy drop;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下方法添加input和output链的策略：</p><p>配置input链“lo”接口ACCEPT策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet test input iif &quot;lo&quot; accept</span></span><br></pre></td></tr></table></figure><p>配置IPv4 input链DROP策略，output链ACCEPT策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet test input iif != &quot;lo&quot; ip saddr 127.0.0.0/8 drop</span></span><br><span class="line"><span class="comment"># nft add rule inet test output ip saddr 127.0.0.0/8 accept</span></span><br></pre></td></tr></table></figure><p>配置IPv6 input链DROP策略，output链ACCEPT策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet test input iif != &quot;lo&quot; ip6 saddr ::1 drop</span></span><br><span class="line"><span class="comment"># nft add rule inet test output ip6 saddr ::1 accept</span></span><br></pre></td></tr></table></figure><p>通过如下方式将当前配置的规则保存到配置文件中，以便系统重启后能够自动加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><p>注意，上述方式保存配置文件会覆盖原有配置内容，亦可将当前规则导出到单独文件中，或者直接在文件中编写新规则，然后在&#x2F;etc&#x2F;sysconfig&#x2F;nftables.conf配置文件中通过include方式加载，此种方式需要注意避免多个include规则文件内有重复规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/nftables/new_test_rules.nft</span></span><br><span class="line"><span class="comment"># echo &quot;include \&quot;/etc/nftables/new_test_rules.nft\&quot;&quot; &gt;&gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><h3 id="3-2-14-应当正确配置nftables-input策略"><a href="#3-2-14-应当正确配置nftables-input策略" class="headerlink" title="3.2.14 应当正确配置nftables input策略"></a>3.2.14 应当正确配置nftables input策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>input链的作用是对从外部接收的报文进行过滤，任何对外提供的服务，都需要配置对应的input策略，开启相关的端口，外部客户端才能通过该端口访问该服务。</p><p>如果未配置，由于默认策略配置为DROP，所有外部尝试访问相关业务的报文都将被丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查input链配置的策略是否满足业务需要，如下例子中开启了目标端口为22的tcp报文通道（即SSH协议的默认端口），且不限制源、目标IP地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list chain inet test input</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain input &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook input priority 0; policy drop;</span><br><span class="line">tcp dport ssh accept</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令新增ACCEPT策略到input链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet &lt;table name&gt; &lt;chain name&gt; &lt;protocol&gt; dport &lt;port number&gt; accept</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># nft add rule inet test input tcp dport ssh accept</span></span><br></pre></td></tr></table></figure><p>通过如下方式将当前配置的规则保存到配置文件中，以便系统重启后能够自动加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><p>注意，上述方式保存配置文件会覆盖原有配置内容，亦可将当前规则导出到单独文件中，或者直接在文件中编写新规则，然后在&#x2F;etc&#x2F;sysconfig&#x2F;nftables.conf配置文件中通过include方式加载，此种方式需要注意避免多个include规则文件内有重复规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/nftables/new_test_rules.nft</span></span><br><span class="line"><span class="comment"># echo &quot;include \&quot;/etc/nftables/new_test_rules.nft\&quot;&quot; &gt;&gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><h3 id="3-2-15-应当正确配置nftables-output策略"><a href="#3-2-15-应当正确配置nftables-output策略" class="headerlink" title="3.2.15 应当正确配置nftables output策略"></a>3.2.15 应当正确配置nftables output策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>服务器外发报文主要有两种情况，一种是主机进程主动连接外部服务器，比如http访问，或者外发数据到日志服务器等，另一种是外部访问本机服务，本机进行回复的报文。</p><p>如果未配置output策略，由于默认策略是DROP，服务器所有外发报文都将被丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查output链配置的策略是否满足业务需要，如下例子中开启了源端口为22的tcp报文通道（即SSH协议的默认端口），且不限制源、目标IP地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list chain inet test output</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain output &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook output priority 0; policy drop;</span><br><span class="line">tcp sport ssh accept</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令新增ACCEPT策略到output链：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet &lt;table name&gt; &lt;chain name&gt; &lt;protocol&gt; sport &lt;port number&gt; accept</span></span><br><span class="line">例如：</span><br><span class="line"><span class="comment"># nft add rule inet test output tcp sport ssh accept</span></span><br></pre></td></tr></table></figure><p>通过如下方式将当前配置的规则保存到配置文件中，以便系统重启后能够自动加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><p>注意，上述方式保存配置文件会覆盖原有配置内容，亦可将当前规则导出到单独文件中，或者直接在文件中编写新规则，然后在&#x2F;etc&#x2F;sysconfig&#x2F;nftables.conf配置文件中通过include方式加载，此种方式需要注意避免多个include规则文件内有重复规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/nftables/new_test_rules.nft</span></span><br><span class="line"><span class="comment"># echo &quot;include \&quot;/etc/nftables/new_test_rules.nft\&quot;&quot; &gt;&gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><h3 id="3-2-16-应当正确配置nftables-input、output关联策略"><a href="#3-2-16-应当正确配置nftables-input、output关联策略" class="headerlink" title="3.2.16 应当正确配置nftables input、output关联策略"></a>3.2.16 应当正确配置nftables input、output关联策略</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>虽然可以通过配置协议、ip和端口等，将进出服务器的报文策略配置到input和output链，但有些情况下会比较复杂，比如客户端通过某端口访问服务器，但服务器在返回响应报文时并不一定从原端口返回，可能使用随机的源端口，这种情况下通过sport参数很难配置准确的策略。</p><p>此时需要考虑使用关联链接的方式配置策略，如果一个外发的报文属于一个已经存在的网络链接，则直接放行；如果一个接收的报文，属于一个已经存在的网络链接，也直接放行。因为这些已经存在的链接必定是经过其他策略过滤和检查的，否则无法建立。</p><p>如果不通过关联链接的方式配置策略，则需要将所有可能的链接情况全部分析清楚并配置对应的策略，如果配置过松，可能导致安全风险，如果配置过严，可能导致业务中断。</p><p><strong>规则影响</strong>：</p><p>无</p><p><strong>检查方法：</strong></p><p>检查input和output链是否配置了关联策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset</span></span><br><span class="line">table inet <span class="built_in">test</span> &#123;</span><br><span class="line">chain input &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook input priority 0; policy drop;</span><br><span class="line">tcp dport ssh accept</span><br><span class="line">ip protocol tcp ct state established accept</span><br><span class="line">ip protocol udp ct state established accept</span><br><span class="line">ip protocol icmp ct state established accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain output &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook output priority 0; policy drop;</span><br><span class="line">ip protocol tcp ct state established,related,new accept</span><br><span class="line">ip protocol udp ct state established,related,new accept</span><br><span class="line">ip protocol icmp ct state established,related,new accept</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">chain forward &#123;</span><br><span class="line"><span class="built_in">type</span> filter hook forward priority 0; policy drop;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下命令配置output链的tcp、udp和icmp策略，允许所有新建和已建立链接的报文外发；配置input链的tcp、udp和icmp策略，允许所有已建立链接的报文接收：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft add rule inet test output ip protocol tcp ct state new,related,established accept</span></span><br><span class="line"><span class="comment"># nft add rule inet test output ip protocol udp ct state new,related,established accept</span></span><br><span class="line"><span class="comment"># nft add rule inet test output ip protocol icmp ct state new,related,established accept</span></span><br><span class="line"><span class="comment"># nft add rule inet test input ip protocol tcp ct state established accept</span></span><br><span class="line"><span class="comment"># nft add rule inet test input ip protocol udp ct state established accept</span></span><br><span class="line"><span class="comment"># nft add rule inet test input ip protocol icmp ct state established accept</span></span><br></pre></td></tr></table></figure><p>通过如下方式将当前配置的规则保存到配置文件中，以便系统重启后能够自动加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><p>注意，上述方式保存配置文件会覆盖原有配置内容，亦可将当前规则导出到单独文件中，或者直接在文件中编写新规则，然后在&#x2F;etc&#x2F;sysconfig&#x2F;nftables.conf配置文件中通过include方式加载，此种方式需要注意避免多个include规则文件内有重复规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nft list ruleset &gt; /etc/nftables/new_test_rules.nft</span></span><br><span class="line"><span class="comment"># echo &quot;include \&quot;/etc/nftables/new_test_rules.nft\&quot;&quot; &gt;&gt; /etc/sysconfig/nftables.conf</span></span><br></pre></td></tr></table></figure><h2 id="3-3-SSH"><a href="#3-3-SSH" class="headerlink" title="3.3 SSH"></a>3.3 SSH</h2><h3 id="3-3-1-确保SSH服务版本配置正确"><a href="#3-3-1-确保SSH服务版本配置正确" class="headerlink" title="3.3.1 确保SSH服务版本配置正确"></a>3.3.1 确保SSH服务版本配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>如果使用SSH1，由于协议本身存在较多的未修复漏洞，且社区已不作为主流协议进行长期维护，容易使攻击者有机可乘，造成信息泄露、命令数据篡改等风险。</p><p>openEuler默认继承的OpenSSH组件使用SSH协议进行远程控制或在服务器之间传递文件，支持SSH 1.3、1.5和2.0协议，其中1.x协议简称SSH1，由于安全原因不允许使用；2.0协议简称为SSH2，目前无安全问题，要求使用。SSH1同SSH2互不兼容，所以要求服务端在使用SSH2之后，客户端也必须使用SSH 2.0协议。</p><p>当前openEuler默认使用SSH2。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下命令，查看返回是否为2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^Protocol&quot; /etc/ssh/sshd_config</span></span><br><span class="line">Protocol 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，将Protocol字段后面的数字修改为2，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">Protocol 2</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-2-确保SSH服务认证方式配置正确"><a href="#3-3-2-确保SSH服务认证方式配置正确" class="headerlink" title="3.3.2 确保SSH服务认证方式配置正确"></a>3.3.2 确保SSH服务认证方式配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>配置合理的认证方式有利于确保用户及系统数据安全，通常情况下，对于人机账号，账号&#x2F;口令方式比较合适；对于非交互式的登录场景，公私钥方式比较合适；而对于高安全风险场景，仅开启公私钥认证方式更合适。如果使用基于主机的身份认证，攻击者可通过域名污染或IP欺骗后无需口令直接入侵系统。</p><p>SSH服务本身提供多种认证方式，但出于安全考虑，禁止使用基于主机的身份认证。</p><p>openEuler默认使用账号&#x2F;口令方式认证，在安装系统时，要求配置root管理员口令。</p><p>openEuler允许公私钥方式认证。</p><p>openEuler允许交互式-账号&#x2F;口令方式认证。</p><p>根据业务场景需要，务必配置正确的认证方式。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下方法，检查配置是否正确，此处IgnoreRhosts必须配置为yes，HostbasedAuthentication必须配置为no，PasswordAuthentication、ChallengeResponseAuthentication和PubkeyAuthentication至少有一个为yes：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^PasswordAuthentication\|^PubkeyAuthentication\|^ChallengeResponseAuthentication\|^IgnoreRhosts\|^HostbasedAuthentication&quot; /etc/ssh/sshd_config</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line">ChallengeResponseAuthentication <span class="built_in">yes</span></span><br><span class="line">IgnoreRhosts <span class="built_in">yes</span></span><br><span class="line">HostbasedAuthentication no</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>启用账号&#x2F;口令认证方式</p><p>配置&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，开启PasswordAuthentication选项，重启sshd服务，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure></li><li><p>启用公私钥认证方式</p><p>配置&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，开启PubkeyAuthentication选项，并配置公钥存储路径，重启sshd服务，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><p>客户端生成RSA公私钥，并把公钥拷贝到指定目录下即可，如上例中“.ssh&#x2F;authorized_keys”目录。</p></li><li><p>启用交互式-账号&#x2F;口令认证方式</p><p>配置&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，开启ChallengeResponseAuthentication选项，重启sshd服务，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">ChallengeResponseAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure></li><li><p>关闭基于主机的认证</p><p>配置&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，开启IgnoreRhosts，关闭HostbasedAuthentication，重启sshd服务，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">IgnoreRhosts <span class="built_in">yes</span></span><br><span class="line">HostbasedAuthentication no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-3-确保SSH密钥交换算法配置正确"><a href="#3-3-3-确保SSH密钥交换算法配置正确" class="headerlink" title="3.3.3 确保SSH密钥交换算法配置正确"></a>3.3.3 确保SSH密钥交换算法配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>密钥交换是密码学中双方交换密钥以允许使用某种加密算法的过程。通过安全的密钥交换算法，双方可以安全地交换密钥，从而允许使用加密算法对要发送的消息进行加密，并对接收到的消息进行解密。设置SSH密钥交换算法，限制密钥交换这一阶段所能使用的算法。要注意的是，若配置的算法不安全，则会增加使用风险，因为弱算法在业界已经或者即将被破解。</p><p>推荐的安全算法如下（按优先级排序，openEuler已默认配置）：</p><p>curve25519-sha256</p><p><a href="mailto:&#99;&#117;&#114;&#x76;&#x65;&#x32;&#x35;&#x35;&#x31;&#57;&#x2d;&#115;&#104;&#97;&#x32;&#53;&#54;&#64;&#x6c;&#105;&#x62;&#115;&#x73;&#x68;&#x2e;&#111;&#x72;&#103;">&#99;&#117;&#114;&#x76;&#x65;&#x32;&#x35;&#x35;&#x31;&#57;&#x2d;&#115;&#104;&#97;&#x32;&#53;&#54;&#64;&#x6c;&#105;&#x62;&#115;&#x73;&#x68;&#x2e;&#111;&#x72;&#103;</a></p><p>diffie-hellman-group-exchange-sha256</p><p>可以根据实际业务场景进行修改配置，但所选择的算法必须符合业界安全标准。</p><p><strong>规则影响：</strong></p><p>如果SSH客户端不支持服务端配置的密钥交换算法，客户端将无法连接到SSH服务端。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;ssh&#x2F;sshd_config中是否配置了正确的密钥交换算法的字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^KexAlgorithms /etc/ssh/sshd_config</span></span><br><span class="line">KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256</span><br></pre></td></tr></table></figure><p>KexAlgorithms字段设置可用的SSH密钥交换算法，用户根据需要进行设置。</p><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config，在该文件中设置SSH密钥交换算法，下面给出密钥交换算法示例，用户在设置的时候应根据需要进行设置，设置好密钥交换算法后需重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-4-确保用户认证密钥算法配置正确"><a href="#3-3-4-确保用户认证密钥算法配置正确" class="headerlink" title="3.3.4 确保用户认证密钥算法配置正确"></a>3.3.4 确保用户认证密钥算法配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>如果采用公私钥认证方式，则需要限制客户端公私钥算法，避免使用已经被业界淘汰的不安全算法。</p><p>推荐的安全算法如下（按优先级排序，openEuler已默认配置）：</p><p>ssh-ed25519</p><p><a href="mailto:&#x73;&#115;&#x68;&#x2d;&#101;&#100;&#50;&#53;&#x35;&#x31;&#57;&#x2d;&#99;&#x65;&#114;&#116;&#x2d;&#118;&#48;&#x31;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#x73;&#x68;&#x2e;&#99;&#111;&#x6d;">&#x73;&#115;&#x68;&#x2d;&#101;&#100;&#50;&#53;&#x35;&#x31;&#57;&#x2d;&#99;&#x65;&#114;&#116;&#x2d;&#118;&#48;&#x31;&#64;&#x6f;&#112;&#101;&#x6e;&#115;&#x73;&#x68;&#x2e;&#99;&#111;&#x6d;</a></p><p>rsa-sha2-256</p><p>rsa-sha2-512</p><p>RFC 4253中定义的ssh-rsa公钥算法使用了SHA1进行哈希运算，因此禁止使用。</p><p><strong>规则影响：</strong></p><p>如果SSH客户端不支持服务端配置的公私钥算法，客户端将无法连接到SSH服务端。</p><p><strong>检查方法：</strong></p><p>通过如下方法检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^PubkeyAcceptedKeyTypes&quot; /etc/ssh/sshd_config</span></span><br><span class="line">PubkeyAcceptedKeyTypes ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改文件&#x2F;etc&#x2F;ssh&#x2F;sshd_config的PubkeyAcceptedKeyTypes字段的算法列表，不同算法间通过逗号分隔，重启sshd服务，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PubkeyAcceptedKeyTypes ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-256,rsa-sha2-512</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-5-确保PAM认证使能"><a href="#3-3-5-确保PAM认证使能" class="headerlink" title="3.3.5 确保PAM认证使能"></a>3.3.5 确保PAM认证使能</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>PAM（Pluggable Authentication Modules）是Linux平台上可插拔的认证模块，PAM提供了一系列的开源共享库文件（so），通过配置参数可以灵活控制相关认证过程。SSH通过配置PAM认证，可以基于Linux系统的用户认证管理模块完成SSH远程登录用户的认证授权和管理，相对比较方便和统一；否则SSH需要对认证过程进行管理，例如认证失败次数控制，账号是否锁定等，配置容易遗漏或无法达到PAM管理的效果。</p><p>openEuler SSH默认使用PAM认证。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^UsePAM&quot; /etc/ssh/sshd_config</span></span><br><span class="line">UsePAM <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，将UsePAM设置为yes，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">UsePAM <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-6-确保SSH服务MACs算法配置正确"><a href="#3-3-6-确保SSH服务MACs算法配置正确" class="headerlink" title="3.3.6 确保SSH服务MACs算法配置正确"></a>3.3.6 确保SSH服务MACs算法配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>消息认证算法MACs：密码学中，通信实体双方使用的一种验证机制，保证了消息数据完整性。若配置的算法不安全，则会增加使用风险，因为弱算法在业界已经或者即将被破解。</p><p>推荐的安全算法如下（按优先级排序，openEuler已默认配置）：</p><p>hmac-sha2-512</p><p><a href="mailto:&#x68;&#x6d;&#97;&#99;&#45;&#115;&#x68;&#x61;&#x32;&#x2d;&#x35;&#49;&#50;&#45;&#x65;&#116;&#109;&#x40;&#x6f;&#112;&#x65;&#x6e;&#x73;&#115;&#104;&#x2e;&#99;&#x6f;&#x6d;">&#x68;&#x6d;&#97;&#99;&#45;&#115;&#x68;&#x61;&#x32;&#x2d;&#x35;&#49;&#50;&#45;&#x65;&#116;&#109;&#x40;&#x6f;&#112;&#x65;&#x6e;&#x73;&#115;&#104;&#x2e;&#99;&#x6f;&#x6d;</a></p><p>hmac-sha2-256</p><p><a href="mailto:&#x68;&#x6d;&#97;&#99;&#x2d;&#x73;&#x68;&#x61;&#50;&#45;&#x32;&#53;&#x36;&#45;&#101;&#116;&#x6d;&#64;&#x6f;&#x70;&#101;&#x6e;&#115;&#x73;&#x68;&#x2e;&#x63;&#x6f;&#x6d;">&#x68;&#x6d;&#97;&#99;&#x2d;&#x73;&#x68;&#x61;&#50;&#45;&#x32;&#53;&#x36;&#45;&#101;&#116;&#x6d;&#64;&#x6f;&#x70;&#101;&#x6e;&#115;&#x73;&#x68;&#x2e;&#x63;&#x6f;&#x6d;</a></p><p><strong>规则影响：</strong></p><p>如果SSH客户端不支持服务端配置的MACs算法，客户端将无法连接到SSH服务端。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^MACs&quot; /etc/ssh/sshd_config</span></span><br><span class="line">MACs hmac-sha2-512,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-256-etm@openssh.com</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，在该文件中设置SSH消息认证算法，下面给出消息认证算法示例，用户在设置的时候应根据需要进行设置，设置好消息认证算法后需重启sshd服务使之生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">MACs hmac-sha2-512,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-256-etm@openssh.com</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-7-确保SSH服务密码算法配置正确"><a href="#3-3-7-确保SSH服务密码算法配置正确" class="headerlink" title="3.3.7 确保SSH服务密码算法配置正确"></a>3.3.7 确保SSH服务密码算法配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>随着密码技术的发展以及计算能力的提升，一些密码算法已不再适合现今的安全领域。例如MD5算法，该算法已经于2004年由山东大学王小云教授的团队予以破解（人为构造出两个具有相同MD5值的信息），并且在2007年由密码学家Marc Stevens进一步扩展和改进该攻击，实现了数字证书伪造，其安全性已非常低下，因此， MD5不应用于所有密码学安全用途，包括用于数字签名，HMAC，口令单向保护、密钥派生、RNG等，但是，对于校验线路错误、校验介质损坏引起的比特跳变等非密码学安全用途，使用MD5不受本规范约束。又比如DES算法，因为密码学分析技术的发展和计算能力提升导致对其进行暴力破解成为可能，现有的暴力破解设备能将破解DES的时间减少到一天以内。这些算法统称为不安全密码算法，如果继续使用这些不安全的密码算法，有可能为数据带来风险。</p><p>强密码算法是指当前被业界普遍认可，在其适合的应用场景下安全强度相对该场景下的其它加密算法有相对优势，在合理的安全假设下具有可证明安全性或对其实施破解在计算上显著不可行的密码算法。</p><p>密码算法用于加密解密数据，若配置的算法不安全，则会增加使用风险，因为弱算法在业界已经或者即将被破解。</p><p><strong>规则影响：</strong></p><p>如果SSH客户端不支持服务端配置的加密算法，客户端将无法连接到SSH服务端。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^Ciphers&quot; /etc/ssh/sshd_config</span></span><br><span class="line">Ciphers aes128-ctr,aes192-ctr,aes256-ctr,chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-gcm@openssh.com</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，在该文件中设置SSH密码算法，下面给出密码算法示例，用户在设置的时候应根据需要进行设置，设置好密码算法后需重启sshd服务使之生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">Ciphers aes128-ctr,aes192-ctr,aes256-ctr,chacha20-poly1305@openssh.com,aes128-gcm@openssh.com,aes256-gcm@openssh.com</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-8-禁止SSH服务配置加密算法覆盖策略"><a href="#3-3-8-禁止SSH服务配置加密算法覆盖策略" class="headerlink" title="3.3.8 禁止SSH服务配置加密算法覆盖策略"></a>3.3.8 禁止SSH服务配置加密算法覆盖策略</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH服务加密算法的配置文件为&#x2F;etc&#x2F;ssh&#x2F;sshd_config、&#x2F;etc&#x2F;sysconfig&#x2F;sshd。当SSH服务正在运行中，用户可以编辑&#x2F;etc&#x2F;sysconfig&#x2F;sshd文件从而覆盖加密算法策略。如果配置加密算法覆盖策略将允许用户配置安全性较低的加密算法、消息认证算法、密钥交换算法等，降低了系统的安全性。攻击者可以利用这些不安全的算法破解系统信息，增加了安全风险。</p><p>openEuler默认不配置加密算法覆盖策略。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查SSH配置文件&#x2F;etc&#x2F;sysconfig&#x2F;sshd，如果“CRYPTO_POLICY&#x3D;”字段为空或该行被注释则说明没有配置加密算法覆盖策略，反之则说明配置了加密算法覆盖策略。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^\s*CRYPTO_POLICY=&quot; /etc/sysconfig/sshd | cut -d &quot;=&quot; -f 2-</span></span><br><span class="line"><span class="string">&#x27;-oCiphers=aes256-ctr,aes192-ctr,aes128-ctr -oMACS=hmac-sha2-512,hmac-sha2-256&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>编辑SSH服务配置文件&#x2F;etc&#x2F;sysconfig&#x2F;sshd删除加密算法策略或注释掉该行，重新加载sshd配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysconfig/sshd</span></span><br><span class="line">  </span><br><span class="line">方案 1 删除加密算法策略：</span><br><span class="line">CRYPTO_POLICY=</span><br><span class="line">方案 2 注释该行：</span><br><span class="line"><span class="comment"># CRYPTO_POLICY=&#x27;-oCiphers=aes256-ctr,aes192-ctr,aes128-ctr -oMACS=hmac-sha2-512,hmac-sha2-256&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># systemctl reload sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-9-确保禁用root用户通过SSH登录"><a href="#3-3-9-确保禁用root用户通过SSH登录" class="headerlink" title="3.3.9 确保禁用root用户通过SSH登录"></a>3.3.9 确保禁用root用户通过SSH登录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH 配置文件：&#x2F;etc&#x2F;ssh&#x2F;sshd_config中的PermitRootLogin参数指定root用户是否可以使用ssh登录。<br>不允许root用户通过SSH登录：要求系统管理员使用自己的个人账户进行SSH登录，然后通过sudo或 su提升权限到root。这样可在发生安全事件时提供清晰的审计线索。<br>在对此项安全建议进行配置前，应确认还有其他可用的系统管理员用户账号，否则在配置生效后，将可能导致无法进行SSH远程管理。</p><p><strong>规则影响：</strong></p><p>配置生效后，root用户不能通过ssh远程登录</p><p><strong>检查方法：</strong></p><p>执行以下命令，验证SSH的PermitRootLogin配置是否正确（同时满足如下两个命令行的检查）：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sshd -T -C user=root -C host=&quot;$(hostname)&quot; -C addr=&quot;$(grep $(hostname) /etc/hosts | awk &#x27;&#123;print $1&#125;&#x27;)&quot; | grep permitrootlogin</span></span><br><span class="line">permitrootlogin no</span><br><span class="line"><span class="comment"># grep -Ei &#x27;^\s*PermitRootLogin\s+yes&#x27; /etc/ssh/sshd_config</span></span><br><span class="line">Nothing is returned</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，将PermitRootLogin字段修改为no，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-10-应当正确配置SSH服务日志级别"><a href="#3-3-10-应当正确配置SSH服务日志级别" class="headerlink" title="3.3.10 应当正确配置SSH服务日志级别"></a>3.3.10 应当正确配置SSH服务日志级别</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH提供多种日志输出级别：QUIET、FATAL、ERROR、INFO、VERBOSE、DEBUG、DEBUG1、DEBUG2、DEBUG3。日志级别设置越高（例如QUIET、FATAL），打印的日志信息越少，有利于节约硬盘空间，但不利于管理员对SSH事件进行审计追溯；反之（例如DEBUG2、DEBUG3），日志打印量大，消耗硬盘空间多，记录的事件比较详细。</p><p>openEuler默认设置为VERBOSE，建议根据实际场景设置合理的日志级别，不建议设置DEBUG及以下级别，容易导致日志量过多。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看日志级别配置，如下例中配置为VERBOSE：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^LogLevel&quot; /etc/ssh/sshd_config</span></span><br><span class="line">LogLevel VERBOSE</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，将LogLevel设置为相应的级别，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">LogLevel VERBOSE</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-11-应当正确配置SSH服务接口"><a href="#3-3-11-应当正确配置SSH服务接口" class="headerlink" title="3.3.11 应当正确配置SSH服务接口"></a>3.3.11 应当正确配置SSH服务接口</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通常情况下服务器存在多个网卡多个IP地址，IP地址应该进行相关的规划，哪些用于业务，哪些用于管理，所以并不是每个IP地址都需要侦听SSH连接，可以通过配置限制只有指定IP地址才能进行SSH连接，减小攻击面。未配置的IP地址无法通过SSH连接到服务器。</p><p>openEuler作为平台，无法确定现网场景，默认不配置。建议根据实际情况规划和配置。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>如果已经配置侦听的地址，通过grep命令可以查询对应的配置（<ip addr>为实际已配置的ip地址），返回打印为空表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^ListenAddress&quot; /etc/ssh/sshd_config</span></span><br><span class="line">ListenAddress &lt;ip addr&gt;</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，在ListenAddress字段后设置相应的IP地址，如果有多个，可以设置多行，重启sshd服务，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">ListenAddress &lt;ip addr 1&gt;</span><br><span class="line">ListenAddress &lt;ip addr 2&gt;</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-12-应当正确配置SSH并发未认证连接数"><a href="#3-3-12-应当正确配置SSH并发未认证连接数" class="headerlink" title="3.3.12 应当正确配置SSH并发未认证连接数"></a>3.3.12 应当正确配置SSH并发未认证连接数</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>攻击者在不知道口令的情况下，可以通过建立大量的未完成认证的并发连接来消耗系统资源。</p><p>openEuler默认不配置，建议根据实际场景配置上限值。</p><p><strong>规则影响：</strong></p><p>如果正在进行认证的连接数达到上限，则新连接将被直接拒绝。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^MaxStartups&quot; /etc/ssh/sshd_config</span></span><br><span class="line">maxstartups 10:30:60</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置maxstartups字段。</p><p>配置值为用冒号分隔的3个字段，其中第一个字段和最后一个字段分别表示连接数下限和上限，中间字段表示丢弃连接的比例，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">maxstartups 10:30:60</span><br></pre></td></tr></table></figure><p>表示未完成认证的连接数达到10个以后，开始丢弃30%的连接申请，如果此时继续累积未完成认证的连接数达到60个，那么拒绝所有新增连接。</p><p>修改本配置需要重启sshd服务生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-13-应当正确配置单个SSH连接允许的并发会话数"><a href="#3-3-13-应当正确配置单个SSH连接允许的并发会话数" class="headerlink" title="3.3.13 应当正确配置单个SSH连接允许的并发会话数"></a>3.3.13 应当正确配置单个SSH连接允许的并发会话数</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH允许支持多路复用的客户端基于一个网络连接可以建立多个会话，MaxSessions限制每个网络连接允许建立的SSH并发会话数，可以防止系统资源被单个或少数连接无限制的占用，导致拒绝服务攻击。MaxSessions设置为1将禁用会话多路复用，即一个连接仅允许一个会话，而将其设置为0将阻止所有连接会话。</p><p>openEuler默认不在配置文件中配置，代码中会取默认值10，建议根据实际场景在配置文件中配置上限值。</p><p><strong>规则影响：</strong></p><p>如果单个客户端连接建立的会话数已经达到最大连接数，新建会话将被拒绝。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^MaxSessions&quot; /etc/ssh/sshd_config</span></span><br><span class="line">MaxSessions 10</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置MaxSessions字段，该字段后面配置的数字表示限制的连接会话数，重启sshd服务，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">MaxSessions 5</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><p>说明：假设设置MaxSessions为5，修改配置并重新启动服务后，对已经存在的SSH会话不参与计数，也就是在该SSH通道还可以新建5个会话；如果修改配置后重新启动服务器，则一个通道只能存在5个会话。</p><h3 id="3-3-14-禁止使用X11-Forwarding"><a href="#3-3-14-禁止使用X11-Forwarding" class="headerlink" title="3.3.14 禁止使用X11 Forwarding"></a>3.3.14 禁止使用X11 Forwarding</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH的X11 Forwarding功能允许在本地主机上执行远程主机的GUI程序。启用X11 Forwarding功能，则扩大了攻击面，存在被X11服务器端其他用户攻击的可能。如果业务场景中不需要，则必须禁止该功能。</p><p>openEuler默认关闭X11 Forwarding功能。</p><p><strong>规则影响：</strong></p><p>依赖于X11 Forwarding的程序执行受限制。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^X11Forwarding&quot; /etc/ssh/sshd_config</span></span><br><span class="line">X11Forwarding no</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置X11Forwarding字段，将该字段设置为no，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">X11Forwarding no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-15-应当正确配置MaxAuthTries"><a href="#3-3-15-应当正确配置MaxAuthTries" class="headerlink" title="3.3.15 应当正确配置MaxAuthTries"></a>3.3.15 应当正确配置MaxAuthTries</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>MaxAuthTries值用于表示系统允许单次连接过程中，用户认证失败的次数，超过上限则自动断开连接。建议设置该值小于等于3。</p><p>如果该值配置比较大，则单次连接过程中客户端可以尝试多次认证失败，降低了攻击开销。如果该值未在配置文件中显式配置，系统默认为6。</p><p><strong>规则影响：</strong></p><p>认证失败次数超过上限，自动断开连接。</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^MaxAuthTries&quot; /etc/ssh/sshd_config</span></span><br><span class="line">MaxAuthTries 3</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置MaxAuthTries字段，该字段后面配置的数字表示限制的尝试次数，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">MaxAuthTries 3</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-16-禁止使用PermitUserEnvironment"><a href="#3-3-16-禁止使用PermitUserEnvironment" class="headerlink" title="3.3.16 禁止使用PermitUserEnvironment"></a>3.3.16 禁止使用PermitUserEnvironment</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>PermitUserEnvironment允许用户设置SSH环境变量，该设置可能导致攻击者通过修改SSH环境变量进行相应攻击。</p><p>如果PermitUserEnvironment配置为yes，则攻击者可以通过修改SSH环境变量绕过安全机制，或者执行攻击代码。该配置必须关闭。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^PermitUserEnvironment&quot; /etc/ssh/sshd_config</span></span><br><span class="line">PermitUserEnvironment no</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置PermitUserEnvironment字段为no，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">PermitUserEnvironment no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-17-应当正确配置LoginGraceTime"><a href="#3-3-17-应当正确配置LoginGraceTime" class="headerlink" title="3.3.17 应当正确配置LoginGraceTime"></a>3.3.17 应当正确配置LoginGraceTime</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>LoginGraceTime用于限制用户登录的时间，如果用户在LoginGraceTime限定的时间内没有完成登录动作，则自动断开连接。建议该值设置为小于或等于60秒。</p><p>如果该值设置过大，则攻击者可以利用大量未完成登录动作的连接来消耗服务器资源，从而导致正常管理员登录失败。如果该值未在配置文件中显式配置，系统默认为120秒。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i &quot;^LoginGraceTime&quot; /etc/ssh/sshd_config</span></span><br><span class="line">LoginGraceTime 60</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件，配置LoginGraceTime的值，该字段后面配置的数字表示限制的时间，单位秒，配置后重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">LoginGraceTime 60</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-18-禁止SSH服务预设置authorized-keys"><a href="#3-3-18-禁止SSH服务预设置authorized-keys" class="headerlink" title="3.3.18 禁止SSH服务预设置authorized_keys"></a>3.3.18 禁止SSH服务预设置authorized_keys</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>authorized_keys为远程主机的公钥，用户可以将该公钥存放于主目录$HOME&#x2F;.ssh&#x2F;authorized_keys文件中，用于公钥认证便可以直接登录系统。如果系统中预设authorized_keys，并且服务端开启了公私钥认证的登录方式，攻击者便可以绕过认证直接登录到指定的系统中对其进行攻击。所以系统中不能预设置authorized_keys。</p><p>openEuler默认不预设置authorized_keys。<br>注意，本规则仅对初始系统预设置进行约束，对于运行期间，按业务要求必须使用公钥认证的场景，可以例外。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未预设置authorized_keys：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find /home/ /root/ -name authorized_keys </span></span><br><span class="line">/home/test/.ssh/authorized_keys</span><br><span class="line">/root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>删除被检测到的预设置authorized_keys，如&#x2F;root&#x2F;.ssh&#x2F;authorized_keys文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /root/.ssh/authorized_keys</span></span><br></pre></td></tr></table></figure><h3 id="3-3-19-禁止SSH服务预设置known-hosts"><a href="#3-3-19-禁止SSH服务预设置known-hosts" class="headerlink" title="3.3.19 禁止SSH服务预设置known_hosts"></a>3.3.19 禁止SSH服务预设置known_hosts</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>known_hosts为主机已经访问过的计算机的公钥，用户成功登录其他计算机后会自动将公钥信息保存在$HOME&#x2F;.ssh&#x2F;known_hosts中。当下次访问相同计算机时会校验公钥，如果校验失败则拒绝建立连接。所以系统中不能预设置known_hosts。</p><p>当系统中预设known_hosts时：</p><ul><li>如果主机公钥正确，则在与目标主机建立连接的过程中不会发出警告，增加了安全风险。</li><li>如果主机公钥错误，则无法建立连接到目标主机。</li></ul><p>openEuler默认不预设置known_hosts。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用grep命令查看配置，如果返回为空，表示未预设置known_hosts：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find /home/ /root/ -name known_hosts </span></span><br><span class="line">/home/test/.ssh/known_hosts</span><br><span class="line">/root/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>删除被检测到的文件，如&#x2F;root&#x2F;.ssh&#x2F;known_hosts文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /root/.ssh/known_hosts</span></span><br></pre></td></tr></table></figure><h3 id="3-3-20-禁止SSH服务配置弃用的选项"><a href="#3-3-20-禁止SSH服务配置弃用的选项" class="headerlink" title="3.3.20 禁止SSH服务配置弃用的选项"></a>3.3.20 禁止SSH服务配置弃用的选项</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>目前SSH服务通讯协议主要分为第一代和第二代，不同版本的通讯协议SSH服务的配置项并不兼容，而且某些低版本的配置项在新版本中已经被废除了。SSH服务端配置文件存放在&#x2F;etc&#x2F;ssh&#x2F;sshd_config中，当前配置选项均为SSH第二代通信协议的配置选项，如果强行配置旧版本的配置项，会导致SSH服务进行自检时报错，且配置项并不生效。所以应禁止配置已经弃用的SSH选项。</p><p>openEuler默认不配置已经弃用的SSH选项。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用SSH服务自检命令进行检查如果返回为空表示未出现错误，反之则说明配置了不兼容的选项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sshd -t</span></span><br><span class="line">/etc/ssh/sshd_config line 147: Deprecated option RSAAuthentication</span><br><span class="line">/etc/ssh/sshd_config line 149: Deprecated option RhostsRSAAuthentication</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>编辑SSH服务配置文件，删除已经废除的配置项，重启sshd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># RSAAuthentication yes</span></span><br><span class="line"><span class="comment"># RhostsRSAAuthentication no</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-21-确保禁用SSH的TCP转发功能"><a href="#3-3-21-确保禁用SSH的TCP转发功能" class="headerlink" title="3.3.21 确保禁用SSH的TCP转发功能"></a>3.3.21 确保禁用SSH的TCP转发功能</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>将AllowTcpForwarding设置为no的作用是禁止SSH客户端进行TCP端口转发。TCP端口转发是通过SSH隧道在本地主机和远程主机之间传输数据的功能。通过禁用这一功能，可以限制用户在SSH会话中的数据传输和访问范围，从而增强系统的安全性。</p><p>配置后具体影响如下：</p><ol><li>限制数据传输： 禁用TCP端口转发可以防止用户在SSH会话中传输数据，从而降低了可能的数据泄露风险。</li><li>减少攻击面：开启TCP端口转发可能会引入一些安全风险，如允许攻击者绕过网络安全措施或访问受限制的服务。禁用这一功能可以减少系统的攻击面。</li><li>避免资源滥用：TCP端口转发可能占用服务器资源和带宽，禁用它可以避免资源被滥用。</li><li>符合安全最佳实践：在某些情况下，如高度安全性要求的环境，禁用TCP端口转发可能是安全最佳实践之一。</li></ol><p><strong>规则影响：</strong></p><p>禁用TCP端口转发可能会影响某些应用和用例，例如需要远程访问受限服务的情况。</p><p><strong>检查方法：</strong></p><p>执行以下命令，验证SSH的allowtcpforwarding配置是否正确（同时满足如下两个命令行的检查）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sshd -T -C user=root -C host=&quot;$(hostname)&quot; -C addr=&quot;$(grep $(hostname) /etc/hosts | awk &#x27;&#123;print $1&#125;&#x27;)&quot; | grep allowtcpforwarding</span></span><br><span class="line">allowtcpforwarding no</span><br><span class="line"><span class="comment"># grep -Ei &#x27;^\s*AllowTcpForwarding\s+yes\b&#x27; /etc/ssh/sshd_config</span></span><br><span class="line">Nothing is returned</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>编辑&#x2F;etc&#x2F;ssh&#x2F;sshd_config配置文件，修改AllowTcpForwarding参数，或添加以下代码，对AllowTcpForwarding参数进行配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">AllowTcpForwarding no</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h3 id="3-3-22-应当正确配置认证黑白名单"><a href="#3-3-22-应当正确配置认证黑白名单" class="headerlink" title="3.3.22 应当正确配置认证黑白名单"></a>3.3.22 应当正确配置认证黑白名单</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SSH提供了黑白名单功能，可以设置账号或用户组的清单，允许或禁止某些账号或用户组的用户登录SSH，openEuler默认不配置，相关字段如下：</p><p>AllowUsers <userlist></p><p>userlist是空格分割的允许登录的账号，不支持uid，可以是user@host格式，user和host将被单独检查，限制特定账号从特定主机上登录，名称里面可使用通配符*和?。配置后将自动禁止系统其他非授权账号登录ssh服务。</p><p>AllowGroups <grouplist></p><p>grouplist是空格分隔的允许登录的用户组名称，不支持gid</p><p>DenyUsers <userlist></p><p>userlist是空格分隔的拒绝登录的账号，不支持uid</p><p>DenyGroups <grouplist></p><p>grouplist是空格分隔的拒绝登录的用户组名称，不支持gid</p><p>建议直接删除不使用的用户账号或用户组，而不是通过DenyUsers&#x2F;DenyGroups进行拒绝登录。如果针对某个账号只允许或拒绝在某些客户端登录，可以通过user@host方式配置Allow或Deny规则。</p><p>Allow或Deny规则如果同时设置，则取并集，也就是说如果设置了Allow规则，那么被允许的用户账号或用户组之外的，都不允许登录；同时设置了Deny规则，那么在遵循Allow规则后，允许登录的用户账号或用户组范围内再匹配是否符合Deny规则，排除以后剩下的才是可以登录的。</p><p><strong>规则影响：</strong></p><p>配置Allow规则，被允许的用户账号或用户组之外的，都不允许登录；配置Deny规则，拒绝登录的用户账号或用户组将无法登录。</p><p><strong>检查方法：</strong></p><p>使用grep命令检查是否存在配置，如果无返回信息，则表示没有任何配置，否则返回配置内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^AllowUsers\|^AllowGroups\|^DenyUsers\|^DenyGroups&quot; /etc/ssh/sshd_config</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>根据业务实际场景，在&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件中添加相关Allow或Deny字段，重启sshd服务，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ssh/sshd_config</span></span><br><span class="line">AllowUsers root <span class="built_in">test</span></span><br><span class="line">DenyUsers test1</span><br><span class="line"><span class="comment"># systemctl restart sshd</span></span><br></pre></td></tr></table></figure><h2 id="3-4-定时任务"><a href="#3-4-定时任务" class="headerlink" title="3.4 定时任务"></a>3.4 定时任务</h2><h3 id="3-4-1-确保crontab执行的脚本非属主用户不可写"><a href="#3-4-1-确保crontab执行的脚本非属主用户不可写" class="headerlink" title="3.4.1 确保crontab执行的脚本非属主用户不可写"></a>3.4.1 确保crontab执行的脚本非属主用户不可写</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>crontab 是系统用来执行定时任务的配置文件，配置文件路径为&#x2F;etc&#x2F;crontab。管理员会根据实际的业务需要定义定时任务，操作系统会自动执行该任务。所以crontabs配置文件中配置的执行脚本（程序）应该只有该脚本（程序）的属主可写，不能配置其他低权限用户可写的脚本，否则其他用户可以通过修改该脚本实现提权操作。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查crontabs配置文件&#x2F;etc&#x2F;crontab，检查执行脚本（程序）是否为其他低权限用户可写。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line">  *  *  *  *  * user-name  /bin/xxx.sh</span><br><span class="line"><span class="comment"># ll /bin/xxx.sh</span></span><br><span class="line">-rw-------. 1 root root 451 Mar 27 17:00 /bin/xxx.sh</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果&#x2F;etc&#x2F;crontab配置文件中的执行脚本（程序）为其他低权限用户可写，则需要根据实际的业务场景进行修复：</p><ul><li><p>修复方法1</p><p>修改&#x2F;etc&#x2F;crontab配置文件中的执行脚本（程序）的文件权限，去除掉其他低特权用户的可写权限，以防止提权操作。</p></li><li><p>修复方法2</p><p>修改&#x2F;etc&#x2F;crontab配置文件，删除该执行脚本（程序）的配置项，防止提权操作。</p></li></ul><h3 id="3-4-2-确保cron守护进程正常启用"><a href="#3-4-2-确保cron守护进程正常启用" class="headerlink" title="3.4.2 确保cron守护进程正常启用"></a>3.4.2 确保cron守护进程正常启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>cron 守护进程用于在系统上执行批处理作业。</p><p>即使操作系统目前可能没有需要运行的用户作业，也会有系统作业需要运行，其中就可能包括安全监控等重要作业，而 cron 守护进程就是用来执行这些作业的。cron守护进程未正常启用的影响：</p><ol><li>定时任务无法运行： 最直接的影响是配置在 cron 中的定时任务将无法自动运行。这可能会导致一些计划性的任务未能按时执行，如日志清理、备份、系统维护等。</li><li>计划性任务延迟： 如果定时任务未能按时执行，可能会导致任务的延迟。这对于某些关键任务来说，可能会影响系统的正常运行和性能。</li><li>系统维护和自动化受阻： 自动化任务通常用于监视系统状态、应用程序的运行情况等。如果这些任务未能按时执行，系统可能会错过对潜在问题的检测和处理。</li><li>日志分析受影响： 许多系统管理员使用定时任务来执行日志分析、报告生成等任务。如果这些任务无法运行，可能会错过对系统运行情况的重要洞察。</li><li>备份延误： 许多备份任务都是通过定时任务实现的。如果定时任务未运行，备份可能会受到影响，导致数据备份不及时或不完整。</li></ol><p><strong>规则影响：</strong><br>无</p><p><strong>检查方法：</strong></p><p>执行以下命令来确定 cron 守护进程是否正常启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled crond</span></span><br><span class="line">enabled</span><br></pre></td></tr></table></figure><p>如结果为enabled，则视为通过此项检查。</p><p><strong>修复方法：</strong></p><p>执行以下命令来启用 cron 进程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now enable crond</span></span><br></pre></td></tr></table></figure><h3 id="3-4-3-确保at、cron配置正确"><a href="#3-4-3-确保at、cron配置正确" class="headerlink" title="3.4.3 确保at、cron配置正确"></a>3.4.3 确保at、cron配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>at服务用于进行简单的一次性任务执行，cron服务用于执行系统中的周期性定时任务。&#x2F;etc&#x2F;cron.deny是cron命令的黑名单配置文件，&#x2F;etc&#x2F;cron.allow是cron命令的白名单配置文件，默认不存在，白名单出现时，黑名单失效，只有root账号和写在白名单中的账号可以使用cron命令。</p><p>如果使用黑名单机制管理cron定时任务，有可能在添加了新账号之后忘记将其加入黑名单中，增大了系统潜在的安全攻击面。如果cron相关配置文件属主不为root，或者允许group和other用户访问，可能导致系统管理员以外的用户进行cron配置，带来系统安全隐患。如果系统无需启用at、cron配置，此配置项无需检查。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>首先要确保系统中cron服务已经启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled crond</span></span><br></pre></td></tr></table></figure><p>请确认返回结果是enabled。</p></li><li><p>确认&#x2F;etc&#x2F;crontab文件和&#x2F;etc&#x2F;cron.hourly、&#x2F;etc&#x2F;cron.daily、&#x2F;etc&#x2F;cron.weekly、&#x2F;etc&#x2F;cron.monthly、&#x2F;etc&#x2F;cron.d目录的UID和GID都是0，且不允许group和other用户访问：  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stat /etc/crontab</span></span><br><span class="line">Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)</span><br></pre></td></tr></table></figure></li><li><p>确认黑名单文件&#x2F;etc&#x2F;cron.deny和&#x2F;etc&#x2F;at.deny不存在，确认白名单文件&#x2F;etc&#x2F;cron.allow和&#x2F;etc&#x2F;at.allow设置了正确的权限，即UID和GID都是0，且不允许group和other用户访问：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stat /etc/cron.allow</span></span><br><span class="line">Access: (0600/-rwx------)  Uid: (    0/    root)   Gid: (    0/    root)</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>如果没有启用cron服务，使用以下命令启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl --now enable crond</span></span><br></pre></td></tr></table></figure></li><li><p>设置&#x2F;etc&#x2F;crontab文件和&#x2F;etc&#x2F;cron.hourly、&#x2F;etc&#x2F;cron.daily、&#x2F;etc&#x2F;cron.weekly、&#x2F;etc&#x2F;cron.monthly、&#x2F;etc&#x2F;cron.d目录的UID&#x2F;GID及权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown root:root /etc/crontab</span></span><br><span class="line"><span class="comment"># chmod og-rwx /etc/crontab</span></span><br></pre></td></tr></table></figure></li><li><p>删除&#x2F;etc&#x2F;cron.deny和&#x2F;etc&#x2F;at.deny文件，创建&#x2F;etc&#x2F;cron.allow和&#x2F;etc&#x2F;at.allow文件并设置正确的权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rm /etc/cron.deny /etc/at.deny</span></span><br><span class="line"><span class="comment"># touch /etc/cron.allow /etc/at.allow</span></span><br><span class="line"><span class="comment"># chmod og-rwx /etc/cron.allow</span></span><br><span class="line"><span class="comment"># chmod og-rwx /etc/at.allow</span></span><br><span class="line"><span class="comment"># chown root:root /etc/cron.allow</span></span><br><span class="line"><span class="comment"># chown root:root /etc/at.allow</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="3-5-内核"><a href="#3-5-内核" class="headerlink" title="3.5 内核"></a>3.5 内核</h2><h3 id="3-5-1-确保内核ASLR已启用"><a href="#3-5-1-确保内核ASLR已启用" class="headerlink" title="3.5.1 确保内核ASLR已启用"></a>3.5.1 确保内核ASLR已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>ASLR通过每次将栈的起始位置、函数库和程序本身移至略微不同的位置，使得缓冲溢出攻击无法猜测正确的位置，导致攻击无法成功实施。linux内核中ASLR分为0,1,2三级通过&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;randomize_va_space文件配置查看，各级对应的效果：</p><p>0：不存在随机化，表示一切都将位于静态地址中</p><p>1：只有共享函数库、栈、mmap’ed 内存、VDSO以及堆是随机的</p><p>2：完全随机化。使用brk()进行的旧式内存配置也将是随机的</p><p>进程中栈的地址被随机化，降低缓冲溢出攻击的风险</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>输入以下命令并检查相应的命令返回是否为2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/sys/kernel/randomize_va_space</span></span><br><span class="line">2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改randomize_va_space值为2：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo 2 &gt; /proc/sys/kernel/randomize_va_space</span></span><br></pre></td></tr></table></figure><h3 id="3-5-2-确保dmesg访问权限配置正确"><a href="#3-5-2-确保dmesg访问权限配置正确" class="headerlink" title="3.5.2 确保dmesg访问权限配置正确"></a>3.5.2 确保dmesg访问权限配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>限制访问 dmesg 信息权限，无特权的用户无法查看系统信息，从而可以避免任何人从系统信息获取敏感信息，进而对系统进行攻击的行为。仅允许具有 CAP_SYSLOG 能力的进程查看内核日志信息。从而控制关键信息的最小权限，保障系统更加安全。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;sysctl.conf文件中是否已经配置相关字段，“kernel.dmesg_restrict&#x3D;1”表示已经设置dmesg的访问限制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep kernel.dmesg_restrict /etc/sysctl.conf</span></span><br><span class="line">kernel.dmesg_restrict=1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>打开&#x2F;etc&#x2F;sysctl.conf文件，设置kernel.dmesg_restrict为1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">kernel.dmesg_restrict=1</span><br></pre></td></tr></table></figure><h3 id="3-5-3-确保正确配置内核参数kptr-restrict"><a href="#3-5-3-确保正确配置内核参数kptr-restrict" class="headerlink" title="3.5.3 确保正确配置内核参数kptr_restrict"></a>3.5.3 确保正确配置内核参数kptr_restrict</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>kptr_restrict的作用是保护内核符号地址，保护等级低时普通用户可以访问得到内核符号地址容易被攻击者利用，增加了攻击面降低了系统安全性。</p><p>当前kptr_restrict可以选择如下参数：</p><p>0：普通用户和带有CAP_SYSLOG特权的用户均可以读取（读取地址为内核符号地址经哈希运算后的值）。</p><p>1：只有带有CAP_SYSLOG特权的用户有读取权限（读取地址为内核符号实际地址），普通用户读取后内核符号地址打印为全零。</p><p>2：普通用户及带有CAP_SYSLOG特权的用户均无权限读取，读取后内核符号地址打印为全零。</p><p>考虑到易维护性、可定位性，openEuler发行版默认配置kptr_restrict参数为0，请根据实际场景按需配置。</p><p><strong>规则影响：</strong></p><p>普通用户无法获取内核符号地址。</p><p><strong>检查方法：</strong></p><p>输入以下命令并检查相应的命令返回值是否为1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl kernel.kptr_restrict</span></span><br><span class="line">kernel.kptr_restrict = 1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>建议设置kptr_restrict的值为1：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo 1 &gt; /proc/sys/kernel/kptr_restrict</span></span><br></pre></td></tr></table></figure><p>或者修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl –p &#x2F;etc&#x2F;sysctl.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.kptr_restrict=1</span><br></pre></td></tr></table></figure><h3 id="3-5-4-确保内核SMAP已启用"><a href="#3-5-4-确保内核SMAP已启用" class="headerlink" title="3.5.4 确保内核SMAP已启用"></a>3.5.4 确保内核SMAP已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>内核参数SMAP(Supervisor Mode Access Prevention，管理模式访问保护)，开启后禁止内核访问用户空间的数据。若不开启SMAP内核参数，攻击者可以利用通过内核态代码重定向的方式访问用户空间数据，增加了攻击面降低了系统安全性。</p><p>openEuler默认开启SMAP。</p><p><strong>规则影响：</strong></p><p>内核不能访问用户空间数据。</p><p><strong>检查方法：</strong></p><p>输入以下命令并检查是否有返回值，如果有返回值则说明cpu支持SMAP，反之则说明不支持SMAP：<br>注：仅X86架构支持SMAP特性（物理机、虚拟机均支持），其他架构可忽略该项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cpuinfo | grep &quot;smap&quot;</span></span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology cpuid tsc_known_freq pni pclmulqdq vmx ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single pti tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid rdseed adx smap xsaveopt arat umip arch_capabilities</span><br></pre></td></tr></table></figure><p>通过检查启动参数检验是否开启SMAP，若有返回值则说明未开启，反之则说明开启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline | grep -i &quot;nosmap&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>若关闭了SMAP选项，需要编辑grub.cfg文件,在启动参数中删除nosmap选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/efi/EFI/openEuler/grub.cfg</span></span><br></pre></td></tr></table></figure><h3 id="3-5-5-确保内核SMEP已启用"><a href="#3-5-5-确保内核SMEP已启用" class="headerlink" title="3.5.5 确保内核SMEP已启用"></a>3.5.5 确保内核SMEP已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>内核参数SMEP(Supervisor Mode Execution Prevention，管理模式执行保护)，开启后禁止内核执行用户空间代码。若不开启SMEP内核参数，攻击者可以利用通过内核态代码重定向的方式执行用户空间代码，增加了攻击面降低了系统安全性。</p><p>openEuler默认开启SMEP。</p><p><strong>规则影响：</strong></p><p>内核不能执行用户空间代码。</p><p><strong>检查方法：</strong></p><p>输入以下命令并检查是否有返回值，如果有返回值则说明cpu支持SMEP，反之则说明不支持SMEP：<br>注：仅X86架构支持SMEP特性（物理机、虚拟机均支持），其他架构可忽略该项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cpuinfo | grep &quot;smep&quot;</span></span><br><span class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology cpuid tsc_known_freq pni pclmulqdq vmx ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single pti tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid rdseed adx smap xsaveopt arat umip arch_capabilities</span><br></pre></td></tr></table></figure><p>通过检查启动参数检验是否开启SMEP，若有返回值则说明未开启，反之则说明开启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline | grep -i &quot;nosmep&quot;</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>若关闭了SMEP选项，需要编辑grub.cfg文件,在启动参数中删除nosmep选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/efi/EFI/openEuler/grub.cfg</span></span><br></pre></td></tr></table></figure><h3 id="3-5-6-禁止系统响应ICMP广播报文"><a href="#3-5-6-禁止系统响应ICMP广播报文" class="headerlink" title="3.5.6 禁止系统响应ICMP广播报文"></a>3.5.6 禁止系统响应ICMP广播报文</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>ICMP是网络控制消息协议，主要用于传递查询报文与差错报文，通过设置是否接受ICMP广播报文对ICMP报文攻击进行防护。</p><p>该参数决定设备是否要回应ICMP echo消息和时间戳请求，对这些消息和请求来说，目的地址就是广播地址。无论是哪台设备发送的报文，报文都会发送到网络上的每一台设备上去。如果源地址是伪造的，就可能会导致网络上所有的设备发送恶意的echo报文给受害者（被伪造地址的设备）。</p><p><strong>规则影响：</strong></p><p>系统不响应ICMP广播报文。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查icmp_echo_ignore_broadcasts参数的返回值，如果icmp_echo_ignore_broadcasts参数返回值为1，表示系统禁止响应ICMP报文。如果icmp_echo_ignore_broadcasts参数返回值为0，表示系统未禁止响应ICMP报文。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.icmp_echo_ignore_broadcasts</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为1)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.icmp_echo_ignore_broadcasts&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts=1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入命令禁止系统响应ICMP广播报文：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.icmp_echo_ignore_broadcasts=1</span><br></pre></td></tr></table></figure><h3 id="3-5-7-禁止接收ICMP重定向报文"><a href="#3-5-7-禁止接收ICMP重定向报文" class="headerlink" title="3.5.7 禁止接收ICMP重定向报文"></a>3.5.7 禁止接收ICMP重定向报文</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>ICMP重定向消息是传递路由信息并告诉系统通过备用路径发送数据包。这是一种允许外部路由设备更新系统路由表的方法。通过将net.ipv4.conf.all.accept_redirects和net.ipv6.conf.all.accept_redirects设置为0，系统不会接受任何ICMP重定向报文。通过将net.ipv4.conf.all.secure_redirects和net.ipv4.conf.default.send_redirects设置为0，系统不会从网关接收ICMP重定向报文（IPv6无此配置项）。</p><p>攻击者可以利用伪造的ICMP重定向消息恶意更改系统路由表，使它们向错误的网络发送数据包，从而获取相应的敏感数据。</p><p><strong>规则影响：</strong></p><p>系统不接收ICMP重定向报文。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。输入命令查看返回值是否为0：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.accept_redirects &amp;&amp; sysctl net.ipv6.conf.all.accept_redirects &amp;&amp; sysctl net.ipv4.conf.all.secure_redirects &amp;&amp; sysctl net.ipv4.conf.default.secure_redirects</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = 0</span><br><span class="line">net.ipv6.conf.all.accept_redirects = 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects = 0</span><br><span class="line">net.ipv4.conf.default.seure_redirects = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为0)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.all.accept_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects=0</span><br><span class="line"><span class="comment"># grep &quot;net.ipv6.conf.all.accept_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv6.conf.all.accept_redirects=0</span><br><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.all.secure_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">/etc/sysctl.conf:net.ipv4.conf.all.secure_redirects=0</span><br><span class="line">/etc/sysctl.d/99-sysctl.conf:net.ipv4.conf.all.secure_redirects=0</span><br><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.default.secure_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">/etc/sysctl.conf:net.ipv4.conf.default.secure_redirects=0</span><br><span class="line">/etc/sysctl.d/99-sysctl.conf:net.ipv4.conf.default.secure_redirects=0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入命令禁止接收ICMP重定向报文：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.accept_redirects=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv6.conf.all.accept_redirects=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.secure_redirects=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.secure_redirects=0</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.accept_redirects=0</span><br><span class="line">net.ipv6.conf.all.accept_redirects=0</span><br><span class="line">net.ipv4.conf.all.secure_redirects=0</span><br><span class="line">net.ipv4.conf.default.secure_redirects=0</span><br></pre></td></tr></table></figure><h3 id="3-5-8-禁止转发ICMP重定向报文"><a href="#3-5-8-禁止转发ICMP重定向报文" class="headerlink" title="3.5.8 禁止转发ICMP重定向报文"></a>3.5.8 禁止转发ICMP重定向报文</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>ICMP重定向用于向其他主机发送路由信息。由于主机本身不充当路由器，因此没有必要转发ICMP重定向数据包。</p><p>攻击者可以利用受到攻击的主机向其他路由器设备发送无效的ICMP重定向，试图破坏路由，并让用户访问错误的系统。</p><p><strong>规则影响：</strong></p><p>系统不转发ICMP重定向报文。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查send_redirects参数的返回值，如果send_redirects参数返回值为1，表示系统转发ICMP重定向报文。如果send_redirects参数返回值为0，表示系统不转发ICMP重定向报文。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.send_redirects</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv4.conf.default.send_redirects</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为0)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.all.send_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.conf.all.send_redirects=0</span><br><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.default.send_redirects&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.conf.default.send_redirects=0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入命令禁止转发ICMP重定向报文：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.send_redirects=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.send_redirects=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.route.flush=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.send_redirects=0</span><br><span class="line">net.ipv4.conf.default.send_redirects=0</span><br></pre></td></tr></table></figure><h3 id="3-5-9-应当忽略所有ICMP请求"><a href="#3-5-9-应当忽略所有ICMP请求" class="headerlink" title="3.5.9 应当忽略所有ICMP请求"></a>3.5.9 应当忽略所有ICMP请求</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>通过忽略所有ICMP请求，禁止外界通过ping命令访问系统。</p><p>攻击者可以通过ping命令的返回来感知系统所处的网址位置。</p><p><strong>规则影响：</strong></p><p>系统忽略所有ICMP请求。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查icmp_echo_ignore_all参数的返回值，如果icmp_echo_ignore_all参数返回值为1，表示系统忽略所有ICMP请求。如果icmp_echo_ignore_all参数返回值为0，表示系统响应ICMP请求。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.icmp_echo_ignore_all</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为0)，建议用户在配置文件中添加正确配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.icmp_echo_ignore_all&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入命令禁止转发ICMP重定向报文：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.icmp_echo_ignore_all=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.icmp_echo_ignore_all=1</span><br></pre></td></tr></table></figure><h3 id="3-5-10-确保丢弃伪造的ICMP报文，不记录日志"><a href="#3-5-10-确保丢弃伪造的ICMP报文，不记录日志" class="headerlink" title="3.5.10 确保丢弃伪造的ICMP报文，不记录日志"></a>3.5.10 确保丢弃伪造的ICMP报文，不记录日志</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>将icmp_ignore_bogus_error_responses设置为1可以防止内核记录广播重复数据包的响应，从而避免文件系统填充无用的日志信息。</p><p>一些攻击者会发送违反RFC-1122的ICMP报文，并试图用大量无用的错误信息填充日志文件系统。</p><p><strong>规则影响：</strong></p><p>系统丢弃伪造的ICMP报文，不记录日志</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查icmp_ignore_bogus_error_responses参数的返回值，如果icmp_ignore_bogus_error_responses参数返回值为1，表示系统忽略ICMP错误响应。如果icmp_ignore_bogus_error_responses参数返回值为0，表示系统处理ICMP错误响应。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.icmp_ignore_bogus_error_responses</span></span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为1)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.icmp_ignore_bogus_error_responses&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入丢弃伪造的ICMP报文规则的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.route.flush=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br></pre></td></tr></table></figure><h3 id="3-5-11-确保反向地址过滤已启用"><a href="#3-5-11-确保反向地址过滤已启用" class="headerlink" title="3.5.11 确保反向地址过滤已启用"></a>3.5.11 确保反向地址过滤已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>将net.ipv4.conf.all.rp_filter和net.ipv4.conf.default.rp_filter设置为1，强制Linux内核对接收到的数据包使用反向路径过滤，检查报文源地址的合法性，如果反查源地址的路由表，发现源地址下一跳的最佳出接口并不是收到报文的入接口，则将报文丢弃。</p><p>攻击者可以实施IP地址欺骗，在目前网络攻击中使用比较多。通过反向地址过滤在收到数据包时，取出源IP地址，然后查看该路由器的路由表中是否有该数据包的路由信息。如果路由表中没有其用于数据返回的路由信息，那么极有可能是某人伪造了该数据包，于是路由便把它丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令，检查rp_filter参数的返回值是否为1。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.rp_filter</span></span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line"><span class="comment"># sysctl net.ipv4.conf.default.rp_filter</span></span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为1)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.all.rp_filter&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line"><span class="comment"># grep &quot;net.ipv4.conf.default.rp_filter&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入启用反向地址过滤的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.rp_filter=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.rp_filter=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.route.flush=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.rp_filter = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br></pre></td></tr></table></figure><h3 id="3-5-12-禁止IP转发"><a href="#3-5-12-禁止IP转发" class="headerlink" title="3.5.12 禁止IP转发"></a>3.5.12 禁止IP转发</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>如果该结点不作为网关服务器，则应禁用IP转发功能。否则攻击者可将此系统作为路由器使用。</p><p>对于容器场景，如果容器内部需要通过宿主机转发网络报文，则可以例外。</p><p><strong>规则影响：</strong></p><p>系统不允许IP转发</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查ip_forward参数的返回值，如果ip_forward参数返回值为0，表示禁用IP转发。如果ip_forward参数返回值为1，表示启用IP转发。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.ip_forward</span></span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv6.conf.all.forwarding</span></span><br><span class="line">net.ipv6.conf.all.forwarding = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置(值为0)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -E -s &quot;^\s*net\.ipv4\.ip_forward\s*=\s*1&quot; /etc/sysctl.conf /etc/sysctl.d/*.conf /usr/lib/sysctl.d/*.conf /run/sysctl.d/*.conf</span></span><br><span class="line">无任何输出</span><br><span class="line"><span class="comment"># grep -E -s &quot;^\s*net\.ipv6\.conf\.all\.forwarding\s*=\s*1&quot; /etc/sysctl.conf /etc/sysctl.d/*.conf /usr/lib/sysctl.d/*.conf /run/sysctl.d/*.conf</span></span><br><span class="line">无任何输出</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入禁止IP转发的命令并修改配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -Els &quot;^\s*net\.ipv4\.ip_forward\s*=\s*1&quot; /etc/sysctl.conf /etc/sysctl.d/*.conf /usr/lib/sysctl.d/*.conf /run/sysctl.d/*.conf | while read filename; do sed -ri &quot;s/^\s*(net\.ipv4\.ip_forward\s*)(=)(\s*\S+\b).*$/# *REMOVED* \1/&quot; $filename; done; sysctl -w net.ipv4.ip_forward=0; sysctl -w net.ipv4.route.flush=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep -Els &quot;^\s*net\.ipv6\.conf\.all\.forwarding\s*=\s*1&quot; /etc/sysctl.conf /etc/sysctl.d/*.conf /usr/lib/sysctl.d/*.conf /run/sysctl.d/*.conf | while read filename; do sed -ri &quot;s/^\s*(net\.ipv6\.conf\.all\.forwarding\s*)(=)(\s*\S+\b).*$/# *REMOVED* \1/&quot; $filename; done; sysctl -w net.ipv6.conf.all.forwarding=0; sysctl -w net.ipv6.route.flush=1</span></span><br></pre></td></tr></table></figure><h3 id="3-5-13-禁止报文源路由"><a href="#3-5-13-禁止报文源路由" class="headerlink" title="3.5.13 禁止报文源路由"></a>3.5.13 禁止报文源路由</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong></p><p>在网络中，源路由允许发送方部分或全部指定数据包通过网络的路由，而常规路由中，网络中的路由器根据数据包的目的地确定路径。大量报文被篡改后通过指定路由，则可以对内部网络进行定向攻击，可导致指定路由器负载过高，正常业务流量中断。</p><p>攻击者可以伪造一些合法的IP地址，通过合适的设置源路由选项及合法的路由器，蒙混进入网络。另外，如果允许源路由数据包，则通过构造中间路由地址，可以用于访问专用地址系统；如果攻击者对原始报文截取，并利用源路由进行地址欺骗，则可以强制指定回传的报文都通过攻击者的设备进行路由返回，这样攻击者就可以成功接收到双向的数据包。所以，应禁用报文源路由，减小攻击面。</p><p><strong>规则影响：</strong></p><p>系统禁用报文源路由</p><p><strong>检查方法：</strong></p><p>输入以下命令并检查相应的命令返回，如果返回值不为0，建议修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.accept_source_route</span></span><br><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv4.conf.default.accept_source_route</span></span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv6.conf.all.accept_source_route</span></span><br><span class="line">net.ipv6.conf.all.accept_source_route = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv6.conf.default.accept_source_route</span></span><br><span class="line">net.ipv6.conf.default.accept_source_route = 0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>输入禁止报文源路由的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.accept_source_route=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.accept_source_route=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv6.conf.all.accept_source_route=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv6.conf.default.accept_source_route=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.route.flush=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv6.route.flush=1</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv6.conf.all.accept_source_route = 0</span><br><span class="line">net.ipv6.conf.default.accept_source_route = 0</span><br></pre></td></tr></table></figure><h3 id="3-5-14-确保TCP-SYN-cookie保护已启用"><a href="#3-5-14-确保TCP-SYN-cookie保护已启用" class="headerlink" title="3.5.14 确保TCP-SYN cookie保护已启用"></a>3.5.14 确保TCP-SYN cookie保护已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>TCP-SYN cookie保护减轻了系统在遭受SYN Flooding攻击时受到的影响。</p><p>攻击者使用SYN泛洪攻击时，快速耗尽内核中半开连接队列，阻止合法连接。但启用SYN cookie，即使受到拒绝服务攻击仍允许系统继续接受合法连接。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查tcp_syncookies参数的返回值，如果tcp_syncookies参数返回值为1，表示启用TCP-SYN cookie保护机制。如果tcp_syncookies参数返回值为0，表示未启用TCP-SYN cookie保护机制。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.tcp_syncookies</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（值为1）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.tcp_syncookies&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.tcp_syncookies=1</span><br><span class="line">/etc/sysctl.d/99-sysctl.conf:net.ipv4.tcp_syncookies=1</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>启用保护，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.tcp_syncookies=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.route.flush=1</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_syncookies=1</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-15-应当记录仿冒、源路由以及重定向报文日志"><a href="#3-5-15-应当记录仿冒、源路由以及重定向报文日志" class="headerlink" title="3.5.15 应当记录仿冒、源路由以及重定向报文日志"></a>3.5.15 应当记录仿冒、源路由以及重定向报文日志</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>记录欺骗的包、源路由包和发给系统的重定向包有助于发现攻击源与制定防护措施。</p><p><strong>规则影响：</strong></p><p>开启后会记录带有不允许的地址的数据到内核日志中，存在冲日志风险。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令并检查log_martians参数的返回值，如果log_martians参数返回值为1，表示开启记录仿冒、源路由以及重定向报文日志。如果log_martians参数返回值为0，表示系统关闭记录机制。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.log_martians</span></span><br><span class="line">net.ipv4.conf.all.log_martians = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv4.conf.default.log_martians</span></span><br><span class="line">net.ipv4.conf.default.log_martians = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为1，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（值为0），建议用户在配置文件中添加正确配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.conf.all.log_martians&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line"><span class="comment"># grep &quot;^net.ipv4.conf.default.log_martians&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>打开记录，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.log_martians=1</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.log_martians=1</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.log_martians=1</span><br><span class="line">net.ipv4.conf.default.log_martians=1</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-16-避免开启tcp-timestamps"><a href="#3-5-16-避免开启tcp-timestamps" class="headerlink" title="3.5.16 避免开启tcp_timestamps"></a>3.5.16 避免开启tcp_timestamps</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>tcp_timestamps用于记录TCP数据包的发送时间，可用于RTT测量（RTTM）和保护序号绕回（PAWS），是一个双向的选项，只有在客户端和服务端同时启用时才使能。启用该选项可能遭受拒绝服务攻击。</p><p><strong>规则影响：</strong></p><p>关闭此项会影响TCP在极端情况下超时重传的可靠性。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置，执行以下命令并检查tcp_timestamps参数的返回值，如果tcp_timestamps参数返回值为1，表示开启tcp_timestamps机制。如果参数返回值为0，表示关闭tcp_timestamps机制。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.tcp_timestamps</span></span><br><span class="line">net.ipv4.tcp_timestamps = 1</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（默认值为1），建议用户在配置文件中添加正确配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.tcp_timestamps&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>关闭tcp_timestamps，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.tcp_timestamps=0</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_timestamps=0</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-17-确保TIME-WAIT-TCP协议等待时间已配置"><a href="#3-5-17-确保TIME-WAIT-TCP协议等待时间已配置" class="headerlink" title="3.5.17 确保TIME_WAIT TCP协议等待时间已配置"></a>3.5.17 确保TIME_WAIT TCP协议等待时间已配置</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>TIME_WAIT是TCP协议等待连接销毁的时间，设置过长会导致存在大量未关闭的TCP连接，导致遭受拒绝服务攻击，建议配置不大于60。</p><p><strong>规则影响：</strong></p><p>TIME_WAIT时间设置过长会导致遭受拒绝服务攻击</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核中TIME_WAIT值的设置，执行以下命令并检查tcp_fin_timeout参数的返回值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.tcp_fin_timeout</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = 60</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值与内核参数不一致，建议根据需求进行修改。如果返回值为空，表示系统使用默认配置（默认值为60）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.tcp_fin_timeout&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>设置TIME_WAIT tcp协议等待时间，建议不大于60，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.tcp_fin_timeout=60</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_fin_timeout=60</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-18-应当正确配置SYN-RECV状态队列数量"><a href="#3-5-18-应当正确配置SYN-RECV状态队列数量" class="headerlink" title="3.5.18 应当正确配置SYN_RECV状态队列数量"></a>3.5.18 应当正确配置SYN_RECV状态队列数量</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SYN_RECV队列保存尚未获得对方确认的TCP连接请求，值越大表示可以容纳更多等待连接的网络连接数。如果配置值太小，容易被TCP SYN泛洪攻击，导致正常连接被拒绝服务；配置太大，则会消耗更多系统资源。建议队列数量设置为256。</p><p><strong>规则影响：</strong></p><p>从安全角度，建议配置较大值以消减TCP SYN泛洪攻击，但配置太大，则会消耗更多系统资源，对内存较小环境，可能会影响正常业务。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核中SYN_RECV队列数量的设置，执行以下命令并检查tcp_fin_timeout参数的返回值。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.tcp_max_syn_backlog</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 256</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值与内核参数不一致，建议根据需求进行修改。如果返回值为空，表示系统使用默认配置（默认值为256）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.tcp_max_syn_backlog&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog=256</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>设置SYN_RECV状态队列数量，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.tcp_max_syn_backlog=256</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_max_syn_backlog=256</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-19-禁止使用ARP代理"><a href="#3-5-19-禁止使用ARP代理" class="headerlink" title="3.5.19 禁止使用ARP代理"></a>3.5.19 禁止使用ARP代理</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>ARP代理允许系统代表连接到某个接口的主机向另一个接口上的ARP请求发送响应。禁用ARP代理不仅可以防止未经授权的信息共享还可以防止连接的网络区段之间寻址信息泄露。所以应关闭ARP代理以避免ARP报文攻击对系统造成影响。</p><p>openEuler默认禁止使用ARP代理，用户可根据业务需求进行配置。</p><p><strong>规则影响：</strong></p><p>依赖于ARP代理的程序执行受限制</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置，执行以下命令并检查proxy_arp参数的返回值，如果proxy_arp参数返回值为1，表示开启ARP代理。如果proxy_arp参数返回值为0，表示禁止使用ARP代理。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl net.ipv4.conf.all.proxy_arp</span></span><br><span class="line">net.ipv4.conf.all.proxy_arp = 0</span><br><span class="line"><span class="comment"># sysctl net.ipv4.conf.default.proxy_arp</span></span><br><span class="line">net.ipv4.conf.default.proxy_arp = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（值为0）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^net.ipv4.conf.all.proxy_arp&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line"><span class="comment"># grep &quot;^net.ipv4.conf.default.proxy_arp&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>关闭ARP代理的命令，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.all.proxy_arp=0</span></span><br><span class="line"><span class="comment"># sysctl -w net.ipv4.conf.default.proxy_arp=0</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.conf.all.proxy_arp=0</span><br><span class="line">net.ipv4.conf.default.proxy_arp=0</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-20-确保core-dump配置正确"><a href="#3-5-20-确保core-dump配置正确" class="headerlink" title="3.5.20 确保core dump配置正确"></a>3.5.20 确保core dump配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>Core dump是当程序运行过程中异常终止或崩溃时，把内存状态记录下来的行为，有助于事后定位，但可能会包含进程内存里的敏感信息。有时用户需要开启core dump功能记录当时产生问题的原因，对于需要开启core dump功能的用户需对日志输入的路径进行限制，同时需限制路径只允许特定用户访问。</p><p>启用core dump有助于程序异常终止或崩溃的事后定位，但容易泄露内存中的敏感信息。openEuler默认打开，用户需要根据业务场景，关闭core dump或对日志输入的路径和访问用户进行限制。</p><p><strong>规则影响：</strong></p><p>关闭core dump后，程序异常时缺少日志记录，不利于问题定位。</p><p><strong>检查方法：</strong></p><ul><li><p>禁用场景的检查方法：</p><p>输入以下命令并检查相应的命令返回：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -c</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>或者检查文件&#x2F;etc&#x2F;security&#x2F;limits.conf，是否包含配置行“* hard core 0”。</p></li><li><p>限制场景的检查方法：</p><p>执行以下脚本成功返回（无内容输出），表示已限制了core dump目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash  </span></span><br><span class="line">core_path=$(sysctl kernel.core_pattern | awk -F<span class="string">&quot;^[[:space:]]*kernel.core_pattern[[:space:]]*=[[:space:]]*&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$&#123;core_path&#125;</span>&quot;</span> =~ ^/.+ ]] || &#123; <span class="built_in">echo</span> <span class="string">&quot;kernel.core_pattern[<span class="variable">$&#123;core_path&#125;</span>] must be started with /&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line">core_dir=$(<span class="built_in">dirname</span> <span class="string">&quot;<span class="variable">$&#123;core_path&#125;</span>&quot;</span>)</span><br><span class="line">[[ -d <span class="string">&quot;<span class="variable">$&#123;core_dir&#125;</span>&quot;</span> ]] || &#123; <span class="built_in">echo</span> <span class="string">&quot;kernel.core_pattern dir[<span class="variable">$&#123;core_dir&#125;</span>] not exist&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line">rights_digit=$(<span class="built_in">stat</span> -c%a <span class="string">&quot;<span class="variable">$&#123;core_dir&#125;</span>&quot;</span>)</span><br><span class="line">[[ <span class="string">&quot;<span class="variable">$&#123;rights_digit&#125;</span>&quot;</span> =~ ^700$ || <span class="string">&quot;<span class="variable">$&#123;rights_digit&#125;</span>&quot;</span> =~ ^1770$ || <span class="string">&quot;<span class="variable">$&#123;rights_digit&#125;</span>&quot;</span> =~ ^1777$ ]] || &#123; <span class="built_in">echo</span> <span class="string">&quot;rights[<span class="variable">$&#123;rights_digit&#125;</span>] of dir[<span class="variable">$&#123;core_dir&#125;</span>] not safe, must be 700 or 1770 or 1777&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>禁用方法</p><p>使用如下命令对当前会话禁止系统支持生成core dump</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -c 0</span></span><br></pre></td></tr></table></figure><p>修改&#x2F;etc&#x2F;security&#x2F;limits.conf文件，添加或修改配置，使其永久生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* hard core 0</span><br></pre></td></tr></table></figure></li><li><p>限制使用方法：<br>1、ulimit -c不为0，比如：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ulimit -c 10485760</span></span><br></pre></td></tr></table></figure><p>2、设置core dump日志文件保存位置和文件格式<br>  通过修改&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_pattern可以控制core dump日志文件保存位置和文件格式。<br>  下例为将所有的core dump日志文件生成到&#x2F;corefiles目录下（绝对路径），文件名的格式为core-命令名-pid-时间戳：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl &quot;kernel.core_pattern=/corefiles/core-%e-%p-%t&quot;</span></span><br></pre></td></tr></table></figure><p>  修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.core_pattern=/corefiles/core-%e-%p-%t</span><br></pre></td></tr></table></figure><p>  建议为&#x2F;corefiles建立独立分区，禁止&#x2F;corefiles目录占用系统分区或业务分区，避免因为core dump日志文件过多导致分区满而影响系统运行或业务运行。</p><p>3、限制目录访问权限：<br>  可根据业务需要限制目录的访问用户范围。<br>  a、限制单个用户（比如admin）访问</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown admin /corefiles</span></span><br><span class="line"><span class="comment"># chmod 700 /corefiles</span></span><br></pre></td></tr></table></figure><p>  b、使用粘滞位保护技术，限制同组用户（比如core_group）访问</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown root:core_group /corefiles</span></span><br><span class="line"><span class="comment"># chmod 1770 /corefiles</span></span><br></pre></td></tr></table></figure><p>  c、使用粘滞位保护技术，限制所有用户访问：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown root:root /corefiles</span></span><br><span class="line"><span class="comment"># chmod 1777 /corefiles</span></span><br></pre></td></tr></table></figure><p>  注：粘滞位对目录的作用，使得目录下A用户不能访问B用户的文件，除非B用户的文件权限允许A用户访问。</p><p>4、建议禁止setuid的应用支持生成core dump：<br>  使用如下命令对当前运行系统禁止setuid的应用支持生成core dump</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w &quot;fs.suid_dumpable=0&quot;</span></span><br></pre></td></tr></table></figure><p>  修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，使其永久生效</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.suid_dumpable=0</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-21-禁止使用SysRq键"><a href="#3-5-21-禁止使用SysRq键" class="headerlink" title="3.5.21 禁止使用SysRq键"></a>3.5.21 禁止使用SysRq键</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SysRq使得具有物理访问的用户能够访问计算机中危险的系统级命令，需要对SysRq的功能使用进行限制。</p><p>如果没有禁用SysRq键，则可以通过键盘触发SysRq的调用，可能造成直接发送命令到内核，对系统造成影响。</p><p>openEuler默认禁止使用SysRq键。</p><p><strong>规则影响：</strong></p><p>系统下sysRq相关命令无法使用</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置。执行以下命令，如果sysrq参数返回值为0，表示禁用SysRq键。否则，表示配置不正确，建议修改配置文件内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/sys/kernel/sysrq</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为0，表示配置不正确，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（值为0）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^kernel.sysrq&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br><span class="line">/etc/sysctl.conf:kernel.sysrq=0</span><br><span class="line">/etc/sysctl.d/99-sysctl.conf:kernel.sysrq=0</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>禁用SysRq，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo 0 &gt; /proc/sys/kernel/sysrq</span></span><br></pre></td></tr></table></figure><p>  或</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w kernel.sysrq=0</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.sysrq=0</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-22-应当正确配置内核参数ptrace-scope"><a href="#3-5-22-应当正确配置内核参数ptrace-scope" class="headerlink" title="3.5.22 应当正确配置内核参数ptrace_scope"></a>3.5.22 应当正确配置内核参数ptrace_scope</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>ptrace是一种系统调用用于进程跟踪，提供了父进程可以观察并控制子进程的能力。Linux Kernel 3.4以及更高版本支持完全限制或禁用ptrace功能，根据Linux Kernel Yama Documentation，ptrace_scope可以选择如下参数：</p><p>0：进程可以将PTRACE_ATTACH传递给任何其他进程，只要它是可转储的（即没有转换uid，没有特权启动或没有调用prctl）。</p><p>1：进程如果要调用PTRACE_ATTACH，必须有预先的定义关系。默认情况下满足上述条件时，预定义的关系仅为子进程的关系。若要改变关系，子进程可以调用prctl调整这种关系。</p><p>2：只有具有CAP_SYS_PTRACE的进程通过PTRACE_ATTACH或通过子进程调用PTRACE_TRACEME才能使用ptrace。</p><p>3：任何进程都不能将ptrace与PTRACE_ATTACH一起使用，也不能通过PTRACE_TRACEME使用。</p><p>openEuler默认参数为0，用户可根据实际使用场景进行配置，建议配置值为2。</p><p><strong>规则影响：</strong></p><p>该参数的配置将影响ptrace的使用，当配置参数为2时，只有CAP_SYS_PTRACE的进程才能使用ptrace，这样会有效防止攻击者恶意提权，但同时会导致用户ptrace部分功能受到影响。</p><p><strong>检查方法：</strong></p><p>首先，检查当前系统内核参数的设置，执行以下命令并检查log_martians参数的返回值与业务场景需求是否一致。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl kernel.yama.ptrace_scope</span></span><br><span class="line">kernel.yama.ptrace_scope = 0</span><br></pre></td></tr></table></figure><p>其次，执行如下命令，如果返回值不为2，建议修改配置文件内容。如果返回值为空，表示系统使用默认配置（值为0），建议用户在配置文件中添加正确配置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^kernel.yama.ptrace_scope&quot; /etc/sysctl.conf /etc/sysctl.d/*</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>设置ptrace_scope的值，可使用如下命令临时设置，重启后恢复默认值：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo 2 &gt; /proc/sys/kernel/yama/ptrace_scope</span></span><br></pre></td></tr></table></figure><p>  或</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -w kernel.randomize_va_space=2</span></span><br></pre></td></tr></table></figure></li><li><p>修改&#x2F;etc&#x2F;sysctl.conf文件，添加或修改配置，并执行# sysctl -p &#x2F;etc&#x2F;sysctl.conf，使其永久生效：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.yama.ptrace_scope=2</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-5-23-应当启用seccomp"><a href="#3-5-23-应当启用seccomp" class="headerlink" title="3.5.23 应当启用seccomp"></a>3.5.23 应当启用seccomp</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>seccomp（全称：secure computing mode），在刚引入linux内核时，将进程可用的系统调用限制为四种：read，write，_exit，sigreturn。最初的这种白名单方式，除了已打开的文件描述符允许的四种系统调用，如果尝试其他系统调用，内核就会使用SIGKILL或SIGSYS终止该进程。</p><p>白名单方式由于限制太强，实际作用并不大，在实际应用中需要更加精细的限制，为了解决此问题，引入了BPF。seccomp和BPF规则的结合，它允许用户使用可配置的策略过滤系统调用，该策略使用Berkeley Packet Filter规则实现，它可以对任意系统调用及其参数进行过滤。</p><p>openEuler内核默认已经提供seccomp功能支持，同时提供了libseccomp外围包，帮助用户态程序可以方便的设置seccomp规则。</p><p><strong>规则影响：</strong></p><p>seccomp并不能全局设置启闭或规则，而是针对于每一个进程的，也就是进程可以自己设置启用seccomp，作用于自身以及所有子线程，但不影响其他进程。</p><p>如果进程启用了seccomp，在进行系统调用时会有性能损失，用户需要根据实际业务场景确定性能损失是否可接受。</p><p><strong>检查方法：</strong></p><p>检查目标进程是否启用了seccomp模式，此处以检查test_seccomp进程为例，首先确定进程号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -aux | grep &quot;test_seccomp&quot; </span></span><br><span class="line">root  [PID_num]  0.0  0.0   2688   976 pts/0    S    12:35   0:00 ./test_seccomp</span><br></pre></td></tr></table></figure><p>根据获取的pid号查询进程是否启用了seccomp功能，若返回值为0代表未开启seccomp功能，1代表开启seccomp STRICT模式，2则代表该进程启用了seccomp FILTER模式。如果用户需要开启seccomp FILTER模式，则建议用户根据实际业务场景设置合理的规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/[pid]/status | grep &quot;Seccomp&quot;</span></span><br><span class="line">Seccomp:        2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>可以在业务进程中通过调用libseccomp接口进行seccomp相关规则的配置，具体配置方法，可以参考libseccomp的开源帮助文档。</p><h2 id="3-6-时间同步"><a href="#3-6-时间同步" class="headerlink" title="3.6 时间同步"></a>3.6 时间同步</h2><h3 id="3-6-1-应当正确配置ntpd服务"><a href="#3-6-1-应当正确配置ntpd服务" class="headerlink" title="3.6.1 应当正确配置ntpd服务"></a>3.6.1 应当正确配置ntpd服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>集群场景下，服务器时间是否准确、是否一致比较关键。例如当时间不一致时，可能会导致不同服务器间产生的数据，在根据时间进行排序或比较时，产生的结果不准确。</p><p>即使我们在初始时使用date命令把所有服务器时间配置成一致的，随着时间的推移，服务器的时间还是会出现不准确、不一致。所以为保证环境中所有机器的时间同步且准确，必须有一个可以同步的时间服务器，网络内的其他服务器都向该服务器进行时间同步。</p><p>当使用ntpd服务实现时间同步时，如果没有正确配置ntpd服务，则服务器时间可能不准确，导致不同服务器间的时间可能不一致。</p><p>服务器时间不准确时，对于类似财务、订单等时间敏感的数据会有很大问题。例如因为时间不准确可能导致一笔记账数据落在了错误的财务周期，从而导致资产负债表期末余额不平。</p><p>服务器之间的时间不一致时，每个主机产生的报文的时间就存在偏差，如果多个服务器间数据流存在一定处理顺序，后一个环节的服务器时间小于前一个服务器的时间时，可能会导致收到的报文因为时间大于本地时间而丢弃。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>检查ntpd服务是否启动，Active字段返回“active (running)”表示服务已经启动，返回“inactive (dead)”表示未启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ntpd status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">   Active: inactive (dead)</span><br></pre></td></tr></table></figure></li><li><p>通过grep命令查看&#x2F;etc&#x2F;ntp.conf中restrict的配置，获取ntp权限控制配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^restrict&quot; /etc/ntp.conf </span></span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br></pre></td></tr></table></figure></li><li><p>通过grep命令查看&#x2F;etc&#x2F;ntp.conf中server|pool的配置（<IP or domain name>表示具体的服务器IP或域名），获取ntp服务器配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -E &quot;^(server|pool)&quot; /etc/ntp.conf</span></span><br><span class="line">server &lt;IP or domain name&gt; iburst</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>将本机配置为时间源，在&#x2F;etc&#x2F;ntp.conf文件中增加ntp权限控制配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ntp.conf </span></span><br><span class="line">restrict &lt;IP or netmask_IP&gt; &lt;parameter&gt;</span><br></pre></td></tr></table></figure><ul><li>IP or netmask_IP：权限控制的IP地址，可以是default表示所有IP；可以是不带mask的某一个具体IP地址，例如“192.168.1.2”；也可以是IP+mask表示某一段IP地址，例如“192.168.0.0 mask 255.255.255.0”，表示192.168.0.1至192.168.0.154的所有地址的服务器都可以连接本服务器获取ntp服务。</li><li>Parameter：权限控制的具体参数。</li></ul><p>例如：restrict default nomodify notrap nopeer noquery，表示允许所有IP地址的服务器与本机时间源进行时间同步，但不允许在此系统上查询或修改服务。</p></li><li><p>本机作为客户端，配置时间源服务器（remote-server为远端时间源服务器地址），在&#x2F;etc&#x2F;ntp.conf文件中增加配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/ntp.conf </span></span><br><span class="line">server &lt;remote-server&gt;</span><br></pre></td></tr></table></figure></li><li><p>在进行前两项配置后（可以同时配置，既作为客户端从远端服务器获取授时，也作为服务端，给其他服务器授时），使用service ntpd restart命令重启ntpd服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service ntpd restart</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="3-6-2-应当正确配置chronyd服务"><a href="#3-6-2-应当正确配置chronyd服务" class="headerlink" title="3.6.2 应当正确配置chronyd服务"></a>3.6.2 应当正确配置chronyd服务</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>授时服务器配置不正确，可能导致本地服务器时间同周边其他服务器不同步，同标准时间不同步，对于一些强依赖于时间同步的服务，如市场交易等，可能造成业务中断、错误，甚至被攻击者利用时间差进行数据篡改、伪造。</p><p>chrony是一个开源的自由软件，同传统NTP服务一样，它能保持系统时钟与授时服务器同步，让时间保持精确，由两个程序组成：chronyd和chronyc。</p><p>chronyd是一个后台运行的守护进程，用于调整内核中运行的系统时钟和授时服务器同步，它确定计算机增减时间的比率，并对此进行补偿。</p><p>chronyc提供了一个用户界面，用于监控性能并进行多样化的配置，它可以在运行chronyd服务的计算机上工作，也可以在一台不同的远程计算机上工作。</p><p>如果根据业务场景选择使用chronyd作为时间同步服务，需正确配置远端授时服务器并启用chronyd服务。</p><p>chrony同NTP可互相替换，openEuler默认启用chronyd服务。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>使用grep命令查看&#x2F;etc&#x2F;chrony.conf文件中是否正确配置了授时服务器地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^server\|^pool&quot; /etc/chrony.conf</span></span><br><span class="line">server &lt;IP address&gt;</span><br><span class="line">pool &lt;IP address&gt;</span><br></pre></td></tr></table></figure></li><li><p>使用ps命令查看是否已启动chronyd服务，如果返回“&#x2F;usr&#x2F;sbin&#x2F;chronyd”进程，表示已经启动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps -ef | grep chronyd</span></span><br><span class="line">chrony   1569550       1  0 18:39 ?        00:00:00 /usr/sbin/chronyd</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>修改&#x2F;etc&#x2F;chrony.conf文件，在pool或server字段添加正确的授时服务器地址，如果有多个授时服务器，可以按照优先顺序配置多条：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/chrony.conf</span></span><br><span class="line">server &lt;IP address&gt;</span><br><span class="line">server &lt;IP address&gt;</span><br></pre></td></tr></table></figure></li><li><p>使用service命令启动chronyd服务，并查看服务启动状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service chronyd start</span></span><br><span class="line">Redirecting to /bin/systemctl start chronyd.service</span><br><span class="line"><span class="comment"># service chronyd status 2&gt;&amp;1 | grep Active</span></span><br><span class="line">   Active: active (running) since Tue 2020-12-01 14:47:49 CST; 1min 6s ago</span><br></pre></td></tr></table></figure></li></ul><h2 id="4-日志审计"><a href="#4-日志审计" class="headerlink" title="4 日志审计"></a>4 日志审计</h2><h2 id="4-1-Audit"><a href="#4-1-Audit" class="headerlink" title="4.1 Audit"></a>4.1 Audit</h2><h3 id="4-1-1-确保auditd审计已启用"><a href="#4-1-1-确保auditd审计已启用" class="headerlink" title="4.1.1 确保auditd审计已启用"></a>4.1.1 确保auditd审计已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>auditd组件是Linux审计框架的用户空间组件，auditd组件提供了auditctl、ausearch、aureport三个程序完成审计和查看日志功能。配置审计规则是通过auditctl程序完成的，该程序启动时从&#x2F;etc&#x2F;audit&#x2F;audit.rules读取这些规则。后台程序本身可以通过设置&#x2F;etc&#x2F;audit&#x2F;auditd.conf 文件来进行定制。其他两个组件分别是audispd和autrace。audispd用于给其他应用发送事件通知，而autrace则通过与strace类似的方式对系统调用进行追踪。系统中一些文件是非常重要的，是不可以轻意修改的，对于这类文件使用auditd组件对其进行审计是非常有必要的。</p><p>openEuler默认要求启用audit审计功能。</p><p><strong>规则影响：</strong> </p><p>审计系统提供了一种记录系统安全信息的方法，为系统管理员在用户违反系统规则时提供及时的警告信息，但启用后对性能有一定影响。</p><p><strong>检查方法：</strong></p><p>执行如下命令，查看auditd.service服务默认状态是否为enable</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled auditd.service</span></span><br><span class="line">enabled</span><br></pre></td></tr></table></figure><p>执行如下命令，查看auditd.service服务当前是否已经启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl status auditd.service | grep active</span></span><br><span class="line">Active: active (running) since Fri 2023-10-13 08:00:00 CST; 2 days ago</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>使能并启动auditd.service：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable auditd.service</span></span><br><span class="line"><span class="comment"># systemctl start auditd.service</span></span><br></pre></td></tr></table></figure><h3 id="4-1-2-确保审计日志rotate已启用"><a href="#4-1-2-确保审计日志rotate已启用" class="headerlink" title="4.1.2 确保审计日志rotate已启用"></a>4.1.2 确保审计日志rotate已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>max_log_file_action用于配置日志文件到达大小上限时该如何处理，openEuler默认配置ROTATE，表示单个文件写满后会重新创建日志文件进行记录，不会删除原先的日志文件。</p><p>num_logs表示基于ROTATE机制，最多可以创建多少个日志文件，如果日志文件数量达到上限，则会依次覆盖最早创建的文件。openEuler默认配置为5。</p><p>num_logs取值范围为0~99，其中0和1表示不做rotate。</p><p>max_log_file_action一共有5种可选配置项：</p><p>IGNORE：表示忽略日志文件大小上限，继续在该文件上记录日志。</p><p>SYSLOG：同IGNORE类似，只是达到上限时会记录一条syslog日志。</p><p>SUSPEND：达到日志文件大小上限，auditd服务进程停止日志记录。</p><p>ROTATE：达到日志文件大小上限，新建日志文件继续记录，如果文件数达到num_logs，则覆盖旧文件。</p><p>KEEP_LOGS：同ROTATE类似，只是不受num_logs限制，会一直新建文件。</p><p><strong>规则影响：</strong></p><p>rotate会按照配置，在日志文件达到写入上限之后依次覆盖最早创建的文件。</p><p><strong>检查方法：</strong></p><p>使用如下命令检查当前配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -iE &quot;max_log_file_action|num_logs&quot; /etc/audit/auditd.conf</span></span><br><span class="line">num_logs = 5</span><br><span class="line">max_log_file_action = ROTATE</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;audit&#x2F;auditd.conf文件中max_log_file_action和num_logs字段的值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/auditd.conf</span></span><br><span class="line">num_logs = &lt;file numbers&gt;</span><br><span class="line">max_log_file_action = &lt;action <span class="built_in">type</span>&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-3-应当配置登录审计规则"><a href="#4-1-3-应当配置登录审计规则" class="headerlink" title="4.1.3 应当配置登录审计规则"></a>4.1.3 应当配置登录审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>用户成功登录时会在&#x2F;var&#x2F;log&#x2F;lastlog文件中刷新记录，所以只要对该文件进行审计监控，就可以记录用户登录事件。如果不配置登录审计，管理员无法从audit日志中追溯登录事件。</p><p>openEuler默认不配置登录审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置登录审计，由于在文件操作时需要记录审计日志，对性能有轻微影响，但由于登录动作本身不应快速、频繁发生，用户无感知。</p><p><strong>检查方法：</strong></p><p>通过执行如下指令，检查用户登录的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;lastlog&quot;</span></span><br><span class="line">-w /var/log/lastlog -p wa -k logins</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如logins.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/logins.rules</span></span><br><span class="line">-w /var/log/lastlog -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-4-应当配置账号信息修改审计规则"><a href="#4-1-4-应当配置账号信息修改审计规则" class="headerlink" title="4.1.4 应当配置账号信息修改审计规则"></a>4.1.4 应当配置账号信息修改审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通常情况下，业务部署完成后，用户账号、用户组已经固定，不会变更，口令由于有效期的缘故，会定期修改，但也不频繁。建议对这些认证授权关键数据进行审计监控，如果有变更，事后也可进行追溯。修改账号、用户组、口令等行为，在攻击行为中比较常见，建议配置审计规则，以便事后追溯。</p><p>openEuler默认不配置账号信息修改审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在操作对应配置文件时需要进行审计日志记录，对性能有轻微影响，但对用户账号、用户组以及口令的修改应不频繁，实际对用户无感知。</p><p><strong>检查方法：</strong></p><p>通过如下命令，检查修改账号信息的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;passwd|group|shadow&quot;</span></span><br><span class="line">-w /etc/group -p wa -k usermgn</span><br><span class="line">-w /etc/passwd -p wa -k usermgn</span><br><span class="line">-w /etc/gshadow -p wa -k usermgn</span><br><span class="line">-w /etc/shadow -p wa -k usermgn</span><br><span class="line">-w /etc/security/opasswd -p wa -k usermgn</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如usermgn.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/usermgn.rules</span></span><br><span class="line">-w /etc/group -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/passwd -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/gshadow -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/shadow -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/security/opasswd -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-5-应当配置提权命令审计规则"><a href="#4-1-5-应当配置提权命令审计规则" class="headerlink" title="4.1.5 应当配置提权命令审计规则"></a>4.1.5 应当配置提权命令审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>普通用户通过调用提权命令（设置了SUID&#x2F;SGID）可以获得超级管理员权限，所以提权命令的使用具有较高风险，往往被攻击者利用用于对系统进行攻击行为。</p><p>建议对提权命令进行审计监控，以便事后追溯。</p><p>openEuler默认不配置提权命令审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在使用提权命令时需要进行审计日志记录，对性能有轻微影响，如果用户业务存在大量、频繁调用提权命令的场景，则可能存在累积效果。</p><p><strong>检查方法：</strong></p><p>使用如下脚本检查提权命令的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">array=`find / -xdev -<span class="built_in">type</span> f \( -perm -4000 -o -perm -2000 \) | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    ret=`auditctl -l | grep <span class="string">&quot;<span class="variable">$element</span> &quot;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$element</span> not set&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$ret</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>如果系统中提权命令已经配置audit策略，则该脚本执行后打印出对应策略行，如果未配置，则打印出“&lt;file path&gt; not set”字样，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sh check.sh</span></span><br><span class="line">/root/test.sh not <span class="built_in">set</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/write -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/gpasswd -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/passwd -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/pkexec -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/crontab -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/newgrp -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/chage -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/fusermount -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/at -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/newgidmap -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/wall -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/umount -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/sudo -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/newuidmap -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/mount -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/bin/su -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/libexec/openssh/ssh-keysign -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/libexec/dbus-1/dbus-daemon-launch-helper -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/libexec/utempter/utempter -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/lib/polkit-1/polkit-agent-helper-1 -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/sbin/pam_timestamp_check -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/sbin/grub2-set-bootflag -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/sbin/mount.nfs -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br><span class="line">-a always,<span class="built_in">exit</span> -S all -F path=/usr/sbin/unix_chkpwd -F perm=x -F auid&gt;=1000 -F auid!=-1 -F key=privileged</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>通过如下方法，查找系统中所有可提权（SUID&#x2F;SGID）命令，并按照配置格式输出到&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;privileged.rules文件中，此处&lt;min uid&gt;是&#x2F;etc&#x2F;login.defs文件中UID_MIN的值，openEuler上可设置为1000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -xdev -type f \( -perm -4000 -o -perm -2000 \) | awk &#x27;&#123;print &quot;-a always,exit -F path=&quot; $1 &quot; -F perm=x -F auid&gt;=&lt;min uid&gt; -F auid!=unset -k &lt;rules name&gt;&quot; &#125;&#x27; &gt; /etc/audit/rules.d/privileged.rules</span></span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-6-应当配置内核模块变更审计规则"><a href="#4-1-6-应当配置内核模块变更审计规则" class="headerlink" title="4.1.6 应当配置内核模块变更审计规则"></a>4.1.6 应当配置内核模块变更审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通常情况下，业务部署完成后，内核模块挂载已经固定，不会变更。如果发生变更，可能存在攻击行为，建议对内核模块变更进行审计监控，事后也可进行追溯。</p><p>openEuler默认不配置内核模块变更审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在内核模块挂载、卸载时需要进行审计日志记录，对性能有轻微影响，但内核模块挂载、卸载相关操作应不频繁，实际对用户无感知。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查内核模块变更的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;insmod|rmmod|modprobe|init_module|delete_module&quot;</span></span><br><span class="line">-w /sbin/insmod -p x -k module</span><br><span class="line">-w /sbin/rmmod -p x -k module</span><br><span class="line">-w /sbin/modprobe -p x -k module</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S init_module,delete_module -F key=module</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S init_module,delete_module -F key=module</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如module.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/module.rules</span></span><br><span class="line">-w /sbin/insmod -p x -k &lt;rules name&gt;</span><br><span class="line">-w /sbin/rmmod -p x -k &lt;rules name&gt;</span><br><span class="line">-w /sbin/modprobe -p x -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S init_module -S delete_module -k &lt;rules name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S init_module -S delete_module -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。 </p><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-7-应当配置管理员特权操作审计规则"><a href="#4-1-7-应当配置管理员特权操作审计规则" class="headerlink" title="4.1.7 应当配置管理员特权操作审计规则"></a>4.1.7 应当配置管理员特权操作审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>openEuler系统中sudo提取命令操作日志默认记录在&#x2F;var&#x2F;log&#x2F;secure日志文件中，该文件中还记录有其他认证相关的安全日志，如果用户希望对sudo提取命令进行audit审计，建议将sudo相关日志单独记录，输出到&#x2F;var&#x2F;log&#x2F;sudo.log中，然后再对sudo日志文件进行审计监控。sudo提权属于高危操作，在攻击行为中比较常见，建议配置审计规则，以便事后追溯。</p><p>openEuler默认不配置管理员特权操作审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在进行任何sudo提权操作时都需要进行审计日志记录，对性能有轻微影响，如果用户业务场景中存在大量、频繁的sudo操作，对性能影响有累积效果。</p><p><strong>检查方法：</strong></p><p>通过如下命令检查管理员特权操作的审计规则，其中sudo输出日志路径根据实际配置情况可能有变化：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;sudo\.log&quot;</span></span><br><span class="line">-w /var/log/sudo.log -p wa -k sudoaction</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;sudoers文件，配置sudo日志独立记录到&#x2F;var&#x2F;log&#x2F;sudo.log文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sudoers</span><br><span class="line">Defaults logfile=/var/log/sudo.log</span><br></pre></td></tr></table></figure><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如sudoaction.rules，在文件中添加审计规则，此处审计的文件“&#x2F;var&#x2F;log&#x2F;sudo.log”必须是&#x2F;etc&#x2F;sudoers中配置的日志输出文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/audit/rules.d/sudoaction.rules</span><br><span class="line">-w /var/log/sudo.log -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-8-应当在启动阶段启用auditd"><a href="#4-1-8-应当在启动阶段启用auditd" class="headerlink" title="4.1.8 应当在启动阶段启用auditd"></a>4.1.8 应当在启动阶段启用auditd</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在启动阶段启用auditd，可以对操作系统启动过程中，auditd服务完成启动前的事件进行审计。启动过程中如果不启用审计，如果攻击者在启动过程中添加一些攻击行为，可能就无法被审计到。</p><p>openEuler默认不配置，建议用户可根据实际场景，确定是否在内核启动参数中添加“audit&#x3D;1”字段，以便在操作系统启动阶段使能审计功能。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>执行如下命令，查看内核启动参数中是否已经添加“audit&#x3D;1”：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline | grep &quot;audit=1&quot;</span></span><br><span class="line">BOOT_IMAGE=/vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M quiet audit=1 </span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>修改grub.cfg文件，直接在对应内核启动参数后面添加，需要注意的是，grub.cfg文件所在目录根据系统安装配置会有不同，大部分情况存在于&#x2F;boot&#x2F;grub2&#x2F;或&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openeuler&#x2F;目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/efi/EFI/openeuler/grub.cfg</span></span><br><span class="line">linuxefi/vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M quiet audit=1</span><br></pre></td></tr></table></figure></li><li><p>或者修改配置文件&#x2F;etc&#x2F;default&#x2F;grub，在GRUB_CMDLINE_LINUX字段添加“audit&#x3D;1”，然后重新生成grub.cfg文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;/dev/mapper/openeuler-swap rd.lvm=openeuler/root rd.lvm.lv=openeuler/swap crashkernel quiet audit=1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure></li><li><p>修改后重启系统生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-1-9-应当正确配置audit-backlog-limit"><a href="#4-1-9-应当正确配置audit-backlog-limit" class="headerlink" title="4.1.9 应当正确配置audit_backlog_limit"></a>4.1.9 应当正确配置audit_backlog_limit</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>audit_backlog_limit用于限制audit事件在发往auditd服务进行处理之前在内核中的缓存队列的大小，该值默认为64，如果队列满，则开始丢弃audit事件，并打印告警日志，提示队列满。如果该值配置过小，则可能导致audit事件丢失。</p><p>如果在操作系统启动阶段已经配置了启用auditd，则建议将audit_backlog_limit适当配置为较大值，因为内核启动过程中auditd服务尚未启动，此时所有事件都是通过队列缓存的。</p><p>openEuler默认不配置，建议用户根据实际场景，设置audit_backlog_limit参数的大小。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>执行如下命令，查看内核启动参数中是否已经添加“audit_backlog_limit&#x3D;&lt;size&gt;”：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline | grep &quot;audit_backlog_limit&quot;</span></span><br><span class="line">BOOT_IMAGE=/vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M quiet audit=1 audit_backlog_limit=8192</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><ul><li><p>修改grub.cfg文件，直接在对应内核启动参数后面添加，需要注意的是，grub.cfg文件所在目录根据系统安装配置会有不同，大部分情况存在于&#x2F;boot&#x2F;grub2&#x2F;或&#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;openEuler&#x2F;目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /boot/grub2/grub.cfg</span></span><br><span class="line">linuxefi/vmlinuz-&lt;kernel version&gt; root=/dev/mapper/openeuler-root ro resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap crashkernel=512M quiet audit=1 audit_backlog_limit=&lt;size&gt;</span><br></pre></td></tr></table></figure></li><li><p>或者修改配置文件&#x2F;etc&#x2F;default&#x2F;grub，在GRUB_CMDLINE_LINUX字段添加“audit_backlog_limit&#x3D;&lt;size&gt;”，然后重新生成grub.cfg文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;/dev/mapper/openeuler-swap rd.lvm=openeuler/root rd.lvm.lv=openeuler/swap crashkernel quiet audit=1 audit_backlog_limit=&lt;size&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure></li><li><p>修改后重启系统生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-1-10-避免使用auditctl设置auditd规则"><a href="#4-1-10-避免使用auditctl设置auditd规则" class="headerlink" title="4.1.10 避免使用auditctl设置auditd规则"></a>4.1.10 避免使用auditctl设置auditd规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>auditd服务规则可以在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下的规则文件中配置后，重启服务器生效，也可以通过auditctl命令设置，并立即生效。&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录权限为750，而auditctl权限为755，所以禁止通过auditctl命令修改auditd服务规则，可以缩小攻击面，防止低权限攻击者通过命令行修改规则并立即实施攻击行为。</p><p>openEuler，默认不禁止通过auditctl命令修改auditd服务规则，建议用户根据业务场景，禁用auditctl方式设置。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过grep命令，检查&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下是否存在特定的rules文件，包含有“-e 2”字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;-e 2&quot; /etc/audit/rules.d/*.rules</span></span><br><span class="line">/etc/audit/rules.d/immutable.rules:-e 2</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建以.rules为后缀的规则文件（可随意命名），添加“-e 2”字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/immutable.rules</span></span><br><span class="line">-e 2</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-11-确保日志大小限制配置正确"><a href="#4-1-11-确保日志大小限制配置正确" class="headerlink" title="4.1.11 确保日志大小限制配置正确"></a>4.1.11 确保日志大小限制配置正确</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>audit日志文件需要配置大小限制，达到限制后通过rotate机制，新建日志文件重新记录，可以防止单个文件过大问题，便于管理和追溯。配置上限过大，容易导致单个日志文件过大，不利于管理；配置上限过小，则容易导致过多的日志文件或者日志文件因rotate机制被频繁覆盖，不利于事后追溯。</p><p>openEuler默认配置8MB，用户可根据实际场景修改配置。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>使用如下命令查看当前配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &quot;^max_log_file&quot; /etc/audit/auditd.conf</span></span><br><span class="line">max_log_file = 8</span><br><span class="line">max_log_file_action = ROTATE</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;audit&#x2F;auditd.conf文件中max_log_file字段的值（单位是MB）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/auditd.conf</span></span><br><span class="line">max_log_file = &lt;numeric value <span class="keyword">in</span> megabytes&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-12-应当正确配置硬盘空间阈值"><a href="#4-1-12-应当正确配置硬盘空间阈值" class="headerlink" title="4.1.12 应当正确配置硬盘空间阈值"></a>4.1.12 应当正确配置硬盘空间阈值</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>在auditd记录日志过程中，如果硬盘空间被写满，可能导致业务无法正常执行，所以需要提前设置相关配置项，确保硬盘在即将写满或已经写满的情况下不至于引起更加严重的系统问题。</p><p>配置文件&#x2F;etc&#x2F;audit&#x2F;auditd.conf的如下相关项openEuler已配置默认值，用户可根据业务场景修改：</p><table><thead><tr><th>配置项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>space_left</td><td>75</td><td>配置硬盘空间下限告警动作阈值，如低于75MB，则触发space_left_action定义的告警动作</td></tr><tr><td>space_left_action</td><td>SYSLOG</td><td>硬盘空间低于space_left时，触发告警事件，可选：IGNORE、SYSLOG、EMAIL、SUSPEND、SINGLE、HALT。  openEuler默认设置为SYSLOG，表示不会阻止继续记录日志，但会通过syslog记录一次告警。</td></tr><tr><td>admin_space_left</td><td>50</td><td>配置硬盘空间下限管理动作阈值，如低于50MB，则触发admin_space_left_action定义的操作动作，admin_space_left设置值不能大于space_left的值。</td></tr><tr><td>admin_space_left_action</td><td>SUSPEND</td><td>硬盘空间低于admin_space_left时，触发管理事件，可选：IGNORE、SYSLOG、EMAIL、SUSPEND、SINGLE、HALT。  openEuler默认设置为SUSPEND，表示auditd服务停止向硬盘输出日志记录。</td></tr><tr><td>disk_full_action</td><td>SUSPEND</td><td>表示如果系统检测到硬盘已经写满，则触发处理动作，可选：IGNORE、SYSLOG、SUSPEND、SINGLE、HALT。  openEuler默认设置为SUSPEND，表示auditd服务停止向硬盘输出日志记录。</td></tr><tr><td>disk_error_action</td><td>SUSPEND</td><td>表示如果在记录audit日志时，检测到硬盘错误，则触发处理动作，可选：IGNORE、SYSLOG、SUSPEND、SINGLE、HALT。  openEuler默认设置为SUSPEND，表示auditd服务停止向硬盘输出日志记录。</td></tr></tbody></table><p>如果告警阈值和管理阈值配置过大，则可能硬盘还有较大空间时audit日志就无法正常输出，如果配置过小，则会因为日志输出而将硬盘空间耗尽，影响正常业务，所以建议一方用户根据实际场景配置合理值，另一方面建议将日志输出到单独分区，避免日志过大影响业务。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>通过如下方法检查&#x2F;etc&#x2F;audit&#x2F;auditd.conf文件是否配置正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/audit/auditd.conf | grep -iE &quot;space_left|space_left_action|admin_space_left|admin_space_left_action|disk_full_action|disk_error_action&quot;</span></span><br><span class="line">space_left = 75</span><br><span class="line">space_left_action = SYSLOG</span><br><span class="line">admin_space_left = 50</span><br><span class="line">admin_space_left_action = SUSPEND</span><br><span class="line">disk_full_action = SUSPEND</span><br><span class="line">disk_error_action = SUSPEND</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;audit&#x2F;auditd.conf文件，配置对应字段内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/auditd.conf</span></span><br><span class="line">space_left = &lt;numeric value <span class="keyword">in</span> megabytes&gt;</span><br><span class="line">space_left_action = &lt;action&gt;</span><br><span class="line">admin_space_left = &lt;numeric value <span class="keyword">in</span> megabytes&gt;</span><br><span class="line">admin_space_left_action = &lt;action&gt;</span><br><span class="line">disk_full_action = &lt;action&gt;</span><br><span class="line">disk_error_action = &lt;action&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使配置生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-13-应当配置sudoers审计规则"><a href="#4-1-13-应当配置sudoers审计规则" class="headerlink" title="4.1.13 应当配置sudoers审计规则"></a>4.1.13 应当配置sudoers审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>sudo命令允许普通用户提权执行root管理员权限相关的操作，属于高危操作，攻击者一般无法直接获取root权限，但通过sudo命令提权，相对比较容易。建议配置对&#x2F;etc&#x2F;sudoers文件以及&#x2F;etc&#x2F;sudoers.d&#x2F;目录审计，记录读、写操作的审计日志，从而追溯是否有配置修改或读取操作（提权操作需要读取配置）。如果不配置sudoers审计，发生非法提权操作时不利于追溯。</p><p>openEuler默认不配置sudoers审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置sudoers审计，由于在文件操作时需要记录审计日志，对性能有轻微影响。</p><p><strong>检查方法：</strong></p><p>通过如下方法，检查是否存在针对&#x2F;etc&#x2F;sudoers文件以及&#x2F;etc&#x2F;sudoers.d&#x2F;目录的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep &quot;sudoers&quot;</span></span><br><span class="line">-w /etc/sudoers -p wa -k sudoers</span><br><span class="line">-w /etc/sudoers.d -p wa -k sudoers</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如sudoers.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/sudoers.rules</span></span><br><span class="line">-w /etc/sudoers -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/sudoers.d -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-14-应当配置会话审计规则"><a href="#4-1-14-应当配置会话审计规则" class="headerlink" title="4.1.14 应当配置会话审计规则"></a>4.1.14 应当配置会话审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>建议对&#x2F;var&#x2F;run&#x2F;utmp、&#x2F;var&#x2F;log&#x2F;wtmp、&#x2F;var&#x2F;log&#x2F;btmp三个文件进行审计监控，utmp文件记录了当前所有的登录事件信息；wtmp文件记录了所有的登录、登出、关机、重启事件信息，btmp记录了登录失败事件信息。如果不配置会话审计，管理员无法从audit日志中追溯登录、登出等事件，或可追溯信息不够。</p><p>openEuler默认不配置会话审计规则，建议用户根据实际业务场景进行配置。</p><p><strong>规则影响：</strong></p><p>配置会话审计，由于在文件操作时需要记录审计日志，对性能有轻微影响，但由于登录、登出动作本身不应快速、频繁发生，用户无感知。</p><p><strong>检查方法：</strong></p><p>通过如下方法，检查是否存在针对&#x2F;var&#x2F;run&#x2F;utmp、&#x2F;var&#x2F;log&#x2F;wtmp、&#x2F;var&#x2F;log&#x2F;btmp文件的审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;utmp|wtmp|btmp&quot;</span></span><br><span class="line">-w /var/run/utmp -p wa -k session</span><br><span class="line">-w /var/log/wtmp -p wa -k session</span><br><span class="line">-w /var/log/btmp -p wa -k session</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如session.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/session.rules</span></span><br><span class="line">-w /var/run/utmp -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /var/log/wtmp -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /var/log/btmp -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-15-应当配置时间修改审计规则"><a href="#4-1-15-应当配置时间修改审计规则" class="headerlink" title="4.1.15 应当配置时间修改审计规则"></a>4.1.15 应当配置时间修改审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>系统时间是否准确，影响着业务的正常运行。除了通过时间同步服务器确保时间同步之外，还需要关注管理员通过手工命令方式修改系统时间，后者往往伴随着攻击风险，如攻击者通过修改系统时间使某些保护策略失效（例如口令过期），达成攻击目的。</p><p>建议通过审计系统调用（adjtimex、settimeofday、clock_settime），对系统时间修改进行日志记录，同时对&#x2F;etc&#x2F;localtime文件进行审计，记录时区变更日志。如果不配置时间修改审计，管理员无法从audit日志中追溯时间变更事件。</p><p>openEuler默认不配置时间修改审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置时间变更审计，由于在文件操作或系统调用时需要记录审计日志，对性能有轻微影响，但由于时间变更动作本身不应快速、频繁发生，用户无感知。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;adjtimex|settimeofday|clock_settime|localtime&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S stime,settimeofday,adjtimex,clock_settime -F key=time</span><br><span class="line">-w /etc/localtime -p wa -k time</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S settimeofday,adjtimex,clock_settime -F key=time</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如time.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/time.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S stime -S settimeofday -S adjtimex -S clock_settime -k &lt;rules name&gt;</span><br><span class="line">-w /etc/localtime -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S settimeofday -S adjtimex -S clock_settime -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。</p><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-16-应当配置SELinux审计规则"><a href="#4-1-16-应当配置SELinux审计规则" class="headerlink" title="4.1.16 应当配置SELinux审计规则"></a>4.1.16 应当配置SELinux审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>SELinux是Linux平台提供的强制访问控制功能组件，用于对进程、文件等进行细粒度的权限控制。建议对SELinux配置文件、策略文件等配置审计，记录修改日志。如果不配置SELinux审计，如果发生非法策略修改，不利于追溯。</p><p>openEuler默认不配置SELinux审计规则，建议用户根据实际业务场景进行配置。</p><p><strong>规则影响：</strong></p><p>配置SELinux审计，由于在策略文件操作时需要记录审计日志，对性能有轻微影响。</p><p><strong>检查方法：</strong></p><p>通过如下命令检查selinux相关审计配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;selinux&quot;</span></span><br><span class="line">-w /etc/selinux -p wa -k selinux</span><br><span class="line">-w /usr/share/selinux -p wa -k selinux</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如selinux.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/selinux.rules</span></span><br><span class="line">-w /etc/selinux/ -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /usr/share/selinux/ -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-17-应当配置网络环境审计规则"><a href="#4-1-17-应当配置网络环境审计规则" class="headerlink" title="4.1.17 应当配置网络环境审计规则"></a>4.1.17 应当配置网络环境审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>攻击者可能通过修改系统域名、主机名等实施攻击行为，比如主机欺骗等，建议用户通过设置对系统调用setdomainname、sethostname的审计，以及文件&#x2F;etc&#x2F;hosts的审计，监控系统域名、主机名的修改；通过设置对&#x2F;etc&#x2F;issue、&#x2F;etc&#x2F;issue.net文件的审计，监控登录提示信息的修改。</p><p>如果不配置相关审计，如果发生非法修改，不利于追溯。</p><p>openEuler默认不配置网络环境审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在文件操作时需要记录审计日志，对性能有轻微影响，但由于域名、主机名以及登录提示信息不应被频繁修改，实际对用户无感知。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;setdomainname|sethostname|hosts|issue&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S sethostname,setdomainname -F key=hostnet</span><br><span class="line">-w /etc/hosts -p wa -k hostnet</span><br><span class="line">-w /etc/issue -p wa -k hostnet</span><br><span class="line">-w /etc/issue.net -p wa -k hostnet</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S sethostname,setdomainname -F key=hostnet</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如hostnet.rules，在文件中添加审计规则：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/hostnet.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S setdomainname -S sethostname -k &lt;rules name&gt;</span><br><span class="line">-w /etc/hosts -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/issue -p wa -k &lt;rules name&gt;</span><br><span class="line">-w /etc/issue.net -p wa -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S setdomainname -S sethostname -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。</p><p>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-18-应当配置文件访问控制权限审计规则"><a href="#4-1-18-应当配置文件访问控制权限审计规则" class="headerlink" title="4.1.18 应当配置文件访问控制权限审计规则"></a>4.1.18 应当配置文件访问控制权限审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>文件访问权限控制是Linux中基础的权限管理，不同用户被授权可以访问不同的文件，防止用户之间敏感信息泄露或文件数据被篡改，也可以防止普通用户越权访问系统高权限文件或配置。</p><p>建议对操作系统中修改文件权限、文件属主的系统调用进行审计监控。如果不配置相关审计，如果发生非法修改，不利于追溯。</p><p>openEuler默认不配置文件访问控制权限审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在文件权限、属主修改时需要记录审计日志，对性能有轻微影响，但由于此类操作不应被频繁执行，实际对用户无感知。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;chmod|chown|setxattr|exattr&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S <span class="built_in">chmod</span>,fchmod,fchmodat -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S <span class="built_in">chown</span>,fchown,lchown,fchownat -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S <span class="built_in">chmod</span>,fchmod,fchmodat -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S <span class="built_in">chown</span>,fchown,lchown,fchownat -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S setxattr,lsetxattr,fsetxattr,removexattr,lremovexattr,fremovexattr -F auid&gt;=1000 -F auid!=-1 -F key=fileperm</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如fileperm.rules，在文件中添加审计规则，此处&lt;min uid&gt;是&#x2F;etc&#x2F;login.defs文件中UID_MIN（UID_MIN为通过useradd方式添加用户，用户uid的最小值），openEuler上默认是1000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/fileperm.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S <span class="built_in">chmod</span> -S fchmod -S fchmodat -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S <span class="built_in">chown</span> -S fchown -S fchownat -S lchown -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S <span class="built_in">chmod</span> -S fchmod -S fchmodat -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S <span class="built_in">chown</span> -S fchown -S fchownat -S lchown -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。<br>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-19-应当配置文件访问失败审计规则"><a href="#4-1-19-应当配置文件访问失败审计规则" class="headerlink" title="4.1.19 应当配置文件访问失败审计规则"></a>4.1.19 应当配置文件访问失败审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通过对open、truncate、ftruncate、create、openat等系统调用进行审计监控，如果这些系统调用返回“-EACCES”或“-EPERM”错误，则表示文件无权访问，需要记录审计日志。由于权限问题导致文件访问失败的场景，在攻击行为中比较常见，建议配置审计规则，以便事后追溯。</p><p>openEuler默认不配置文件访问失败审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在文件访问失败时需要进行审计日志记录，对性能有轻微影响，但在实际场景中，文件访问失败的场景较少，影响有限。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;EACCES|EPERM&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S open,<span class="built_in">truncate</span>,ftruncate,creat,openat -F <span class="built_in">exit</span>=-EACCES -F auid&gt;=1000 -F auid!=-1 -F key=fileaccess</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S open,<span class="built_in">truncate</span>,ftruncate,creat,openat -F <span class="built_in">exit</span>=-EPERM -F auid&gt;=1000 -F auid!=-1 -F key=fileaccess</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S open,<span class="built_in">truncate</span>,ftruncate,creat,openat -F <span class="built_in">exit</span>=-EACCES -F auid&gt;=1000 -F auid!=-1 -F key=fileaccess</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S open,<span class="built_in">truncate</span>,ftruncate,creat,openat -F <span class="built_in">exit</span>=-EPERM -F auid&gt;=1000 -F auid!=-1 -F key=fileaccess</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如fileaccess.rules，在文件中添加审计规则，此处&lt;min uid&gt;是&#x2F;etc&#x2F;login.defs文件中UID_MIN的值，openEuler上默认是1000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/fileaccess.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S creat -S open -S openat -S <span class="built_in">truncate</span> -S ftruncate -F <span class="built_in">exit</span>=-EACCES -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S creat -S open -S openat -S <span class="built_in">truncate</span> -S ftruncate -F <span class="built_in">exit</span>=-EPERM -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S creat -S open -S openat -S <span class="built_in">truncate</span> -S ftruncate -F <span class="built_in">exit</span>=-EACCES -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S creat -S open -S openat -S <span class="built_in">truncate</span> -S ftruncate -F <span class="built_in">exit</span>=-EPERM -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。<br>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-20-应当配置文件删除审计规则"><a href="#4-1-20-应当配置文件删除审计规则" class="headerlink" title="4.1.20 应当配置文件删除审计规则"></a>4.1.20 应当配置文件删除审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>操作系统中文件删除操作一般都属于高危操作，管理员误操作或者攻击者攻击行为，都可能导致严重的系统故障，建议通过对rename、unlink、unlinkat、renameat等系统调用进行审计监控，记录删除操作日志。删除系统或业务文件，在攻击行为中比较常见，建议配置审计规则，以便事后追溯。</p><p>openEuler默认不配置文件删除审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在文件删除时需要进行审计日志记录，对性能有轻微影响，如果实际业务场景存在大量文件删除操作，则累积影响可能较大。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;unlink|unlinkat|rename|renameat&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S rename,<span class="built_in">unlink</span>,unlinkat,renameat -F auid&gt;=1000 -F auid!=-1 -F key=filedelete</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S rename,<span class="built_in">unlink</span>,unlinkat,renameat -F auid&gt;=1000 -F auid!=-1 -F key=filedelete</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如filedelete.rules，在文件中添加审计规则，此处&lt;min uid&gt;是&#x2F;etc&#x2F;login.defs文件中UID_MIN的值，openEuler上默认是1000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/filedelete.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S <span class="built_in">unlink</span> -S unlinkat -S rename -S renameat -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S <span class="built_in">unlink</span> -S unlinkat -S rename -S renameat -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。<br>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h3 id="4-1-21-应当配置文件系统挂载审计规则"><a href="#4-1-21-应当配置文件系统挂载审计规则" class="headerlink" title="4.1.21 应当配置文件系统挂载审计规则"></a>4.1.21 应当配置文件系统挂载审计规则</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>通常情况下，业务部署完成后，文件系统挂载已经固定，不会变更。如果发生变更，可能存在攻击行为，建议对这些文件系统挂载进行审计监控，如果有变更，事后也可进行追溯。</p><p>openEuler默认不配置文件系统挂载审计规则，建议用户根据实际业务场景配置相应规则。</p><p><strong>规则影响：</strong></p><p>配置审计，由于在文件系统挂载时需要进行审计日志记录，对性能有轻微影响，但文件系统挂载相关操作应不频繁，实际对用户无感知。</p><p><strong>检查方法：</strong></p><p>如果是32位系统，通过如下命令检查配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auditctl -l | grep -iE &quot;mount&quot;</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S mount -F auid&gt;=1000 -F auid!=-1 -F key=mount</span><br></pre></td></tr></table></figure><p>如果是64位系统，还需有如下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S mount -F auid&gt;=1000 -F auid!=-1 -F key=mount</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>如果是32位系统，在&#x2F;etc&#x2F;audit&#x2F;rules.d&#x2F;目录下新建规则文件，例如mount.rules，在文件中添加审计规则，此处&lt;min uid&gt;是&#x2F;etc&#x2F;login.defs文件中UID_MIN的值，openEuler上默认是1000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/audit/rules.d/mount.rules</span></span><br><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b32 -S mount -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>如果是64位系统，需要再添加arch&#x3D;b64相关配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a always,<span class="built_in">exit</span> -F <span class="built_in">arch</span>=b64 -S mount -F auid&gt;=&lt;min uid&gt; -F auid!=<span class="built_in">unset</span> -k &lt;rules name&gt;</span><br></pre></td></tr></table></figure><p>考虑兼容性，64位系统中arch&#x3D;b32相关配置必须保留。<br>重启auditd服务，使规则生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service auditd restart</span></span><br><span class="line">Stopping logging: [  OK  ]</span><br><span class="line">Redirecting start to /bin/systemctl start auditd.service</span><br></pre></td></tr></table></figure><h2 id="4-2-Rsyslog"><a href="#4-2-Rsyslog" class="headerlink" title="4.2 Rsyslog"></a>4.2 Rsyslog</h2><h3 id="4-2-1-确保rsyslog服务已启用"><a href="#4-2-1-确保rsyslog服务已启用" class="headerlink" title="4.2.1 确保rsyslog服务已启用"></a>4.2.1 确保rsyslog服务已启用</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>当前系统日志默认存储在内存，若不开启rsyslog服务，系统日志无法转储到持久性存储设备，系统重启后，会导致日志丢失。</p><p>rsyslog服务用于转储、分发系统日志，具有以下特点：</p><ul><li>多线程工作</li><li>支持UDP、TCP、SSL、TLS、RELP</li><li>支持将日志存储到MySQL、PGSQL、Oracle等多种关系数据库中</li><li>支持日志信息过滤</li><li>自定义输出格式</li></ul><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><ul><li><p>执行如下命令，查看rsyslog.service服务默认状态是否为enable</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl is-enabled rsyslog.service</span></span><br><span class="line">enabled</span><br></pre></td></tr></table></figure></li><li><p>执行如下命令，查看rsyslog.service服务是否已经启动成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl status rsyslog.service | grep Active</span></span><br><span class="line">Active: active (running) since Tue 2020-12-01 16:33:25 CST; 2h 46min ago</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><ul><li><p>执行如下命令，使能rsyslog.service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chkconfig rsyslog on</span></span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable rsyslog.service</span></span><br></pre></td></tr></table></figure></li><li><p>执行如下命令，启动rsyslog.service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start rsyslog.service</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-2-2-确保系统认证相关事件日志已记录"><a href="#4-2-2-确保系统认证相关事件日志已记录" class="headerlink" title="4.2.2 确保系统认证相关事件日志已记录"></a>4.2.2 确保系统认证相关事件日志已记录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>必须记录系统认证相关的事件，以便帮助分析用户登录、root权限使用以及监视系统的可疑动作等情况。</p><p>不记录系统认证相关事件日志，会导致无法从日志上分析可疑的攻击动作，例如攻击者尝试猜测管理员口令，而进行的登录动作。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.conf文件中是否已经配置auth相关字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep auth /etc/rsyslog.conf | grep -v &quot;^#&quot;</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none           /var/log/messages</span><br><span class="line">authpriv.*                                         /var/log/secure</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;rsyslog.conf文件添加如下设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none           /var/log/messages</span><br><span class="line">authpriv.*                                         /var/log/secure</span><br></pre></td></tr></table></figure><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-3-确保cron服务日志已记录"><a href="#4-2-3-确保cron服务日志已记录" class="headerlink" title="4.2.3 确保cron服务日志已记录"></a>4.2.3 确保cron服务日志已记录</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>linux系统计划任务一般由cron来承担，由于cron可能会被黑客利用来加载恶意代码，因此需要全部记录cron的日志信息，以便跟踪系统异常状况。</p><p>不记录cron日志，当出现攻击者恶意操作时，将无法从日志信息中查看异常，进而无法跟踪系统异常状况。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.conf文件中是否已经配置相关字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep /var/log/cron /etc/rsyslog.conf</span></span><br><span class="line">cron.*                                                  /var/log/cron</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;rsyslog.conf文件，添加cron相关配置字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line">cron.*                                                  /var/log/cron</span><br></pre></td></tr></table></figure><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-4-应当正确配置rsyslog默认文件权限"><a href="#4-2-4-应当正确配置rsyslog默认文件权限" class="headerlink" title="4.2.4 应当正确配置rsyslog默认文件权限"></a>4.2.4 应当正确配置rsyslog默认文件权限</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>日志文件记录了系统的行为，日志工具rsyslog能将日志记录到设定的文件中。当设定的日志文件在系统中不存在时，rsyslog能创建新日志文件。新创建的日志文件权限可在rsyslog配置文件中进行配置，通过设置默认文件权限以确保新创建的日志文件具有合理安全的权限。</p><p>若日志文件权限过大，普通用户也能读取日志，则增加了日志信息泄漏和被篡改的风险。合理的日志文件权限确保敏感的日志数据能得到保护。建议将日志权限设置为0600。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.conf或&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf配置文件是否配置了合理的默认文件权限，如果指令存在返回值且FileCreateMode的值不为0600，则说明系统日志信息存在泄露和被篡改的风险，需对日志文件权限进行修复。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^\$FileCreateMode /etc/rsyslog.conf /etc/rsyslog.d/*.conf</span></span><br><span class="line">/etc/rsyslog.d/sysalarm.conf:<span class="variable">$FileCreateMode</span> 0600</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;rsyslog.conf或&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf，为$FileCreateMode设置合理的权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.d/test.conf</span></span><br><span class="line"><span class="variable">$FileCreateMode</span> 0600</span><br></pre></td></tr></table></figure><p>rsyslog.conf中默认会包含&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf中的配置，因此配置任何一处即可。</p><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-5-应当正确配置各服务日志记录"><a href="#4-2-5-应当正确配置各服务日志记录" class="headerlink" title="4.2.5 应当正确配置各服务日志记录"></a>4.2.5 应当正确配置各服务日志记录</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>配置日志记录，这样系统的重要行为及安全相关的信息将使用rsyslog进行记录。配置文件&#x2F;etc&#x2F;rsyslog.conf及&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf中可以指定记录日志的规则及哪些文件将用于记录特定类型的日志。</p><p>若不配置日志记录，系统的行为无法记录，在出现问题时无法进行问题定位及审计。</p><p><strong>规则影响：</strong></p><p>配置日志记录后，如果不及时清理日志，日志可能占满当前分区，导致其他进程或系统故障风险。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.conf及&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf中是否配置了合理的日志记录规则，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep \/var\/log /etc/rsyslog.conf /etc/rsyslog.d/*.conf</span></span><br><span class="line">/etc/rsyslog.conf:*.info;mail.none;authpriv.none;cron.none        /var/log/messages</span><br><span class="line">/etc/rsyslog.conf:authpriv.*                                 /var/log/secure</span><br><span class="line">/etc/rsyslog.conf:mail.*                                    /var/log/maillog</span><br><span class="line">/etc/rsyslog.conf:cron.*                                    /var/log/cron</span><br><span class="line">/etc/rsyslog.conf:uucp,news.crit                             /var/log/spooler</span><br><span class="line">/etc/rsyslog.conf:local7.*                                  /var/log/boot.log</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;rsyslog.conf及&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf中配置合理的日志记录规则，以&#x2F;etc&#x2F;rsyslog.conf为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line">/etc/rsyslog.conf:*.info;mail.none;authpriv.none;cron.none        /var/log/messages</span><br><span class="line">/etc/rsyslog.conf:authpriv.*                                 /var/log/secure</span><br><span class="line">/etc/rsyslog.conf:mail.*                                    /var/log/maillog</span><br><span class="line">/etc/rsyslog.conf:cron.*                                    /var/log/cron</span><br><span class="line">/etc/rsyslog.conf:uucp,news.crit                             /var/log/spooler</span><br><span class="line">/etc/rsyslog.conf:local7.*                                  /var/log/boot.log</span><br></pre></td></tr></table></figure><p>系统管理员在配置日志规则时，按需进行合理配置。以mail日志为例，“*”表示所有级别的日志；“&#x2F;var&#x2F;log&#x2F;maillog”意思是mail相关的日志记录到该文件中。具体的日志配置规则可参考rsyslog标准。</p><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-6-确保rsyslog转储journald日志已配置"><a href="#4-2-6-确保rsyslog转储journald日志已配置" class="headerlink" title="4.2.6 确保rsyslog转储journald日志已配置"></a>4.2.6 确保rsyslog转储journald日志已配置</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>系统采用journald进行日志收集，日志可能存在易失性存储设备上，也有可能存储在持久性存储设备上，存在日志丢失或者日志占满磁盘等问题，及时对日志进行转储，保障日志与系统更加安全。</p><p><strong>规则影响：</strong></p><p>日志如果存在易失性存储设备，不及时对日志进行转储，可能导致日志丢失。如果存在持久性存储设备上，日志量可能非常大，不及时对日志进行转储，有可能导致日志占满当前分区，导致其他进程或系统故障风险。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.conf文件中是否已经配置相关字段，如果返回结果不为空，表示已配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep imjournal /etc/rsyslog.conf</span></span><br><span class="line">module(load=<span class="string">&quot;imjournal&quot;</span>   <span class="comment"># provides access to the systemd journal</span></span><br><span class="line">StateFile=<span class="string">&quot;/run/log/imjournal.state&quot;</span>) <span class="comment"># File to store the position in the journal</span></span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>打开&#x2F;etc&#x2F;rsyslog.conf文件，新增如下设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line">module(load=<span class="string">&quot;imjournal&quot;</span>   <span class="comment"># provides access to the systemd journal</span></span><br><span class="line">StateFile=<span class="string">&quot;/run/log/imjournal.state&quot;</span>) <span class="comment"># File to store the position in the journal</span></span><br></pre></td></tr></table></figure><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-7-确保rsyslog日志rotate已配置"><a href="#4-2-7-确保rsyslog日志rotate已配置" class="headerlink" title="4.2.7 确保rsyslog日志rotate已配置"></a>4.2.7 确保rsyslog日志rotate已配置</h3><p><strong>级别：</strong> 要求</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>rsyslog负责从系统中收集日志记录到文件中，logrotate负责定期或定量对日志文件进行拷贝、压缩，以确保不会因为日志文件过大而导致占用过多的硬盘资源，甚至日志文件不可维护。</p><p>如果不配置rotate策略，日志文件会一直增长，最终可能导致日志所在硬盘分区空间耗尽，轻则影响日志记录，重则可能导致系统和业务无法继续正常执行。</p><p>openEuler默认已经在&#x2F;etc&#x2F;logrotate.d&#x2F;rsyslog文件中配置rsyslog的rotate策略如下：</p><ul><li><p>rotate日志文件</p><p>&#x2F;var&#x2F;log&#x2F;cron</p><p>&#x2F;var&#x2F;log&#x2F;maillog</p><p>&#x2F;var&#x2F;log&#x2F;messages</p><p>&#x2F;var&#x2F;log&#x2F;secure</p><p>&#x2F;var&#x2F;log&#x2F;spooler</p></li><li><p>日志文件最大保留期限365天；</p></li><li><p>日志文件最多保留30个；</p></li><li><p>日志文件采用压缩方式保留；</p></li><li><p>日志文件达到4MB，进行rotate操作。</p></li></ul><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;logrotate.d&#x2F;rsyslog文件中是否已经配置相关字段，此处“&#x2F;var&#x2F;log&#x2F;*”是&#x2F;etc&#x2F;rsyslog.conf文件中配置的rsyslog日志输出路径，两者需要匹配一致：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/logrotate.d/rsyslog | grep -iE &quot;\/var\/log|maxage|\&lt;rotate\&gt;|compress|size&quot;</span></span><br><span class="line">/var/log/cron</span><br><span class="line">/var/log/maillog</span><br><span class="line">/var/log/messages</span><br><span class="line">/var/log/secure</span><br><span class="line">/var/log/spooler</span><br><span class="line">    maxage 365</span><br><span class="line">    rotate 30</span><br><span class="line">    compress</span><br><span class="line">    size +4096k</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;logrotate.d目录下创建配置文件，比如&#x2F;etc&#x2F;logrotate.d&#x2F;rsyslog文件，检查并新增如下设置，其中&lt;log file paths&gt;是&#x2F;etc&#x2F;rsyslog.conf文件中配置的rsyslog日志输出路径，两者需要匹配一致：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/logrotate.d/rsyslog</span></span><br><span class="line">&lt;<span class="built_in">log</span> file paths&gt;</span><br><span class="line">&#123;</span><br><span class="line">    maxage &lt;days&gt;</span><br><span class="line">    rotate &lt;files counts&gt;</span><br><span class="line">    notifempty</span><br><span class="line">    compress</span><br><span class="line">    copytruncate</span><br><span class="line">    missingok</span><br><span class="line">    size +&lt;numeric value <span class="keyword">in</span> kilobyte&gt;k</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -HUP `<span class="built_in">cat</span> /var/run/rsyslogd.pid 2&gt; /dev/null` 2&gt; /dev/null || <span class="literal">true</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-8-应当配置远程日志服务器"><a href="#4-2-8-应当配置远程日志服务器" class="headerlink" title="4.2.8 应当配置远程日志服务器"></a>4.2.8 应当配置远程日志服务器</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>rsyslog日志服务可以将本地日志发送到远端日志服务器统一保存，有利于组网环境下日志集中管理，防止本地日志占用过多硬盘空间的同时，也可以防止日志在本地被篡改。</p><p>如果不配置远程日志存储，则rsyslog日志会保存在本地文件中，管理员正确配置日志存储路径以及rotate参数的情况下，对系统及业务无影响。如果配置了远程日志存储，就必须保证日志传输过程安全，如传输日志前进行加密、通过开启安全加密通道（TCP+TLS1.2及更高版本）等方法进行日志传输。</p><p>openEuler默认不配置远程日志存储，建议用户根据实际业务场景进行配置。</p><p><strong>规则影响：</strong></p><p>配置远程日志存储，则需要确保日志服务器有足够的硬盘空间用于存储组网环境下所有服务器上报的日志。</p><p><strong>检查方法：</strong></p><p>检查&#x2F;etc&#x2F;rsyslog.d&#x2F;目录下配置文件中是否已经配置相关字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -irE &quot;^*.*@*:[0-9]+$&quot; /etc/rsyslog.d/*.conf</span></span><br><span class="line">/etc/rsyslog.d/server.conf:*.* @@9.82.213.138:11514</span><br></pre></td></tr></table></figure><p><strong>修复方法：</strong></p><p>在&#x2F;etc&#x2F;rsyslog.d&#x2F;目录下新建以conf为后缀的配置文件，例如server.conf，然后加入配置如下，其中“*.*” 指将所有的日志都打印到服务器（含义是：日志类型.日志级别，mail.info就表示只将mail的info日志打印到服务器），“@”表示使用UDP协议，“@@”表示使用TCP协议：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.d/server.conf</span></span><br><span class="line">*.* @@&lt;remote IP&gt;:&lt;remote port&gt;</span><br><span class="line"><span class="comment"># 如果是IPv6，则添加如下配置:</span></span><br><span class="line">*.* @@[&lt;remove IPv6&gt;%&lt;interface name&gt;]:&lt;remote port&gt;</span><br></pre></td></tr></table></figure><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure><h3 id="4-2-9-应当仅在指定的日志主机上接受远程rsyslog消息"><a href="#4-2-9-应当仅在指定的日志主机上接受远程rsyslog消息" class="headerlink" title="4.2.9 应当仅在指定的日志主机上接受远程rsyslog消息"></a>4.2.9 应当仅在指定的日志主机上接受远程rsyslog消息</h3><p><strong>级别：</strong> 建议</p><p><strong>适用版本：</strong> 全部</p><p><strong>规则说明：</strong> </p><p>默认情况下，rsyslog不会监听来自远程系统的日志消息。rsyslog需加载imtcp.so模块才能通过TCP监听，同理需要加载imudp.so模块才能通过UDP监听，两者都需要指定监听的TCP&#x2F;UDP端口。确保只在指定的日志主机上接收远程rsyslog消息，以便管理员集中管理，但需要确保日志服务器有足够的硬盘空间用于存储组网环境下所有服务器上报的日志。</p><p><strong>规则影响：</strong></p><p>无</p><p><strong>检查方法：</strong></p><p>运行如下命令检查&#x2F;etc&#x2F;rsyslog.conf及&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf配置文件：</p><ul><li><p>检查TCP配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^\$ModLoad /etc/rsyslog.conf /etc/rsyslog.d/*.conf | grep imtcp</span></span><br><span class="line">/etc/rsyslog.conf:<span class="variable">$ModLoad</span> imtcp</span><br><span class="line"><span class="comment"># grep ^\$InputTCPServerRun /etc/rsyslog.conf /etc/rsyslog.d/*.conf</span></span><br><span class="line">/etc/rsyslog.conf:<span class="variable">$InputTCPServerRun</span> 11514</span><br></pre></td></tr></table></figure></li><li><p>检查UDP配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep ^\$ModLoad /etc/rsyslog.conf /etc/rsyslog.d/*.conf | grep imudp</span></span><br><span class="line">/etc/rsyslog.conf:<span class="variable">$ModLoad</span> imudp</span><br><span class="line"><span class="comment"># grep ^\$InputUDPServerRun /etc/rsyslog.conf /etc/rsyslog.d/*.conf</span></span><br><span class="line">/etc/rsyslog.conf:<span class="variable">$InputUDPServerRun</span> 11514</span><br></pre></td></tr></table></figure></li></ul><p><strong>修复方法：</strong></p><p>修改&#x2F;etc&#x2F;rsyslog.conf或&#x2F;etc&#x2F;rsyslog.d&#x2F;*.conf，配置接受远程rsyslog消息，并根据客户端IP单独存放在不同目录，可以自定义指定目录：</p><ul><li><p>修复TCP配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line"><span class="variable">$ModLoad</span> imtcp</span><br><span class="line"><span class="variable">$InputTCPServerRun</span> 11514</span><br><span class="line"><span class="variable">$template</span> Remote, <span class="string">&quot;/var/log/syslog/%fromhost-ip%/%<span class="variable">$YEAR</span>%-%<span class="variable">$MONTH</span>%-%<span class="variable">$DAY</span>%.log&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>修复UDP配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/rsyslog.conf</span></span><br><span class="line"><span class="variable">$ModLoad</span> imudp</span><br><span class="line"><span class="variable">$InputUDPServerRun</span> 11514</span><br><span class="line"><span class="variable">$template</span> Remote, <span class="string">&quot;/var/log/syslog/%fromhost-ip%/%<span class="variable">$YEAR</span>%-%<span class="variable">$MONTH</span>%-%<span class="variable">$DAY</span>%.log&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>执行如下命令，重启服务，使配置生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart rsyslog.service</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安全配置基线 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux常用配置项</title>
      <link href="/posts/217c81a9.html"/>
      <url>/posts/217c81a9.html</url>
      
        <content type="html"><![CDATA[<h2 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：主机名不要使用下划线，但支持横线、数字. 数字中间也不要使用小数点,会导致一些服务起不来</span></span><br><span class="line">hostname ubuntu18-04   <span class="comment"># 临时设置主机名</span></span><br><span class="line">hostnamectl set-hostname ubuntu18-04  <span class="comment"># 永久设置主机名</span></span><br></pre></td></tr></table></figure><h2 id="创建账号和修改密码"><a href="#创建账号和修改密码" class="headerlink" title="创建账号和修改密码"></a>创建账号和修改密码</h2><p><a href="https://blog.csdn.net/qq_27754983/article/details/73693060">CentOS批量添加用户和修改密码_批量修改centos6服务器用户密码_烟雨醉梦里的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/hhd1988/article/details/127275470">Linux：如何在centos下创建新用户名和密码_centos创建用户_技术探索者的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/gahsfjshf/article/details/121115663">centos 7修改用户名和密码_centos7修改用户名_古人诚不我欺的博客-CSDN博客</a></p><p><a href="https://www.jianshu.com/p/581c0444d627">Centos 7 忘记密码重置用户密码 - 简书 (jianshu.com)</a></p><h3 id="创建账号-修改密码"><a href="#创建账号-修改密码" class="headerlink" title="创建账号&#x2F;修改密码"></a>创建账号&#x2F;修改密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改账号密码</span></span><br><span class="line"><span class="built_in">echo</span> 密码 | passwd --stdin 账号名</span><br></pre></td></tr></table></figure><h3 id="配置开机默认用户"><a href="#配置开机默认用户" class="headerlink" title="配置开机默认用户"></a>配置开机默认用户</h3><p>配置文件路径：<code>/etc/gdm/custom.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/gdm/custom.conf</span><br><span class="line"><span class="comment"># GDM configuration storage</span></span><br><span class="line">[daemon]</span><br><span class="line"><span class="comment"># Uncomment the line below to force the login screen to use Xorg</span></span><br><span class="line"><span class="comment">#WaylandEnable=false</span></span><br><span class="line">[security]</span><br><span class="line">[xdmcp]</span><br><span class="line">[chooser]</span><br><span class="line">[debug]</span><br><span class="line"><span class="comment"># Uncomment the line below to turn on debugging</span></span><br><span class="line"><span class="comment">#Enable=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 [daemon] 下写入：</span></span><br><span class="line">AutomaticLoginEnable=True</span><br><span class="line">AutomaticLogin=&lt;用户名&gt;</span><br></pre></td></tr></table></figure><p>重启系统后即可自动进入你指定的账户了。</p><h2 id="配置静态IP地址"><a href="#配置静态IP地址" class="headerlink" title="配置静态IP地址"></a>配置静态IP地址</h2><h3 id="Centos-7配置静态IP地址"><a href="#Centos-7配置静态IP地址" class="headerlink" title="Centos 7配置静态IP地址"></a>Centos 7配置静态IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑网卡配置文件</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static     <span class="comment"># 静态</span></span><br><span class="line">IPADDR=10.0.0.181    <span class="comment"># IP地址</span></span><br><span class="line">PREFIX=24            <span class="comment"># 子网掩码</span></span><br><span class="line">DNS=10.0.0.1         <span class="comment"># DNS地址</span></span><br><span class="line">GATEWAY=10.0.0.1     <span class="comment"># 网关地址</span></span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">NAME=eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span>           <span class="comment"># 开启自动启动</span></span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><h3 id="ubuntu配置静态IP地址"><a href="#ubuntu配置静态IP地址" class="headerlink" title="ubuntu配置静态IP地址"></a>ubuntu配置静态IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 18.04和20.04的网卡配置文件名是01-netcfg.yaml, 22.04版本变为00-installer-config.yaml</span></span><br><span class="line"><span class="comment"># 编辑网卡配置文件</span></span><br><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:                             <span class="comment">#网卡名</span></span><br><span class="line">      addresses: [10.0.0.182/24]      <span class="comment">#静态IP地址</span></span><br><span class="line">      dhcp4: no                       <span class="comment">#取消ipv4的dhcp</span></span><br><span class="line">      optional: <span class="literal">true</span></span><br><span class="line">      gateway4: 10.0.0.1              <span class="comment">#网关地址</span></span><br><span class="line">      nameservers:</span><br><span class="line">         addresses: [180.76.76.76,223.5.5.5 ]   <span class="comment">#DNS地址，多个用逗号分隔,中间不要有空格</span></span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">sudo netplan apply</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2204配置静态IP地址,gateway4已经被弃用需要使用routes参数配置网关</span></span><br><span class="line">vim /etc/netplan/00-installer-config.yaml</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses:</span><br><span class="line">        - 10.0.0.10/24</span><br><span class="line">      routes:</span><br><span class="line">        - to: default</span><br><span class="line">          via: 10.0.0.2</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses:</span><br><span class="line">          - 180.76.76.76</span><br><span class="line">          - 223.5.5.5</span><br><span class="line"><span class="comment"># 重启网络</span></span><br><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure><h3 id="Centos-8配置静态IP地址"><a href="#Centos-8配置静态IP地址" class="headerlink" title="Centos 8配置静态IP地址"></a>Centos 8配置静态IP地址</h3><p>在centos 8之后，使用<code>systemctl restart network</code>命令重启网络时，会出现以下报错:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Failed to restart network.service: Unit network.service not found.</span><br><span class="line">意思为无法重启网络服务，原因是无法找到network.service网络服务。</span><br></pre></td></tr></table></figure><p>在rhel8(含centos8)上，在&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;里也看不到任何脚本文件(centos7中此路径下包含网卡配置文件和一些脚本)，没有传统的network.service。因此只能通过NM命令工具集进行网络配置。换言之，在rhel8上，必须开启NM，否则无法使用网络。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑网卡配置文件</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens32</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=066b4926-b40c-4c28-a5b4-2310d2b96613</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=192.168.1.200</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.1.254</span><br><span class="line">DNS1=223.5.5.5</span><br><span class="line">DNS2=180.76.76.76</span><br><span class="line">PREFIX=24</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载重载ens32 网卡</span></span><br><span class="line">nmcli c reload eth0</span><br><span class="line"><span class="comment"># 启用connection（相当于ifup）</span></span><br><span class="line">nmcli c up eth0</span><br></pre></td></tr></table></figure><h3 id="nmcli常用命令一览"><a href="#nmcli常用命令一览" class="headerlink" title="nmcli常用命令一览"></a>nmcli常用命令一览</h3><p><a href="https://www.cnblogs.com/qianyuliang/archive/2019/09/26/11591970.html">Centos8 配置静态IP - 浅雨凉 - 博客园 (cnblogs.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看ip（类似于ifconfig、ip addr）</span></span><br><span class="line">nmcli</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建connection，配置静态ip（等同于配置ifcfg，其中BOOTPROTO=none，并ifup启动）</span></span><br><span class="line">nmcli c add <span class="built_in">type</span> ethernet con-name ens32 ifname ens32 ipv4.addr 192.168.1.100/24 ipv4.gateway 192.168.1.1 ipv4.method manual</span><br><span class="line"><span class="comment"># 创建connection，配置动态ip（等同于配置ifcfg，其中BOOTPROTO=dhcp，并ifup启动）</span></span><br><span class="line">nmcli c add <span class="built_in">type</span> ethernet con-name ens32 ifname ens32 ipv4.method auto</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改ip（非交互式）</span></span><br><span class="line">nmcli c modify ens32 ipv4.addr <span class="string">&#x27;192.168.1.200/24&#x27;</span></span><br><span class="line">nmcli c up ens32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用connection（相当于ifup）</span></span><br><span class="line">nmcli c up ens32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止connection（相当于ifdown）</span></span><br><span class="line">nmcli c down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除connection（类似于ifdown并删除ifcfg）</span></span><br><span class="line">nmcli c delete ens32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看connection列表</span></span><br><span class="line">nmcli c show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看connection详细信息</span></span><br><span class="line">nmcli c show ens32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载所有ifcfg或route到connection（不会立即生效）</span></span><br><span class="line">nmcli c reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即生效connection，有3种方法</span></span><br><span class="line">nmcli c up ens32</span><br><span class="line">nmcli d reapply ens32</span><br><span class="line">nmcli d connect ens32</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看device详细信息</span></span><br><span class="line">nmcli d show      <span class="comment"># 查看所有device详细信息</span></span><br><span class="line">nmcli d show ens32  <span class="comment"># 查看指定device的详细信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看NM纳管状态</span></span><br><span class="line">nmcli n</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 开启NM纳管</span></span><br><span class="line">nmcli n on</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 关闭NM纳管（谨慎执行）</span></span><br><span class="line">nmcli n off</span><br></pre></td></tr></table></figure><h2 id="yum、apt的基本使用"><a href="#yum、apt的基本使用" class="headerlink" title="yum、apt的基本使用"></a>yum、apt的基本使用</h2><h3 id="yum-dnf常用命令"><a href="#yum-dnf常用命令" class="headerlink" title="yum&#x2F;dnf常用命令"></a>yum&#x2F;dnf常用命令</h3><p>DNF，即DaNdiFied，是新一代的RPM软件包管理器。DNF 发行日期是2015年5月11日，DNF 包管理器采用Python 编写，发行许可为GPL v2，首先出现在Fedora 18 发行版中。在 RHEL 8.0 版本正式取代了 YUM，DNF包管理器克服了YUM包管理器的一些瓶颈，提升了包括用户体验，内存占用，依赖分析，运行速度等.</p><p>yum客户端配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/yum.conf               <span class="comment">#为所有仓库提供公共配置</span></span><br><span class="line">/etc/yum.repos.d/*.repo：   <span class="comment">#为每个仓库的提供配置文件</span></span><br></pre></td></tr></table></figure><p>常用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yum instll -y package_name    <span class="comment"># 安装指定软件包并确认安装</span></span><br><span class="line">yum update                    <span class="comment"># 更新系统中所有软件包</span></span><br><span class="line">yum upgrade package_name      <span class="comment"># 升级指定的软件包：</span></span><br><span class="line">yum repolist                  <span class="comment"># 列出可用的镜像源</span></span><br><span class="line">yum list                      <span class="comment"># 列出所有可用的package和package组,会有大量输出</span></span><br><span class="line">yum clean all                 <span class="comment"># 清除所有缓冲数据</span></span><br><span class="line">yum makecache                 <span class="comment"># 缓存本地yum源</span></span><br><span class="line">yum provides httpd            <span class="comment"># 查看提供某个命令的rpm包</span></span><br><span class="line">yum deplist httpd             <span class="comment"># 列出一个包所有依赖的包</span></span><br><span class="line">yum remove package_name       <span class="comment"># 删除指定软件包</span></span><br><span class="line">yum install --downloadonly --downloaddir=/package_installdir/ package_name  <span class="comment"># 软件包仅下载不安装,如果下载的包有依赖也会一起下载. 如果提示没有--downloadonly选项则需要安装yum-plugin-downloadonly软件包(只有centos 6需要)；</span></span><br><span class="line">yum search package_name        <span class="comment"># 搜索可用的软件包</span></span><br><span class="line">yum info package_name          <span class="comment"># 显示已安装的软件包的信息</span></span><br><span class="line">yum installed                  <span class="comment"># 查看已经安装的包</span></span><br><span class="line">yum list available             <span class="comment"># 查看可安装的包</span></span><br><span class="line">yum list updates               <span class="comment"># 查看可以升级的包</span></span><br><span class="line">yum check-update               <span class="comment"># 检查更新</span></span><br></pre></td></tr></table></figure><p>yum仓库管理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum repolist all               <span class="comment"># 显示所有资源库</span></span><br><span class="line">yum repolist enabled           <span class="comment"># 显示所有已启动的资源库</span></span><br><span class="line">yum repolist disabled          <span class="comment"># 显示所有被禁用的资源库</span></span><br><span class="line">yum-config-manager --<span class="built_in">disable</span> epel   <span class="comment"># 禁用仓库epel</span></span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> epel    <span class="comment">#启用仓库epel</span></span><br></pre></td></tr></table></figure><h3 id="apt常用命令"><a href="#apt常用命令" class="headerlink" title="apt常用命令"></a>apt常用命令</h3><p>apt 相当于 <code>apt-get、apt-cache </code>和 <code>apt-config </code>中最常用命令选项的集合</p><p>apt 具有更精减但足够的命令选项，而且参数选项的组织方式更为有效。此外，启用的几个特性也非常 有帮助。例如：可以在使用 apt 命令安装或删除程序时看到进度条,apt 还会在更新存储库数据库时提示</p><p>用户可升级的软件包个数 apt 与 apt-get 有一些类似的命令选项，但它并不能完全向下兼容 apt-get 命令,也即可用 apt 替换部分 apt-get 系列命令，但不是全部.</p><p>APT包索引配置文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/apt/sources.list </span><br><span class="line">/etc/apt/sources.list.d</span><br></pre></td></tr></table></figure><p>常用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">apt list                  <span class="comment">#列出包含条件的包（已安装，可升级等），等于yum list</span></span><br><span class="line">apt list --installed      <span class="comment">#列出已安装的软件包</span></span><br><span class="line">apt edit-sources          <span class="comment">#编辑source源⽂件</span></span><br><span class="line">apt search apache2        <span class="comment">#搜索安装包apache2</span></span><br><span class="line">apt show apache2          <span class="comment">#或者apt-cache show apache2 更详细, 查看仓库中软件包的详细信息</span></span><br><span class="line">apt-cache madison nginx   <span class="comment">#查看仓库中软件包有哪些版本可以安装</span></span><br><span class="line">apt install apache2       <span class="comment">#或者apt-get install apache2, 在线安装软件包apache2</span></span><br><span class="line">apt install nginx=1.14.0-0ubuntu1.6     <span class="comment">#安装软件包的时候指定安装具体的版本,配合apt-cache madison使用</span></span><br><span class="line">apt remove apache2        <span class="comment">#卸载单个软件包但是保留配置⽂件</span></span><br><span class="line">apt purge apache2         <span class="comment">#卸载单个软件包以及删除配置⽂件</span></span><br><span class="line">apt autoremove apache2    <span class="comment">#删除安装包并解决依赖关系</span></span><br><span class="line">apt update                <span class="comment">#更新本地软件包列表索引，修改了apt仓库后必须执⾏</span></span><br><span class="line">apt upgrade               <span class="comment">#升级所有已安装且可升级到新版本的软件包</span></span><br><span class="line">apt full-upgrade          <span class="comment"># 或者apt-get dist-upgrade, 在线升级整个系统软件包,自动处理依赖关系，必要时可以移除旧软件包。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看文件来自于哪个包,类似redhat中的yum provides &lt;filename&gt;</span></span><br><span class="line">apt-file search <span class="string">&#x27;string&#x27;</span>  <span class="comment">#默认是包含此字符串的文件</span></span><br><span class="line">apt-file search -x  <span class="string">&#x27;正则表达式&#x27;</span></span><br><span class="line">apt-file search -F /path/file</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询软件xxx依赖哪些包</span></span><br><span class="line">apt depends xxx</span><br><span class="line">apt-cache depends xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询软件xxx被哪些包依赖</span></span><br><span class="line">apt rdepends xxx</span><br><span class="line">apt-cache rdepends xxx</span><br></pre></td></tr></table></figure><h3 id="安装常用软件包"><a href="#安装常用软件包" class="headerlink" title="安装常用软件包"></a>安装常用软件包</h3><p>ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install purge ufw lxd lxd-client lxcfs lxc-common</span><br><span class="line">apt install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute gcc openssh-server lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip libevent-dev</span><br><span class="line">apt install procps         <span class="comment"># top 命令</span></span><br><span class="line">apt install iputils-ping   <span class="comment"># ping 命令</span></span><br><span class="line">apt install net-tools      <span class="comment"># 网络工具</span></span><br></pre></td></tr></table></figure><p>centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最小化安装建议的软件包</span></span><br><span class="line">yum install gcc make autoconf gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel systemd-devel zlib-devel vim lrzsz tree tmux lsof tcpdump wget net-tools iotop bc bzip2 zip unzip nfs-utils man-pages autofs</span><br></pre></td></tr></table></figure><h2 id="rpm、dpkg包的基本查询和使用"><a href="#rpm、dpkg包的基本查询和使用" class="headerlink" title="rpm、dpkg包的基本查询和使用"></a>rpm、dpkg包的基本查询和使用</h2><h3 id="rpm常用命令"><a href="#rpm常用命令" class="headerlink" title="rpm常用命令"></a>rpm常用命令</h3><p>RPM包默认安装路径: 通常情况下，RPM 包采用系统默认的安装路径，所有安装文件会按照类别分散安装到目录中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认安装路径            含 义</span></span><br><span class="line">/etc/                     <span class="comment"># 配置文件安装目录</span></span><br><span class="line">/usr/bin/                 <span class="comment"># 可执行的命令安装目录</span></span><br><span class="line">/usr/lib/                 <span class="comment"># 程序所使用的函数库保存位置</span></span><br><span class="line">/usr/share/doc/             <span class="comment"># 基本的软件使用手册保存位置</span></span><br><span class="line">/usr/share/man/             <span class="comment"># 帮助文件保存位置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># rpm常用命令</span></span><br><span class="line">rpm -Uvh 包全名               <span class="comment"># RPM 包的升级</span></span><br><span class="line">rpm -ivh xxx.rpm             <span class="comment"># 安装 RPM, 后跟详细路径,h显示进度,v显示过程</span></span><br><span class="line">rpm -ivh xxx.rpm --force     <span class="comment"># 强行安装</span></span><br><span class="line">rpm -e 包全名                 <span class="comment"># 卸载</span></span><br><span class="line">rpm -qa vsftpd               <span class="comment"># 查询安装的包,后跟明确的包名,以vsftpd为例</span></span><br><span class="line">rpm -qa |<span class="built_in">wc</span> -l               <span class="comment"># 列出所有安装的包,并统计数量</span></span><br><span class="line">rpm -qa |grep vsft           <span class="comment"># 利用grep进行模糊搜索,如搜索vsftpd包</span></span><br><span class="line">rpm -qi vsftpd               <span class="comment"># 查看包的信息,安装日期等</span></span><br><span class="line">rpm -ql vsftpd               <span class="comment"># 列出包中所有文件列表</span></span><br><span class="line">rpm -qc vsftpd               <span class="comment"># 列出包的配置文件</span></span><br><span class="line">rpm -q --scripts vsftpd      <span class="comment">#列出包中的脚本文件</span></span><br><span class="line">rpm -qf /etc/issue           <span class="comment"># 查看某个文件来自哪个包,如/etc/issue</span></span><br></pre></td></tr></table></figure><h3 id="dpkg常用命令"><a href="#dpkg常用命令" class="headerlink" title="dpkg常用命令"></a>dpkg常用命令</h3><p>注意：一般建议不要使用dpkg卸载软件包。因为删除包时，其它依赖它的包不会卸载，并且可能无法再正常运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装包</span></span><br><span class="line">dpkg -i package.deb </span><br><span class="line"></span><br><span class="line"><span class="comment">#删除包，不建议，不自动卸载依赖于它的包</span></span><br><span class="line">dpkg -r package </span><br><span class="line"></span><br><span class="line"><span class="comment">#删除包（包括配置文件）</span></span><br><span class="line">dpkg -P package </span><br><span class="line"></span><br><span class="line"><span class="comment">#列出当前已安装的包，类似rpm -qa</span></span><br><span class="line">dpkg -l</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看软件包信息</span></span><br><span class="line">dpkg -I package.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#列出该包的状态，包括详细信息，类似rpm –qi</span></span><br><span class="line">dpkg -s package </span><br><span class="line"></span><br><span class="line"><span class="comment">#列出该包中所包含的文件，类似rpm –ql </span></span><br><span class="line">dpkg -L package </span><br><span class="line"></span><br><span class="line"><span class="comment">#搜索包含pattern的包，类似rpm –qf </span></span><br><span class="line">dpkg -S &lt;pattern&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">#配置包，-a 使用，配置所有没有配置的软件包</span></span><br><span class="line">dpkg --configure package </span><br><span class="line"></span><br><span class="line"><span class="comment">#列出 deb 包的内容，⽂件及⽬录内容,类似rpm –qpl </span></span><br><span class="line">dpkg -c package.deb </span><br><span class="line"></span><br><span class="line"><span class="comment">#解开 deb 包的内容</span></span><br><span class="line">dpkg --unpack package.deb</span><br></pre></td></tr></table></figure><h2 id="配置sshd-root远程登陆"><a href="#配置sshd-root远程登陆" class="headerlink" title="配置sshd root远程登陆"></a>配置sshd root远程登陆</h2><p>默认情况下，ubuntu不允许root⽤⼾远程ssh，如果有实际场景需要允许 root⽤⼾远程ssh，则需要设置root密码，并且编辑&#x2F;etc&#x2F;ssh&#x2F;sshd_config ⽂件(注意,不是&#x2F;etc&#x2F;ssh&#x2F;ssh_config文件)修改如下 :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">32 <span class="comment">#PermitRootLogin prohibit-password  #默认为禁⽌登录</span></span><br><span class="line">33 PermitRootLogin <span class="built_in">yes</span>   <span class="comment">#改为允许登录</span></span><br><span class="line">57 <span class="comment">#PasswordAuthentication yes</span></span><br><span class="line">58 PasswordAuthentication <span class="built_in">yes</span> <span class="comment">#打开密码认证，其实默认就是允许通过密码认证登录</span></span><br><span class="line"></span><br><span class="line">su - root    <span class="comment">#切换到root⽤户环境</span></span><br><span class="line">passwd root  <span class="comment">#设置密码</span></span><br><span class="line">systemctl restart sshd <span class="comment">#重启ssh服务并测试root⽤户远程ssh连接</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用命令修改ssd配置文件</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;s/^#\?PermitRootLogin.*/PermitRootLogin yes/g&#x27;</span> /etc/ssh/sshd_config;</span><br><span class="line">sudo sed -i <span class="string">&#x27;s/^#\?PasswordAuthentication.*/PasswordAuthentication yes/g&#x27;</span> /etc/ssh/sshd_config;</span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure><h2 id="修改网卡名称为eth0"><a href="#修改网卡名称为eth0" class="headerlink" title="修改网卡名称为eth0"></a>修改网卡名称为eth0</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑grub配置文件/etc/sysconfig/grub</span></span><br><span class="line">sudo vim /etc/default/grub</span><br><span class="line"><span class="comment"># 在GRUB_CMDLINE_LINUX前面添加参数net.ifnames=0 biosdevname=0，前后使用空格分隔</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;net.ifnames=0 biosdevname=0 find_preseed=/preseed.cfg auto noprompt priority=critical locale=en_US&quot;</span></span><br><span class="line"><span class="comment"># ubuntu重新生成grub配置并更新内核参数</span></span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg  </span><br><span class="line"><span class="comment">#centos重新生成grub配置并更新内核参数</span></span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg  </span><br><span class="line"><span class="comment"># 或者都可以使用下面的命令更新grub配置</span></span><br><span class="line">sudo update-grub</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">#centos修改网卡配置文件: 复制网卡配置文件, 名称可能会不同</span></span><br><span class="line"><span class="built_in">cp</span> /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="comment">#编辑网卡配置文件, 修改网卡名称</span></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=10.0.0.181</span><br><span class="line">PREFIX=24</span><br><span class="line">DNS=10.0.0.1</span><br><span class="line">GATEWAY=10.0.0.1</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">NAME=eth0      <span class="comment">#修改为新的eth0</span></span><br><span class="line">DEVICE=eth0    <span class="comment">#修改为新的eth0</span></span><br><span class="line">ONBOOT=<span class="built_in">yes</span>   </span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu修改网卡配置文件, 名称可能不同，使用tab补全即可</span></span><br><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:                             <span class="comment">#修改网卡名</span></span><br><span class="line">      addresses: [10.0.0.182/24]      <span class="comment">#静态IP地址</span></span><br><span class="line">      dhcp4: no                       <span class="comment">#取消ipv4的dhcp</span></span><br><span class="line">      optional: <span class="literal">true</span></span><br><span class="line">      gateway4: 10.0.0.1              <span class="comment">#网关地址</span></span><br><span class="line">      nameservers:</span><br><span class="line">         addresses: [180.76.76.76,223.5.5.5 ] <span class="comment">#DNS地址，多个用逗号分隔</span></span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure><h2 id="查看和关闭防火墙"><a href="#查看和关闭防火墙" class="headerlink" title="查看和关闭防火墙"></a>查看和关闭防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 7/8</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> --now firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo ufw <span class="built_in">disable</span> &amp;&amp; sudo ufw status</span><br></pre></td></tr></table></figure><h2 id="查看和关闭Selinux"><a href="#查看和关闭Selinux" class="headerlink" title="查看和关闭Selinux"></a>查看和关闭Selinux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu 中默认没有安装 SELinux, Ubuntu有一个类似于SELinux的强制访问控制系统，名为AppArmor。</span></span><br><span class="line">sudo systemctl status apparmor  <span class="comment"># 查看apparmor状态</span></span><br><span class="line">sudo systemctl stop apparmor    <span class="comment"># 停止apparmor</span></span><br><span class="line">sudo systemctl <span class="built_in">disable</span> apparmor <span class="comment"># 禁止apparmor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看selinux状态</span></span><br><span class="line">sestatus   <span class="comment"># 或者 getenforce</span></span><br><span class="line"><span class="comment"># 查看selinux配置文件, SELinux共有3个状态enforcing （执行中）、permissive（不执行但产生警告）、disabled（关闭）</span></span><br><span class="line"><span class="built_in">cat</span> /etc/selinux/config</span><br><span class="line"><span class="comment">#临时关闭selinux, 设置为permissive模式；setenforce 1 设置为enforcing模式；</span></span><br><span class="line">setenforce 0   </span><br><span class="line"><span class="comment">#永久关闭selinux需要编辑配置文件</span></span><br><span class="line">sed -i <span class="string">&#x27;s#SELINUX=enforcing#SELINUX=disabled#g&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure><h2 id="查看和关闭swap分区"><a href="#查看和关闭swap分区" class="headerlink" title="查看和关闭swap分区"></a>查看和关闭swap分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a   <span class="comment"># 临时关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭swap需要编辑配置文件,将swap分区注释掉并重启生效</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=e309bcf8-7056-4f7d-961a-3e6c8b1e2c48 /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=D330-01CD          /boot/efi               vfat    <span class="built_in">umask</span>=0077,shortname=winnt 0 2</span><br><span class="line">/dev/mapper/rl-home     /home                   xfs     defaults        0 0</span><br><span class="line"><span class="comment"># /dev/mapper/rl-swap     none                    swap    defaults        0 0   #注释掉swap分区</span></span><br></pre></td></tr></table></figure><h2 id="配置系统服务systemd"><a href="#配置系统服务systemd" class="headerlink" title="配置系统服务systemd"></a>配置系统服务systemd</h2><p>systemd（是的，全小写，即使在句子开头也是小写），是初始化程序（init）和 SystemV 初始化脚本的现代替代者。</p><p>像 init 一样，systemd 是所有进程之母，它负责使 Linux 主机启动到可以做生产性任务的状态。systemd 设定的一些功能比老的初始化程序要广泛得多，它要管理正在运行的 Linux 主机的许多方面，包括挂载文件系统、管理硬件、处理定时器以及启动和管理生产性主机所需的系统服务。</p><h3 id="centos6"><a href="#centos6" class="headerlink" title="centos6"></a>centos6</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">service [服务] start     <span class="comment"># 启动服务</span></span><br><span class="line">service [服务] stop      <span class="comment">#停止服务</span></span><br><span class="line">service [服务] restart   <span class="comment">#重启服务</span></span><br><span class="line">service [服务] status    <span class="comment">#查看服务状态</span></span><br><span class="line">chkconfig [服务] on      <span class="comment">#设置服务在各等级为on,开机启动，“各等级”包括2、3、4、5等级</span></span><br><span class="line">chkconfig [服务] off     <span class="comment">#设置服务禁止开机启动</span></span><br><span class="line">chkconfig --add name    <span class="comment">#添加service, 添加一个chkconfig管理的service，并在/etc/rc[0-6].d 目录下添加相应的符号链接</span></span><br><span class="line">chkconfig --del name    <span class="comment">#删除service, 从chkconfig 管理名单中删除该service，并且删除 /etc/rc[0-6].d 目录下所有与之关联的符号链接</span></span><br><span class="line">chkconfig --list [name]  <span class="comment"># 列出service的启动信息, 如果不指定name，会列出所有services的信息。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置service运行级别</span></span><br><span class="line">chkconfig --level 2345 httpd on     <span class="comment">#设置httpd在运行级别为2、3、4的情况下都是on（开启）的状态</span></span><br><span class="line"><span class="comment">#指定运行级为2,3,4,5</span></span><br><span class="line"><span class="comment">#等级0表示：表示关机</span></span><br><span class="line"><span class="comment">#等级1表示：单用户模式</span></span><br><span class="line"><span class="comment">#等级2表示：无网络连接的多用户命令行模式</span></span><br><span class="line"><span class="comment">#等级3表示：有网络连接的多用户命令行模式</span></span><br><span class="line"><span class="comment">#等级4表示：不可用</span></span><br><span class="line"><span class="comment">#等级5表示：带图形界面的多用户模式</span></span><br><span class="line"><span class="comment">#等级6表示：重新启动</span></span><br></pre></td></tr></table></figure><h3 id="centos7-8、ubuntu"><a href="#centos7-8、ubuntu" class="headerlink" title="centos7&#x2F;8、ubuntu"></a>centos7&#x2F;8、ubuntu</h3><p><a href="https://cloud.tencent.com/developer/article/1516125">可能是史上最全面易懂的 Systemd 服务管理教程！( 强烈建议收藏 )-腾讯云开发者社区-腾讯云 (tencent.com)</a></p><p>常用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件</span></span><br><span class="line">/etc/systemd/system：系统或用户自定义的配置文件   Ubuntu: Unit文件指向该目录</span><br><span class="line">/run/systemd/system：软件运行时生成的配置文件</span><br><span class="line">/usr/lib/systemd/system：系统或第三方软件安装时添加的配置文件。 CentOS 7/8：Unit 文件指向该目录</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload        <span class="comment">#重新加载服务，每次修改了 unit 的配置文件后，需要执行以下命令重新加载 unit 的配置文件</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker        <span class="comment">#设置开机自动启动docker</span></span><br><span class="line">systemctl status docker        <span class="comment">#查看 docker服务状态</span></span><br><span class="line">systemctl start docker         <span class="comment">#启动docker</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now docker  <span class="comment">#立即启动并设置为开机启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> docker       <span class="comment">#取消 unit 开机启动</span></span><br><span class="line"></span><br><span class="line">systemctl is-enabled docker    <span class="comment">#查看 unit 是否开机启动</span></span><br><span class="line">systemctl <span class="built_in">cat</span> docker.service   <span class="comment">#查看 Unit 配置文件的内容</span></span><br><span class="line">systemctl -H root@rhel7.example.com status httpd.service   <span class="comment"># 显示远程主机的某个 Unit 的状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有正在运行的服务（即所有已加载和正在运行的服务）</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --state=running   <span class="comment">#或者 systemctl --type=service --state=running</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有已加载但处于活动状态的服务，包括正在运行的服务和已退出的服务，可以添加--state选项，其值为active</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --state=active    <span class="comment">#或者 systemctl --type=service --state=active</span></span><br></pre></td></tr></table></figure><p>target启动管理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前系统的所有 Target</span></span><br><span class="line">systemctl list-unit-files --<span class="built_in">type</span>=target</span><br><span class="line"></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=target  <span class="comment"># 获取当前正在使用的运行target</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一个 Target 包含的所有 Unit</span></span><br><span class="line">systemctl list-dependencies multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看启动时的默认Target运行级别</span></span><br><span class="line">systemctl get-default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置启动时的默认 Target运行级别为mulit-user,进入图形化界面,需要重启才能看到效果</span></span><br><span class="line">systemctl set-default multi-user.target</span><br><span class="line"><span class="comment"># 设置启动时的默认 Target运行级别为mulit-user, 不进入图形界面的多用户模式,需要重启才能看到效果。</span></span><br><span class="line">systemctl set-default graphical.target</span><br><span class="line"></span><br><span class="line">systemctl isolate multi-user.target   <span class="comment"># 在不重启的情况下，切换到运行级别mulit-user下</span></span><br><span class="line">systemctl isolate graphical.target   <span class="comment"># 在不重启的情况下，切换到图形界面下</span></span><br></pre></td></tr></table></figure><p>systemctl: 用于检查和控制各种系统服务和资源的状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启系统</span></span><br><span class="line">systemctl reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭系统，切断电源</span></span><br><span class="line">systemctl poweroff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入睡眠模式,暂停系统</span></span><br><span class="line">systemctl <span class="built_in">suspend</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统进入休眠状态</span></span><br><span class="line">systemctl hibernate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让系统进入交互式休眠状态</span></span><br><span class="line">systemctl hybrid-sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制进入救援状态（单用户状态）</span></span><br><span class="line">systemctl rescue</span><br><span class="line"><span class="comment"># 强制进入紧急救援模式</span></span><br><span class="line">systemctl emergency</span><br></pre></td></tr></table></figure><p>systemd-analyze: 显示此次系统启动时运行每个服务所消耗的时间，可以用于分析系统启动过程中的性能瓶颈</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看启动耗时</span></span><br><span class="line">systemd-analyze</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看每个服务的启动耗时</span></span><br><span class="line">systemd-analyze blame</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示瀑布状的启动过程流</span></span><br><span class="line">systemd-analyze critical-chain</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定服务的启动流</span></span><br><span class="line">systemd-analyze critical-chain atd.service</span><br></pre></td></tr></table></figure><p>hostnamectl: 查看和修改系统的主机名和主机信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前主机的信息</span></span><br><span class="line">hostnamectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置主机名。</span></span><br><span class="line">hostnamectl set-hostname rhel7</span><br></pre></td></tr></table></figure><p>timedatectl: 用于查看和管理系统的时间和时区信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前时区设置</span></span><br><span class="line">timedatectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有可用的时区</span></span><br><span class="line">timedatectl list-timezones</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置当前时区</span></span><br><span class="line">timedatectl set-timezone America/New_York   <span class="comment">#设置时区为美国纽约</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai      <span class="comment">#设置时区为中国上海</span></span><br><span class="line">timedatectl set-time YYYY-MM-DD             <span class="comment">#设置年,月,日</span></span><br><span class="line">timedatectl set-time HH:MM:SS               <span class="comment">#设置时间:小时,分钟,秒</span></span><br></pre></td></tr></table></figure><p>loginctl: 用于管理系统已登录用户和 Session 的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出当前 session</span></span><br><span class="line">loginctl list-sessions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前登录用户</span></span><br><span class="line">loginctl list-users</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出显示指定用户的信息</span></span><br><span class="line">loginctl show-user ruanyf</span><br></pre></td></tr></table></figure><p>systemd-ask-password: 辅助性工具，用星号屏蔽用户的任意输入，然后返回实际输入的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PASSWORD=$(systemd-ask-password <span class="string">&quot;Input Your Passowrd:&quot;</span>)</span><br><span class="line">systemd-detect-virt</span><br></pre></td></tr></table></figure><p>systemd-detect-virt：显示主机的虚拟化类型</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd-detect-virt</span><br></pre></td></tr></table></figure><p>systemd-run: 用于将任意指定的命令包装成一个临时的后台服务运行</p><p><a href="https://www.jinbuguo.com/systemd/systemd-run.html">systemd-run 中文手册 金步国</a></p><p>systemd-run 可以将一个指定的操作变成后台运行的服务。它的效果似乎与直接在命令后加上表示后台运行的 &amp; 符号很相似。然而，它让命令成为服务还意味着，它的生命周期将由 Systemd 控制。具体来说，包括以下好处：</p><ul><li>服务的生命击期由 Systemd 接管，不会随着启动它的控制台关闭而结束</li><li>可以通过 systemctl 工具管理服务的状态</li><li>可以通过 journalctl 工具查看和管理服务的日志信息</li><li>可以通过 Systemd 提供的方法限制服务的 CPU、内存、磁盘 IO 等系统资源的使用情况。</li></ul><h3 id="systemd-unit配置文件"><a href="#systemd-unit配置文件" class="headerlink" title="systemd unit配置文件"></a>systemd unit配置文件</h3><p>[systemd.index 中文手册 ]<a href="https://www.jinbuguo.com/systemd/systemd.index.htm">https://www.jinbuguo.com/systemd/systemd.index.htm</a></p><p>unit部分: <a href="http://www.jinbuguo.com/systemd/systemd.unit.html">systemd.unit 中文手册</a></p><p>service部分: <a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd.service</a></p><p>如何杀死进程: <a href="http://www.jinbuguo.com/systemd/systemd.kill.html">systemd.kill 中文手册</a></p><p>进程环境变量: <a href="http://www.jinbuguo.com/systemd/systemd.exec.html">systemd.exec 中文手册</a></p><p>常见service unit文件示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prometheus, 注意,每个单元之间必须有空行分开</span></span><br><span class="line">vi /usr/lib/systemd/system/prometheus.service</span><br><span class="line">[Unit] </span><br><span class="line">Description=Prometheus server daemon</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=prometheus       <span class="comment">#运行的用户</span></span><br><span class="line">Group=prometheus      <span class="comment">#运行的组</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">ExecStart=/usr/local/prometheus/prometheus --config.file <span class="string">&quot;/usr/local/prometheus/prometheus.yml&quot;</span> --web.listen-address <span class="string">&quot;0.0.0.0:9090&quot;</span> --storage.tsdb.retention.time=60d <span class="comment">#数据默认保存时间为15天，启动时加上此参数可以控制数据保存时间</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>service unit文件说明</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker</span></span><br><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine     <span class="comment"># 当前 unit 的描述</span></span><br><span class="line">Documentation=https://docs.docker.com               <span class="comment"># 文档地址</span></span><br><span class="line">After=network-online.target firewalld.service time-set.target   <span class="comment"># 表示本 unit 应该在某服务之后启动,只涉及启动顺序，不涉及依赖关系</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务的依赖关系:</span></span><br><span class="line"><span class="comment">#Requires：表示本 unit 与其它 unit 之间存在强依赖关系，如果本 unit 被激活，此处列出的 unit 也会被激活，如果其中一个依赖的 unit 无法激活，systemd 都不会启动本 unit. </span></span><br><span class="line"><span class="comment">#Wants: 如果依赖的 unit 启动失败，不影响本 unit 的继续运行</span></span><br><span class="line"><span class="comment">#BindsTo：当指定的 unit 停止时，也会导致本 unit 停止</span></span><br><span class="line"><span class="comment">#PartOf：当指定的 unit 停止或重启时，也会导致本 unit 停止或重启</span></span><br><span class="line">Wants=network-online.target  </span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="comment"># 设置进程的启动类型。必须设为 simple, exec, forking, oneshot, dbus, notify, idle之一</span></span><br><span class="line"><span class="comment">#simple: 默认值, ExecStart= 进程就是该服务的主进程， 并且 systemd 会认为在创建了该服务的主服务进程之后，该服务就已经启动完成。</span></span><br><span class="line"><span class="comment">#notify: 该服务将会在启动完成之后通过 [sd_notify](https://www.jinbuguo.com/systemd/sd_notify.html) 之类的接口发送一个通知消息。systemd 将会在启动后继单元之前， 首先确保该进程已经成功的发送了这个消息。</span></span><br><span class="line"><span class="comment">#dbus: 该服务只有获得了 BusName=指定的 D-Bus 名称之后，systemd 才会认为该服务启动完成，才会开始启动后继单元。 设为此类型相当于隐含的依赖于 dbus.socket 单元。</span></span><br><span class="line"><span class="comment">#forking: ExecStart=进程将会在启动过程中使用 fork()系统调用。 也就是当所有通信渠道都已建好、启动亦已成功之后，父进程将会退出，而子进程将作为主服务进程继续运行。 这是传统UNIX守护进程的经典做法。 在这种情况下，systemd 会认为在父进程退出之后，该服务就已经启动完成。 如果使用了此种类型，那么建议同时设置 PIDFile= 选项，以帮助 systemd 准确可靠的定位该服务的主进程。 systemd 将会在父进程退出之后 立即开始启动后继单元。</span></span><br><span class="line"><span class="comment">#idle: 与 simple`类似，不同之处在于， 服务进程将会被延迟到所有活动任务都完成之后再执行。</span></span><br><span class="line"><span class="comment">#exec: 只有在该服务的主服务进程执行完成之后，systemd 才会认为该服务启动完成。 其他后继单元必须一直阻塞到这个时间点之后才能继续启动。</span></span><br><span class="line"><span class="comment">#建议对长时间持续运行的服务尽可能使用 `Type=simple` (这是最简单和速度最快的选择)。 注意，simple类型的服务无法报告启动失败、也无法在服务完成初始化后对其他单元进行排序</span></span><br><span class="line"><span class="comment">#当当客户端需要通过仅由该服务本身创建的IPC通道(而非由 systemd 创建的套接字或 D-bus 之类)连接到该服务的时候, notify或 dbus(该服务必须提供 D-Bus 接口) 才是最佳选择， 这两种类型都允许服务进程精确的安排何时算是服务启动成功、何时可以继续启动后继单元。 notify类型需要服务进程明确使用 sd_notify()函数或类似的API， 否则，可以使用 forking作为替代(它支持传统的UNIX服务启动协议)。</span></span><br><span class="line">Type=notify</span><br><span class="line"></span><br><span class="line">ExecStart=/usr/local/bin/dockerd    <span class="comment">#服务启动时执行的命令和参数</span></span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span>    <span class="comment"># 重启服务时执行的命令</span></span><br><span class="line">TimeoutStartSec=0     <span class="comment">#等待服务停止/启动的时间（以秒为单位）</span></span><br><span class="line">RestartSec=2      <span class="comment"># 重新启动服务前的睡眠时间（以秒为单位）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置当服务的进程退出、被杀死或达到超时时是否重新启动服务</span></span><br><span class="line"><span class="comment">#no 服务将不会重新启动，这是默认设置</span></span><br><span class="line"><span class="comment">#on-failure 仅在服务进程异常退出时重启，所谓“异常退出”是指：退出码不为&quot;0&quot;</span></span><br><span class="line"><span class="comment">#on-abnormal 如果进程因信号或超时而终止时重新启动</span></span><br><span class="line"><span class="comment">#always 总是重新启动</span></span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line"><span class="comment"># PIDFile=该服务PID文件的路径(一般位于 /run/目录下)。 强烈建议在 Type=forking的情况下明确设置此选项。 如果设为相对路径，那么表示相对于 /run/目录。 systemd 将会在此服务启动完成之后，从此文件中读取主服务进程的PID 。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WorkingDirectory=：设置进程的工作目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User=, Group=：设置进程在执行时使用的用户与组，既可以设为一个数字形式的 UID/GID 也可以设为一个字符串形式的名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># BusName= 设置与此服务通信所使用的 D-Bus 名称。 在 `Type=dbus` 的情况下 必须明确设置此选项。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ExecStartPre=: 服务启动之前执行的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ExecStartPost=: 服务启动之后执行的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ExecStop=：服务停止时执行的命令和参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ExecStopPost=：服务停止之后执行的命令</span></span><br><span class="line"></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TasksMax=infinity</span><br><span class="line">Delegate=<span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义systemd如何停止服务</span></span><br><span class="line"><span class="comment">#control-group（默认值）：当前控制组里面的所有子进程，都会被杀掉</span></span><br><span class="line"><span class="comment">#process：只杀主进程</span></span><br><span class="line"><span class="comment">#mixed：主进程将收到SIGTERM信号，子进程收到SIGKILL信号</span></span><br><span class="line"><span class="comment">#none：没有进程会被杀掉，只是执行 ExecStop= 动作, 而不杀死任何进程。 这会导致即使单元已经停止， 但是该单元的 cgroup 依然一直存在， 直到其中的进程全部死亡。</span></span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line">OOMScoreAdjust=-500</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="comment">#Alias：当前 unit 可用于启动的别名，此处列出的名称必须与服务文件名具有相同的后缀（即类型），在执行 systemctl enable 时将创建从这些名称到 unit 文件名的符号链接</span></span><br><span class="line"><span class="comment">#RequiredBy：表示该服务所在的Target，它的值是一个或多个Target，当 systemctl enable 时 unit 符号链接会放入 /etc/systemd/system 目录下面以 Target名 + .required 后缀构成的子目录中</span></span><br><span class="line"><span class="comment">#WantedBy：表示该服务所在的Target，它的值是一个或多个Target，当前 systemctl enable 时 unit符号链接会放入 /etc/systemd/system 目录下面以 Target名 + .wants 后缀构成的子目录中</span></span><br><span class="line"><span class="comment">#Also：当 systemctl enable 或 systemctl disable 时会同时 enable 和 disable 的其它 unit 列表</span></span><br><span class="line"><span class="comment">#Target的含义是服务组，表示一组服务 WantedBy=multi-user.target 指的是，unit 所在的 Target 是multi-user.target（多用户模式）</span></span><br><span class="line"><span class="comment">#这个设置非常重要，因为执行systemctl enable 是会将 unit 链接到 /etc/systemd/system/multi-user.target.wants目录之中，实现开机启动的功能</span></span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">进程环境变量: </span><br><span class="line">* <span class="variable">$PATH</span>：可执行文件的目录列表(冒号分隔的绝对路径)， 此值固定为 `/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`</span><br><span class="line">* <span class="variable">$LANG</span>：本地化设置。可以通过 locale.conf(5) 文件设置</span><br><span class="line">* <span class="variable">$USER</span>, <span class="variable">$LOGNAME</span>, <span class="variable">$HOME</span>, <span class="variable">$SHELL</span>：用户名, 用户名, 家目录, 登录shell</span><br><span class="line">* <span class="variable">$MAINPID</span>：单元主进程的PID (如果能确定的话)</span><br></pre></td></tr></table></figure><h3 id="日志管理工具-journalctl"><a href="#日志管理工具-journalctl" class="headerlink" title="日志管理工具 journalctl"></a>日志管理工具 journalctl</h3><p>[journalctl 中文手册 <a href="https://www.jinbuguo.com/systemd/journalctl.html#">金步国] (jinbuguo.com)</a></p><p>1  概述</p><p>journalctl是ubuntu&#x2F;centos7及以上专有的日志管理工具，该工具是从message这个文件里读取信息。Systemd统一管理所有Unit的启动日志。带来的好处就是，可以只用journalctl一个命令，查看所有日志（内核日志和应用日志）。日志的配置文件是&#x2F;etc&#x2F;systemd&#x2F;journald.conf</p><p>2  journalctl 使用方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有日志, 默认情况下，只保存本次启动的日志</span></span><br><span class="line">journalctl</span><br><span class="line"><span class="comment"># 查看内核日志（不显示应用日志）</span></span><br><span class="line">journalctl -k</span><br><span class="line"><span class="comment"># 查看系统本次启动的日志</span></span><br><span class="line">journalctl   -b</span><br><span class="line">journalctl  -b  -0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看上一次启动的日志,如上次系统崩溃，需要查看日志时就要看上一次的启动日志。需更改设置:</span></span><br><span class="line"><span class="comment">#修改配置文件/etc/systemd/journald.conf, 将systemd-journald服务配置为在重新启动后永久保留系统日志，只需要将Storage参数设置为persistent。提交更改后，重新启动systemd-journald服务以使配置更改生效：</span></span><br><span class="line">vim /etc/systemd/journald.conf</span><br><span class="line">[Journal]</span><br><span class="line">Storage=persistent   <span class="comment">#修改此处</span></span><br><span class="line"><span class="comment">#重启systemd-journald服务</span></span><br><span class="line">systemctl restart systemd-journald  </span><br><span class="line"><span class="comment">#查看上一次启动的日志</span></span><br><span class="line">journalctl  -b -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定时间的日志</span></span><br><span class="line">journalctl --since yesterday  <span class="comment">#查看昨天的日志</span></span><br><span class="line">journalctl --since <span class="string">&quot;2023-08-9 20:00:00&quot;</span> --<span class="keyword">until</span> <span class="string">&quot;2023-08-10 13:00&quot;</span>  <span class="comment">#查看8月9日到8月10日的日志</span></span><br><span class="line">journalctl --since <span class="string">&quot;12:00&quot;</span> --<span class="keyword">until</span> now  <span class="comment">#查看从12点到现在的日志</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示尾部的最新10行日志</span></span><br><span class="line">journalctl  -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示尾部指定行数的日志. 查看的是/var/log/messages的日志，但是格式上有所调整，如主机名格式不一样而已</span></span><br><span class="line">journalctl -n 20</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时滚动显示最新日志</span></span><br><span class="line">journalctl   -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务的日志</span></span><br><span class="line">journalctl  /usr/lib/systemd/systemd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程的日志</span></span><br><span class="line">journalctl   _PID=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有 D-Bus 进程产生的日志</span></span><br><span class="line">journalctl /usr/bin/dbus-daemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个路径的脚本的日志</span></span><br><span class="line">journalctl    /usr/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定用户的日志</span></span><br><span class="line">journalctl _UID=33  --since today</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个Unit的日志</span></span><br><span class="line">journalctl  -u nginx.service</span><br><span class="line">journalctl  -u nginx.service  --since  today</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时滚动显示某个Unit的最新日志</span></span><br><span class="line">journalctl  -u nginx.service  -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并显示多个Unit的日志</span></span><br><span class="line">journalctl  -u nginx.service  -u php-fpm.service  --since today</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定优先级（及其以上级别）的日志, 日志优先级共有8级</span></span><br><span class="line">0: emerg</span><br><span class="line">1: alert</span><br><span class="line">2: crit</span><br><span class="line">3: err</span><br><span class="line">4: warning</span><br><span class="line">5: notice</span><br><span class="line">6: info</span><br><span class="line">7: debug</span><br><span class="line">journalctl  -p err  -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以JSON格式（单行）输出</span></span><br><span class="line">journalctl  -b -u httpd.service  -o json</span><br><span class="line"><span class="comment">#以JSON格式（多行）输出，可读性更好，建议选择多行输出</span></span><br><span class="line">journalctl  -b -u httpd.service  -o json-pretty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示日志占据的硬盘空间</span></span><br><span class="line">journalctl  --disk-usage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定日志文件占据的最大空间</span></span><br><span class="line">journalctl   --vacuum-size=1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定日志文件保存多久</span></span><br><span class="line">journalctl   --vacuum-time=1years</span><br></pre></td></tr></table></figure><h2 id="生成随机字符"><a href="#生成随机字符" class="headerlink" title="生成随机字符"></a>生成随机字符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 8   <span class="comment"># 生成随机base64码</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$RANDOM</span>             <span class="comment"># 随机数字</span></span><br><span class="line"><span class="built_in">cat</span> /dev/urandom |<span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span>|<span class="built_in">head</span> -c12   <span class="comment"># 提取12位的随机数字和字母</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$RANDOM</span> 12345|<span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span>      <span class="comment">#生成后缀为12345的随机数字</span></span><br></pre></td></tr></table></figure><h2 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h2><h3 id="搭建chrony时间同步服务器-局域网同步时间）"><a href="#搭建chrony时间同步服务器-局域网同步时间）" class="headerlink" title="搭建chrony时间同步服务器(局域网同步时间）"></a>搭建chrony时间同步服务器(局域网同步时间）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="comment"># apt install chrony -y</span></span><br><span class="line">yum install chrony -y</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/chrony.conf &lt;&lt; <span class="string">EOF </span></span><br><span class="line"><span class="string">pool ntp.aliyun.com iburst</span></span><br><span class="line"><span class="string">driftfile /var/lib/chrony/drift</span></span><br><span class="line"><span class="string">makestep 1.0 3</span></span><br><span class="line"><span class="string">rtcsync</span></span><br><span class="line"><span class="string">allow 192.168.0.0/24</span></span><br><span class="line"><span class="string">local stratum 10</span></span><br><span class="line"><span class="string">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="string">leapsectz right/UTC</span></span><br><span class="line"><span class="string">logdir /var/log/chrony</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl restart chronyd ; systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="comment"># apt install chrony -y</span></span><br><span class="line">yum install chrony -y</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/chrony.conf &lt;&lt; <span class="string">EOF </span></span><br><span class="line"><span class="string">pool 192.168.0.31 iburst</span></span><br><span class="line"><span class="string">driftfile /var/lib/chrony/drift</span></span><br><span class="line"><span class="string">makestep 1.0 3</span></span><br><span class="line"><span class="string">rtcsync</span></span><br><span class="line"><span class="string">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="string">leapsectz right/UTC</span></span><br><span class="line"><span class="string">logdir /var/log/chrony</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl restart chronyd ; systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用客户端进行验证</span></span><br><span class="line">chronyc sources -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数解释</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># pool ntp.aliyun.com iburst</span></span><br><span class="line"><span class="comment"># 指定使用ntp.aliyun.com作为时间服务器池，iburst选项表示在初始同步时会发送多个请求以加快同步速度。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># driftfile /var/lib/chrony/drift</span></span><br><span class="line"><span class="comment"># 指定用于保存时钟漂移信息的文件路径。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># makestep 1.0 3</span></span><br><span class="line"><span class="comment"># 设置当系统时间与服务器时间偏差大于1秒时，会以1秒的步长进行调整。如果偏差超过3秒，则立即进行时间调整。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># rtcsync</span></span><br><span class="line"><span class="comment"># 启用硬件时钟同步功能，可以提高时钟的准确性。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># allow 192.168.0.0/24</span></span><br><span class="line"><span class="comment"># 允许192.168.0.0/24网段范围内的主机与chrony进行时间同步。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># local stratum 10</span></span><br><span class="line"><span class="comment"># 将本地时钟设为stratum 10，stratum值表示时钟的准确度，值越小表示准确度越高。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="comment"># 指定使用的密钥文件路径，用于对时间同步进行身份验证。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># leapsectz right/UTC</span></span><br><span class="line"><span class="comment"># 指定时区为UTC。</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># logdir /var/log/chrony</span></span><br><span class="line"><span class="comment"># 指定日志文件存放目录。</span></span><br></pre></td></tr></table></figure><h2 id="设置时间和时区"><a href="#设置时间和时区" class="headerlink" title="设置时间和时区"></a>设置时间和时区</h2><p>设置时间</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>设置时区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前时区设置</span></span><br><span class="line">timedatectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有可用的时区</span></span><br><span class="line">timedatectl list-timezones</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置当前时区</span></span><br><span class="line">timedatectl set-timezone America/New_York   <span class="comment">#设置时区为美国纽约</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai      <span class="comment">#设置时区为中国上海</span></span><br><span class="line">timedatectl set-time YYYY-MM-DD             <span class="comment">#设置年,月,日</span></span><br><span class="line">timedatectl set-time HH:MM:SS               <span class="comment">#设置时间:小时,分钟,秒</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有亚洲时区 </span></span><br><span class="line"><span class="built_in">ls</span> /usr/share/zoneinfo/Asia/</span><br><span class="line"><span class="comment"># 修改时区</span></span><br><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"><span class="comment"># 更新硬件时钟</span></span><br><span class="line">hwclock -w</span><br><span class="line"><span class="comment"># 查看时区设置</span></span><br><span class="line">timedatectl status</span><br></pre></td></tr></table></figure><h2 id="优化内核参数"><a href="#优化内核参数" class="headerlink" title="优化内核参数"></a>优化内核参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="LVM磁盘分区"><a href="#LVM磁盘分区" class="headerlink" title="LVM磁盘分区"></a>LVM磁盘分区</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常用配置项 </tag>
            
            <tag> 配置IP地址 </tag>
            
            <tag> yum </tag>
            
            <tag> apt </tag>
            
            <tag> 防火墙 </tag>
            
            <tag> selinux </tag>
            
            <tag> systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux配置软件源</title>
      <link href="/posts/ec80583f.html"/>
      <url>/posts/ec80583f.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux配置软件源"><a href="#Linux配置软件源" class="headerlink" title="Linux配置软件源"></a>Linux配置软件源</h1><h2 id="yum源配置文件说明"><a href="#yum源配置文件说明" class="headerlink" title="yum源配置文件说明"></a>yum源配置文件说明</h2><p>yum客户端配置文件</p><ul><li><p>为每个仓库单独提供的配置文件: <code>/etc/yum.conf</code></p></li><li><p>为所有仓库提供公共配置: <code>/etc/yum.repos.d/*.repo</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum配置文件示例说明: </span></span><br><span class="line">[epel]                                                  <span class="comment">#id名称,可以自定义,保证唯一</span></span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span>  <span class="comment">#repo的描述,$basearch为系统架构</span></span><br><span class="line">baseurl=http://mirrors.aliyun.com/epel/7/<span class="variable">$basearch</span>      <span class="comment">#服务器的地址,file://本地地址;网络地址http://;https://;ftp://;可设置多个</span></span><br><span class="line">enabled=1         <span class="comment">#可以不写,默认值就是1,为启用;0为不启用</span></span><br><span class="line">gpgcheck=0        <span class="comment">#安装包时的校验,0为不校验,1为安装前校验,效验要导入密钥 </span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7  <span class="comment">#密钥,本地在/etc/pki/rpm-gpg下,由yum源提供</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># repo文件中的变量:</span></span><br><span class="line"><span class="comment"># $releasever:当前os发行版的主版本号,如6;7;8;等</span></span><br><span class="line"><span class="comment"># $arch:CPU架构,如x86_64等</span></span><br><span class="line"><span class="comment"># $basearch:系统基础架构如x86_64等</span></span><br><span class="line"><span class="comment"># $contentdir:表示目录,如centos-7等</span></span><br><span class="line"><span class="comment"># 注意: yum仓库指向的路径一定必须指定到repodata目录所在目录</span></span><br><span class="line"><span class="comment"># 注意，如果需要启用其中一些 repo，需要将其中的 enabled=0 改为 enabled=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS8 分为两个源  baseos、AppStream</span></span><br><span class="line">    BaseOS</span><br><span class="line">        <span class="comment">#光盘本地路径,需要先挂载</span></span><br><span class="line">        file:///mnt/BaseOS/</span><br><span class="line">        <span class="comment">#腾讯</span></span><br><span class="line">        https://mirrors.cloud.tencent.com/centos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/os</span><br><span class="line">        <span class="comment">#网易</span></span><br><span class="line">        https://mirrors.163.com/centos/<span class="variable">$releasever</span>/BaseOS/<span class="variable">$basearch</span>/os/</span><br><span class="line"></span><br><span class="line">    AppStream</span><br><span class="line">        <span class="comment">#光盘本地路径,需要先挂载</span></span><br><span class="line">        file:///mnt/AppStream/</span><br><span class="line">                <span class="comment">#腾讯</span></span><br><span class="line">        https://mirrors.cloud.tencent.com/centos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/os/</span><br><span class="line">        <span class="comment">#网易</span></span><br><span class="line">        https://mirrors.163.com/centos/<span class="variable">$releasever</span>/AppStream/<span class="variable">$basearch</span>/os/</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS7  base</span></span><br><span class="line">        <span class="comment">#腾讯</span></span><br><span class="line">        https://mirrors.cloud.tencent.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        <span class="comment">#网易</span></span><br><span class="line">        https://mirrors.163.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># EPEL </span></span><br><span class="line">    CentOS8</span><br><span class="line">            <span class="comment">#腾讯</span></span><br><span class="line">            https://mirrors.cloud.tencent.com/epel/<span class="variable">$releasever</span>/Everything/<span class="variable">$basearch</span>/</span><br><span class="line">            <span class="comment">#华为</span></span><br><span class="line">            https://mirrors.huaweicloud.com/epel/<span class="variable">$releasever</span>/Everything/<span class="variable">$basearch</span>/</span><br><span class="line">            <span class="comment">#清华大学</span></span><br><span class="line">            https://mirrors.tuna.tsinghua.edu.cn/epel/<span class="variable">$releasever</span>/Everything/<span class="variable">$basearch</span>/</span><br><span class="line">    CentOS7</span><br><span class="line">            <span class="comment">#腾讯</span></span><br><span class="line">            https://mirrors.cloud.tencent.com/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">            <span class="comment">#华为</span></span><br><span class="line">            https://mirrors.huaweicloud.com/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">            <span class="comment">#清华大学</span></span><br><span class="line">            https://mirrors.tuna.tsinghua.edu.cn/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br></pre></td></tr></table></figure><h2 id="配置ISO本地源"><a href="#配置ISO本地源" class="headerlink" title="配置ISO本地源"></a>配置ISO本地源</h2><h3 id="Centos-使用-ISO-光盘文件作为本地源"><a href="#Centos-使用-ISO-光盘文件作为本地源" class="headerlink" title="Centos 使用 ISO 光盘文件作为本地源"></a>Centos 使用 ISO 光盘文件作为本地源</h3><p>将系统 iso 镜像文件挂载到 CD&#x2F;DVD 驱动器上，或者上传 iso 镜像文件至服务器上. 配置本地源，创建 cdrom.repo 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /mnt/centos/          <span class="comment"># 创建本地源文件夹</span></span><br><span class="line">mount /dev/sr0 /mnt/centos     <span class="comment"># 挂载镜像文件至指定的目录</span></span><br><span class="line"><span class="built_in">cp</span> -rf /etc/yum.repos.d  /etc/yum.repos.d_$(<span class="built_in">date</span> <span class="string">&#x27;+%Y%m%d_%H%M%S&#x27;</span>)     <span class="comment"># 备份原本地源</span></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/yum.repos.d/*      <span class="comment"># 删除默认本地源</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 7</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/cdrom.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[iso]</span></span><br><span class="line"><span class="string">name=cdrom</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/centos/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 8及之后</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/cdrom.repo &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=cdrom</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/centos/BaseOS/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=cdrom</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/centos/AppStream/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>加载本地 yum 源&amp;测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum clean all    <span class="comment"># 清除yum缓存</span></span><br><span class="line">yum makecache    <span class="comment"># 缓存本地yum源</span></span><br><span class="line">yum list         <span class="comment"># 测试yum本地源 ,列出所有rpm包</span></span><br></pre></td></tr></table></figure><h3 id="Centos使用脚本配置本地源"><a href="#Centos使用脚本配置本地源" class="headerlink" title="Centos使用脚本配置本地源"></a>Centos使用脚本配置本地源</h3><p>示例脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim /root/auto_source.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 创建本地源文件夹</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /media/centos/</span><br><span class="line"><span class="comment"># 挂载镜像文件至指定的目录</span></span><br><span class="line">mount /dev/sr0 /media/centos</span><br><span class="line"><span class="comment"># 备份原本地源</span></span><br><span class="line"><span class="built_in">cp</span> -rf /etc/yum.repos.d  /etc/yum.repos.d_$(<span class="built_in">date</span> <span class="string">&#x27;+%Y%m%d_%H%M%S&#x27;</span>)</span><br><span class="line"><span class="comment"># 删除默认原本地源</span></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/yum.repos.d/*</span><br><span class="line"><span class="comment"># 配置本地源,创建cdrom.repo文件,并配置如下内容</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/cdrom.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[iso]</span></span><br><span class="line"><span class="string">name=cdrom</span></span><br><span class="line"><span class="string">baseurl=file:///media/centos/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># 清除yum缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="comment"># 缓存本地yum源</span></span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h3 id="Ubuntu使用-ISO-光盘文件作为本地源"><a href="#Ubuntu使用-ISO-光盘文件作为本地源" class="headerlink" title="Ubuntu使用 ISO 光盘文件作为本地源"></a>Ubuntu使用 ISO 光盘文件作为本地源</h3><p>APT包索引配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/apt/sources.list </span><br><span class="line">/etc/apt/sources.list.d</span><br></pre></td></tr></table></figure><p>首先将 ISO 文件挂载到服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /media/cdrom     <span class="comment"># 创建挂载目录 </span></span><br><span class="line"><span class="comment">#-t 指定挂载类型 ；-O loop：用来把一个文件当成硬盘分区挂接上系统 ；</span></span><br><span class="line">mount -t iso9660 /dev/cdrom /media/cdrom    <span class="comment"># 或者 mount -t auto /dev/cdrom /media/cdrom</span></span><br><span class="line">sudo apt-cdrom -m -d=/media/cdrom add      <span class="comment"># 添加本地目录到软件源</span></span><br></pre></td></tr></table></figure><p>配置源地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt源的地址,该文件中包含很多在线源，如果不用在线的软件源，则将其他的注释掉只保留本地源即可</span></span><br><span class="line">vim /etc/apt/sources.list</span><br><span class="line">deb cdrom:[Ubuntu-Server 18.04.5 LTS _Bionic Beaver_ - Release amd64 (20200810)]/ bionic main restricted</span><br><span class="line"><span class="comment"># 进行本地库依赖更新 </span></span><br><span class="line">apt-get update</span><br><span class="line"><span class="comment">#升级软件包</span></span><br><span class="line">apt-get upgrade </span><br></pre></td></tr></table></figure><h2 id="搭建本地私有-yum-仓库"><a href="#搭建本地私有-yum-仓库" class="headerlink" title="搭建本地私有 yum 仓库"></a>搭建本地私有 yum 仓库</h2><p>下载所有yum仓库的相关包和meta 数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 8 dnf 工具集成</span></span><br><span class="line">dnf reposync --<span class="built_in">help</span> <span class="comment"># 查看帮助</span></span><br><span class="line"><span class="comment"># 默认只下载rpm包，不下载 meta数据，需要指定--download-metadata 才能下载 meta</span></span><br><span class="line">dnf reposync --repoid=epel --download-metadata -p /path </span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 7 以前版本，reposync工具来自于yum-utils包</span></span><br><span class="line">reposync --repoid=epel --download-metadata -p /path </span><br></pre></td></tr></table></figure><h3 id="方式一-创建局域网的基于ISO光盘的私有yum源"><a href="#方式一-创建局域网的基于ISO光盘的私有yum源" class="headerlink" title="方式一: 创建局域网的基于ISO光盘的私有yum源"></a>方式一: 创建局域网的基于ISO光盘的私有yum源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装需要联网或者更改yum源路径为光盘路径</span></span><br><span class="line">yum -y install httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"><span class="comment"># 挂载光盘,需要事先将光盘文件复制到服务器中</span></span><br><span class="line"><span class="built_in">mkdir</span> -pv /mnt/centos/&#123;7,8&#125;</span><br><span class="line">mount /root/CentOS-7-x86_64-Everything-2009.iso  /mnt/centos/7 </span><br><span class="line">mount /root/CentOS-8.3.2011-x86_64-dvd1.iso  /mnt/centos/8</span><br><span class="line"><span class="comment"># 复制文件到httpd默认web目录中</span></span><br><span class="line"><span class="built_in">cp</span> -a /mnt/* /var/www/html/centos/8</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 7 yum客户端配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/test.repo&lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=http://10.0.0.8/centos/8/BaseOS</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># centos 8 yum客户端配置</span></span><br><span class="line"><span class="string">cat &gt; /etc/yum.repos.d/test.repo&lt;&lt;-EOF</span></span><br><span class="line">[BaseOS]</span><br><span class="line">name=BaseOS</span><br><span class="line">baseurl=http://10.0.0.8/centos/8/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[AppStream]</span><br><span class="line">name=Appstream</span><br><span class="line">baseurl=http://10.0.0.8/centos/8/AppStream/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="方式二-reposync下载阿里云的EPEL源，制作私有yum源"><a href="#方式二-reposync下载阿里云的EPEL源，制作私有yum源" class="headerlink" title="方式二: reposync下载阿里云的EPEL源，制作私有yum源"></a>方式二: reposync下载阿里云的EPEL源，制作私有yum源</h3><p><a href="https://cloud.tencent.com/developer/article/1444713">https://cloud.tencent.com/developer/article/1444713</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先配置好yum服务器的源,可查看下面的&lt;配置 Centos 网络yum源&gt;一节</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装需要联网或者更改yum源路径为光盘路径</span></span><br><span class="line">yum -y install httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">[root@centos8 ~]<span class="comment">#dnf repolist</span></span><br><span class="line">Last metadata expiration check: 0:07:40 ago on Sun 22 Dec 2019 03:14:16 PM CST.</span><br><span class="line">repo <span class="built_in">id</span>              repo name                                           status</span><br><span class="line">AppStream            AppStream                                           4,681</span><br><span class="line">BaseOS               BaseOS                                              1,655</span><br><span class="line">epel                 EPEL                                                3,707</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载相关仓库包和元数据,CentOS 8 写法, --download-metadata 加此选项可以下载元数据</span></span><br><span class="line">dnf reposync --repoid=epel --download-metadata -p /var/www/html</span><br><span class="line"><span class="comment"># CentOS 7 以前版本，reposync工具来自yum-utils包，没有先安装yum -y install yum-utils</span></span><br><span class="line">reposync --repoid=epel --download-metadata -p /var/www/html</span><br><span class="line"><span class="comment"># 下载相关的key文件</span></span><br><span class="line">wget -P /var/www/html/epel/ https://mirrors.aliyun.com/epel/RPM-GPG-KEY-EPEL-8</span><br><span class="line"><span class="comment"># 下面两个步骤只有centos 7 没meta数据才需要执行,createrepo命令对/var/www/html/epel下的 rpm包创建为本地的 YUM 仓库，目的是为生成repodata目录并自动创建索引信息</span></span><br><span class="line"><span class="comment">#[root@centos7 ~]# yum -y install createrepo httpd </span></span><br><span class="line"><span class="comment">#[root@centos7 ~]# createrepo -pdo /var/www/html/epel/ /var/www/html/epel/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看下载的文件,启动httpd</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#ls /var/www/html/epel/</span></span><br><span class="line">Packages repodata</span><br><span class="line">[root@centos8 ~]<span class="comment"># systemctl start httpd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为保证本地yum源能和阿里云镜像源同步，可以通过脚本定时任务实现(Centos7)</span></span><br><span class="line">vim /root/yum-update.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">datetime=`<span class="built_in">date</span> +<span class="string">&quot;%Y-%m-%d&quot;</span>`</span><br><span class="line"><span class="built_in">exec</span> &gt; /var/log/epel.log　　               <span class="comment">#同步日志输出</span></span><br><span class="line">reposync -d -r epel -p /var/www/html/  　　<span class="comment">#同步镜像源</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    createrepo --update  /var/www/html/epel 　　<span class="comment">#每次添加新的rpm时,必须更新epel索引信息</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SUCESS: <span class="variable">$datetime</span> epel update successful&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ERROR: <span class="variable">$datetime</span> epel update failed&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># 定时任务：每周六凌晨三点同步yum源</span></span><br><span class="line">crontab -e</span><br><span class="line">3 * * 6 /bin/bash/root/yum-update.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 8 客户端yum源配置</span></span><br><span class="line">[root@repo-client ~]<span class="comment"># vim /etc/yum.repos.d/centos8.repo </span></span><br><span class="line">[BaseOS]</span><br><span class="line">name=BaseOS</span><br><span class="line">baseurl=http://10.0.0.8/centos/8/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[AppStream]</span><br><span class="line">name=Appstream</span><br><span class="line">baseurl=http://10.0.0.8/centos/8/AppStream/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[extras]</span><br><span class="line">name=extras</span><br><span class="line">baseurl=http://10.0.0.8/centos/extras/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">name=epel</span><br><span class="line">baseurl=http://10.0.0.8/epel/</span><br><span class="line">gpgkey=http://10.0.0.8/epel/RPM-GPG-KEY-EPEL-8</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><h3 id="方式三-rsync同步公网的yum仓库"><a href="#方式三-rsync同步公网的yum仓库" class="headerlink" title="方式三: rsync同步公网的yum仓库"></a>方式三: rsync同步公网的yum仓库</h3><p>使用rsync来和公网的yum仓库同步，推荐使用此方法同步，特别是在网络不稳定容易中断的情况下，因为rsync是快速增量备份工具，它能从上次中断的文件后继续同步，缺点是很多门户网站yum源不支持rsync同步。</p><p>因为这里直接下载了公网yum源的repo文件，所以不需要再用createrepo来创建索引了，同步完之后就直接可以用了。</p><h4 id="centos-7"><a href="#centos-7" class="headerlink" title="centos 7"></a>centos 7</h4><p>Base包和相关repo文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装需要联网或者更改yum源路径为光盘路径</span></span><br><span class="line">yum -y install httpd</span><br><span class="line">systemctl <span class="built_in">enable</span> --now httpd</span><br><span class="line"></span><br><span class="line">rsync -avrtzH --delete --delay-updates rsync://rsync.mirrors.ustc.edu.cn/centos/7/os/x86_64/Packages/ /var/www/html/centos/7/os/x86_64/Packages/ &gt; /tmp/rsyncbase.log 2&gt;&amp;1</span><br><span class="line">rsync -avrtzH --delete --delay-updates rsync://rsync.mirrors.ustc.edu.cn/centos/7/os/x86_64/repodata/ /var/www/html/centos/7/os/x86_64/repodata/ &gt; /tmp/rsyncbaserepo.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>Update包和相关repo文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rsync -avrtzH --delete --delay-updates rsync://rsync.mirrors.ustc.edu.cn/centos/7/updates/x86_64/Packages/  /var/www/html/centos/7/updates/x86_64/Packages/ &gt; /tmp/rsyncupdate.log 2&gt;&amp;1</span><br><span class="line">rsync -avrtzH --delete --delay-updates rsync://rsync.mirrors.ustc.edu.cn/centos/7/updates/x86_64/repodata/ /var/www/html/centos/7/updates/x86_64/repodata/ &gt; /tmp/rsyncupdaterepo.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>epel的扩展包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avrtzH --delete --delay-updates --exclude=SRPMS/ --exclude=aarch64/ --exclude=ppc64/ --exclude=ppc64le/ --exclude=x86_64/debug/ rsync://rsync.mirrors.ustc.edu.cn/epel/7/  /var/www/html/epel/7/  &gt; /tmp/rsyncepel.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>客户端配置repo文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/centos7.repo</span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base</span><br><span class="line">baseurl=http://10.100.10.89/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#released updates</span></span><br><span class="line">[updates]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Updates</span><br><span class="line">baseurl=http://10.100.10.89/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#additional packages that may be useful</span></span><br><span class="line">[extras]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Extras</span><br><span class="line">baseurl=http://10.100.10.89/centos/<span class="variable">$releasever</span>/extras/<span class="variable">$basearch</span>/</span><br><span class="line"><span class="built_in">enable</span>=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">name=Extra Packages <span class="keyword">for</span> Enterprise Linux 7 - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://10.100.10.89/centos/epel/7/<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>参数说明-a, –archive 归档模式，表示以递归方式传输文件，并保持所有文件属</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose 详细模式输出</span><br><span class="line">-r, --recursive 对子目录以递归模式处理</span><br><span class="line">-t, --<span class="built_in">times</span> 保持文件时间信息</span><br><span class="line">-z, --compress 对备份的文件在传输时进行压缩处理</span><br><span class="line">-H, --hard-links 保留硬链接</span><br><span class="line">--delete 删除那些DST中SRC没有的文件</span><br><span class="line">--delay-updates 在传输末尾把所有更新的文件放到位</span><br><span class="line">--exclude=PATTERN 指定排除不需要传输的文件模式</span><br><span class="line">--include=PATTERN 指定不排除而需要传输的文件模式</span><br></pre></td></tr></table></figure><h2 id="配置网络源"><a href="#配置网络源" class="headerlink" title="配置网络源"></a>配置网络源</h2><h3 id="镜像站"><a href="#镜像站" class="headerlink" title="镜像站"></a>镜像站</h3><table><thead><tr><th>序号</th><th>镜像站名称</th><th>Kali</th><th>Rocky</th><th>AlmaLinux</th><th>EPEL</th><th>Fedora</th><th>openEuler</th><th>OpenCloudOS</th></tr></thead><tbody><tr><td>1</td><td><a href="https://mirrors.aliyun.com/">阿里云</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>2</td><td><a href="https://mirrors.tencent.com/">腾讯云</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>3</td><td><a href="https://mirrors.huaweicloud.com/">华为云</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>4</td><td><a href="https://mirrors.163.com/">网易</a></td><td>❌</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>5</td><td><a href="https://mirrors.sohu.com/">搜狐</a></td><td>❌</td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>6</td><td><a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学</a></td><td>✅</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>7</td><td><a href="https://mirrors.pku.edu.cn/Mirrors">北京大学</a></td><td>❌</td><td>❌</td><td>❌</td><td>✅</td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td>8</td><td><a href="https://mirrors.zju.edu.cn/">浙江大学</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>9</td><td><a href="https://mirrors.nju.edu.cn/">南京大学</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>10</td><td><a href="https://mirrors.cqu.edu.cn/">重庆大学</a></td><td>✅</td><td>✅</td><td>❌</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>11</td><td><a href="https://mirror.lzu.edu.cn/">兰州大学</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>12</td><td><a href="https://mirror.sjtu.edu.cn/">上海交通大学</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>13</td><td><a href="https://mirrors.hit.edu.cn/">哈尔滨工业大学</a></td><td>✅</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>14</td><td><a href="https://mirrors.ustc.edu.cn/">中国科学技术大学</a></td><td>✅</td><td>✅</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>15</td><td><a href="https://mirror.iscas.ac.cn/">中国科学院软件研究所</a></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr></tbody></table><p><strong>使用建议</strong></p><p>上述列表中的镜像站均支持 <code>Debian Ubuntu CentOS openSUSE Arch Linux </code>软件源，列表根据单位性质、地理位置、名称长度进行排序与实际速度无关</p><p>软件源的速度区分刷新速度和下载速度，后者才是关键，具体请结合实际地理位置选择尝试，华北地区建议优先使用 中科大、腾讯云 镜像站，你可以使用下面提到的<a href="https://linuxmirrors.cn/mirrors/#%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99">辅助工具网站</a>来帮助你进行选择</p><p>目前不建议使用 阿里云 镜像站，由于使用人数过多其公网下行带宽已被限制在了 10M 左右。如果你的内网环境过于复杂例如经过了多次 NAT 转换那么请不要使用 清华大学(TUNA) 镜像站，容易被阻断</p><h3 id="配置-Centos-网络yum源"><a href="#配置-Centos-网络yum源" class="headerlink" title="配置 Centos 网络yum源"></a>配置 Centos 网络yum源</h3><p>请注意，<code>CentOS 8</code>（非 Stream 版）已提前进入 EOL 停止服务阶段，因此镜像已被官方移动。如果正在寻找关于这些系统的镜像，请配置各大镜像站的 <code>centos-vault</code>源。</p><p>注意：与之前的版本不同，CentOS 8 系统有两个yum 源：BaseOS和AppStream ，需要分别设置两个仓库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 7</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># vim /etc/yum.repos.d/base.repo</span></span><br><span class="line">[epel]</span><br><span class="line">name=epel</span><br><span class="line">baseurl=https://mirrors.aliyun.com/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">        https://mirrors.tuna.tsinghua.edu.cn/epel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/epel/RPM-GPG-KEY-EPEL-7</span><br><span class="line"></span><br><span class="line">[centosplus]</span><br><span class="line">name=centosplus</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/<span class="variable">$releasever</span>/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">        https://mirrors.aliyun.com/centos/7/centosplus/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[base]   </span><br><span class="line">name=base </span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        https://mirrors.tuna.tsinghua.edu.cn/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line">[updates]</span><br><span class="line">name=updates</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">        https://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/updates/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span><br><span class="line"></span><br><span class="line"><span class="comment">#centos 8 </span></span><br><span class="line">[root@centos8 ~]<span class="comment"># vim /etc/yum.repos.d/base.repo</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/base.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[AppStream]</span></span><br><span class="line"><span class="string">name=AppStream</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/centos/$releasever/AppStream/$basearch/os/</span></span><br><span class="line"><span class="string">       =https://mirror.nju.edu.cn/centos-vault/centos/$releasever/AppStream/$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[BaseOS]</span></span><br><span class="line"><span class="string">name=BaseOS</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/centos/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line"><span class="string">       =https://mirror.nju.edu.cn/centos-vault/centos/$releasever/BaseOS/$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=EPEL</span></span><br><span class="line"><span class="string">baseurl=http://mirrors.aliyun.com/epel/$releasever/Everything/$basearch</span></span><br><span class="line"><span class="string">       http://mirrors.huaweicloud.com/epel/$releasever/Everything/$basearch</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[extras]</span></span><br><span class="line"><span class="string">name=extras</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/centos/$releasever/extras/$basearch/os/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br></pre></td></tr></table></figure><p>centos 7 脚本配置网络yum源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vim repoconfig.sh</span><br><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line">repo=/etc/yum.repos.d</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/yum.repos.d/back</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$repo</span>/*.repo <span class="variable">$repo</span>/back</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$repo</span></span><br><span class="line"><span class="built_in">cat</span> &gt; base.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[epel]</span></span><br><span class="line"><span class="string">name=epel</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/epel/$releasever/$basearch/</span></span><br><span class="line"><span class="string">        https://mirrors.tuna.tsinghua.edu.cn/epel/$releasever/$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/epel/RPM-GPG-KEY-EPEL-7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[centosplus]</span></span><br><span class="line"><span class="string">name=centosplus</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/centosplus/$basearch/</span></span><br><span class="line"><span class="string">        https://mirrors.aliyun.com/centos/7/centosplus/$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[base]   </span></span><br><span class="line"><span class="string">name=base </span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/centos/$releasever/os/$basearch/</span></span><br><span class="line"><span class="string">        https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/os/$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.tuna.tsinghua.edu.cn/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[updates]</span></span><br><span class="line"><span class="string">name=updates</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/updates/$basearch/</span></span><br><span class="line"><span class="string">        https://mirrors.aliyun.com/centos/$releasever/updates/$basearch/</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</span></span><br><span class="line"><span class="string">EOF</span> </span><br><span class="line">yum clean all  <span class="comment">#清理缓存</span></span><br><span class="line">yum makecache  <span class="comment">#更新缓存</span></span><br></pre></td></tr></table></figure><p>使用命令配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清华源, 对于 CentOS 7</span></span><br><span class="line">sudo sed -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span><br><span class="line">         -e <span class="string">&#x27;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g&#x27;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 南京大学源, 对于 CentOS 8, 由于已经停止支持,所以需要配置centos过期源centos-vault</span></span><br><span class="line">sudo sed -e <span class="string">&#x27;s|^mirrorlist=|#mirrorlist=|g&#x27;</span> \</span><br><span class="line">         -e <span class="string">&#x27;s|^#baseurl=http://mirror.centos.org/$contentdir|baseurl=https://mirror.nju.edu.cn/centos-vault/centos|g&#x27;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br></pre></td></tr></table></figure><h3 id="过期的yum源"><a href="#过期的yum源" class="headerlink" title="过期的yum源"></a>过期的yum源</h3><p>需要确定所需要的小版本，如无特殊需要则使用该大版本的最后一个小版本，比如 6.10，5.11，需要在命令中替换$minorver变量。</p><h4 id="清华CentOS-Vault-软件仓库"><a href="#清华CentOS-Vault-软件仓库" class="headerlink" title="清华CentOS Vault 软件仓库"></a>清华CentOS Vault 软件仓库</h4><p><a href="https://mirrors.tuna.tsinghua.edu.cn/help/centos-vault/">centos-vault | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 6 及之前</span></span><br><span class="line">minorver=6.10</span><br><span class="line">sudo sed -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">         -e <span class="string">&quot;s|^#baseurl=http://mirror.centos.org/centos/\$releasever|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-vault/<span class="variable">$minorver</span>|g&quot;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 8 之后</span></span><br><span class="line">minorver=8.5.2111</span><br><span class="line">sudo sed -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">         -e <span class="string">&quot;s|^#baseurl=http://mirror.centos.org/\$contentdir/\$releasever|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-vault/<span class="variable">$minorver</span>|g&quot;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line">yum makecache    <span class="comment"># 更新软件包缓存</span></span><br></pre></td></tr></table></figure><h4 id="阿里云CentOS-Vault-软件仓库"><a href="#阿里云CentOS-Vault-软件仓库" class="headerlink" title="阿里云CentOS Vault 软件仓库"></a>阿里云CentOS Vault 软件仓库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  Centos 6</span></span><br><span class="line">minorver=6.10</span><br><span class="line">sudo sed -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">         -e <span class="string">&quot;s|^#baseurl=http://mirror.centos.org/centos/\$releasever|baseurl=https://mirrors.aliyun.com/centos-vault/<span class="variable">$minorver</span>|g&quot;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 8 </span></span><br><span class="line">minorver=8.5.2111</span><br><span class="line">sudo sed -e <span class="string">&quot;s|^mirrorlist=|#mirrorlist=|g&quot;</span> \</span><br><span class="line">         -e <span class="string">&quot;s|^#baseurl=http://mirror.centos.org/\$contentdir/\$releasever|baseurl=https://mirrors.aliyun.com/centos-vault/<span class="variable">$minorver</span>|g&quot;</span> \</span><br><span class="line">         -i.bak \</span><br><span class="line">         /etc/yum.repos.d/CentOS-*.repo</span><br><span class="line"></span><br><span class="line">yum makecache    <span class="comment"># 更新软件包缓存</span></span><br></pre></td></tr></table></figure><h3 id="手动配置-Ubuntu-网络软件源"><a href="#手动配置-Ubuntu-网络软件源" class="headerlink" title="手动配置 Ubuntu 网络软件源"></a>手动配置 Ubuntu 网络软件源</h3><p>Ubuntu 的软件源配置文件是<code> /etc/apt/sources.list</code>。将系统自带的该文件做个备份，将该文件替换为下面内容，即可使用选择的软件源镜像。</p><p>清华源: <a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">ubuntu | 镜像站使用帮助 | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></p><p>阿里云源: <a href="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.1ecc1b11xxWgOg">ubuntu镜像_ubuntu下载地址_ubuntu安装教程-阿里巴巴开源镜像站 (aliyun.com)</a></p><p>南京大学源: <a href="https://mirror.nju.edu.cn/mirrorz-help/ubuntu/?mirror=NJU">Ubuntu 软件仓库镜像使用帮助 - MirrorZ Help (nju.edu.cn)</a></p><p>Ubuntu 版本：18.04 LTS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份原来的源，将以前的源备份一下，以防以后可以用的。</span></span><br><span class="line">sudo <span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开/etc/apt/sources.list文件, 在前面添加如下条目，并保存。</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新源</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment">#如出现依赖问题，解决方式如下：</span></span><br><span class="line">sudo apt-get -f install</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件：</span></span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure><p>Ubuntu 版本：20.04 LTS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份原来的源，将以前的源备份一下，以防以后可以用的。</span></span><br><span class="line">sudo <span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开/etc/apt/sources.list文件, 在前面添加如下条目，并保存。</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure><p>Ubuntu 版本：22.04 LTS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份原来的源，将以前的源备份一下，以防以后可以用的。</span></span><br><span class="line">sudo <span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开/etc/apt/sources.list文件, 在前面添加如下条目，并保存。</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line">deb http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure><h2 id="LinuxMirrors-项目"><a href="#LinuxMirrors-项目" class="headerlink" title="LinuxMirrors 项目"></a>LinuxMirrors 项目</h2><p>GNU&#x2F;Linux 一键更换系统软件源脚本</p><p>这是一个完全开源的非盈利项目，旨在为从事计算机相关行业的朋友们提供便利</p><blockquote><p>Github: <a href="https://github.com/SuperManito/LinuxMirrors">https://github.com/SuperManito/LinuxMirrors</a></p><p>Website: <a href="https://linuxmirrors.cn/">https://linuxmirrors.cn</a></p></blockquote><h3 id="适配系统及其版本"><a href="#适配系统及其版本" class="headerlink" title="适配系统及其版本"></a>适配系统及其版本</h3><table><thead><tr><th>Debian</th><th>8.0  ~ 12</th></tr></thead><tbody><tr><td>Ubuntu</td><td>14.04  ~ 23</td></tr><tr><td>Kali  Linux</td><td>2.0  ~ 2023</td></tr><tr><td>Red  Hat Enterprise Linux</td><td>7.0  ~ 9</td></tr><tr><td>Fedora</td><td>30  ~ 38</td></tr><tr><td>CentOS</td><td>7.0  ~ 8.5 &#x2F; Stream 8 ~ 9</td></tr><tr><td>Rocky  Linux</td><td>8  ~ 9</td></tr><tr><td>AlmaLinux</td><td>8  ~ 9</td></tr><tr><td>OpenCloudOS</td><td>8.6  &#x2F; 9.0</td></tr><tr><td>openEuler</td><td>21.03  ~ 23</td></tr><tr><td>openSUSE</td><td>Leep  15 &#x2F; Tumbleweed</td></tr><tr><td>Arch  Linux</td><td>all</td></tr></tbody></table><p>当前支持上述基于 <code>Debian、RedHat、OpenCloudOS、openEuler、openSUSE、Arch Linux </code>的发行版和及其部分衍生版本<br> 点击列表中的图标可快速前往其官网，理论支持所有架构的环境</p><p>脚本文件:</p><p><a href="assets/ChangeMirrors-20230510141711-nfwadx8.sh">ChangeMirrors.sh</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> yum源 </tag>
            
            <tag> ubuntu </tag>
            
            <tag> centos </tag>
            
            <tag> 软件源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubectl备忘录</title>
      <link href="/posts/dfa35092.html"/>
      <url>/posts/dfa35092.html</url>
      
        <content type="html"><![CDATA[<h1 id="kubectl备忘录"><a href="#kubectl备忘录" class="headerlink" title="kubectl备忘录"></a>kubectl备忘录</h1><p><strong>说明:</strong></p><p>这些指令适用于 Kubernetes v1.27。要检查版本，请使用 <code>kubectl version</code> 命令。</p><p>本页列举了常用的 <code>kubectl</code> 命令和标志。Kubectl 自动补全</p><p><a href="https://kubernetes.io/zh-cn/docs/reference/kubectl/cheatsheet/">kubectl 备忘单 | Kubernetes</a></p><p><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#-strong-getting-started-strong-">Kubectl 命令参考文档</a></p><h2 id="Kubectl-自动补全"><a href="#Kubectl-自动补全" class="headerlink" title="Kubectl 自动补全"></a>Kubectl 自动补全</h2><p>BASH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bash-completion</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)  <span class="comment"># 在 bash 中设置当前 shell 的自动补全，要先安装 bash-completion 包。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; ~/.bashrc <span class="comment"># 在你的 bash shell 中永久地添加自动补全</span></span><br></pre></td></tr></table></figure><h3 id="关于-all-namespaces-的一点说明"><a href="#关于-all-namespaces-的一点说明" class="headerlink" title="关于 --all-namespaces 的一点说明"></a>关于 <code>--all-namespaces</code> 的一点说明</h3><p>我们经常用到<code>--all-namespaces</code> 参数，应该要知道它的简写：</p><p><code>kubectl -A</code></p><h2 id="Kubectl-上下文和配置"><a href="#Kubectl-上下文和配置" class="headerlink" title="Kubectl 上下文和配置"></a>Kubectl 上下文和配置</h2><p>设置<code>kubectl</code> 与哪个 Kubernetes 集群进行通信并修改配置信息。 查看使用 kubeconfig 跨集群授权访问 文档获取配置文件详细信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">kubectl config view <span class="comment"># 显示合并的 kubeconfig 配置。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时使用多个 kubeconfig 文件并查看合并的配置</span></span><br><span class="line">KUBECONFIG=~/.kube/config:~/.kube/kubconfig2</span><br><span class="line">kubectl config view</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 e2e 用户的密码</span></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[?(@.name == &quot;e2e&quot;)].user.password&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[].name&#125;&#x27;</span>    <span class="comment"># 显示第一个用户</span></span><br><span class="line">kubectl config view -o jsonpath=<span class="string">&#x27;&#123;.users[*].name&#125;&#x27;</span>   <span class="comment"># 获取用户列表</span></span><br><span class="line">kubectl config get-contexts                          <span class="comment"># 显示上下文列表</span></span><br><span class="line">kubectl config current-context                       <span class="comment"># 展示当前所处的上下文</span></span><br><span class="line">kubectl config use-context my-cluster-name           <span class="comment"># 设置默认的上下文为 my-cluster-name</span></span><br><span class="line"></span><br><span class="line">kubectl config set-cluster my-cluster-name           <span class="comment"># 在 kubeconfig 中设置集群条目</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 kubeconfig 中配置代理服务器的 URL，以用于该客户端的请求</span></span><br><span class="line">kubectl config set-cluster my-cluster-name --proxy-url=my-proxy-url</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加新的用户配置到 kubeconf 中，使用 basic auth 进行身份认证</span></span><br><span class="line">kubectl config set-credentials kubeuser/foo.kubernetes.com --username=kubeuser --password=kubepassword</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定上下文中持久性地保存名字空间，供所有后续 kubectl 命令使用</span></span><br><span class="line">kubectl config set-context --current --namespace=ggckad-s2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用特定的用户名和名字空间设置上下文</span></span><br><span class="line">kubectl config set-context gce --user=cluster-admin --namespace=foo \</span><br><span class="line">  &amp;&amp; kubectl config use-context gce</span><br><span class="line"></span><br><span class="line">kubectl config <span class="built_in">unset</span> users.foo                       <span class="comment"># 删除用户 foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置或显示 context / namespace 的短别名</span></span><br><span class="line"><span class="comment"># （仅适用于 bash 和 bash 兼容的 shell，在使用 kn 设置命名空间之前要先设置 current-context）</span></span><br><span class="line"><span class="built_in">alias</span> kx=<span class="string">&#x27;f() &#123; [ &quot;$1&quot; ] &amp;&amp; kubectl config use-context $1 || kubectl config current-context ; &#125; ; f&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> kn=<span class="string">&#x27;f() &#123; [ &quot;$1&quot; ] &amp;&amp; kubectl config set-context --current --namespace $1 || kubectl config view --minify | grep namespace | cut -d&quot; &quot; -f6 ; &#125; ; f&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./my-manifest.yaml           <span class="comment"># 创建资源</span></span><br><span class="line">kubectl apply -f ./my1.yaml -f ./my2.yaml     <span class="comment"># 使用多个文件创建</span></span><br><span class="line">kubectl apply -f ./dir                        <span class="comment"># 基于目录下的所有清单文件创建资源</span></span><br><span class="line">kubectl apply -f https://git.io/vPieo         <span class="comment"># 从 URL 中创建资源</span></span><br><span class="line">kubectl create deployment nginx --image=nginx <span class="comment"># 启动单实例 nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个打印 “Hello World” 的 Job</span></span><br><span class="line">kubectl create job hello --image=busybox:1.28 -- <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个打印 “Hello World” 间隔1分钟的 CronJob</span></span><br><span class="line">kubectl create cronjob hello --image=busybox:1.28   --schedule=<span class="string">&quot;*/1 * * * *&quot;</span> -- <span class="built_in">echo</span> <span class="string">&quot;Hello World&quot;</span>  </span><br><span class="line"></span><br><span class="line">kubectl explain pods                          <span class="comment"># 获取 pod 清单的文档说明</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从标准输入创建多个 YAML 对象</span></span><br><span class="line">kubectl apply -f - &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: busybox-sleep</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: busybox</span></span><br><span class="line"><span class="string">    image: busybox:1.28</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">    - sleep</span></span><br><span class="line"><span class="string">    - &quot;1000000&quot;</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: busybox-sleep-less</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: busybox</span></span><br><span class="line"><span class="string">    image: busybox:1.28</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">    - sleep</span></span><br><span class="line"><span class="string">    - &quot;1000&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建有多个 key 的 Secret</span></span><br><span class="line">kubectl apply -f - &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Secret</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: mysecret</span></span><br><span class="line"><span class="string">type: Opaque</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">  password: $(echo -n &quot;s33msi4&quot; | base64 -w0)</span></span><br><span class="line"><span class="string">  username: $(echo -n &quot;jane&quot; | base64 -w0)</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="查看和查找资源"><a href="#查看和查找资源" class="headerlink" title="查看和查找资源"></a>查看和查找资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get 命令的基本输出</span></span><br><span class="line">kubectl get services                          <span class="comment"># 列出当前命名空间下的所有 services</span></span><br><span class="line">kubectl get pods --all-namespaces             <span class="comment"># 列出所有命名空间下的全部的 Pods</span></span><br><span class="line">kubectl get pods -o wide                      <span class="comment"># 列出当前命名空间下的全部 Pods，并显示更详细的信息</span></span><br><span class="line">kubectl get deployment my-dep                 <span class="comment"># 列出某个特定的 Deployment</span></span><br><span class="line">kubectl get pods                              <span class="comment"># 列出当前命名空间下的全部 Pods</span></span><br><span class="line">kubectl get pod my-pod -o yaml                <span class="comment"># 获取一个 pod 的 YAML</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># describe 命令的详细输出</span></span><br><span class="line">kubectl describe nodes my-node</span><br><span class="line">kubectl describe pods my-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前名字空间下所有 Services，按名称排序</span></span><br><span class="line">kubectl get services --sort-by=.metadata.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出 Pods，按重启次数排序</span></span><br><span class="line">kubectl get pods --sort-by=<span class="string">&#x27;.status.containerStatuses[0].restartCount&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列举所有 PV 持久卷，按容量排序</span></span><br><span class="line">kubectl get pv --sort-by=.spec.capacity.storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取包含 app=cassandra 标签的所有 Pods 的 version 标签</span></span><br><span class="line">kubectl get pods --selector=app=cassandra -o \</span><br><span class="line">  jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.labels.version&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索带有 “.” 键值，例： &#x27;ca.crt&#x27;</span></span><br><span class="line">kubectl get configmap myconfig \</span><br><span class="line">  -o jsonpath=<span class="string">&#x27;&#123;.data.ca\.crt&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索一个 base64 编码的值，其中的键名应该包含减号而不是下划线。</span></span><br><span class="line">kubectl get secret my-secret --template=<span class="string">&#x27;&#123;&#123;index .data &quot;key-name-with-dashes&quot;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有工作节点（使用选择器以排除标签名称为 &#x27;node-role.kubernetes.io/control-plane&#x27; 的结果）</span></span><br><span class="line">kubectl get node --selector=<span class="string">&#x27;!node-role.kubernetes.io/control-plane&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前命名空间中正在运行的 Pods</span></span><br><span class="line">kubectl get pods --field-selector=status.phase=Running</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取全部节点的 ExternalIP 地址</span></span><br><span class="line">kubectl get nodes -o jsonpath=<span class="string">&#x27;&#123;.items[*].status.addresses[?(@.type==&quot;ExternalIP&quot;)].address&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出属于某个特定 RC 的 Pods 的名称</span></span><br><span class="line"><span class="comment"># 在转换对于 jsonpath 过于复杂的场合，&quot;jq&quot; 命令很有用；可以在 https://stedolan.github.io/jq/ 找到它。</span></span><br><span class="line">sel=<span class="variable">$&#123;$(kubectl get rc my-rc --output=json | jq -j &#x27;.spec.selector | to_entries | .[] | &quot;\(.key)=\(.value),&quot;&#x27;)%?&#125;</span></span><br><span class="line"><span class="built_in">echo</span> $(kubectl get pods --selector=<span class="variable">$sel</span> --output=jsonpath=&#123;.items..metadata.name&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有 Pods 的标签（或任何其他支持标签的 Kubernetes 对象）</span></span><br><span class="line">kubectl get pods --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查哪些节点处于就绪状态</span></span><br><span class="line">JSONPATH=<span class="string">&#x27;&#123;range .items[*]&#125;&#123;@.metadata.name&#125;:&#123;range @.status.conditions[*]&#125;&#123;@.type&#125;=&#123;@.status&#125;;&#123;end&#125;&#123;end&#125;&#x27;</span> \</span><br><span class="line"> &amp;&amp; kubectl get nodes -o jsonpath=<span class="string">&quot;<span class="variable">$JSONPATH</span>&quot;</span> | grep <span class="string">&quot;Ready=True&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用外部工具来输出解码后的 Secret</span></span><br><span class="line">kubectl get secret my-secret -o go-template=<span class="string">&#x27;&#123;&#123;range $k,$v := .data&#125;&#125;&#123;&#123;&quot;### &quot;&#125;&#125;&#123;&#123;$k&#125;&#125;&#123;&#123;&quot;\n&quot;&#125;&#125;&#123;&#123;$v|base64decode&#125;&#125;&#123;&#123;&quot;\n\n&quot;&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出被一个 Pod 使用的全部 Secret</span></span><br><span class="line">kubectl get pods -o json | jq <span class="string">&#x27;.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name&#x27;</span> | grep -v null | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列举所有 Pods 中初始化容器的容器 ID（containerID）</span></span><br><span class="line"><span class="comment"># 可用于在清理已停止的容器时避免删除初始化容器</span></span><br><span class="line">kubectl get pods --all-namespaces -o jsonpath=<span class="string">&#x27;&#123;range .items[*].status.initContainerStatuses[*]&#125;&#123;.containerID&#125;&#123;&quot;\n&quot;&#125;&#123;end&#125;&#x27;</span> | <span class="built_in">cut</span> -d/ -f3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出事件（Events），按时间戳排序</span></span><br><span class="line">kubectl get events --sort-by=.metadata.creationTimestamp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有警告事件</span></span><br><span class="line">kubectl events --types=Warning</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较当前的集群状态和假定某清单被应用之后的集群状态</span></span><br><span class="line">kubectl diff -f ./my-manifest.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个句点分隔的树，其中包含为节点返回的所有键</span></span><br><span class="line"><span class="comment"># 在复杂的嵌套JSON结构中定位键时非常有用</span></span><br><span class="line">kubectl get nodes -o json | jq -c <span class="string">&#x27;paths|join(&quot;.&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成一个句点分隔的树，其中包含为pod等返回的所有键</span></span><br><span class="line">kubectl get pods -o json | jq -c <span class="string">&#x27;paths|join(&quot;.&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设你的 Pods 有默认的容器和默认的名字空间，并且支持 &#x27;env&#x27; 命令，可以使用以下脚本为所有 Pods 生成 ENV 变量。</span></span><br><span class="line"><span class="comment"># 该脚本也可用于在所有的 Pods 里运行任何受支持的命令，而不仅仅是 &#x27;env&#x27;。 </span></span><br><span class="line"><span class="keyword">for</span> pod <span class="keyword">in</span> $(kubectl get po --output=jsonpath=&#123;.items..metadata.name&#125;); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$pod</span> &amp;&amp; kubectl <span class="built_in">exec</span> -it <span class="variable">$pod</span> -- <span class="built_in">env</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个 Deployment 的 status 子资源</span></span><br><span class="line">kubectl get deployment nginx-deployment --subresource=status</span><br></pre></td></tr></table></figure><h2 id="更新资源"><a href="#更新资源" class="headerlink" title="更新资源"></a>更新资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/frontend www=image:v2               <span class="comment"># 滚动更新 &quot;frontend&quot; Deployment 的 &quot;www&quot; 容器镜像</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/frontend                      <span class="comment"># 检查 Deployment 的历史记录，包括版本</span></span><br><span class="line">kubectl rollout undo deployment/frontend                         <span class="comment"># 回滚到上次部署版本</span></span><br><span class="line">kubectl rollout undo deployment/frontend --to-revision=2         <span class="comment"># 回滚到特定部署版本</span></span><br><span class="line">kubectl rollout status -w deployment/frontend                    <span class="comment"># 监视 &quot;frontend&quot; Deployment 的滚动升级状态直到完成</span></span><br><span class="line">kubectl rollout restart deployment/frontend                      <span class="comment"># 轮替重启 &quot;frontend&quot; Deployment</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> pod.json | kubectl replace -f -                              <span class="comment"># 通过传入到标准输入的 JSON 来替换 Pod</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制替换，删除后重建资源。会导致服务不可用。</span></span><br><span class="line">kubectl replace --force -f ./pod.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为多副本的 nginx 创建服务，使用 80 端口提供服务，连接到容器的 8000 端口。</span></span><br><span class="line">kubectl expose rc nginx --port=80 --target-port=8000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将某单容器 Pod 的镜像版本（标签）更新到 v4</span></span><br><span class="line">kubectl get pod mypod -o yaml | sed <span class="string">&#x27;s/\(image: myimage\):.*$/\1:v4/&#x27;</span> | kubectl replace -f -</span><br><span class="line"></span><br><span class="line">kubectl label pods my-pod new-label=awesome                      <span class="comment"># 添加标签</span></span><br><span class="line">kubectl label pods my-pod new-label-                             <span class="comment"># 移除标签</span></span><br><span class="line">kubectl annotate pods my-pod icon-url=http://goo.gl/XXBTWq       <span class="comment"># 添加注解</span></span><br><span class="line">kubectl autoscale deployment foo --min=2 --max=10                <span class="comment"># 对 &quot;foo&quot; Deployment 自动伸缩容</span></span><br></pre></td></tr></table></figure><h2 id="部分更新资源"><a href="#部分更新资源" class="headerlink" title="部分更新资源"></a>部分更新资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部分更新某节点</span></span><br><span class="line">kubectl patch node k8s-node-1 -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;unschedulable&quot;:true&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新容器的镜像；spec.containers[*].name 是必须的。因为它是一个合并性质的主键。</span></span><br><span class="line">kubectl patch pod valid-pod -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;name&quot;:&quot;kubernetes-serve-hostname&quot;,&quot;image&quot;:&quot;new image&quot;&#125;]&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用带位置数组的 JSON patch 更新容器的镜像</span></span><br><span class="line">kubectl patch pod valid-pod --<span class="built_in">type</span>=<span class="string">&#x27;json&#x27;</span> -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/containers/0/image&quot;, &quot;value&quot;:&quot;new image&quot;&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用带位置数组的 JSON patch 禁用某 Deployment 的 livenessProbe</span></span><br><span class="line">kubectl patch deployment valid-deployment  --<span class="built_in">type</span> json   -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/livenessProbe&quot;&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在带位置数组中添加元素</span></span><br><span class="line">kubectl patch sa default --<span class="built_in">type</span>=<span class="string">&#x27;json&#x27;</span> -p=<span class="string">&#x27;[&#123;&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/secrets/1&quot;, &quot;value&quot;: &#123;&quot;name&quot;: &quot;whatever&quot; &#125; &#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过修正 scale 子资源来更新 Deployment 的副本数</span></span><br><span class="line">kubectl patch deployment nginx-deployment --subresource=<span class="string">&#x27;scale&#x27;</span> --<span class="built_in">type</span>=<span class="string">&#x27;merge&#x27;</span> -p <span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;replicas&quot;:2&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="对资源进行伸缩"><a href="#对资源进行伸缩" class="headerlink" title="对资源进行伸缩"></a>对资源进行伸缩</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=3 rs/foo                                 <span class="comment"># 将名为 &#x27;foo&#x27; 的副本集伸缩到 3 副本</span></span><br><span class="line">kubectl scale --replicas=3 -f foo.yaml                            <span class="comment"># 将在 &quot;foo.yaml&quot; 中的特定资源伸缩到 3 个副本</span></span><br><span class="line">kubectl scale --current-replicas=2 --replicas=3 deployment/mysql  <span class="comment"># 如果名为 mysql 的 Deployment 的副本当前是 2，那么将它伸缩到 3</span></span><br><span class="line">kubectl scale --replicas=5 rc/foo rc/bar rc/baz                   <span class="comment"># 伸缩多个副本控制器</span></span><br></pre></td></tr></table></figure><h2 id="删除资源"><a href="#删除资源" class="headerlink" title="删除资源"></a>删除资源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f ./pod.json                                              <span class="comment"># 删除在 pod.json 中指定的类型和名称的 Pod</span></span><br><span class="line">kubectl delete pod unwanted --now                                         <span class="comment"># 删除 Pod 且无宽限期限（无优雅时段）</span></span><br><span class="line">kubectl delete pod,service baz foo                                        <span class="comment"># 删除名称为 &quot;baz&quot; 和 &quot;foo&quot; 的 Pod 和服务</span></span><br><span class="line">kubectl delete pods,services -l name=myLabel                              <span class="comment"># 删除包含 name=myLabel 标签的 pods 和服务</span></span><br><span class="line">kubectl -n my-ns delete pod,svc --all                                     <span class="comment"># 删除在 my-ns 名字空间中全部的 Pods 和服务</span></span><br><span class="line"><span class="comment"># 删除所有与 pattern1 或 pattern2 awk 模式匹配的 Pods</span></span><br><span class="line">kubectl get pods  -n mynamespace --no-headers=<span class="literal">true</span> | awk <span class="string">&#x27;/pattern1|pattern2/&#123;print $1&#125;&#x27;</span> | xargs  kubectl delete -n mynamespace pod</span><br></pre></td></tr></table></figure><h2 id="与运行中的-Pod-进行交互"><a href="#与运行中的-Pod-进行交互" class="headerlink" title="与运行中的 Pod 进行交互"></a>与运行中的 Pod 进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs my-pod                                 <span class="comment"># 获取 pod 日志（标准输出）</span></span><br><span class="line">kubectl logs -l name=myLabel                        <span class="comment"># 获取含 name=myLabel 标签的 Pods 的日志（标准输出）</span></span><br><span class="line">kubectl logs my-pod --previous                      <span class="comment"># 获取上个容器实例的 pod 日志（标准输出）</span></span><br><span class="line">kubectl logs my-pod -c my-container                 <span class="comment"># 获取 Pod 容器的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -l name=myLabel -c my-container        <span class="comment"># 获取含 name=myLabel 标签的 Pod 容器日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs my-pod -c my-container --previous      <span class="comment"># 获取 Pod 中某容器的上个实例的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -f my-pod                              <span class="comment"># 流式输出 Pod 的日志（标准输出）</span></span><br><span class="line">kubectl logs -f my-pod -c my-container              <span class="comment"># 流式输出 Pod 容器的日志（标准输出, 多容器场景）</span></span><br><span class="line">kubectl logs -f -l name=myLabel --all-containers    <span class="comment"># 流式输出含 name=myLabel 标签的 Pod 的所有日志（标准输出）</span></span><br><span class="line">kubectl run -i --<span class="built_in">tty</span> busybox --image=busybox:1.28 -- sh  <span class="comment"># 以交互式 Shell 运行 Pod</span></span><br><span class="line">kubectl run nginx --image=nginx -n mynamespace      <span class="comment"># 在 “mynamespace” 命名空间中运行单个 nginx Pod</span></span><br><span class="line">kubectl run nginx --image=nginx --dry-run=client -o yaml &gt; pod.yaml</span><br><span class="line">                                                    <span class="comment"># 为运行 nginx Pod 生成规约并将其写入到名为 pod.yaml 的文件</span></span><br><span class="line"></span><br><span class="line">kubectl attach my-pod -i                            <span class="comment"># 挂接到一个运行的容器中</span></span><br><span class="line">kubectl port-forward my-pod 5000:6000               <span class="comment"># 在本地计算机上侦听端口 5000 并转发到 my-pod 上的端口 6000</span></span><br><span class="line">kubectl <span class="built_in">exec</span> my-pod -- <span class="built_in">ls</span> /                         <span class="comment"># 在已有的 Pod 中运行命令（单容器场景）</span></span><br><span class="line">kubectl <span class="built_in">exec</span> --stdin --<span class="built_in">tty</span> my-pod -- /bin/sh        <span class="comment"># 使用交互 shell 访问正在运行的 Pod (一个容器场景)</span></span><br><span class="line">kubectl <span class="built_in">exec</span> my-pod -c my-container -- <span class="built_in">ls</span> /         <span class="comment"># 在已有的 Pod 中运行命令（多容器场景）</span></span><br><span class="line">kubectl top pod POD_NAME --containers               <span class="comment"># 显示给定 Pod 和其中容器的监控数据</span></span><br><span class="line">kubectl top pod POD_NAME --sort-by=cpu              <span class="comment"># 显示给定 Pod 的指标并且按照 &#x27;cpu&#x27; 或者 &#x27;memory&#x27; 排序</span></span><br></pre></td></tr></table></figure><h2 id="从容器中复制文件和目录"><a href="#从容器中复制文件和目录" class="headerlink" title="从容器中复制文件和目录"></a>从容器中复制文件和目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo_dir my-pod:/tmp/bar_dir            <span class="comment"># 将 /tmp/foo_dir 本地目录复制到远程当前命名空间中 Pod 中的 /tmp/bar_dir</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo my-pod:/tmp/bar -c my-container    <span class="comment"># 将 /tmp/foo 本地文件复制到远程 Pod 中特定容器的 /tmp/bar 下</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /tmp/foo my-namespace/my-pod:/tmp/bar       <span class="comment"># 将 /tmp/foo 本地文件复制到远程 “my-namespace” 命名空间内指定 Pod 中的 /tmp/bar</span></span><br><span class="line">kubectl <span class="built_in">cp</span> my-namespace/my-pod:/tmp/foo /tmp/bar       <span class="comment"># 将 /tmp/foo 从远程 Pod 复制到本地 /tmp/bar</span></span><br></pre></td></tr></table></figure><h2 id="与-Deployments-和-Services-进行交互"><a href="#与-Deployments-和-Services-进行交互" class="headerlink" title="与 Deployments 和 Services 进行交互"></a>与 Deployments 和 Services 进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs deploy/my-deployment                         <span class="comment"># 获取一个 Deployment 的 Pod 的日志（单容器例子）</span></span><br><span class="line">kubectl logs deploy/my-deployment -c my-container         <span class="comment"># 获取一个 Deployment 的 Pod 的日志（多容器例子）</span></span><br><span class="line"></span><br><span class="line">kubectl port-forward svc/my-service 5000                  <span class="comment"># 侦听本地端口 5000 并转发到 Service 后端端口 5000</span></span><br><span class="line">kubectl port-forward svc/my-service 5000:my-service-port  <span class="comment"># 侦听本地端口 5000 并转发到名字为 &lt;my-service-port&gt; 的 Service 目标端口</span></span><br><span class="line"></span><br><span class="line">kubectl port-forward deploy/my-deployment 5000:6000       <span class="comment"># 侦听本地端口 5000 并转发到 &lt;my-deployment&gt; 创建的 Pod 里的端口 6000</span></span><br><span class="line">kubectl <span class="built_in">exec</span> deploy/my-deployment -- <span class="built_in">ls</span>                   <span class="comment"># 在 Deployment 里的第一个 Pod 的第一个容器里运行命令（单容器和多容器例子）</span></span><br></pre></td></tr></table></figure><h2 id="与节点和集群进行交互"><a href="#与节点和集群进行交互" class="headerlink" title="与节点和集群进行交互"></a>与节点和集群进行交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl cordon my-node                                                <span class="comment"># 标记 my-node 节点为不可调度</span></span><br><span class="line">kubectl drain my-node                                                 <span class="comment"># 对 my-node 节点进行清空操作，为节点维护做准备</span></span><br><span class="line">kubectl uncordon my-node                                              <span class="comment"># 标记 my-node 节点为可以调度</span></span><br><span class="line">kubectl top node my-node                                              <span class="comment"># 显示给定节点的度量值</span></span><br><span class="line">kubectl cluster-info                                                  <span class="comment"># 显示主控节点和服务的地址</span></span><br><span class="line">kubectl cluster-info dump                                             <span class="comment"># 将当前集群状态转储到标准输出</span></span><br><span class="line">kubectl cluster-info dump --output-directory=/path/to/cluster-state   <span class="comment"># 将当前集群状态输出到 /path/to/cluster-state</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前节点上存在的现有污点。</span></span><br><span class="line">kubectl get nodes -o=<span class="string">&#x27;custom-columns=NodeName:.metadata.name,TaintKey:.spec.taints[*].key,TaintValue:.spec.taints[*].value,TaintEffect:.spec.taints[*].effect&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果已存在具有指定键和效果的污点，则替换其值为指定值。</span></span><br><span class="line">kubectl taint nodes foo dedicated=special-user:NoSchedule</span><br></pre></td></tr></table></figure><h2 id="资源类型"><a href="#资源类型" class="headerlink" title="资源类型"></a>资源类型</h2><p>列出所支持的全部资源类型和它们的简称、<a href="https://kubernetes.io/zh-cn/docs/concepts/overview/kubernetes-api/#api-groups-and-versioning">API 组</a>, <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces">名字空间作用域</a> 和 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/kubernetes-objects">Kind</a>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources</span><br></pre></td></tr></table></figure><p>用于探索 API 资源的其他操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources --namespaced=<span class="literal">true</span>      <span class="comment"># 所有命名空间作用域的资源</span></span><br><span class="line">kubectl api-resources --namespaced=<span class="literal">false</span>     <span class="comment"># 所有非命名空间作用域的资源</span></span><br><span class="line">kubectl api-resources -o name                <span class="comment"># 用简单格式列举所有资源（仅显示资源名称）</span></span><br><span class="line">kubectl api-resources -o wide                <span class="comment"># 用扩展格式列举所有资源（又称 &quot;wide&quot; 格式）</span></span><br><span class="line">kubectl api-resources --verbs=list,get       <span class="comment"># 支持 &quot;list&quot; 和 &quot;get&quot; 请求动词的所有资源</span></span><br><span class="line">kubectl api-resources --api-group=extensions <span class="comment"># &quot;extensions&quot; API 组中的所有资源</span></span><br></pre></td></tr></table></figure><p>‍</p>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
            <tag> kubectl </tag>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu</title>
      <link href="/posts/7c4b9639.html"/>
      <url>/posts/7c4b9639.html</url>
      
        <content type="html"><![CDATA[<h1 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h1><h2 id="Ubuntu镜像下载"><a href="#Ubuntu镜像下载" class="headerlink" title="Ubuntu镜像下载"></a>Ubuntu镜像下载</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://cdimage.ubuntu.com/releases/ #ubuntu server(服务器版)</span><br><span class="line">http://releases.ubuntu.com/ #ubuntu desktop(桌⾯版)</span><br></pre></td></tr></table></figure><h2 id="Ubuntu-Server系统基础配置"><a href="#Ubuntu-Server系统基础配置" class="headerlink" title="Ubuntu Server系统基础配置"></a>Ubuntu Server系统基础配置</h2><p> 更改主机名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/hostname</span></span><br><span class="line">ubuntu-node.example.com</span><br></pre></td></tr></table></figure><h3 id="更改网卡名称为eth0"><a href="#更改网卡名称为eth0" class="headerlink" title="更改网卡名称为eth0"></a>更改网卡名称为eth0</h3><p> 如果没有在安装系统之前传递内核参数将⽹卡名称更改为eth*，则可以在 安装系统之后使⽤以下⽅式修改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/default/grub</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;net.ifnames=0 biosdevname=0&quot;</span>   <span class="comment">#修改此行添加net.ifnames=0 biosdevname=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新生成grub配置,并重启</span></span><br><span class="line">update-grub   </span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="配置root远程登录"><a href="#配置root远程登录" class="headerlink" title="配置root远程登录"></a>配置root远程登录</h3><p> 默认情况下，ubuntu不允许root⽤⼾远程ssh，如果有实际场景需要允许 root⽤⼾远程ssh，则需要设置root密码，并且编辑 <code>/etc/ssh/sshd_config</code> ⽂件修改如下 :</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">32 <span class="comment">#PermitRootLogin prohibit-password  #默认为禁⽌登录</span></span><br><span class="line">33 PermitRootLogin <span class="built_in">yes</span>   <span class="comment">#改为允许登录</span></span><br><span class="line">57 <span class="comment">#PasswordAuthentication yes</span></span><br><span class="line">58 PasswordAuthentication <span class="built_in">yes</span> <span class="comment">#打开密码认证，其实默认就是允许通过密码认证登录</span></span><br><span class="line"></span><br><span class="line">su - root <span class="comment">#切换到root⽤户环境</span></span><br><span class="line">passwd <span class="comment">#设置密码</span></span><br><span class="line">systemctl restart sshd <span class="comment">#重启ssh服务并测试root⽤户远程ssh连接</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Ubuntu-18-04网络配置"><a href="#Ubuntu-18-04网络配置" class="headerlink" title="Ubuntu 18.04网络配置"></a>Ubuntu 18.04网络配置</h2><h3 id="单网卡静态IP地址"><a href="#单网卡静态IP地址" class="headerlink" title="单网卡静态IP地址"></a>单网卡静态IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.0.0.121/24]</span><br><span class="line">      gateway4: 10.0.0.2</span><br><span class="line">      nameservers:</span><br><span class="line">        search: [neteagles.cn， neteagles.com]</span><br><span class="line">        addresses: [223.5.5.5, 223.6.6.6]</span><br><span class="line"><span class="comment">#重启网络生效</span></span><br><span class="line">netplan apply</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果复制粘贴格式错位,可以取消vim⾃动缩进功能</span></span><br><span class="line">vim ~/.vimrc </span><br><span class="line"><span class="built_in">set</span> <span class="built_in">paste</span>  <span class="comment">#添加</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置多网卡静态IP"><a href="#配置多网卡静态IP" class="headerlink" title="配置多网卡静态IP"></a>配置多网卡静态IP</h3><p> ubuntu 18.04配置多⽹卡静态IP以及静态路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/netplan/01-netcfg.yaml</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.0.0.121/24]</span><br><span class="line">      gateway4: 10.0.0.2</span><br><span class="line">      nameservers:</span><br><span class="line">        search: [neteagles.cn， neteagles.com]</span><br><span class="line">        addresses: [223.5.5.5, 223.6.6.6]</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [192.168.10.100/24]</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 192.168.10.2</span><br><span class="line"><span class="comment">#重启网络</span></span><br><span class="line">netplan apply</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="单网卡桥接"><a href="#单网卡桥接" class="headerlink" title="单网卡桥接"></a>单网卡桥接</h3><p> ubuntu 18.04的单⽹卡桥接配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6]</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">      </span><br><span class="line"><span class="comment">#netplan apply</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="多⽹卡桥接"><a href="#多⽹卡桥接" class="headerlink" title="多⽹卡桥接"></a>多⽹卡桥接</h3><p> ubuntu 18.04多⽹卡的桥接配置，将br0和br1分别桥接到eth0和eth1。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  </span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6]</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">    br1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [10.20.3.18/16]</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        interfaces:</span><br><span class="line">          - eth1</span><br></pre></td></tr></table></figure><h3 id="双⽹卡绑定"><a href="#双⽹卡绑定" class="headerlink" title="双⽹卡绑定"></a>双⽹卡绑定</h3><p> 七种bond模式说明</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第⼀种模式：mod=0，即：(balance-rr) Round-robin policy（平衡抡循环策略）</span></span><br><span class="line">特点：传输数据包顺序是依次传输（即：第1个包⾛eth0，下⼀个包就⾛eth1….⼀直循环下去，直到最后⼀个传输完毕），此模式提供负载平衡和容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第⼆种模式：mod=1，即： (active-backup) Active-backup policy（主-备份策略）</span></span><br><span class="line">特点：只有⼀个设备处于活动状态，当⼀个宕掉另⼀个⻢上由备份转换为主设备。mac地址是外部可⻅得，从外⾯看来，bond的MAC地址是唯⼀的，以避免switch(交换机)发⽣混乱。此模式只提供了容错能⼒；由此可⻅此算法的优点是可以提供⾼⽹络连接的可⽤性，但是它的资源利⽤率较低，只有⼀个接⼝处于⼯作状态，在有 N 个⽹络接⼝的情况下，资源利⽤率为1/N。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第三种模式：mod=2，即：(balance-xor) XOR policy（平衡策略）</span></span><br><span class="line">特点：基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR⽬标MAC地址) % slave数量。其他的传输策略可以通过xmit_hash_policy选项指定，此模式提供负载平衡和容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第四种模式：mod=3，即：broadcast（⼴播策略）</span></span><br><span class="line">特点：在每个slave接⼝上传输每个数据包，此模式提供了容错能⼒。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第五种模式：mod=4，即：(802.3ad) IEEE 802.3adDynamic link aggregation（IEEE 802.3ad 动态链接聚合）</span></span><br><span class="line">特点：创建⼀个聚合组，它们共享同样的速率和双⼯设定。根据802.3ad规范将多个slave⼯作在同⼀个激活的聚合下。</span><br><span class="line">必要条件：</span><br><span class="line">条件1：ethtool⽀持获取每个slave的速率和双⼯设定。</span><br><span class="line">条件2：switch(交换机)⽀持IEEE 802.3ad Dynamic <span class="built_in">link</span> aggregation。</span><br><span class="line">条件3：⼤多数switch(交换机)需要经过特定配置才能⽀持802.3ad模式。</span><br><span class="line"></span><br><span class="line"><span class="comment">#第六种模式：mod=5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）</span></span><br><span class="line">特点：不需要任何特别的switch(交换机)⽀持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另⼀个slave接管失败的slave的MAC地址。该模式的必要条件：ethtool⽀持获取每个slave的速率</span><br><span class="line"></span><br><span class="line"><span class="comment">#第七种模式：mod=6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡）</span></span><br><span class="line">特点：该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance, rlb)，⽽且不需要任何switch(交换机)的⽀持。</span><br></pre></td></tr></table></figure><p> ubuntu 18.04的双⽹卡绑定配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">需要提前安装好bridge命令</span><br><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line"></span><br><span class="line"><span class="comment">#netplan apply</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="双⽹卡绑定-桥接"><a href="#双⽹卡绑定-桥接" class="headerlink" title="双⽹卡绑定+桥接"></a>双⽹卡绑定+桥接</h3><p> ⽹卡绑定⽤于提供⽹卡接⼝冗余以及⾼可⽤和端⼝聚合功能，桥接⽹卡再 给需要桥接设备的服务使⽤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      <span class="comment">#addresses: [172.18.3.18/16]</span></span><br><span class="line">      <span class="comment">#gateway4: 172.18.0.1</span></span><br><span class="line">      <span class="comment">#nameservers:</span></span><br><span class="line">        <span class="comment">#addresses: [223.6.6.6,223.5.5.5]</span></span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      interfaces:</span><br><span class="line">        - bond0</span><br><span class="line"><span class="comment">#reboot</span></span><br></pre></td></tr></table></figure><h3 id="内外多⽹卡绑定"><a href="#内外多⽹卡绑定" class="headerlink" title="内外多⽹卡绑定"></a>内外多⽹卡绑定</h3><p> 多⽹络情况下实现⽹卡绑定</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth2:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth3:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">    bond1:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth2</span><br><span class="line">        - eth3</span><br><span class="line">      addresses: [10.20.3.18/16]</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">      routes:</span><br><span class="line">        - to: 172.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.20.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.2.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br><span class="line">        - to: 10.8.0.0/16</span><br><span class="line">          via: 10.20.0.1</span><br></pre></td></tr></table></figure><h3 id="内⽹多⽹卡绑定-桥接"><a href="#内⽹多⽹卡绑定-桥接" class="headerlink" title="内⽹多⽹卡绑定+桥接"></a>内⽹多⽹卡绑定+桥接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vim /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth2:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">    eth3:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">  bonds:</span><br><span class="line">    bond0:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth0</span><br><span class="line">        - eth1</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">    bond1:</span><br><span class="line">      interfaces:</span><br><span class="line">        - eth2</span><br><span class="line">        - eth3</span><br><span class="line">      parameters:</span><br><span class="line">        mode: active-backup</span><br><span class="line">        mii-monitor-interval: 100</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      dhcp4: no</span><br><span class="line">      dhcp6: no</span><br><span class="line">      addresses: [172.18.3.18/16]</span><br><span class="line">      gateway4: 172.18.0.1</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [223.6.6.6,223.5.5.5]</span><br><span class="line">      interfaces:</span><br><span class="line">        - bond0</span><br><span class="line">      br1:</span><br><span class="line">        dhcp4: no</span><br><span class="line">        dhcp6: no</span><br><span class="line">        interfaces:</span><br><span class="line">          - bond1</span><br><span class="line">        addresses: [10.20.3.18/16]</span><br><span class="line">        routes:</span><br><span class="line">          - to: 172.20.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.20.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.2.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br><span class="line">          - to: 10.8.0.0/16</span><br><span class="line">            via: 10.20.0.1</span><br></pre></td></tr></table></figure><h2 id="Ubuntu软件包管理"><a href="#Ubuntu软件包管理" class="headerlink" title="Ubuntu软件包管理"></a>Ubuntu软件包管理</h2><h3 id="修改软件仓库"><a href="#修改软件仓库" class="headerlink" title="修改软件仓库"></a>修改软件仓库</h3><p> 阿⾥云仓库地址：<a href="https://opsx.alibaba.com/mirror">https://opsx.alibaba.com/mirror</a></p><p>中科⼤：<a href="http://mirrors.ustc.edu.cn/help/ubuntu.html">http://mirrors.ustc.edu.cn/help/ubuntu.html</a></p><p>清华⼤学：<a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/">https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/</a></p><p>华为：<a href="https://mirrors.huaweicloud.com/">https://mirrors.huaweicloud.com/</a></p><p>设置为清华源:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">18.04LTS:</span><br><span class="line">Ubuntu 的软件源配置文件是 /etc/apt/sources.list。将系统自带的该文件做个备份，将该文件替换为下面内容:</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">20.04LTS:</span><br><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新软件源:</span></span><br><span class="line">apt update</span><br></pre></td></tr></table></figure><h3 id="apt-apt-get"><a href="#apt-apt-get" class="headerlink" title="apt&#x2F;apt-get"></a>apt&#x2F;apt-get</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apt list     <span class="comment">#apt列出仓库软件包，等于yum list</span></span><br><span class="line">apt search NAME    <span class="comment">#搜索安装包</span></span><br><span class="line">apt show apache2   <span class="comment">#查看某个安装包的详细信息</span></span><br><span class="line">apt install apache2   <span class="comment">#在线安装软件包</span></span><br><span class="line">apt remove apache2    <span class="comment">#卸载单个软件包但是保留配置⽂件</span></span><br><span class="line">apt autoremove apache2   <span class="comment">#删除安装包并解决依赖关系</span></span><br><span class="line">apt update   <span class="comment">#更新本地软件包列表索引，修改了apt仓库后必须执⾏</span></span><br><span class="line">apt purge apache2   <span class="comment">#卸载单个软件包删除配置⽂件</span></span><br><span class="line">apt upgrade   <span class="comment">#升级所有已安装且可升级到新版本的软件包</span></span><br><span class="line">apt full-upgrade    <span class="comment">#升级整个系统，必要时可以移除旧软件包。</span></span><br><span class="line">apt edit-sources    <span class="comment">#编辑source源⽂件</span></span><br><span class="line">apt-cache madison nginx    <span class="comment">#查看仓库中软件包有哪些版本可以安装</span></span><br><span class="line">apt install nginx=1.14.0-0ubuntu1.6    <span class="comment">#安装软件包的时候指定安装具体的版本,配合apt-cache madison使用</span></span><br></pre></td></tr></table></figure><h3 id="dpkg安装包管理"><a href="#dpkg安装包管理" class="headerlink" title="dpkg安装包管理"></a>dpkg安装包管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i gitlab-ce_11.9.8-ce.0_amd64.deb   <span class="comment">#安装某个软件包</span></span><br><span class="line">dpkg -r gitlab-ce     <span class="comment">#删除某个软件包保留配置⽂件</span></span><br><span class="line">dpkg -r -P gitlab-ce  <span class="comment">#删除某个软件包不保留配置⽂件</span></span><br><span class="line">dpkg -I gitlab-ce_11.9.8-ce.0_amd64.deb  <span class="comment">#查看软件包信息</span></span><br><span class="line">dpkg -c gitlab-ce_11.9.8-ce.0_amd64.deb  <span class="comment">#查看软件包内的⽂件及⽬录内容</span></span><br><span class="line">dpkg -l  <span class="comment">#列出本机已经安装的所有软件</span></span><br><span class="line">dpkg -L tree <span class="comment">#列出已安装软件包的⽂件</span></span><br></pre></td></tr></table></figure><h3 id="设置oracle-JDK环境"><a href="#设置oracle-JDK环境" class="headerlink" title="设置oracle JDK环境"></a>设置oracle JDK环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入目录中,解压⼆进制⽂件并设置软连接：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br><span class="line">tar xf jdk-8u212-linux-x64.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -sv /usr/local/src/jdk1.8.0_212 /usr/local/jdk</span><br><span class="line"><span class="comment">#配置环境变量： </span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span> </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="comment">#重新导⼊环境变量并验证：</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><h3 id="安装OpenJDK："><a href="#安装OpenJDK：" class="headerlink" title="安装OpenJDK："></a>安装OpenJDK：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure><h3 id="安装常用系统命令："><a href="#安装常用系统命令：" class="headerlink" title="安装常用系统命令："></a>安装常用系统命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt install purge ufw lxd lxd-client lxcfs lxc-common</span><br><span class="line">apt install iproute2 ntpdate tcpdump telnet traceroute nfs-kernel-server nfs-common lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute gcc openssh-server lrzsz tree openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip libevent-dev</span><br><span class="line"></span><br><span class="line">apt install procps (top 命令)</span><br><span class="line">apt install iputils-ping (ping 命令)</span><br><span class="line">apt install net-tools (网络工具)</span><br></pre></td></tr></table></figure><h3 id="系统资源限制优化"><a href="#系统资源限制优化" class="headerlink" title="系统资源限制优化"></a>系统资源限制优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ubuntu需要root和普通用户都要设置,centos只要设置星号的就行</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"><span class="comment">#root账⼾的资源软限制和硬限制</span></span><br><span class="line">root   soft   core      unlimited</span><br><span class="line">root   hard   core      unlimited</span><br><span class="line">root   soft   <span class="built_in">nproc</span>     1000000</span><br><span class="line">root   hard   <span class="built_in">nproc</span>     1000000</span><br><span class="line">root   soft   nofile    1000000</span><br><span class="line">root   hard   nofile    1000000</span><br><span class="line">root   soft   memlock   32000</span><br><span class="line">root   hard   memlock   32000</span><br><span class="line">root   soft   msgqueue  8192000</span><br><span class="line">root   hard   msgqueue  8192000</span><br><span class="line"></span><br><span class="line"><span class="comment">#其他账⼾的资源软限制和硬限制</span></span><br><span class="line">*      soft   core      unlimited</span><br><span class="line">*      hard   core      unlimited</span><br><span class="line">*      soft   <span class="built_in">nproc</span>     1000000</span><br><span class="line">*      hard   <span class="built_in">nproc</span>     1000000</span><br><span class="line">*      soft   nofile    1000000</span><br><span class="line">*      hard   nofile    1000000</span><br><span class="line">*      soft   memlock   32000</span><br><span class="line">*      hard   memlock   32000</span><br><span class="line">*      soft   msgqueue  8192000</span><br><span class="line">*      hard   msgqueue  8192000</span><br></pre></td></tr></table></figure><h3 id="内核参数优化"><a href="#内核参数优化" class="headerlink" title="内核参数优化"></a>内核参数优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.conf.default.rp_filter = 1</span><br><span class="line">net.ipv4.ip_nonlocal_bind = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not accept source routing</span></span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the System Request debugging functionality of the kernel</span></span><br><span class="line">kernel.sysrq = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls whether core dumps will append the PID to the core filename.</span></span><br><span class="line"><span class="comment"># Useful for debugging multi-threaded applications.</span></span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the use of TCP syncookies</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable netfilter on bridges.</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the default maxmimum size of a mesage queue</span></span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># # Controls the maximum size of a message, in bytes</span></span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum shared segment size, in bytes</span></span><br><span class="line">kernel.shmmax = 68719476736</span><br><span class="line"></span><br><span class="line"><span class="comment"># # Controls the maximum number of shared memory segments,in pages</span></span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP kernel paramater</span></span><br><span class="line">net.ipv4.tcp_mem = 786432 1048576 1572864</span><br><span class="line">net.ipv4.tcp_rmem = 4096 87380 4194304</span><br><span class="line">net.ipv4.tcp_wmem = 4096 16384 4194304</span><br><span class="line">net.ipv4.tcp_window_scaling = 1</span><br><span class="line">net.ipv4.tcp_sack = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># socket buffer</span></span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line">net.core.somaxconn = 20480</span><br><span class="line">net.core.optmem_max = 81920</span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP conn</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 262144</span><br><span class="line">net.ipv4.tcp_syn_retries = 3</span><br><span class="line">net.ipv4.tcp_retries1 = 3</span><br><span class="line">net.ipv4.tcp_retries2 = 15</span><br><span class="line"></span><br><span class="line"><span class="comment"># tcp conn reuse</span></span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_tw_reuse = 0</span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line">net.ipv4.tcp_fin_timeout = 1</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 20000</span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line">net.ipv4.tcp_synack_retries = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># keepalive conn</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 300</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 30</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 3</span><br><span class="line">net.ipv4.ip_local_port_range = 10001 65000</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">vm.overcommit_memory = 0</span><br><span class="line">vm.swappiness = 10</span><br><span class="line"></span><br><span class="line"><span class="comment">#net.ipv4.conf.eth1.rp_filter = 0</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.lo.arp_ignore = 1</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.lo.arp_announce = 2</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.all.arp_ignore = 1</span></span><br><span class="line"><span class="comment">#net.ipv4.conf.all.arp_announce = 2</span></span><br></pre></td></tr></table></figure><h2 id="Ubuntu-Desktop版本使用"><a href="#Ubuntu-Desktop版本使用" class="headerlink" title="Ubuntu Desktop版本使用"></a>Ubuntu Desktop版本使用</h2><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">1、设置软件源及安装常⽤命令：</span><br><span class="line">https://opsx.alibaba.com/mirror</span><br><span class="line"></span><br><span class="line">sudo apt install build-essential cmake pkg-config qt4-qmake libqt4-dev desktop-file-utils \</span><br><span class="line">libavformat-dev libavcodec-dev libavutil-dev libswscale-dev libasound2-dev libpulse-dev libjack-jackd2-dev \</span><br><span class="line">libgl1-mesa-dev libglu1-mesa-dev libx11-dev libxfixes-dev libxext-dev libxi-dev libxinerama-dev</span><br><span class="line"></span><br><span class="line">2、系统更新及配置中⽂语⾔环境：</span><br><span class="line"></span><br><span class="line">3、安装搜狗拼⾳输⼊法</span><br><span class="line">https://pinyin.sogou.com/linux/?r=pinyin</span><br><span class="line"></span><br><span class="line">4、安装转码器ffmpeg：</span><br><span class="line">多媒体视频处理⼯具FFmpeg有⾮常强⼤的功能包括视频采集功能、视频格式转</span><br><span class="line">换、视频抓图、给视频加⽔印等。</span><br><span class="line">sudo apt-get install ffmpeg</span><br><span class="line"></span><br><span class="line">5、安装视频播放器： smplayer</span><br><span class="line">https://www.jianshu.com/p/f24252c632d0</span><br><span class="line">sudo apt-get install smplayer</span><br><span class="line"></span><br><span class="line">6、办公软件WPS：</span><br><span class="line">https://www.wps.cn/product/wpslinux</span><br><span class="line"></span><br><span class="line">7、单机VNC⼯具:</span><br><span class="line">x11vnc server</span><br><span class="line"></span><br><span class="line">8、RealVNC v6.6：</span><br><span class="line">⽀持多个⽤⼾同时连接</span><br><span class="line">https://www.realvnc.com/en/connect/download/vnc/linux/</span><br><span class="line"></span><br><span class="line">9、⽂本编辑器：</span><br><span class="line">visual studio code</span><br><span class="line"></span><br><span class="line">10、markdown⼯具：</span><br><span class="line">https://www.typora.io/<span class="comment">#linux</span></span><br><span class="line">sudo apt-get install typora=0.9.60-1</span><br><span class="line"></span><br><span class="line">11、Ubuntu 桌⾯3D特效：</span><br><span class="line">sudo apt-get install compiz-plugins compizconfig-settings-manager</span><br><span class="line"></span><br><span class="line">12、左侧菜单在底栏显⽰：</span><br><span class="line">~$ gsettings <span class="built_in">set</span> com.canonical.Unity.Launcher launcher-position Bottom</span><br><span class="line"></span><br><span class="line">13、VMware workstion桥接⽹卡设置</span><br><span class="line">https://kb.vmware.com/s/article/287?lang=zh_CN</span><br><span class="line"><span class="built_in">chmod</span> a+rw /dev/vmnet0   <span class="comment">#解决⽹卡桥接不通问题</span></span><br><span class="line"></span><br><span class="line">14、远程⼯具:</span><br><span class="line">SecureCRT</span><br><span class="line"></span><br><span class="line">15、python开发：</span><br><span class="line">pycharm</span><br><span class="line"></span><br><span class="line">16、java开发：</span><br><span class="line">Eclipse</span><br><span class="line">Intellij IDEA</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ubuntu </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/4a17b156.html"/>
      <url>/posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 示例 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 示例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>遍历目录下的文件</title>
      <link href="/posts/da20005e.html"/>
      <url>/posts/da20005e.html</url>
      
        <content type="html"><![CDATA[<hr><p>任务:  </p><ul><li>遍历&#x2F;data目录下的txt文件</li><li>将这些txt文件做一个备份</li><li>备份的文件名称后面增加一个年月日的后缀,比如将aming.txt备份为aming.txt_20230927</li></ul><p>以下是脚本文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#date: 2023-09-28</span></span><br><span class="line"><span class="comment">##定义后缀变量,注意下面``(反引号)的含义</span></span><br><span class="line">suffix=`<span class="built_in">date</span> +%Y%m%d`</span><br><span class="line"><span class="comment">##定义备份的目录</span></span><br><span class="line">path=/data</span><br><span class="line"></span><br><span class="line"><span class="comment">## 判断目录是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$path</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="comment">## 找到/data目录下的txt文件, 用for循环遍历</span></span><br><span class="line">  <span class="keyword">for</span> f <span class="keyword">in</span> `find <span class="variable">$path</span> -<span class="built_in">type</span> f -name <span class="string">&quot;*.txt&quot;</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;备份文件 <span class="variable">$f</span>&quot;</span></span><br><span class="line">    <span class="built_in">cp</span> <span class="variable">$&#123;f&#125;</span> <span class="variable">$&#123;f&#125;</span>_<span class="variable">$&#123;suffix&#125;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;目录不存在&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">##脚本结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ChatGPT的版本开始</span></span><br><span class="line"><span class="comment">## 这个脚本首先遍历了`/data`目录下的所有`.txt`文件。然后，它提取了文件名和扩展名，并创建了一个备份文件名，该备份文件名包含了当前的年月日。最后，它使用`cp`命令将原始文件复制到`/backup`目录下，并输出备份的文件名。请确保在实际使用前测试该脚本，并根据需要进行调整。</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历/data目录下的txt文件</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /data/*.txt; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="comment"># 提取文件名和扩展名</span></span><br><span class="line">        filename=$(<span class="built_in">basename</span> -- <span class="string">&quot;<span class="variable">$file</span>&quot;</span>)</span><br><span class="line">        extension=<span class="string">&quot;<span class="variable">$&#123;filename##*.&#125;</span>&quot;</span></span><br><span class="line">        filename=<span class="string">&quot;<span class="variable">$&#123;filename%.*&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建备份文件名</span></span><br><span class="line">        backup_filename=<span class="string">&quot;$filename_<span class="subst">$(date +&#x27;%Y%m%d&#x27;)</span>.<span class="variable">$extension</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 备份文件</span></span><br><span class="line">        <span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span> <span class="string">&quot;/backup/<span class="variable">$backup_filename</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;备份文件 <span class="variable">$file</span> 为 <span class="variable">$backup_filename</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键知识点总结:</span></span><br><span class="line"><span class="comment">## date命令的用法: 可以根据日期,时间获取到想要的字符</span></span><br><span class="line"><span class="comment">## for循环如何遍历文件</span></span><br><span class="line"><span class="comment">## if 判断目录是否存在</span></span><br></pre></td></tr></table></figure><p>if 判断目录或者文件是否存在的语法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 定义使用的目录和文件变量</span></span><br><span class="line">file=/data/aming.txt</span><br><span class="line">folder=/data</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d 参数判断目录是否存在, 如果目录不存在则创建</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;<span class="variable">$folder</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$folder</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -f 参数判断 $file 文件是否存在, 如果不存在则创建</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">touch</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 判断文件,目录是否存在或者具有权限</span></span><br><span class="line"><span class="comment">## -x 参数判断 $folder 是否存在并且是否具有可执行权限</span></span><br><span class="line"><span class="keyword">if</span> [ ! -x <span class="string">&quot;<span class="variable">$folder</span>&quot;</span>]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">mkdir</span> <span class="string">&quot;<span class="variable">$folder</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -n 判断一个变量是否有值</span></span><br><span class="line"><span class="keyword">if</span> [ ! -n <span class="string">&quot;<span class="variable">$var</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$var</span> is empty&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 判断两个变量是否相等</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$var1</span>&quot;</span> = <span class="string">&quot;<span class="variable">$var2</span>&quot;</span> || <span class="string">&quot;<span class="variable">$var1</span>&quot;</span> == <span class="string">&quot;<span class="variable">$var2</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;$var1 eq $var2&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;$var1 not eq $var2&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux脚本练习 </tag>
            
            <tag> 遍历文件 </tag>
            
            <tag> if判断 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown语法与外挂标签写法汇总</title>
      <link href="/posts/2013454d.html"/>
      <url>/posts/2013454d.html</url>
      
        <content type="html"><![CDATA[<h1 id="1-Markdown语法自带格式"><a href="#1-Markdown语法自带格式" class="headerlink" title="1.Markdown语法自带格式"></a>1.Markdown语法自带格式</h1><div class="note info flat"><p>参考：<a href="https://blog.csdn.net/u014061630/article/details/81359144">Markdown语法图文全面详解(10分钟学会)</a></p></div><div class="note warning flat"><p>注意：此页面偶尔会存在CSS冲突问题!</p></div><h2 id="1-1-代码块"><a href="#1-1-代码块" class="headerlink" title="1.1 代码块"></a>1.1 代码块</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\```shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br><span class="line">\```</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCode终端</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmder终端</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-2-多级标题"><a href="#1-2-多级标题" class="headerlink" title="1.2 多级标题"></a>1.2 多级标题</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># H1</span></span><br><span class="line"><span class="section">## H2</span></span><br><span class="line"><span class="section">### H3</span></span><br><span class="line"><span class="section">#### H4</span></span><br><span class="line"><span class="section">##### H5</span></span><br><span class="line"><span class="section">###### H6</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><p>见本文章标题!</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-3-文字样式"><a href="#1-3-文字样式" class="headerlink" title="1.3 文字样式"></a>1.3 文字样式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>下划线演示<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">文字<span class="strong">**加粗**</span>演示</span><br><span class="line"></span><br><span class="line">文字<span class="emphasis">*斜体*</span>演示</span><br><span class="line"></span><br><span class="line">文本<span class="code">`高亮`</span>演示</span><br><span class="line"></span><br><span class="line">文本~~删除~~线演示</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span> = <span class="string">5</span>&gt;</span></span>5号字<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;黑体&quot;</span>&gt;</span></span>黑体<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">blue</span>&gt;</span></span>蓝色<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">MistyRose</span>&gt;</span></span>这里的背景色是：MistyRosen，此处输入任意想输入的内容<span class="language-xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><p><u>下划线演示</u></p><p>文字<strong>加粗</strong>演示</p><p>文字<em>斜体</em>演示</p><p>文本<code>高亮</code>演示</p><p>文本<del>删除</del>线演示</p><p><font size = 5>5号字</font><br><font face="黑体">黑体</font><br><font color=blue>蓝色</font></p><table><tr><td bgcolor=MistyRose>这里的背景色是：MistyRosen，此处输入任意想输入的内容</td></tr></table></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div class="note info flat"><p>上述要点可参考:<a href="https://blog.csdn.net/qq_43732429/article/details/108034518">【Markdown语法】字体颜色大小及文字底色设置</a></p></div><h2 id="1-4-引用"><a href="#1-4-引用" class="headerlink" title="1.4 引用"></a>1.4 引用</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt;  Java</span></span><br><span class="line"><span class="quote">&gt; 二级引用演示</span></span><br><span class="line"><span class="quote">&gt; MySQL</span></span><br><span class="line"><span class="quote">&gt; &gt;外键</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;事务</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;<span class="strong">**行级锁**</span>(引用内部一样可以用格式)</span></span><br><span class="line"><span class="quote">&gt; </span></span><br><span class="line"><span class="quote">&gt; ....</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><blockquote><p> Java<br>二级引用演示<br>MySQL</p><blockquote><p>外键</p><p>事务</p><p><strong>行级锁</strong>(引用内部一样可以用格式)</p></blockquote><p>….</p></blockquote></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-5-分割线"><a href="#1-5-分割线" class="headerlink" title="1.5 分割线"></a>1.5 分割线</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><hr><hr></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-6-列表-跟空格都可以"><a href="#1-6-列表-跟空格都可以" class="headerlink" title="1.6 列表(*,+,-跟空格都可以)"></a>1.6 列表(*,+,-跟空格都可以)</h2><h3 id="1-6-1-无序列表"><a href="#1-6-1-无序列表" class="headerlink" title="1.6.1 无序列表"></a>1.6.1 无序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> Java</span><br><span class="line"><span class="bullet">*</span> Python</span><br><span class="line"><span class="bullet">*</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span> Java</span><br><span class="line"><span class="bullet">+</span> Python</span><br><span class="line"><span class="bullet">+</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Java</span><br><span class="line"><span class="bullet">-</span> Python</span><br><span class="line"><span class="bullet">-</span> ...</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul><ul><li>Java</li><li>Python</li><li>…</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h3 id="1-6-2-有序列表"><a href="#1-6-2-有序列表" class="headerlink" title="1.6.2 有序列表"></a>1.6.2 有序列表</h3><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 注意后面有空格</span></span><br><span class="line"><span class="bullet">1.</span> </span><br><span class="line"><span class="bullet">2.</span> </span><br><span class="line"><span class="bullet">3.</span> </span><br><span class="line"><span class="bullet">4.</span> </span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><p>1.<br>2.<br>3.<br>4. </p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-7-图片"><a href="#1-7-图片" class="headerlink" title="1.7 图片"></a>1.7 图片</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 本地图片</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/assets/pusheencode.webp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;示例图片&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:50%;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="section"># 在线图片</span></span><br><span class="line">![<span class="string">code</span>](<span class="link">https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png</span>)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><p>本地图片:<br><img src="/assets/pusheencode.webp" alt="示例图片" style="zoom:50%;" /><br>在线图片:<br><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png" alt="code"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-8-表格"><a href="#1-8-表格" class="headerlink" title="1.8 表格"></a>1.8 表格</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| 项目标号 | 资金     | 备注 |</span><br><span class="line">| -------- | -------- | ---- |</span><br><span class="line">| 1        | 100，000 | 无   |</span><br><span class="line">| 2        | 200，000 | 无   |</span><br><span class="line">| 3        | 300,600  | 重要 |</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><table><thead><tr><th>项目标号</th><th>资金</th><th>备注</th></tr></thead><tbody><tr><td>1</td><td>100，000</td><td>无</td></tr><tr><td>2</td><td>200，000</td><td>无</td></tr><tr><td>3</td><td>300,600</td><td>重要</td></tr></tbody></table></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="1-9-公式"><a href="#1-9-公式" class="headerlink" title="1.9 公式"></a>1.9 公式</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\Gamma(z)=\int<span class="emphasis">_0^\infty t^&#123;z-1&#125;e^&#123;-t&#125;dt.</span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><p>$$<br>\Gamma(z)&#x3D;\int_0^\infty t^{z-1}e^{-t}dt.<br>$$</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="2-Butterfly外挂标签"><a href="#2-Butterfly外挂标签" class="headerlink" title="2.Butterfly外挂标签"></a>2.Butterfly外挂标签</h1><div class="note info flat"><p>这部分参考安知鱼:<a href="https://anzhiy.cn/posts/7d58.html">基于Butterfly的外挂标签引入</a></p></div><h2 id="2-1-行内文本样式-text"><a href="#2-1-行内文本样式-text" class="headerlink" title="2.1 行内文本样式 text"></a>2.1 行内文本样式 text</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">示例源码</button><button type="button" class="tab " data-href="分栏-3">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u 文本内容 %&#125;</span><br><span class="line">&#123;% emp 文本内容 %&#125;</span><br><span class="line">&#123;% wavy 文本内容 %&#125;</span><br><span class="line">&#123;% del 文本内容 %&#125;</span><br><span class="line">&#123;% kbd 文本内容 %&#125;</span><br><span class="line">&#123;% psw 文本内容 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 带 &#123;% u 下划线 %&#125; 的文本</span><br><span class="line"><span class="bullet">2.</span> 带 &#123;% emp 着重号 %&#125; 的文本</span><br><span class="line"><span class="bullet">3.</span> 带 &#123;% wavy 波浪线 %&#125; 的文本</span><br><span class="line"><span class="bullet">4.</span> 带 &#123;% del 删除线 %&#125; 的文本</span><br><span class="line"><span class="bullet">5.</span> 键盘样式的文本 &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> 密码样式的文本：&#123;% psw 这里没有验证码 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><ol><li>带 <u>下划线</u> 的文本</li><li>带 <emp>着重号</emp> 的文本</li><li>带 <wavy>波浪线</wavy> 的文本</li><li>带 <del>删除线</del> 的文本</li><li>键盘样式的文本 <kbd>command</kbd> + <kbd>D</kbd></li><li>密码样式的文本：<psw>这里没有验证码</psw></li></ol></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-2-行内文本-span"><a href="#2-2-行内文本-span" class="headerlink" title="2.2 行内文本 span"></a>2.2 行内文本 span</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% span 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% span red, 红色 %&#125;、&#123;% span yellow, 黄色 %&#125;、&#123;% span green, 绿色 %&#125;、&#123;% span cyan, 青色 %&#125;、&#123;% span blue, 蓝色 %&#125;、&#123;% span gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% span center logo large, Volantis %&#125;</span><br><span class="line">&#123;% span center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<span class='p red'>红色</span>、<span class='p yellow'>黄色</span>、<span class='p green'>绿色</span>、<span class='p cyan'>青色</span>、<span class='p blue'>蓝色</span>、<span class='p gray'>灰色</span>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。<br><span class='p center logo large'>Volantis</span><br><span class='p center small'>A Wonderful Theme for Hexo</span></li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-3-段落文本-p"><a href="#2-3-段落文本-p" class="headerlink" title="2.3 段落文本 p"></a>2.3 段落文本 p</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p 样式参数(参数以空格划分), 文本内容 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>字体</code>: logo, code</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>大小</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>对齐方向</code>: left, center, right</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> 彩色文字</span><br><span class="line">在一段话中方便插入各种颜色的标签，包括：&#123;% p red, 红色 %&#125;、&#123;% p yellow, 黄色 %&#125;、&#123;% p green, 绿色 %&#125;、&#123;% p cyan, 青色 %&#125;、&#123;% p blue, 蓝色 %&#125;、&#123;% p gray, 灰色 %&#125;。</span><br><span class="line"><span class="bullet">-</span> 超大号文字</span><br><span class="line">文档「开始」页面中的标题部分就是超大号文字。</span><br><span class="line">&#123;% p center logo large, Volantis %&#125;</span><br><span class="line">&#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><ul><li>彩色文字<br>在一段话中方便插入各种颜色的标签，包括：<p class='p red'>红色</p>、<p class='p yellow'>黄色</p>、<p class='p green'>绿色</p>、<p class='p cyan'>青色</p>、<p class='p blue'>蓝色</p>、<p class='p gray'>灰色</p>。</li><li>超大号文字<br>文档「开始」页面中的标题部分就是超大号文字。<p class='p center logo large'>Volantis</p><p class='p center small'>A Wonderful Theme for Hexo</p></li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-4-引用note"><a href="#2-4-引用note" class="headerlink" title="2.4 引用note"></a>2.4 引用note</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">通用配置</button><button type="button" class="tab " data-href="分栏-2">语法格式</button><button type="button" class="tab " data-href="分栏-3">参数配置</button><button type="button" class="tab " data-href="分栏-4">示例源码</button><button type="button" class="tab " data-href="分栏-5">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">note:</span><br><span class="line">  # Note tag style values:</span><br><span class="line">  #  - simple    bs-callout old alert style. Default.</span><br><span class="line">  #  - modern    bs-callout new (v2-v3) alert style.</span><br><span class="line">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span><br><span class="line">  #  - disabled  disable all CSS styles import of note tag.</span><br><span class="line">  style: simple</span><br><span class="line">  icons: false</span><br><span class="line">  border<span class="emphasis">_radius: 3</span></span><br><span class="line"><span class="emphasis">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line"><span class="emphasis">  # Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line"><span class="emphasis">  light_</span>bg<span class="emphasis">_offset: 0</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 自带icon</span></span><br><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"><span class="section"># 外部icon</span></span><br><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><p>1.自带icon</p><table><thead><tr><th>参数</th><th align="center">用法</th></tr></thead><tbody><tr><td>class</td><td align="center">【可选】标识，不同的标识有不同的配色 （ default &#x2F; primary &#x2F; success &#x2F; info &#x2F; warning &#x2F; danger ）</td></tr><tr><td>no-icon</td><td align="center">【可选】不显示 icon</td></tr><tr><td>style</td><td align="center">【可选】可以覆盖配置中的 style （simple&#x2F;modern&#x2F;flat&#x2F;disabled）</td></tr></tbody></table><p>2.外部icon</p><table><thead><tr><th>参数</th><th align="center">用法</th></tr></thead><tbody><tr><td>class</td><td align="center">【可选】标识，不同的标识有不同的配色 （ default &#x2F; blue &#x2F; pink &#x2F; red &#x2F; purple &#x2F; orange &#x2F; green ）</td></tr><tr><td>no-icon</td><td align="center">【可选】可配置自定义 icon (只支持 fontawesome 图标, 也可以配置 no-icon )</td></tr><tr><td>style</td><td align="center">【可选】可以覆盖配置中的 style （simple&#x2F;modern&#x2F;flat&#x2F;disabled）</td></tr></tbody></table></div><div class="tab-item-content" id="分栏-4"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default simple %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary simple %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success simple %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info simple %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning simple %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger simple %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default modern %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary modern %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success modern %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info modern %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning modern %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger modern %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default flat %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary flat %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success flat %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info flat %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning flat %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger flat %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default disabled %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary disabled %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success disabled %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info disabled %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning disabled %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger disabled %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;默认 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default no-icon %&#125;default 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary no-icon %&#125;primary 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success no-icon %&#125;success 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info no-icon %&#125;info 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning no-icon %&#125;warning 提示块标签&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger no-icon %&#125;danger 提示块标签&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; simple%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; modern %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; modern%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; modern %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; modern %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; modern %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; flat%&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; disabled %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; disabled %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; disabled %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; disabled %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; disabled %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; disabled %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>样式</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue no-icon %&#125;2021年快到了....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink no-icon %&#125;小心开车 安全至上&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red no-icon %&#125;这是三片呢？还是四片？&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange no-icon %&#125;你是刷 Visa 还是 UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple no-icon %&#125;剪刀石头布&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green no-icon %&#125;前端最讨厌的浏览器&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details></div><div class="tab-item-content" id="分栏-5"><details class="folding-tag" blue><summary> 1.自带icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note simple"><p>默认 提示块标签</p></div><div class="note default simple"><p>default 提示块标签</p></div><div class="note primary simple"><p>primary 提示块标签</p></div><div class="note success simple"><p>success 提示块标签</p></div><div class="note info simple"><p>info 提示块标签</p></div><div class="note warning simple"><p>warning 提示块标签</p></div><div class="note danger simple"><p>danger 提示块标签</p></div>2.`modern`样式<div class="note modern"><p>默认 提示块标签</p></div><div class="note default modern"><p>default 提示块标签</p></div><div class="note primary modern"><p>primary 提示块标签</p></div><div class="note success modern"><p>success 提示块标签</p></div><div class="note info modern"><p>info 提示块标签</p></div><div class="note warning modern"><p>warning 提示块标签</p></div><div class="note danger modern"><p>danger 提示块标签</p></div><p>3.<code>flat</code>样式</p><div class="note flat"><p>默认 提示块标签</p></div><div class="note default flat"><p>default 提示块标签</p></div><div class="note primary flat"><p>primary 提示块标签</p></div><div class="note success flat"><p>success 提示块标签</p></div><div class="note info flat"><p>info 提示块标签</p></div><div class="note warning flat"><p>warning 提示块标签</p></div><div class="note danger flat"><p>danger 提示块标签</p></div><p>4.<code>disabled</code>样式</p><div class="note disabled"><p>默认 提示块标签</p></div><div class="note default disabled"><p>default 提示块标签</p></div><div class="note primary disabled"><p>primary 提示块标签</p></div><div class="note success disabled"><p>success 提示块标签</p></div><div class="note info disabled"><p>info 提示块标签</p></div><div class="note warning disabled"><p>warning 提示块标签</p></div><div class="note danger disabled"><p>danger 提示块标签</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>默认 提示块标签</p></div><div class="note default no-icon flat"><p>default 提示块标签</p></div><div class="note primary no-icon flat"><p>primary 提示块标签</p></div><div class="note success no-icon flat"><p>success 提示块标签</p></div><div class="note info no-icon flat"><p>info 提示块标签</p></div><div class="note warning no-icon flat"><p>warning 提示块标签</p></div><div class="note danger no-icon flat"><p>danger 提示块标签</p></div>              </div>            </details><details class="folding-tag" blue><summary> 2.外部icon </summary>              <div class='content'>              <p>1.<code>simple</code>样式</p><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了….</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>2.<code>modern</code>样式</p><div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了….</p></div><div class="note pink icon-padding modern"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding modern"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>3.<code>flat</code>样式</p><div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了….</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>4.<code>disabled</code>样式</p><div class="note icon-padding disabled"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon-padding disabled"><i class="note-icon fas fa-bullhorn"></i><p>2021年快到了….</p></div><div class="note pink icon-padding disabled"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon-padding disabled"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon-padding disabled"><i class="note-icon fas fa-battery-half"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple icon-padding disabled"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon-padding disabled"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><p>5.<code>no-icon</code>样式</p><div class="note no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue no-icon flat"><p>2021年快到了….</p></div><div class="note pink no-icon flat"><p>小心开车 安全至上</p></div><div class="note red no-icon flat"><p>这是三片呢？还是四片？</p></div><div class="note orange no-icon flat"><p>你是刷 Visa 还是 UnionPay</p></div><div class="note purple no-icon flat"><p>剪刀石头布</p></div><div class="note green no-icon flat"><p>前端最讨厌的浏览器</p></div>              </div>            </details></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-5-上标标签-tip"><a href="#2-5-上标标签-tip" class="headerlink" title="2.5 上标标签 tip"></a>2.5 上标标签 tip</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: success,error,warning,bolt,ban,home,sync,cogs,key,bell</li><li><code>自定义图标</code>: 支持fontawesome。</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip %&#125;default&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip info %&#125;info&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip success %&#125;success&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip error %&#125;error&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip warning %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bolt %&#125;bolt&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban %&#125;ban&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip home %&#125;home&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip sync %&#125;sync&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip cogs %&#125;cogs&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip key %&#125;key&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bell %&#125;bell&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip fa-atom %&#125;自定义font awesome图标&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>自定义font awesome图标</p></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-6-动态标签-anima"><a href="#2-6-动态标签-anima" class="headerlink" title="2.6 动态标签 anima"></a>2.6 动态标签 anima</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">示例源码</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [参数，可选] %&#125;文本内容&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><div class="note info flat"><ol><li>将所需的CSS类添加到图标（或DOM中的任何元素）。</li><li>对于父级悬停样式，需要给目标元素添加指定CSS类，同时还要给目标元素的父级元素添加CSS类<code>faa-parent animated-hover</code>。（详情见示例及示例源码）<br>You can regulate the speed of the animation by adding the CSS class or . faa-fastfaa-slow</li><li>可以通过给目标元素添加CSS类<code>faa-fast</code>或<code>faa-slow</code>来控制动画快慢。</li></ol></div></div><div class="tab-item-content" id="分栏-3"><p>   1.On DOM load（当页面加载时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>2.调整动画速度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated faa-fast %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated faa-slow %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>3.On hover（当鼠标悬停时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated-hover %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated-hover %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>4.On parent hover（当鼠标悬停在父级元素时显示动画）</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-horizontal&quot;</span>&gt;</span></span>warning<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-flash&quot;</span>&gt;</span></span>ban<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.On DOM load（当页面加载时显示动画）</p><div class="tip warning faa-horizontal animated"><p>warning</p></div><div class="tip ban faa-flash animated"><p>ban</p></div>2.调整动画速度<div class="tip warning faa-horizontal animated faa-fast"><p>warning</p></div><div class="tip ban faa-flash animated faa-slow"><p>ban</p></div>3.On hover（当鼠标悬停时显示动画）<div class="tip warning faa-horizontal animated-hover"><p>warning</p></div><div class="tip ban faa-flash animated-hover"><p>ban</p></div>4.On parent hover（当鼠标悬停在父级元素时显示动画）<div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">warning</p></div><div class="tip ban faa-parent animated-hover"><p class="faa-flash">ban</p></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-7-复选列表-checkbox"><a href="#2-7-复选列表-checkbox" class="headerlink" title="2.7 复选列表 checkbox"></a>2.7 复选列表 checkbox</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>样式</code>: plus, minus, times</li><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox 纯文本测试 %&#125;</span><br><span class="line">&#123;% checkbox checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% checkbox red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% checkbox green checked, 绿色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, 黄色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, 青色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox blue checked, 蓝色 + 默认选中 %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, 增加 %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, 减少 %&#125;</span><br><span class="line">&#123;% checkbox times red checked, 叉 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="checkbox" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="checkbox" />            <p>支持自定义颜色</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>绿色 + 默认选中</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>黄色 + 默认选中</p>            </div><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>青色 + 默认选中</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>蓝色 + 默认选中</p>            </div><div class='checkbox plus green checked'><input type="checkbox" checked="checked"/>            <p>增加</p>            </div><div class='checkbox minus yellow checked'><input type="checkbox" checked="checked"/>            <p>减少</p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>叉</p>            </div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-8-单选列表-radio"><a href="#2-8-单选列表-radio" class="headerlink" title="2.8 单选列表 radio"></a>2.8 单选列表 radio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 样式参数（可选）, 文本（支持简单md） %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>颜色</code>: red,yellow,green,cyan,blue,gray</li><li><code>选中状态</code>: checked</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio 纯文本测试 %&#125;</span><br><span class="line">&#123;% radio checked, 支持简单的 [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) 语法 %&#125;</span><br><span class="line">&#123;% radio red, 支持自定义颜色 %&#125;</span><br><span class="line">&#123;% radio green, 绿色 %&#125;</span><br><span class="line">&#123;% radio yellow, 黄色 %&#125;</span><br><span class="line">&#123;% radio cyan, 青色 %&#125;</span><br><span class="line">&#123;% radio blue, 蓝色 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><div class='checkbox'><input type="radio" />            <p>纯文本测试</p>            </div><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>支持简单的 <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> 语法</p>            </div><div class='checkbox red'><input type="radio" />            <p>支持自定义颜色</p>            </div><div class='checkbox green'><input type="radio" />            <p>绿色</p>            </div><div class='checkbox yellow'><input type="radio" />            <p>黄色</p>            </div><div class='checkbox cyan'><input type="radio" />            <p>青色</p>            </div><div class='checkbox blue'><input type="radio" />            <p>蓝色</p>            </div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-9-时间轴-timeline"><a href="#2-9-时间轴-timeline" class="headerlink" title="2.9 时间轴 timeline"></a>2.9 时间轴 timeline</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间线标题（可选）[,color] %&#125;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline 时间节点（标题） --&gt;</span><br><span class="line">正文内容</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>title</code>:标题&#x2F;时间线</li><li><code>color</code>:<code>timeline</code>颜色:default(留空) &#x2F; blue &#x2F; pink &#x2F; red &#x2F; purple &#x2F; orange &#x2F; green</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 时间轴样式,blue %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-07-24 [<span class="string">2.6.6 -&gt; 3.0</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 如果有 <span class="code">`hexo-lazyload-image`</span> 插件，需要删除并重新安装最新版本，设置 <span class="code">`lazyload.isSPA: true`</span>。</span><br><span class="line"><span class="bullet">2.</span> 2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <span class="code">`use_cdn: true`</span> 则需要删除。</span><br><span class="line"><span class="bullet">3.</span> 2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</span><br><span class="line"><span class="bullet">4.</span> 2.x 版本的置顶 <span class="code">`top: true`</span> 改为了 <span class="code">`pin: true`</span>，并且同样适用于 <span class="code">`layout: page`</span> 的页面。</span><br><span class="line"><span class="bullet">5.</span> 如果使用了 <span class="code">`hexo-offline`</span> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-05-15 [<span class="string">2.6.3 -&gt; 2.6.6</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6</span>) --&gt;</span><br><span class="line"></span><br><span class="line">不需要额外处理。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-04-20 [<span class="string">2.6.2 -&gt; 2.6.3</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 全局搜索 <span class="code">`seotitle`</span> 并替换为 <span class="code">`seo_title`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的索引规则有变，使用 group 组件的文章内，<span class="code">`group: group_name`</span> 对应的组件名必须是 <span class="code">`group_name`</span>。</span><br><span class="line"><span class="bullet">2.</span> group 组件的列表名优先显示文章的 <span class="code">`short_title`</span> 其次是 <span class="code">`title`</span>。</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>时间轴样式</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-07-24 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases">2.6.6 -&gt; 3.0</a></p></div></div><div class='timeline-item-content'><ol><li>如果有 <code>hexo-lazyload-image</code> 插件，需要删除并重新安装最新版本，设置 <code>lazyload.isSPA: true</code>。</li><li>2.x 版本的 css 和 js 不适用于 3.x 版本，如果使用了 <code>use_cdn: true</code> 则需要删除。</li><li>2.x 版本的 fancybox 标签在 3.x 版本中被重命名为 gallery 。</li><li>2.x 版本的置顶 <code>top: true</code> 改为了 <code>pin: true</code>，并且同样适用于 <code>layout: page</code> 的页面。</li><li>如果使用了 <code>hexo-offline</code> 插件，建议卸载，3.0 版本默认开启了 pjax 服务。</li></ol></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-05-15 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6">2.6.3 -&gt; 2.6.6</a></p></div></div><div class='timeline-item-content'><p>不需要额外处理。</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-04-20 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3">2.6.2 -&gt; 2.6.3</a></p></div></div><div class='timeline-item-content'><ol><li>全局搜索 <code>seotitle</code> 并替换为 <code>seo_title</code>。</li><li>group 组件的索引规则有变，使用 group 组件的文章内，<code>group: group_name</code> 对应的组件名必须是 <code>group_name</code>。</li><li>group 组件的列表名优先显示文章的 <code>short_title</code> 其次是 <code>title</code>。</li></ol></div></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-10-链接卡片-link"><a href="#2-10-链接卡片-link" class="headerlink" title="2.10 链接卡片 link"></a>2.10 链接卡片 link</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">示例源码</button><button type="button" class="tab " data-href="分栏-3">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 标题, 链接, 图片链接（可选） %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link 糖果屋教程贴, https://akilar.top/posts/615e2dec/, https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><div calss='anzhiyu-tag-link'><a class="tag-Link" target="_blank" href="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico">    <div class="tag-link-tips">引用站外地址</div>    <div class="tag-link-bottom">        <div class="tag-link-left" style="">          <i class="anzhiyufont anzhiyu-icon-link" style=""></i>        </div>        <div class="tag-link-right">            <div class="tag-link-title">糖果屋教程贴</div>            <div class="tag-link-sitename"> https://akilar.top/posts/615e2dec/</div>        </div>        <i class="anzhiyufont anzhiyu-icon-angle-right"></i>    </div>    </a></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-11-按钮-btns"><a href="#2-11-按钮-btns" class="headerlink" title="2.11 按钮 btns"></a>2.11 按钮 btns</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">参数配置</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns 样式参数 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% cell 标题, 链接, 图片或者图标 %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li>圆角样式：rounded, circle</li><li>增加文字样式：可以在容器内增加 <code>&lt;b&gt;</code>标题<code>&lt;/b&gt;</code>和<code>&lt;p&gt;</code>描述文字<code>&lt;/p&gt;</code></li><li>布局方式：<br>默认为自动宽度，适合视野内只有一两个的情况。</li></ol><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>wide</td><td>宽一点的按钮</td></tr><tr><td>fill</td><td>填充布局，自动铺满至少一行，多了会换行</td></tr><tr><td>center</td><td>居中，按钮之间是固定间距</td></tr><tr><td>around</td><td>居中分散</td></tr><tr><td>grid2</td><td>等宽最多2列，屏幕变窄会适当减少列数</td></tr><tr><td>grid3</td><td>等宽最多3列，屏幕变窄会适当减少列数</td></tr><tr><td>grid4</td><td>等宽最多4列，屏幕变窄会适当减少列数</td></tr><tr><td>grid5</td><td>等宽最多5列，屏幕变窄会适当减少列数</td></tr></tbody></table></div><div class="tab-item-content" id="分栏-3"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle grid5 %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>2.或者含有图标的按钮</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns rounded grid5 %&#125;</span><br><span class="line">&#123;% cell 下载源码, /, fas fa-download %&#125;</span><br><span class="line">&#123;% cell 查看文档, /, fas fa-book-open %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle center grid5 %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p red, 专业版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>心率管家<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p green, 免费版 %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.如果需要显示类似「团队成员」之类的一组含有头像的链接</p><div class="btns circle grid5">            <a class="button no-text-decoration" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button no-text-decoration" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button no-text-decoration" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button no-text-decoration" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button no-text-decoration" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a>          </div>2.或者含有图标的按钮<div class="btns rounded grid5">            <a class="button no-text-decoration" href='/' title='下载源码'><img src='fas fa-download'>下载源码</a><a class="button no-text-decoration" href='/' title='查看文档'><img src='fas fa-book-open'>查看文档</a>          </div>3.圆形图标 + 标题 + 描述 + 图片 + 网格5列 + 居中<div class="btns circle center grid5">            <a href='https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p red'>专业版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png'></a><a href='https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1'>  <i class='fab fa-apple'></i>  <b>心率管家</b>  <p class='p green'>免费版</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png'></a>          </div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-14-网站卡片-sites"><a href="#2-14-网站卡片-sites" class="headerlink" title="2.14 网站卡片 sites"></a>2.14 网站卡片 sites</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">示例源码</button><button type="button" class="tab " data-href="分栏-3">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% site 标题, url=链接, screenshot=截图链接, avatar=头像链接（可选）, description=描述（可选） %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site xaoxuu, url=https://xaoxuu.com, screenshot=https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg, avatar=https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png, description=简约风格 %&#125;</span><br><span class="line">&#123;% site inkss, url=https://inkss.cn, screenshot=https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg, avatar=https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site MHuiG, url=https://blog.mhuig.top, screenshot=https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png, avatar=https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Colsrch, url=https://colsrch.top, screenshot=https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png, avatar=https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% site Linhk1606, url=https://linhk1606.github.io, screenshot=https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png, avatar=https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png, description=这是一段关于这个网站的描述文字 %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><div class="site-card-group"><a class="site-card" href="https://fomalhaut1998.com" data-title=简约风格><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg"/></div><div class="info"><img class="flink-avatar" src="https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png"/><span class="site-title">fomalhaut1998</span></div></a><a class="site-card" href="https://inkss.cn" data-title=这是一段关于这个网站的描述文字><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg"/></div><div class="info"><img class="flink-avatar" src="https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg"/><span class="site-title">inkss</span></div></a><a class="site-card" href="https://blog.mhuig.top" data-title=这是一段关于这个网站的描述文字><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png"/></div><div class="info"><img class="flink-avatar" src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png"/><span class="site-title">MHuiG</span></div></a><a class="site-card" href="https://colsrch.top" data-title=这是一段关于这个网站的描述文字><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png"/></div><div class="info"><img class="flink-avatar" src="https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg"/><span class="site-title">Colsrch</span></div></a><a class="site-card" href="https://linhk1606.github.io" data-title=这是一段关于这个网站的描述文字><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png"/></div><div class="info"><img class="flink-avatar" src="https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png"/><span class="site-title">Linhk1606</span></div></a></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-15-行内图片-inlineimage"><a href="#2-15-行内图片-inlineimage" class="headerlink" title="2.15 行内图片 inlineimage"></a>2.15 行内图片 inlineimage</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">参数配置</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineimage 图片链接, height=高度（可选） %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>高度</code>：height&#x3D;20px</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif %&#125; 一段话。</span><br><span class="line"></span><br><span class="line">这又是 &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif, height=40px %&#125; 一段话。</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>这是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif" style="height:1.5em"/> 一段话。</p><p>这又是 <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif" style="height:40px;"/> 一段话。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-16-单张图片-image"><a href="#2-16-单张图片-image" class="headerlink" title="2.16 单张图片 image"></a>2.16 单张图片 image</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">参数配置</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image 链接, width=宽度（可选）, height=高度（可选）, alt=描述（可选）, bg=占位颜色（可选） %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li>图片宽度高度：width&#x3D;300px, height&#x3D;32px</li><li>图片描述：alt&#x3D;图片描述（butterfly需要在主题配置文件中开启图片描述）</li><li>占位背景色：bg&#x3D;#f2f2f2</li></ol></div><div class="tab-item-content" id="分栏-3"><p>1.添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>2.指定宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px %&#125;</span><br></pre></td></tr></table></figure><p>3.指定宽度并添加描述：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, alt=每天下课回宿舍的路，没有什么故事。 %&#125;</span><br></pre></td></tr></table></figure><p>4.设置占位背景色：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, bg=#1D0C04, alt=优化不同宽度浏览的观感 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.添加描述：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>2..指定宽度<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" style="width:400px;"/></div></div>3.指定宽度并添加描述：<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="每天下课回宿舍的路，没有什么故事。" style="width:400px;"/></div><span class="image-caption">每天下课回宿舍的路，没有什么故事。</span></div>4.设置占位背景色：<div class="img-wrap"><div class="img-bg" style="background:#1D0C04"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="优化不同宽度浏览的观感" style="width:400px;"/></div><span class="image-caption">优化不同宽度浏览的观感</span></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-17-音频-audio"><a href="#2-17-音频-audio" class="headerlink" title="2.17 音频 audio"></a>2.17 音频 audio</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">示例源码</button><button type="button" class="tab " data-href="分栏-3">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio 音频链接 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><div class="audio"><audio controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-18-视频-video"><a href="#2-18-视频-video" class="headerlink" title="2.18 视频 video"></a>2.18 视频 video</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">标签语法</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video 视频链接 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>对齐方向</code>：left, center, right</li><li><code>列数</code>：逗号后面直接写列数，支持 1 ～ 4 列。</li></ol></div><div class="tab-item-content" id="分栏-3"><p>1.100%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br></pre></td></tr></table></figure><p>2.50%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 2 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><p>3.25%宽度</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 4 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.100%宽度</p><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div>2.50%宽度<div class="videos" col='2'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div>3.25%宽度<div class="videos" col='4'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-19-相册-gallery"><a href="#2-19-相册-gallery" class="headerlink" title="2.19 相册 gallery"></a>2.19 相册 gallery</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">参数配置</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown 圖片格式</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ul><li>gallerygroup 相册图库</li></ul><table><thead><tr><th>参数名</th><th>释义</th></tr></thead><tbody><tr><td>name</td><td>图库名字</td></tr><tr><td>description</td><td>图库描述</td></tr><tr><td>link</td><td>链接到对应相册的地址</td></tr><tr><td>img-url</td><td>图库封面</td></tr></tbody></table><ul><li><p>gallery 相册</p><p>区别于旧版的Gallery相册,新的Gallery相册会自动根据图片长度进行排版，书写也更加方便，与markdown格式一样。可根据需要插入到相应的md。无需再自己配置长宽。<strong>建议在粘贴时故意使用长短、大小、横竖不一的图片</strong>，会有更好的效果。（尺寸完全相同的图片只会平铺输出，效果很糟糕）</p></li></ul></div><div class="tab-item-content" id="分栏-3"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup MC 在Rikkaの六花服务器里留下的足迹 &#x27;/gallery/MC/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg %&#125;</span><br><span class="line">&#123;% galleryGroup Gundam 哦咧哇gundam哒！ &#x27;/gallery/Gundam/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png %&#125;</span><br><span class="line">&#123;% galleryGroup I-am-Akilar 某种意义上也算自拍吧 &#x27;/gallery/I-am-Akilar/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery 相册</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.gallerygroup 相册图库</p><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">MC</div>  <p>在Rikkaの六花服务器里留下的足迹</p>  <a href='/gallery/MC/'></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Gundam</div>  <p>哦咧哇gundam哒！</p>  <a href='/gallery/Gundam/'></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">I-am-Akilar</div>  <p>某种意义上也算自拍吧</p>  <a href='/gallery/I-am-Akilar/'></a>  </figcaption>  </figure>  </div>2.gallery 相册<div class="gallery">  <div class="fj-gallery page_img_lazyload  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg","alt":""},{"url":"https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg","alt":""}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>加载更多</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-20-折叠框-folding"><a href="#2-20-折叠框-folding" class="headerlink" title="2.20 折叠框 folding"></a>2.20 折叠框 folding</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">示例源码</button><button type="button" class="tab " data-href="分栏-3">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><p>1.gallerygroup 相册图库</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 参数（可选）, 标题 %&#125;</span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><!-- tab 参数配置 --><ol><li><p><code>颜色</code>：blue, cyan, green, yellow, red</p></li><li><p><code>状态</code>：状态填写 open 代表默认打开。</p></li></ol></div><div class="tab-item-content" id="分栏-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding 查看图片测试 %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, 查看默认打开的折叠框 %&#125;</span><br><span class="line"></span><br><span class="line">这是一个默认打开的折叠框。</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, 查看代码测试 %&#125;</span><br><span class="line">假装这里有代码块（代码块没法嵌套代码块）</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, 查看列表测试 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, 查看嵌套测试 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, 查看嵌套测试2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding 查看嵌套测试3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-3"><details class="folding-tag" ><summary> 查看图片测试 </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"></p>              </div>            </details><details class="folding-tag" cyan open><summary> 查看默认打开的折叠框 </summary>              <div class='content'>              <p>这是一个默认打开的折叠框。</p>              </div>            </details><details class="folding-tag" green><summary> 查看代码测试 </summary>              <div class='content'>              <p>假装这里有代码块（代码块没法嵌套代码块）</p>              </div>            </details><details class="folding-tag" yellow><summary> 查看列表测试 </summary>              <div class='content'>              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> 查看嵌套测试 </summary>              <div class='content'>              <details class="folding-tag" blue><summary> 查看嵌套测试2 </summary>              <div class='content'>              <details class="folding-tag" ><summary> 查看嵌套测试3 </summary>              <div class='content'>              <p>hahaha <span><img src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png' style='height:24px'></span></p>              </div>            </details>              </div>            </details>              </div>            </details></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-21-分栏-tab"><a href="#2-21-分栏-tab" class="headerlink" title="2.21 分栏 tab"></a>2.21 分栏 tab</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">配置参数</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><p>Unique name :</p><ul><li><p>选项卡块标签的唯一名称，不带逗号。</p></li><li><p>将在#id中用作每个标签及其索引号的前缀。</p></li><li><p>如果名称中包含空格，则对于生成#id，所有空格将由破折号代替。</p></li><li><p>仅当前帖子&#x2F;页面的URL必须是唯一的！</p></li></ul></li><li><p>[index]:</p><ul><li><p>活动选项卡的索引号。</p></li><li><p>如果未指定，将选择第一个标签（1）。</p></li><li><p>如果index为-1，则不会选择任何选项卡。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[Tab caption]:</p><ul><li><p>当前选项卡的标题。</p></li><li><p>如果未指定标题，则带有制表符索引后缀的唯一名称将用作制表符的标题。</p></li><li><p>如果未指定标题，但指定了图标，则标题将为空。</p></li><li><p>可选参数。</p></li></ul></li><li><p>[@icon]:</p><ul><li><p>FontAwesome图标名称（全名，看起来像“ fas fa-font”）</p></li><li><p>可以指定带空格或不带空格；</p></li><li><p>例如’Tab caption @icon’ 和 ‘Tab caption@icon’.</p></li><li><p>可选参数。</p></li></ul></li></ol></div><div class="tab-item-content" id="分栏-3"><p>1.Demo 1 - 预设选择第一个【默认】</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>2.Demo 2 - 预设选择tabs</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test2, 3 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>3.Demo 3 - 没有预设值</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test3, -1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line">&lt;!-- tab 第一个Tab --&gt;</span><br><span class="line"><span class="strong">**tab名字为第一个Tab**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt;</span><br><span class="line"><span class="strong">**只有图标 没有Tab名字**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab 炸弹@fas fa-bomb --&gt;</span><br><span class="line"><span class="strong">**名字+icon**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p>1.Demo 1 - 预设选择第一个【默认】</p><div class="tabs" id="test1"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="test1-1">test1 1</button><button type="button" class="tab " data-href="test1-2">test1 2</button><button type="button" class="tab " data-href="test1-3">test1 3</button></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><p>2.Demo 2 - 预设选择tabs</p><div class="tabs" id="test2"><ul class="nav-tabs"><button type="button" class="tab " data-href="test2-1">test2 1</button><button type="button" class="tab " data-href="test2-2">test2 2</button><button type="button" class="tab  active" data-href="test2-3">test2 3</button></ul><div class="tab-contents"><div class="tab-item-content" id="test2-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test2-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content active" id="test2-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><p>3.Demo 3 - 没有预设值</p><div class="tabs" id="test3"><ul class="nav-tabs no-default"><button type="button" class="tab " data-href="test3-1">test3 1</button><button type="button" class="tab " data-href="test3-2">test3 2</button><button type="button" class="tab " data-href="test3-3">test3 3</button></ul><div class="tab-contents"><div class="tab-item-content" id="test3-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test3-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content" id="test3-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><p>4.Demo 4 - 自定义Tab名 + 只有icon + icon和Tab名</p><div class="tabs" id="test4"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="test4-1">第一个Tab</button><button type="button" class="tab " data-href="test4-2"><i class="fab fa-apple-pay" style="text-align: center;"></i></button><button type="button" class="tab " data-href="test4-3"><i class="fas fa-bomb"></i>炸弹</button></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p><strong>tab名字为第一个Tab</strong></p></div><div class="tab-item-content" id="test4-2"><p><strong>只有图标 没有Tab名字</strong></p></div><div class="tab-item-content" id="test4-3"><p><strong>名字+icon</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="2-23-阿里图标-icon"><a href="#2-23-阿里图标-icon" class="headerlink" title="2.23 阿里图标 icon"></a>2.23 阿里图标 icon</h2><div class="tabs" id="分栏"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分栏-1">标签语法</button><button type="button" class="tab " data-href="分栏-2">参数配置</button><button type="button" class="tab " data-href="分栏-3">示例源码</button><button type="button" class="tab " data-href="分栏-4">渲染演示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分栏-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon [icon-xxxx],[font-size] %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-2"><ol><li><code>icon-xxxx</code>：表示图标<code>font-class</code>,可以在自己的阿里矢量图标库项目的<code>font-class</code>引用方案内查询并复制。</li><li><code>font-size</code>：表示图标大小，直接填写数字即可，单位为<code>em</code>。图标大小默认值为<code>1em</code>。</li></ol></div><div class="tab-item-content" id="分栏-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon icon-rat<span class="emphasis">_zi %&#125;&#123;% icon icon-rat,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-ox_</span>chou,3 %&#125;&#123;% icon icon-ox,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-tiger<span class="emphasis">_yin,5 %&#125;&#123;% icon icon-tiger,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rabbit_</span>mao,1 %&#125;&#123;% icon icon-rabbit,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dragon<span class="emphasis">_chen,3 %&#125;&#123;% icon icon-dragon,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-snake_</span>si,5 %&#125;&#123;% icon icon-snake,6 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-horse<span class="emphasis">_wu %&#125;&#123;% icon icon-horse,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-goat_</span>wei,3 %&#125;&#123;% icon icon-goat,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-monkey<span class="emphasis">_shen,5 %&#125;&#123;% icon icon-monkey,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rooster_</span>you %&#125;&#123;% icon icon-rooster,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dog<span class="emphasis">_xu,3 %&#125;&#123;% icon icon-dog,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-boar_</span>hai,5 %&#125;&#123;% icon icon-boar,6 %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="分栏-4"><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rat_zi"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rat"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-ox_chou"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-ox"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-tiger_yin"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-tiger"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rabbit_mao"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rabbit"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dragon_chen"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dragon"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-snake_si"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-snake"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-horse_wu"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-horse"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-goat_wei"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-goat"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-monkey_shen"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-monkey"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rooster_you"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rooster"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dog_xu"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dog"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-boar_hai"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-boar"></use></svg></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>]]></content>
      
      
      <categories>
          
          <category> 演示 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 外挂标签 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>相册</title>
      <link href="/album/index.html"/>
      <url>/album/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>我的装备</title>
      <link href="/equipment/index.html"/>
      <url>/equipment/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>日常生活</title>
      <link href="/dailyPhoto/index.html"/>
      <url>/dailyPhoto/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>关于本人</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/json/music.json"/>
      <url>/json/music.json</url>
      
        <content type="html"><![CDATA[[{"name":"青花瓷","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/青花瓷/青花瓷.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002eFUFm2XYZ7z_2.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/青花瓷/青花瓷.lrc"},{"name":"稻香","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/稻香/稻香.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/稻香/稻香.lrc"},{"name":"晴天","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/晴天/晴天.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/晴天/晴天.lrc"},{"name":"七里香","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/七里香/七里香.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/七里香/七里香.lrc"},{"name":"花海","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/花海/花海.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/花海/花海.lrc"},{"name":"反方向的钟","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/反方向的钟/反方向的钟.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/反方向的钟/反方向的钟.lrc"},{"name":"兰亭序","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/兰亭序/兰亭序.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/兰亭序/兰亭序.lrc"},{"name":"说好的辛福呢","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/说好的辛福呢/说好的辛福呢.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002Neh8l0uciQZ_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/说好的辛福呢/说好的幸福呢.lrc"},{"name":"等你下课 (with 杨瑞代)","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/等你下课/等你下课.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003bSL0v4bpKAx_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.1/周杰伦/等你下课/等你下课.lrc"},{"name":"我落泪情绪零碎","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/我落泪情绪零碎/我落泪情绪零碎.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000bviBl4FjTpO_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/我落泪情绪零碎/我落泪情绪零碎.lrc"},{"name":"听妈妈的话","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/听妈妈的话/听妈妈的话.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.2/听妈妈的话/听妈妈的话.lrc"},{"name":"明明就","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/明明就/明明就.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003Ow85E3pnoqi_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/明明就/明明就.lrc"},{"name":"我是如此相信","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/我是如此相信/我是如此相信.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000001hGx1Z0so1YX_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music-jay@1.0.1/我是如此相信/我是如此相信.lrc"},{"name":"发如雪","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/发如雪/发如雪.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M0000024bjiL2aocxT_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/发如雪/发如雪.lrc"},{"name":"以父之名","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/以父之名/以父之名.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000MkMni19ClKG_3.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/以父之名/以父之名.lrc"},{"name":"园游会","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/园游会/园游会.flac","cover":"https://y.qq.com/music/photo_new/T002R300x300M000003DFRzD192KKD_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.3/园游会/园游会.lrc"},{"name":"本草纲目","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/本草纲目/本草纲目.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000002jLGWe16Tf1H_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/本草纲目/本草纲目.lrc"},{"name":"龙卷风","artist":"周杰伦","url":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/龙卷风/龙卷风.mp3","cover":"https://y.qq.com/music/photo_new/T002R300x300M000000f01724fd7TH_1.jpg?max_age=2592000","lrc":"https://npm.elemecdn.com/anzhiyu-music@1.0.4/龙卷风/龙卷风.lrc"}]]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>闲言碎语</title>
      <link href="/essay/index.html"/>
      <url>/essay/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>朋友圈</title>
      <link href="/fcircle/index.html"/>
      <url>/fcircle/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>友人帐</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>世界各地风景</title>
      <link href="/wordScenery/index.html"/>
      <url>/wordScenery/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>音乐馆</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>标签</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
